<!DOCTYPE html><html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Load_path.html">
<link rel="next" href="Misc.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel="Appendix" href="index_types.html">
<link title="Index of extensions" rel="Appendix" href="index_extensions.html">
<link title="Index of exceptions" rel="Appendix" href="index_exceptions.html">
<link title="Index of values" rel="Appendix" href="index_values.html">
<link title="Index of modules" rel="Appendix" href="index_modules.html">
<link title="Index of module types" rel="Appendix" href="index_module_types.html">
<link title="Compiler_libs" rel="Chapter" href="Compiler_libs.html">
<link title="Ast_helper" rel="Chapter" href="Ast_helper.html">
<link title="Ast_invariants" rel="Chapter" href="Ast_invariants.html">
<link title="Ast_iterator" rel="Chapter" href="Ast_iterator.html">
<link title="Ast_mapper" rel="Chapter" href="Ast_mapper.html">
<link title="Asttypes" rel="Chapter" href="Asttypes.html">
<link title="Attr_helper" rel="Chapter" href="Attr_helper.html">
<link title="Builtin_attributes" rel="Chapter" href="Builtin_attributes.html">
<link title="CamlinternalMenhirLib" rel="Chapter" href="CamlinternalMenhirLib.html">
<link title="Depend" rel="Chapter" href="Depend.html">
<link title="Docstrings" rel="Chapter" href="Docstrings.html">
<link title="Lexer" rel="Chapter" href="Lexer.html">
<link title="Location" rel="Chapter" href="Location.html">
<link title="Longident" rel="Chapter" href="Longident.html">
<link title="Parse" rel="Chapter" href="Parse.html">
<link title="Parser" rel="Chapter" href="Parser.html">
<link title="Parsetree" rel="Chapter" href="Parsetree.html">
<link title="Pprintast" rel="Chapter" href="Pprintast.html">
<link title="Printast" rel="Chapter" href="Printast.html">
<link title="Syntaxerr" rel="Chapter" href="Syntaxerr.html">
<link title="Arg_helper" rel="Chapter" href="Arg_helper.html">
<link title="Binutils" rel="Chapter" href="Binutils.html">
<link title="Build_path_prefix_map" rel="Chapter" href="Build_path_prefix_map.html">
<link title="Ccomp" rel="Chapter" href="Ccomp.html">
<link title="Clflags" rel="Chapter" href="Clflags.html">
<link title="Config_boot" rel="Chapter" href="Config_boot.html">
<link title="Config_main" rel="Chapter" href="Config_main.html">
<link title="Config" rel="Chapter" href="Config.html">
<link title="Consistbl" rel="Chapter" href="Consistbl.html">
<link title="Diffing" rel="Chapter" href="Diffing.html">
<link title="Diffing_with_keys" rel="Chapter" href="Diffing_with_keys.html">
<link title="Domainstate" rel="Chapter" href="Domainstate.html">
<link title="Identifiable" rel="Chapter" href="Identifiable.html">
<link title="Int_replace_polymorphic_compare" rel="Chapter" href="Int_replace_polymorphic_compare.html">
<link title="Lazy_backtrack" rel="Chapter" href="Lazy_backtrack.html">
<link title="Load_path" rel="Chapter" href="Load_path.html">
<link title="Local_store" rel="Chapter" href="Local_store.html">
<link title="Misc" rel="Chapter" href="Misc.html">
<link title="Numbers" rel="Chapter" href="Numbers.html">
<link title="Profile" rel="Chapter" href="Profile.html">
<link title="Strongly_connected_components" rel="Chapter" href="Strongly_connected_components.html">
<link title="Targetint" rel="Chapter" href="Targetint.html">
<link title="Terminfo" rel="Chapter" href="Terminfo.html">
<link title="Warnings" rel="Chapter" href="Warnings.html">
<link title="Pparse" rel="Chapter" href="Pparse.html"><link title="Creators" rel="Section" href="#1_Creators">
<link title="State management" rel="Section" href="#1_Statemanagement">
<title>OCaml compiler library : Local_store</title>
<script src="search.js"></script><script src="scroll.js"></script><script src="navigation.js"></script><link rel="shortcut icon" type="image/x-icon" href="favicon.ico"></head>
<body><div class="api"><div id="sidebar-button"><span>â˜°</span></div><header id="sidebar"><nav class="toc brand"><a class="brand" href="../../manual/index.html"><img src="colour-logo.svg" class="svg" alt="OCaml"></a></nav><nav class="toc"><div class="toc_version"><a id="version-select" href="https://ocaml.org/releases/">Compiler API Version 5.1</a></div><a href="index.html">&lt; General Index</a><div class="api_search"><input type="text" name="apisearch" id="api_search" class="api_search" oninput="mySearch(false);" onkeypress="this.oninput();" onclick="this.oninput();" onpaste="this.oninput();">
<img src="search_icon.svg" alt="Search" class="api_search svg" onclick="mySearch(false)"></div>
<div id="search_results"></div><div class="toc_title"><a href="#top">OCaml compiler library : Local_store</a></div><ul><li><a href="#1_Creators">Creators</a></li><li><a href="#1_Statemanagement">State management</a></li></ul></nav></header>
<h1>Module <a href="type_Local_store.html">Local_store</a></h1>

<pre><span id="MODULELocal_store"><span class="keyword">module</span> Local_store</span>: <code class="code"><span class="keyword">sig</span></code> <a href="Local_store.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
<div class="info-desc">
<p>This module provides some facilities for creating references (and hash
    tables) which can easily be snapshoted and restored to an arbitrary version.</p>

<p>It is used throughout the frontend (read: typechecker), to register all
    (well, hopefully) the global state. Thus making it easy for tools like
    Merlin to go back and forth typechecking different files.</p>
</div>
</div>
<hr width="100%">
<h2 id="1_Creators">Creators</h2>
<pre><span id="VALs_ref"><span class="keyword">val</span> s_ref</span> : <code class="type">'a -&gt; 'a ref</code></pre><div class="info ">
<div class="info-desc">
<p>Similar to <code class="code"><span class="constructor">Stdlib</span>.ref</code>, except the allocated reference is registered
    into the store.</p>
</div>
</div>

<pre><span id="VALs_table"><span class="keyword">val</span> s_table</span> : <code class="type">('a -&gt; 'b) -&gt; 'a -&gt; 'b ref</code></pre><div class="info ">
<div class="info-desc">
<p>Used to register hash tables. Those also need to be placed into refs to be
    easily swapped out, but one can't just "snapshot" the initial value to
    create fresh instances, so instead an initializer is required.</p>

<p>Use it like this:</p>
<pre class="codepre"><code class="code">      <span class="keyword">let</span> my_table = s_table <span class="constructor">Hashtbl</span>.create 42
    </code></pre></div>
</div>
<h2 id="1_Statemanagement">State management</h2>
<p>Note: all the following functions are currently unused inside the compiler
    codebase. Merlin is their only user at the moment.</p>

<pre><span id="TYPEstore"><span class="keyword">type</span> <code class="type"></code>store</span> </pre>


<pre><span id="VALfresh"><span class="keyword">val</span> fresh</span> : <code class="type">unit -&gt; <a href="Local_store.html#TYPEstore">store</a></code></pre><div class="info ">
<div class="info-desc">
<p>Returns a fresh instance of the store.</p>

<p>The first time this function is called, it snapshots the value of all the
    registered references, later calls to <code class="code">fresh</code> will return instances
    initialized to those values.</p>
</div>
</div>

<pre><span id="VALwith_store"><span class="keyword">val</span> with_store</span> : <code class="type"><a href="Local_store.html#TYPEstore">store</a> -&gt; (unit -&gt; 'a) -&gt; 'a</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">with_store&nbsp;s&nbsp;f</code> resets all the registered references to the value they have
    in <code class="code">s</code> for the run of <code class="code">f</code>.
    If <code class="code">f</code> updates any of the registered refs, <code class="code">s</code> is updated to remember those
    changes.</p>
</div>
</div>

<pre><span id="VALreset"><span class="keyword">val</span> reset</span> : <code class="type">unit -&gt; unit</code></pre><div class="info ">
<div class="info-desc">
<p>Resets all the references to the initial snapshot (i.e. to the same values
    that new instances start with).</p>
</div>
</div>

<pre><span id="VALis_bound"><span class="keyword">val</span> is_bound</span> : <code class="type">unit -&gt; bool</code></pre><div class="info ">
<div class="info-desc">
<p>Returns <code class="code"><span class="keyword">true</span></code> when a store is active (i.e. when called from the callback
    passed to <a href="Local_store.html#VALwith_store"><code class="code"><span class="constructor">Local_store</span>.with_store</code></a>), <code class="code"><span class="keyword">false</span></code> otherwise.</p>
</div>
</div>

</div></body></html>