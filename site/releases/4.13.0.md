<!-- ((! set title OCaml 4.13.0 !)) -->

# OCaml 4.13.0
This page describes OCaml version **4.13.0**, released on
2021-09-24.  Go [here](./) for a list of all releases.

This release is available as an
[OPAM](https://opam.ocaml.org/doc/Usage.html) switch.

What's new
----------
Some of the highlights in OCaml 4.13.0 are:

- Safe points: a multicore prerequisite that ensures that ocamlopt-generated code can always be interrupted.
- The best-fit GC allocation policy is the now default policy (and many other GCs   improvements.
- Named existential type variables in pattern matching  `Showable (type a) (x, show : a * (a -> string))`.
- Improved error messages for functor application and functor types.
- Let-punning for monadic let: `let* x = x in` can be shortened to `let* x in`.
- Module type substitutions `SIG with module type T = F(X).S`.
- Many other quality of life improvements
- Many bug fixes 

For a comprehensive list of changes and details on all new features,
bug fixes, optimizations, etc., please consult the
[changelog](#Changes).

Configuration options
---------------------

The configuration of the installed opam switch can be tuned with the
following options:

- ocaml-option-32bit: set OCaml to be compiled in 32-bit mode for 64-bit Linux and OS X hosts
- ocaml-option-afl: set OCaml to be compiled with afl-fuzz instrumentation
- ocaml-option-bytecode-only: compile OCaml without the native-code compiler
- ocaml-option-default-unsafe-string: set OCaml to be compiled without safe strings by default
- ocaml-option-flambda: set OCaml to be compiled with flambda activated
- ocaml-option-fp: set OCaml to be compiled with frame-pointers enabled
- ocaml-option-musl: set OCaml to be compiled with musl-gcc
- ocaml-option-nnp : set OCaml to be compiled with --disable-naked-pointers
- ocaml-option-nnpchecker: set OCaml to be compiled with --enable-naked-pointers-checker
- ocaml-option-no-flat-float-array: set OCaml to be compiled with --disable-flat-float-array
- ocaml-option-static :set OCaml to be compiled with musl-gcc -static

For instance, one can install a switch with both `flambda` and the naked-pointer checker enabled with

```
opam switch create 4.13.0+flambda+nnpchecker --package=ocaml-variants.4.13.0+options,ocaml-option-flambda,ocaml-option-nnpchecker
```

or with opam 2.1:

```
opam switch create 4.13.0+flambda+nnpchecker ocaml-variants.4.13.0+options ocaml-option-flambda ocaml-option-nnpchecker
```


![](../img/source.gif "") Source distribution
---------------------------------------------

- [Source
  tarball](https://github.com/ocaml/ocaml/archive/4.13.0.tar.gz)
  (.tar.gz) for compilation under Unix (including Linux and MacOS X)
  and Microsoft Windows (including Cygwin).
- Also available in
  [.zip](https://github.com/ocaml/ocaml/archive/4.13.0.zip)
  format.
- [OPAM](https://opam.ocaml.org/) is a source-based distribution of
  OCaml and many companion libraries and tools. Compilation and
  installation are automated by powerful package managers.
- The official development repo is hosted on
  [GitHub](https://github.com/ocaml/ocaml).

The
[INSTALL](4.13/notes/INSTALL.adoc) file
of the distribution provides detailed compilation and installation
instructions — see also the [Windows release
notes](4.13/notes/README.win32.adoc) for
instructions on how to build under Windows.

Alternative Compilers
---------------------

Additionally, the following projects allow you to compile OCaml code to
targets traditionally associated with other languages:

* [Js_of_ocaml](http://ocsigen.org/js_of_ocaml/) is a stable OCaml
  to JavaScript compiler.

![](../img/doc.gif "") User's manual
------------------------------------

The user's manual for OCaml can be:

- [browsed
  online](4.13/manual/index.html),
- downloaded as a single
  [PDF](4.13/ocaml-4.13-refman.pdf),
  or [plain
  text](4.13/ocaml-4.13-refman.txt)
  document,
- downloaded as a single
  [TAR](4.13/ocaml-4.13-refman-html.tar.gz)
  or
  [ZIP](4.13/ocaml-4.13-refman-html.zip)
  archive of HTML files,
- downloaded as a single
  [tarball](4.13/ocaml-4.13-refman.info.tar.gz)
  of Emacs info files,



Changes
-------

This is the
[changelog](4.13/notes/Changes).
(Changes that can break existing programs are marked with a  "breaking change" warning)

### Language features:

- [#10039](https://github.com/ocaml/ocaml/issues/10039): Safepoints
  Add poll points to native generated code. These are effectively
  zero-sized allocations and fix some signal and remembered set
  issues. Also multicore prerequisite.
  (Sadiq Jaffer, Stephen Dolan, Damien Doligez, Xavier Leroy,
   Anmol Sahoo, Mark Shinwell, review by Damien Doligez, Xavier Leroy,
   and Mark Shinwell)

- [#9584](https://github.com/ocaml/ocaml/issues/9584), [#7074](https://github.com/ocaml/ocaml/issues/7074): Allow to name existentials in pattern-matching
  One can now write '(Cstr (type a) (x, y : int * a))' to give a name to
  existentials freshly introduced by GADT constructors.
  (Jacques Garrigue, review by Leo White and Gabriel Scherer)

- [#9331](https://github.com/ocaml/ocaml/issues/9331): Improve error messages for functor application and functor types.
  (Florian Angeletti and Gabriel Radanne, review by Leo White)

- [#10013](https://github.com/ocaml/ocaml/issues/10013): Let-punning
  Allow 'let* x in ...' and 'let%ext x in ...' as shorthand for
    'let* x = x in ...' and 'let%ext x = x in ...' respectively.
  (Stephen Dolan, review by Gabriel Scherer)

- [#10133](https://github.com/ocaml/ocaml/issues/10133): module type substitutions
  Allow 'SIG with module type T = F(X).S', 'SIG with module type T := sig end'
  and their local equivalent `module type T := sig type u end`
  (Florian Angeletti, review by Gabriel Radanne and Leo White)

* [*breaking change*] [#10081](https://github.com/ocaml/ocaml/issues/10081): Typecheck `x |> f` and `f @@ x` as `(f x)`
  (Alain Frisch, review by Jacques Garrigue, Josh Berdine and Thomas Refis)

### Runtime system:

- [#9284](https://github.com/ocaml/ocaml/issues/9284): Add -config option to display the configuration of ocamlrun on stdout,
  including the search path for shared stub libraries.
  (David Allsopp, review by Xavier Leroy)

- [#9934](https://github.com/ocaml/ocaml/issues/9934): Optimise sweeping using prefetching.
  (Stephen Dolan and Will Hasenplaugh, review by David Allsopp, Xavier
   Leroy and Damien Doligez, benchmarking by Shubham Kumar and KC
   Sivaramakrishnan)

- [#9919](https://github.com/ocaml/ocaml/issues/9919): Introduce caml_record_backtraces and update Interfacing with C to
  refer to it (previous instruction to use caml_record_backtrace primitive was
  not possible without defining CAML_INTERNALS)

- [#10102](https://github.com/ocaml/ocaml/issues/10102): Ignore PROFINFO_WIDTH if WITH_PROFINFO is not defined (technically
  a breaking change if the configuration system was being abused before).
  (David Allsopp, review by Xavier Leroy)

- [#10107](https://github.com/ocaml/ocaml/issues/10107): Ensure modules compiled with -afl-instrument can still link on
  platforms without AFL support.
  (David Allsopp, review by Xavier Leroy)

* [*breaking change*] [#10098](https://github.com/ocaml/ocaml/issues/10098): Improve command-line parsing in ocamlrun: strictly recognise options,
  be more informative for `ocamlrun -I` and support `--` for terminating options
  parsing.
  (David Allsopp, review by Xavier Leroy)

- [#10101](https://github.com/ocaml/ocaml/issues/10101): Add -help/--help option to ocamlrun.
  (David Allsopp, review by Xavier Leroy)

- [#10136](https://github.com/ocaml/ocaml/issues/10136): Minor clean-ups in runtime/io.c and runtime/caml/io.h
  (Xavier Leroy, review by David Allsopp and Guillaume Munch-Maccagnoni)

- [#10171](https://github.com/ocaml/ocaml/issues/10171): Tweak the naked pointers checker so that processes which trigger the
  alarm always exit with non-zero status (i.e. exit(0) becomes exit(70)).
  (David Allsopp, review by Xavier Leroy)

- [#10188](https://github.com/ocaml/ocaml/issues/10188), [#10213](https://github.com/ocaml/ocaml/issues/10213): Switch the default allocation policy to best-fit and adjust
  the default overhead parameter accordingly.
  (Damien Doligez, review by Josh Berdine and Xavier Leroy)

- [#10212](https://github.com/ocaml/ocaml/issues/10212): Simplify and improve the Windows-specific code that connects
  to the debugger via a socket.
  (Antonin Décimo, review by Xavier Leroy)

- [#10217](https://github.com/ocaml/ocaml/issues/10217): Fix a segfault in a corner case of compaction (reported in [#9853](https://github.com/ocaml/ocaml/issues/9853))
  (Damien Doligez, report by Sadiq Jaffer, review by Stephen Dolan)

- [#10250](https://github.com/ocaml/ocaml/issues/10250), [#10266](https://github.com/ocaml/ocaml/issues/10266): Dynamically allocate alternate signal stacks to
   accommodate changes in Glibc 2.34.
  (Xavier Leroy, reports by Tomasz Kłoczko and R.W.M. Jones, review by Anil
   Madhavapeddy, Stephen Dolan, and Florian Angeletti)

- [#10318](https://github.com/ocaml/ocaml/issues/10318): Windows Unicode runtime functions are no longer marked as
  experimental.
  (Nicolás Ojeda Bär, review by David Allsopp)

- [#10194](https://github.com/ocaml/ocaml/issues/10194): Change compaction-triggering heuristic: use the overhead measured
  by the previous GC cycle instead of an indirect (and noisy) computation
  of the current overhead.
  (Damien Doligez, review by Stephen Dolan)

- [#10549](https://github.com/ocaml/ocaml/issues/10549): Stack overflow detection and naked pointers checking for ARM64
  (Xavier Leroy, review by Stephen Dolan)

### Code generation and optimizations:

- [#1400](https://github.com/ocaml/ocaml/issues/1400): Add an optional invariants check on Cmm, which can be activated
  with the -dcmm-invariants flag
  (Vincent Laviron, with help from Sebastien Hinderer, review by Stephen Dolan
   and David Allsopp)

- [#9562](https://github.com/ocaml/ocaml/issues/9562), [#367](https://github.com/ocaml/ocaml/issues/367): Allow CSE of immutable loads across stores
  (Stephen Dolan, review by Mark Shinwell)

- [#9876](https://github.com/ocaml/ocaml/issues/9876): do not cache the young_limit GC variable in a processor register.
  This affects the ARM64, PowerPC and RISC-V ports, making signal handling
  and minor GC triggers more reliable, at the cost of a small slowdown.
  (Xavier Leroy, review by Nicolás Ojeda Bär)

- [#9937](https://github.com/ocaml/ocaml/issues/9937): improvements in ARM64 code generation (constants, sign extensions)
  (Xavier Leroy, review by Stephen Dolan)

- [#10228](https://github.com/ocaml/ocaml/issues/10228): Better code-generation for inlined comparisons
  (Stephen Dolan, review by Alain Frisch and Xavier Leroy)

- [#10244](https://github.com/ocaml/ocaml/issues/10244): Optimise Int32.unsigned_to_int
  (Fabian Hemmer, review by Stephen Dolan and Xavier Leroy)

- [#10302](https://github.com/ocaml/ocaml/issues/10302), [#10303](https://github.com/ocaml/ocaml/issues/10303): Fix incorrect instruction selection for string constant loads
  on ppc.
  (David Allsopp, review by Stephen Dolan)

- [#10349](https://github.com/ocaml/ocaml/issues/10349): Fix destroyed_at_c_call on RISC-V
  (Mark Shinwell, review by Nicolás Ojeda Bär)

- [#10404](https://github.com/ocaml/ocaml/issues/10404): Add a generic backward dataflow analyzer and use it to speed up
  liveness analysis
  (Xavier Leroy, review by Gabriel Scherer, Greta Yorsh, Mark Shinwell)

- [#10414](https://github.com/ocaml/ocaml/issues/10414): Avoid compilation times exponential in the nesting of loops
  in the spilling and reloading passes
  (Xavier Leroy, review by Vincent Laviron)

- [#10419](https://github.com/ocaml/ocaml/issues/10419): Add %frame_pointers primitive which is true only in native code with
  frame pointers mode enabled.
  (David Allsopp, review by Vincent Laviron and Mark Shinwell)

### Standard library:

- [#944](https://github.com/ocaml/ocaml/issues/944): Add some missing C99 float operations.  `Stdlib` now contains
  the inverse hyperbolic functions `acosh`, `asinh`, and `atanh`.  These
  functions were also added to module `Stdlib.Float` together with `exp2`,
  `log2`, `cbrt`, `erf`, and `erfc`. Full support on MSVC requires VS2013+ but
  emulated versions are still available (for now) for older compilers.
  (Markus Mottl, review by David Allsopp, Olivier Andrieu, Florian Angeletti,
  Nicolás Ojeda Bär, Daniel Bünzli, Fabian @copy, Pascal Cuoq, Damien
  Doligez, Sébastien Hinderer, Jacques-Henri Jourdan, Xavier Leroy, Guillaume
  Melquiond, Perry E. Metzger, @objmagic, Gabriel Scherer, Mark Shinwell,
  Bernhard Schommer and Christophe Troestler)

- [#9448](https://github.com/ocaml/ocaml/issues/9448): Add String.{empty,cat} as dual of Bytes.{empty,cat},
  String.{of,to}_bytes as aliases of Bytes.{to,of}_string,
  Bytes.split_on_char as dual of String.split_on_char, and binary decoding
  functions in String to match those in Bytes.
  (David Allsopp, review by Damien Doligez, Gabriel Scherer and others)

- [#9487](https://github.com/ocaml/ocaml/issues/9487), [#9489](https://github.com/ocaml/ocaml/issues/9489): Add Random.full_int which allows 62-bit bounds on 64-bit
  systems.
  (David Allsopp, request by Francois Berenger, review by Xavier Leroy and
   Damien Doligez)

- [#9533](https://github.com/ocaml/ocaml/issues/9533): Added String.starts_with and String.ends_with.
  (Bernhard Schommer, review by Daniel Bünzli, Gabriel Scherer and
  Alain Frisch)

- [#9582](https://github.com/ocaml/ocaml/issues/9582): Add Array.{find_opt,find_map,split,combine}.
  (Nicolás Ojeda Bär, review by Daniel Bünzli and Gabriel Scherer)

- [#9961](https://github.com/ocaml/ocaml/issues/9961): Add Array.fold_left_map.
  (Craig Ferguson, review by Damien Doligez)

- [#10097](https://github.com/ocaml/ocaml/issues/10097): Lazy.map, Lazy.map_val: ('a -> 'b) -> 'a Lazy.t -> 'b Lazy.t
  (map f x) is always (lazy (f (force x))), whereas (map_val f x)
  applies f directly if x is already forced.
  (Gabriel Scherer, review by Nicolás Ojeda Bär, Alain Frisch, Xavier Leroy,
   Daniel Bünzli and Stephen Dolan)

* [*breaking change*] [#10169](https://github.com/ocaml/ocaml/issues/10169), [#10270](https://github.com/ocaml/ocaml/issues/10270), [#10301](https://github.com/ocaml/ocaml/issues/10301), [#10451](https://github.com/ocaml/ocaml/issues/10451): Use capitalized module names in the Standard
  Library prefixing scheme to match Dune, e.g. Stdlib__String instead of
  Stdlib__string. This is a breaking change only to code which attempted to use
  the internal names before. The Standard Library generated by the Dune rules is
  now equivalent to the main build (the Dune rules still do not generate a
  distributable compiler).
  (David Allsopp and Mark Shinwell, review by Gabriel Scherer)

- [#10242](https://github.com/ocaml/ocaml/issues/10242): Added convenience pretty printer for Either.t in the Format module.
  (Oghenevwogaga Ebresafe, review by Nicolás Ojeda Bär,
  Gabriel Scherer and Xavier Van de Woestyne)

- [#10352](https://github.com/ocaml/ocaml/issues/10352): Seq.(concat : 'a t t -> 'a t)
  Seq.concat_map as an alias to Seq.flat_map,
  (Gabriel Scherer, review by Ulugbek Abdullaev and Daniel Bünzli
   and Nicolás Ojeda Bär and Florian Angeletti)

- [#882](https://github.com/ocaml/ocaml/issues/882): Add fold_left, fold_right, exists and for_all to String/Bytes
  (Yotam Barnoy, review by Alain Frisch and Jeremy Yallop)

- [#4070](https://github.com/ocaml/ocaml/issues/4070), [#10398](https://github.com/ocaml/ocaml/issues/10398): small optimization of Stdlib.{frexp,modf}.
  (Markus Mottl, Nicolás Ojeda Bär, review by Gabriel Scherer)

- [#10389](https://github.com/ocaml/ocaml/issues/10389), [#10391](https://github.com/ocaml/ocaml/issues/10391), [#10392](https://github.com/ocaml/ocaml/issues/10392): Add {Int,Int32,Int64,Nativeint}.{min,max}.
  (Nicolás Ojeda Bär and Alain Frisch, review by Xavier Leroy)

- [#10430](https://github.com/ocaml/ocaml/issues/10430): Add Format.print_bytes and Format.pp_print_bytes.
  (Gabriel Radanne, review by Gabriel Scherer and David Allsopp)

### Other libraries:

- [#10047](https://github.com/ocaml/ocaml/issues/10047): Add `Unix.realpath`
  (Daniel Bünzli, review by David Allsopp, Josh Berdine and Gabriel Scherer)

* [*breaking change*] [#10084](https://github.com/ocaml/ocaml/issues/10084): Unix.open_process_args* functions now look up the program in the PATH.
  This was already the case under Windows, but this is now also done under
  Unix. Note that previously the program was interpreted relative to the current
  directory.
  (Nicolás Ojeda Bär, review by Gabriel Scherer and Xavier Leroy)

- [#10184](https://github.com/ocaml/ocaml/issues/10184): Remove expensive debug assertion from dynlink.
  (Leo White, review by David Allsopp and Xavier Leroy)

- [#10185](https://github.com/ocaml/ocaml/issues/10185): Consider that IPv6 is always enabled on Windows.
  (Antonin Décimo, review by David Allsopp and Xavier Leroy)

- [#10306](https://github.com/ocaml/ocaml/issues/10306): Map WSA error code to Unix errno for sockopt and getsockname
  functions (Antonin Décimo, review by David Allsopp)

- [#10309](https://github.com/ocaml/ocaml/issues/10309): Properly return EBADF on error in Unix.descr_of_{in,out}_channel on
  Win32 and map Windows error correctly in Unix.truncate and Unix.ftruncate on
  Win32.
  (David Allsopp, review by Nicolás Ojeda Bär)

### Tools:

- [#8645](https://github.com/ocaml/ocaml/issues/8645), [#10363](https://github.com/ocaml/ocaml/issues/10363): ocamldoc: escape `<`, `>`, and `&` in html backend.
  (Florian Angeletti, report by Wim Lewis, review by Gabriel Scherer)

- [#10139](https://github.com/ocaml/ocaml/issues/10139): Remove confusing navigation bar from stdlib documentation.
  Adds a -nonavbar option to ocamldoc, and uses it to improve navigation within
  the reference manual.
  (John Whitington, review by David Allsopp)

### Manual and documentation:

- [#9525](https://github.com/ocaml/ocaml/issues/9525), [#10402](https://github.com/ocaml/ocaml/issues/10402): ocamldoc only create paragraphq at the toplevel of
  documentation comments
  (Florian Angeletti, report by Hendrik Tews, review by Gabriel Scherer)

- [#10206](https://github.com/ocaml/ocaml/issues/10206): Split labels and polymorphic variants tutorials
  Splits the labels and polymorphic variants tutorial into two. Moves the GADTs
  tutorial from the Language Extensions chapter to the tutorials.
  (John Whitington, review by Florian Angeletti and Xavier Leroy)

- [#10247](https://github.com/ocaml/ocaml/issues/10247): Add initial tranche of examples to reference manual.
  Adds some eighty examples to the reference manual, principally to the
  expressions and patterns sections.
  (John Whitington, review by Xavier Leroy, Gabriel Scherer, @Fourchaux, and
  Florian Angeletti)

- [#9786](https://github.com/ocaml/ocaml/issues/9786), [#10181](https://github.com/ocaml/ocaml/issues/10181): improved documentation of Unix.{in,out}_channel_of_descr
  with respect to closing.
  (Xavier Leroy, report by Jacques-Henri Jourdan, review by Guillaume
   Munch-Maccagnoni, Gabriel Scherer, Jacques-Henri Jourdan)

- [#10139](https://github.com/ocaml/ocaml/issues/10139): Remove confusing navigation bar from stdlib documentation.
  Removes the 'Up', 'Previous' and 'Next' links from the top of each standard
  library module's documentation.
  (John Whitington, review by David Allsopp)

- [#1351](https://github.com/ocaml/ocaml/issues/1351): Document `-output-complete-obj` option in the manual.
  (François Bobot, Nicolás Ojeda Bär, review by Daniel Bünzli and Damien
  Doligez)

- [#9987](https://github.com/ocaml/ocaml/issues/9987), [#9988](https://github.com/ocaml/ocaml/issues/9988), [#9996](https://github.com/ocaml/ocaml/issues/9996), [#9997](https://github.com/ocaml/ocaml/issues/9997): add an odoc mode for the documentation
  of the standard library and compiler library
  (Florian Angeletti, review by David Allsopp, Sébastien Hinderer,
   and Gabriel Scherer)

- [#9632](https://github.com/ocaml/ocaml/issues/9632): Document incremental build solutions with opam
  (Vincent Laviron, review by Daniel Bünzli and Gabriel Scherer)

- [#10497](https://github.com/ocaml/ocaml/issues/10497): Styling changes in the post-processed HTML manual (webman)
  (Wiktor Kuchta, review by Florian Angeletti)

- [#10605](https://github.com/ocaml/ocaml/issues/10605): manual, name few css classes to ease styling and maintainability.
  (Florian Angeletti, review by Wiktor Kuchta and Gabriel Scherer)

### Compiler user-interface and warnings:

- [#1737](https://github.com/ocaml/ocaml/issues/1737), [#2092](https://github.com/ocaml/ocaml/issues/2092), [#7852](https://github.com/ocaml/ocaml/issues/7852), [#7859](https://github.com/ocaml/ocaml/issues/7859), [#10405](https://github.com/ocaml/ocaml/issues/10405), [#10417](https://github.com/ocaml/ocaml/issues/10417): Update locations during
  destructive substitutions
  (Thomas Refis, review by Gabriel Radanne, report by Hugo Heuzard)

- [#2245](https://github.com/ocaml/ocaml/issues/2245): Improve error message for link order error in bytecode
  (Pierre Chambart, review by Jérémie Dimino and Gabriel Scherer)

- [#8732](https://github.com/ocaml/ocaml/issues/8732), improved error messages for invalid private row type definitions.
  For instance, [ type t = private [< `A > `A ] ] .
  (Florian Angeletti, review by Jacques Garrigue, Thomas Refis,
   and Gabriel Scherer)

- [#9407](https://github.com/ocaml/ocaml/issues/9407): added warning for missing mli interface file
  (Anukriti Kumar, review by Florian Angeletti)

- [#9960](https://github.com/ocaml/ocaml/issues/9960), [#10619](https://github.com/ocaml/ocaml/issues/10619): extend ocamlc/ocamlopt's -o option to work when
  compiling C files
  (Sébastien Hinderer, reported by Daniel Bünzli, review by
  Florian Angeletti and Gabriel Scherer)

- [#10095](https://github.com/ocaml/ocaml/issues/10095): simplify the syntax error messages produced by the compiler.
  In many cases, the compiler would produce an error message that looked
  potentially helpful but was actually misguided and arguably confusing,
  because the error message implicitly referred to an earlier point in
  the source code than the point explicitly shown in the error message.
  (François Pottier, review by Gabriel Scherer and Frédéric Bour.)

* [*breaking change*] [#10118](https://github.com/ocaml/ocaml/issues/10118), [#10140](https://github.com/ocaml/ocaml/issues/10140): enable warning 6 [labels-omitted] by default.
  The following now warns:
    let f ~x y = ... in f 3 5
  the callsite (f 3 5) has to be turned into (f ~x:3 5).
  This prevents mistakes where two arguments of the same types are swapped.
  (Note: Dune already enables this warning by default.)
  (Gabriel Scherer, review by Xavier Leroy and Florian Angeletti,
   report by ygrek)

- [#10196](https://github.com/ocaml/ocaml/issues/10196), [#10197](https://github.com/ocaml/ocaml/issues/10197): better error message on empty character literals ''.
  (Gabriel Scherer, review by David Allsopp and Florian Angeletti
   and Daniel Bünzli, report by Robin Björklin)

- [#8877](https://github.com/ocaml/ocaml/issues/8877): Call the linker when ocamlopt is invoked with .o and .a files only.
  (Greta Yorsh, review by Leo White)

- [#10207](https://github.com/ocaml/ocaml/issues/10207), [#10312](https://github.com/ocaml/ocaml/issues/10312): deprecate consecutive letters in warning
  specifications.
  The form `-w aBcD` was equivalent to `-w -a+b-c+d`.
  It is now deprecated to improve the coexistence with warning mnemonics.
  However, using isolated single letter is not deprecated to allow the form
  `-w "A-32..50-45"`.
  (Florian Angeletti, review by Damien Doligez and Gabriel Scherer)

- [#10232](https://github.com/ocaml/ocaml/issues/10232): Warning for unused record fields.
  (Leo White, review by Florian Angeletti)

### Internal/compiler-libs changes:

- [#9243](https://github.com/ocaml/ocaml/issues/9243), simplify parser rules for array indexing operations
  (Florian Angeletti, review by Damien Doligez and Gabriel Scherer)

- [#9650](https://github.com/ocaml/ocaml/issues/9650), [#9651](https://github.com/ocaml/ocaml/issues/9651): keep refactoring the pattern-matching compiler
  (Gabriel Scherer, review by Thomas Refis and Florian Angeletti)

- [#9827](https://github.com/ocaml/ocaml/issues/9827): Replace references with functions arguments in Simplif
  (Anukriti Kumar, review by Vincent Laviron and David Allsop)

- [#10007](https://github.com/ocaml/ocaml/issues/10007): Driver.compile_common: when typing a .ml file, return the
  compilation unit signature (inferred or from the .cmi) in addition
  to the implementation and the coercion.
  (Leandro Ostera, review by Gabriel Scherer and Thomas Refis)

- [#10045](https://github.com/ocaml/ocaml/issues/10045): Add libext variable to ocamltest and enable C# tests on on mingw
  (David Allsopp, review by Gabriel Scherer)

* [*breaking change*] [#10061](https://github.com/ocaml/ocaml/issues/10061), [#10078](https://github.com/ocaml/ocaml/issues/10078), [#10187](https://github.com/ocaml/ocaml/issues/10187): remove library `ocamlopttoplevel`, remove modules
  `Opttoploop`, `Opttopstart`, which are replaced by `Toploop` and `Topstart` in
  library `ocamltoplevel`, made available in native code.

- [#10124](https://github.com/ocaml/ocaml/issues/10124): remove duplicated code from the native toplevel, split toplevel
  implementation into the shared part (`Topcommon`, etc.) and specific ones
  (`Topeval`, `Trace`, `Topmain`).

* [*breaking change*] [#10086](https://github.com/ocaml/ocaml/issues/10086): add the commands `make list-parse-errors` and `make
  generate-parse-errors` to generate a set of syntactically incorrect
  sentences that covers all error states of the LR automaton. Add these
  sentences to the test suite. This can be used to evaluate the quality of the
  parser's syntax error messages and (in the future) to evaluate the impact of
  changes in the parser.
  (François Pottier, review by Gabriel Scherer and Xavier Leroy.)

- [#10090](https://github.com/ocaml/ocaml/issues/10090): Distinguished constructors for ref variables at lambda level
  (Keryan Didier, review by Gabriel Scherer and Vincent Laviron)

- [#10113](https://github.com/ocaml/ocaml/issues/10113): add a `-timeout` option to ocamltest and use it in the test suite.
  (Xavier Leroy and Gabriel Scherer, review by Sébastien Hinderer
   and David Allsopp)

- [#10327](https://github.com/ocaml/ocaml/issues/10327): Add a subdirectories variable and a copy action to ocamltest
  (Sébastien Hinderer, review by David Allsopp)

- [#10358](https://github.com/ocaml/ocaml/issues/10358): Use a hash table for the load path.
  (Leo White, review by Gabriel Scherer)

- [#8936](https://github.com/ocaml/ocaml/issues/8936): Per-function environment for Emit
  (Greta Yorsh, review by Vincent Laviron and Florian Angeletti)

- [#10543](https://github.com/ocaml/ocaml/issues/10543): Fix Ast_mapper to apply the mapping function to the constants in
  "interval" patterns `c1..c2`.
  (Guillaume Petiot, review by Gabriel Scherer and Nicolás Ojeda Bär)

### Internal typechecker changes:

- [#9994](https://github.com/ocaml/ocaml/issues/9994): Make Types.type_expr a private type, and abstract marking mechanism
  (Jacques Garrigue and Takafumi Saikawa,
   review by Gabriel Scherer and Leo White)

- [#10170](https://github.com/ocaml/ocaml/issues/10170): Maintain more structural information in type-checking errors
  A mostly-internal change that preserves more information in errors
  during type checking; most significantly, it split the errors from
  unification, moregen, and type equality into three different types.
  (Antal Spector-Zabusky and Mekhrubon Tuarev, review by Leo White,
  Florian Angeletti, and Jacques Garrigue)

- [#10174](https://github.com/ocaml/ocaml/issues/10174): Make Tsubst more robust by avoiding strange workarounds
  (Takafumi Saikawa and Jacques Garrigue, review by Gabriel Scherer and
   Florian Angeletti)

- [#10265](https://github.com/ocaml/ocaml/issues/10265): Move type_unboxed.unboxed into type_kind
  (Stephen Dolan, review by Gabriel Scherer)

- [#10307](https://github.com/ocaml/ocaml/issues/10307): Refactor type_description in the typing env
  (Nicolas Chataing, review by Takafumi Saikawa, Florian Angeletti and Thomas
   Refis)

- [#10311](https://github.com/ocaml/ocaml/issues/10311): Separate the constraint-solving part of Typecore.type_pat into
  specific solver functions.
  (Jacques Garrigue and Takafumi Saikawa, review by Gabriel Scherer)

- [#10428](https://github.com/ocaml/ocaml/issues/10428): Make build_other_constrs work with names instead of tags.
  (Nicolas Chataing, review by Florian Angeletti)

### Build system:

- [#10289](https://github.com/ocaml/ocaml/issues/10289), [#10406](https://github.com/ocaml/ocaml/issues/10406): Do not print option documentation in usage messages.
    (Pavlo Khrystenko, review by Gabriel Scherer, fix by Kate Deplaix)

- [#9191](https://github.com/ocaml/ocaml/issues/9191), [#10091](https://github.com/ocaml/ocaml/issues/10091), [#10182](https://github.com/ocaml/ocaml/issues/10182): take the LDFLAGS variable into account, except on
  flexlink-using systems.
  (Gabriel Scherer, review by Sébastien Hinderer and David Allsopp,
   report by Ralph Seichter)

- [#10135](https://github.com/ocaml/ocaml/issues/10135): Overhaul the FlexDLL bootstrap process. It's now fully integrated
  with the default build target and controlled by --with-flexdll which allows
  externally downloaded sources for FlexDLL to be specified. A separate
  non-shared version of the runtime is built, and shared artefacts are no longer
  built twice. When bootstrapping, any flexlink in PATH is now ignored and the
  Cygwin port also supports bootstrapping FlexDLL. flexlink.opt is automatically
  built and installed as part of opt.opt/world.opt.
  (David Allsopp, review by Sébastien Hinderer)

- [#10156](https://github.com/ocaml/ocaml/issues/10156): configure script: fix sockets feature detection.
  (Lucas Pluvinage, review by David Allsopp and Damien Doligez)

- [#10176](https://github.com/ocaml/ocaml/issues/10176): By default, call the assembler through the C compiler driver
  (Sébastien Hinderer, review by Gabriel Scherer, David Allsopp and Xavier
  Leroy)

- [#10186](https://github.com/ocaml/ocaml/issues/10186): configure wasn't using library link flags when searching for
  network functions on systems where they're not in libc. Fix IPv6 and
  socklen_t detection on Windows.
  (Antonin Décimo, review by David Allsopp and Sébastien Hinderer)

- [#10332](https://github.com/ocaml/ocaml/issues/10332), [#10333](https://github.com/ocaml/ocaml/issues/10333): Generate lambda/runtimedef.ml correctly in Swedish locale.
  (the letter 'w' is not included in '[a-z]' in sv_SE.UTF-8)
  (David Allsopp, report by Anders Jackson, review by Florian Angeletti and
   Gabriel Scherer)

- [#10366](https://github.com/ocaml/ocaml/issues/10366): Make it possible to use the OCAMLRUN variable to specify
  which runtime to use while building the compilers (Sébastien Hinderer,
  review by David Allsopp)

- [#10451](https://github.com/ocaml/ocaml/issues/10451): Replace the use of iconv with a C utility to convert $(LIBDIR) to a
  C string constant on Windows when building the runtime. Hardens the generation
  of the constant on Unix for paths with backslashes, double-quotes and
  newlines.
  (David Allsopp, review by Florian Angeletti and Sébastien Hinderer)

- [#10471](https://github.com/ocaml/ocaml/issues/10471): Fix detection of arm32 architectures with musl in configure.
  (Louis Gesbert, review by David Allsopp)

### Bug fixes:

- [#6654](https://github.com/ocaml/ocaml/issues/6654), [#9774](https://github.com/ocaml/ocaml/issues/9774), [#10401](https://github.com/ocaml/ocaml/issues/10401): make `include` and with `constraints` handle correctly
  the ghost components of signatures. For instance, in

    include struct class c = object end end type c

   the type `c` shadows the `class c` to avoid shadowing only the ghost type
   c introduced by the class.
  (Florian Angeletti, report by Eduardo Rafael, review by Gabriel Scherer)

- [#6985](https://github.com/ocaml/ocaml/issues/6985), [#10385](https://github.com/ocaml/ocaml/issues/10385): remove all ghost row types from included modules
  (Florian Angeletti, review by Gabriel Scherer)

- [#7453](https://github.com/ocaml/ocaml/issues/7453), [#9828](https://github.com/ocaml/ocaml/issues/9828), [#10416](https://github.com/ocaml/ocaml/issues/10416): fix #show for recursive types and modules
  (Florian Angeletti, review by Gabriel Scherer)

* [*breaking change*] [#7469](https://github.com/ocaml/ocaml/issues/7469), [#10408](https://github.com/ocaml/ocaml/issues/10408): Sys.time now returns processor time on Windows (previously
  returned wall-clock time)
  (David Allsopp, review by Nicolás Ojeda Bär)

* [*breaking change*] [#8857](https://github.com/ocaml/ocaml/issues/8857), [#10220](https://github.com/ocaml/ocaml/issues/10220): Don't clobber GetLastError() in caml_leave_blocking_section
  when the systhreads library is loaded.
  (David Allsopp, report by Anton Bachin, review by Xavier Leroy)

- [#8575](https://github.com/ocaml/ocaml/issues/8575), [#10362](https://github.com/ocaml/ocaml/issues/10362): Surprising interaction between polymorphic variants and
  constructor disambiguation.
  (Jacques Garrigue, report and review by Thomas Refis)

- [#8917](https://github.com/ocaml/ocaml/issues/8917), [#8929](https://github.com/ocaml/ocaml/issues/8929), [#9889](https://github.com/ocaml/ocaml/issues/9889), [#10219](https://github.com/ocaml/ocaml/issues/10219): fix printing of nested recursive definitions
  in presence of a name collision.
  (Florian Angeletti, report by Thomas Refis, review by Gabriel Scherer)

- [#10005](https://github.com/ocaml/ocaml/issues/10005): Try expanding aliases in Ctype.nondep_type_rec
  (Stephen Dolan, review by Gabriel Scherer, Leo White and Xavier Leroy)

- [#10072](https://github.com/ocaml/ocaml/issues/10072), [#10085](https://github.com/ocaml/ocaml/issues/10085): Check that sizes and offsets in stack frame descriptors
  do not overflow the 16-bit fields where they are stored.
  (Xavier Leroy, report by Github user pveber, review by Gabriel Scherer)

- [#10087](https://github.com/ocaml/ocaml/issues/10087), [#10138](https://github.com/ocaml/ocaml/issues/10138): In the toplevel REPL, don't use the cache
  of included directories, so that files created or deleted while
  the REPL is running are correctly handled.
  (Xavier Leroy, report by Github user quakerquickoats, review by
   Jeremie Dimino)

- [#10294](https://github.com/ocaml/ocaml/issues/10294), [#10295](https://github.com/ocaml/ocaml/issues/10295): fix an assert-failure in pattern-matching compilation
  (Gabriel Scherer, review by Thomas Refis and Luc Maranget,
   report by Nicolás Ojeda Bär)

- [#10147](https://github.com/ocaml/ocaml/issues/10147), [#10148](https://github.com/ocaml/ocaml/issues/10148): Fix building runtime with GCC on macOS.
  (David Allsopp, report by John Skaller)

- [#10166](https://github.com/ocaml/ocaml/issues/10166): Fix illegal permutation error reporting in module aliases.
  (Matthew Ryan, review by Florian Angeletti)

- [#10189](https://github.com/ocaml/ocaml/issues/10189), [#10190](https://github.com/ocaml/ocaml/issues/10190), [#10347](https://github.com/ocaml/ocaml/issues/10347): Universal variables leaking through GADT equations
  (Jacques Garrigue, report and review by Leo White)

- [#10205](https://github.com/ocaml/ocaml/issues/10205): Avoid overwriting closures while initialising recursive modules
  (Stephen Dolan, review by Xavier Leroy, Hugo Heuzard and Vincent Laviron)

- [#10253](https://github.com/ocaml/ocaml/issues/10253), [#10373](https://github.com/ocaml/ocaml/issues/10373): tweak error message for unknown variant constructors
  or record fields in type-directed disambiguation
  (Florian Angeletti, report by Hongbo Zhang, review by Gabriel Scherer)

* [*breaking change*] [#10277](https://github.com/ocaml/ocaml/issues/10277), [#10383](https://github.com/ocaml/ocaml/issues/10383): Need to detect ambiguity recursively inside types to
  guarantee principality (affects only principal mode)
  (Jacques Garrigue, review by Thomas Refis, Leo White and Kate Deplaix)

- [#10283](https://github.com/ocaml/ocaml/issues/10283), [#10284](https://github.com/ocaml/ocaml/issues/10284): Enforce right-to-left evaluation order for Lstaticraise
  (Vincent Laviron, report by Github user Ngoguey42, review by Gabriel Scherer)

- [#10298](https://github.com/ocaml/ocaml/issues/10298), [#10305](https://github.com/ocaml/ocaml/issues/10305): Incorrect propagation of type equalities in functor
  application
  (Jacques Garrigue, report and review by Didier Remy)

- [#10324](https://github.com/ocaml/ocaml/issues/10324), [#10325](https://github.com/ocaml/ocaml/issues/10325): Prevent generation of Lsend(Cached, _) in bytecode
  (Vincent Laviron, report by Yawar Amin and Nicolás Ojeda Bär, review by
   Jacques Garrigue)

- [#10338](https://github.com/ocaml/ocaml/issues/10338), [#10340](https://github.com/ocaml/ocaml/issues/10340): Translcore.push_defaults does not respect scoping
  (Jacques Garrigue, report and review by Stephen Dolan)

- [#10351](https://github.com/ocaml/ocaml/issues/10351): Fix DLL loading with binutils 2.36+ on mingw-w64
  (David Allsopp, review by Nicolás Ojeda Bär)

- [#10339](https://github.com/ocaml/ocaml/issues/10339), [#10354](https://github.com/ocaml/ocaml/issues/10354), [#10387](https://github.com/ocaml/ocaml/issues/10387): Fix handling of exception-raising specific
  operations during spilling and liveness analysis.
  (This bug affects ARM and ARM64.)
  In passing, refactor Proc.op_is_pure and Mach.operation_can_raise.
  (Xavier Leroy, report by Richard Bornat, review by Stephen Dolan
   and Mark Shinwell)

- [#10371](https://github.com/ocaml/ocaml/issues/10371): no longer generatd useless `.cds` file when using
  `-output-complete-exe`.
  (Nicolás Ojeda Bär, review by David Allsopp)

- [#10376](https://github.com/ocaml/ocaml/issues/10376): Link runtime libraries correctly on msvc64 in -output-complete-obj
  (David Allsopp, review by Gabriel Scherer)

- [#10380](https://github.com/ocaml/ocaml/issues/10380): Correct handling of UTF-8 paths in configure on Windows
  (David Allsopp, review by Sébastien Hinderer)

- [#10449](https://github.com/ocaml/ocaml/issues/10449): Fix major GC work accounting (the GC was running too fast).
  (Damien Doligez, report by Stephen Dolan, review by Nicolás Ojeda Bär and
   Sadiq Jaffer)

- [#10450](https://github.com/ocaml/ocaml/issues/10450), [#10558](https://github.com/ocaml/ocaml/issues/10558): keep %apply and %revapply primitives working with abstract
  types. This breach of backward compatibility was only present in the alpha
  releases of OCaml 4.13.0 .
  (Florian Angeletti, review by Thomas Refis and Leo White)

- [#10454](https://github.com/ocaml/ocaml/issues/10454): Check row_more in nondep_type_rec.
  (Leo White, review by Thomas Refis)

- [#10468](https://github.com/ocaml/ocaml/issues/10468): Correctly pretty print local type substitution, e.g. type t := ...,
  with -dsource
  (Matt Else, review by Florian Angeletti)

- [#10461](https://github.com/ocaml/ocaml/issues/10461), [#10498](https://github.com/ocaml/ocaml/issues/10498): `caml_send*` helper functions take derived pointers
  as arguments.  Those must be declared with type Addr instead of Val.
  Moreover, poll point insertion must be disabled for `caml_send*`,
  otherwise the derived pointer is live across a poll point.
  (Vincent Laviron and Xavier Leroy, review by Xavier Leroy and Sadiq Jaffer)

- [#10511](https://github.com/ocaml/ocaml/issues/10511): Cygwin ports now correctly configure when flexdll is not available.
  (David Allsopp, review by Florian Angeletti)

- [#10550](https://github.com/ocaml/ocaml/issues/10550), [#10551](https://github.com/ocaml/ocaml/issues/10551): fix pretty-print of gadt-pattern-with-type-vars
  (Chet Murthy, review by Gabriel Scherer)

- [#10584](https://github.com/ocaml/ocaml/issues/10584), [#10856](https://github.com/ocaml/ocaml/issues/10856): Standard Library documentation build no longer fails if
  optional libraries have been disabled.
  (David Allsopp, report by Yuri Victorovich review by Florian Angeletti)

- [#10593](https://github.com/ocaml/ocaml/issues/10593): Fix untyping of patterns without named existential quantifiers. This
  bug was only present in the beta version of OCaml 4.13.0.
  (Ulysse Gérard, review by Florian Angeletti)

- [#10603](https://github.com/ocaml/ocaml/issues/10603), [#10611](https://github.com/ocaml/ocaml/issues/10611): Fix if condition marked as inconstant in flambda
  (Vincent Laviron and Pierre Chambart, report by Marcello Seri)
