<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.09">
<style type="text/css">
.c000{border-spacing:0;}
.c001{border-spacing:0;width:80%}
.c002{border-spacing:6px;border-collapse:separate;}
.c003{color:#006000}
.c004{color:black}
.c005{color:blue}
.c006{color:maroon}
.c007{font-family:monospace}
.c008{font-family:monospace;color:blue}
.c009{font-family:monospace;font-style:italic}
.c010{font-family:monospace;font-weight:bold}
.c011{font-family:sans-serif}
.c012{font-size:small}
.c013{font-style:italic}
.c014{font-style:italic;color:maroon}
.c015{font-style:italic;color:red}
.c016{font-style:italic;font-size:small}
.c017{font-style:italic;font-weight:bold}
.c018{font-style:oblique}
.c019{font-weight:bold}
.c020{font-weight:bold;font-size:small}
.c021{text-align:center;border:solid 1px;white-space:nowrap}
.c022{text-align:center;white-space:nowrap}
.c023{text-align:left;border:solid 1px;white-space:nowrap}
.c024{text-align:left;white-space:nowrap}
.c025{text-align:right;white-space:nowrap}
.c026{vertical-align:middle}
.c027{vertical-align:top;text-align:left;}
.c028{vertical-align:top;text-align:left;border:solid 1px;}
.c029{vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap}
.c030{vertical-align:top;text-align:left;white-space:nowrap}
.c031{vertical-align:top;text-align:right;white-space:nowrap}
.c032{width:80%;height:2}
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.center{text-align:center;margin-left:auto;margin-right:auto;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
a:link{color:#00A000;text-decoration:underline;}
a:visited{color:#006000;text-decoration:underline;}
a:hover{color:black;text-decoration:none;background-color:#7FFF7F}
.li-links{margin:0ex 0ex;}
a.syntax:link{color:maroon;text-decoration:underline}
a.syntax:visited{color:maroon;text-decoration:underline}
a.syntax:hover{color:black;text-decoration:none;background-color:#FF6060}
body{background-color:white}
a:link{color:#00B200;text-decoration:underline;}
a:visited{color:#006600;text-decoration:underline;}
a:hover{color:black;text-decoration:none;background-color:#99FF99}
.part{padding:1ex;background-color:#00CC00}
.section{padding:.5ex;background-color:#66FF66}
.subsection{padding:0.3ex;background-color:#7FFF7F}
.subsubsection{padding:0.5ex;background-color:#99FF99}
.paragraph{padding:0.5ex;background-color:#CCFFCC}
.chapter{padding:0.5ex;background-color:#2DE52D}
.ffootnoterule{border:none;margin:1em auto 1em 0px;width:50%;background-color:#00CC00}
.ftoc1{list-style:none;margin:0ex 1ex;padding:0ex 1ex;border-left:1ex solid #00CC00}
.ftoc2{list-style:none;margin:1ex 1ex;padding:0ex 1ex;border-left:1ex solid #2DE52D}
.ftoc3{list-style:none;margin:0ex 1ex;padding:0ex 1ex;border-left:1ex solid #66FF66}
.ftoc4{list-style:none;margin:0ex 1ex;padding:0ex 1ex;border-left:1ex solid #7FFF7F}
</style>
<title>The OCaml system, release 4.01
</title>
</head>
<body>
<!--HEVEA command line is: hevea -fix -exec xxdate.exe -O -I .. -I ../refman -I ../library -I ../cmds -I ../tutorials -I ../../styles -I ../texstuff manual.hva -e macros.tex ../manual.tex -->
<!--CUT STYLE book--><!--CUT DEF chapter 1 --><div class="center">
&#XA0;<span style="font-size:xx-large"><span style="font-size:150%">The OCaml system <br>
 release 4.01<br>
<span style="font-size:x-large">Documentation and user&#X2019;s manual <br>
<span style="font-size:large">Xavier Leroy, <br>
 Damien Doligez, Alain Frisch, Jacques Garrigue, Didier R&#XE9;my and J&#XE9;r&#XF4;me Vouillon <br>
 September&#XA0;12, 2013<br>
 &#XA0;
<span style="font-size:medium">Copyright &#XA9; 2013 Institut National de
Recherche en Informatique et en Automatique
</span></span></span></span></span></div><blockquote class="quote">
<hr style="height:2">
This manual is also available in
<a href="https://ocaml.org/releases/4.01/ocaml-4.01-refman.pdf">PDF</a>.
<a href="https://ocaml.org/releases/4.01/ocaml-4.01-refman.ps.gz">Postscript</a>,
<a href="https://ocaml.org/releases/4.01/ocaml-4.01-refman.dvi.gz">DVI</a>,
<a href="https://ocaml.org/releases/4.01/ocaml-4.01-refman.txt">plain text</a>,
as a
<a href="https://ocaml.org/releases/4.01/ocaml-4.01-refman.html.tar.gz">bundle of HTML files</a>,
and as a
<a href="https://ocaml.org/releases/4.01/ocaml-4.01-refman.info.tar.gz">bundle of Emacs Info files</a>.
<hr style="height:2">
</blockquote><!--TOC chapter id="sec1" Contents-->
<h1 class="chapter" id="sec1">Contents</h1><!--SEC END --><ul class="ftoc1"><li class="li-toc">
<a href="#sec6">Part&#XA0;I&#XA0;&#XA0;An introduction to OCaml</a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec7">Chapter&#XA0;1&#XA0;&#XA0;The core language</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec8">1.1&#XA0;&#XA0;Basics</a>
</li><li class="li-toc"><a href="#sec9">1.2&#XA0;&#XA0;Data types</a>
</li><li class="li-toc"><a href="#sec10">1.3&#XA0;&#XA0;Functions as values</a>
</li><li class="li-toc"><a href="#sec11">1.4&#XA0;&#XA0;Records and variants</a>
</li><li class="li-toc"><a href="#sec12">1.5&#XA0;&#XA0;Imperative features</a>
</li><li class="li-toc"><a href="#sec13">1.6&#XA0;&#XA0;Exceptions</a>
</li><li class="li-toc"><a href="#sec14">1.7&#XA0;&#XA0;Symbolic processing of expressions</a>
</li><li class="li-toc"><a href="#sec15">1.8&#XA0;&#XA0;Pretty-printing and parsing</a>
</li><li class="li-toc"><a href="#sec16">1.9&#XA0;&#XA0;Standalone OCaml programs</a>
</li></ul>
</li><li class="li-toc"><a href="#sec17">Chapter&#XA0;2&#XA0;&#XA0;The module system</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec18">2.1&#XA0;&#XA0;Structures</a>
</li><li class="li-toc"><a href="#sec19">2.2&#XA0;&#XA0;Signatures</a>
</li><li class="li-toc"><a href="#sec20">2.3&#XA0;&#XA0;Functors</a>
</li><li class="li-toc"><a href="#sec21">2.4&#XA0;&#XA0;Functors and type abstraction</a>
</li><li class="li-toc"><a href="#sec22">2.5&#XA0;&#XA0;Modules and separate compilation</a>
</li></ul>
</li><li class="li-toc"><a href="#sec23">Chapter&#XA0;3&#XA0;&#XA0;Objects in OCaml</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec24">3.1&#XA0;&#XA0;Classes and objects</a>
</li><li class="li-toc"><a href="#sec25">3.2&#XA0;&#XA0;Immediate objects</a>
</li><li class="li-toc"><a href="#sec26">3.3&#XA0;&#XA0;Reference to self</a>
</li><li class="li-toc"><a href="#sec27">3.4&#XA0;&#XA0;Initializers</a>
</li><li class="li-toc"><a href="#sec28">3.5&#XA0;&#XA0;Virtual methods</a>
</li><li class="li-toc"><a href="#sec29">3.6&#XA0;&#XA0;Private methods</a>
</li><li class="li-toc"><a href="#sec30">3.7&#XA0;&#XA0;Class interfaces</a>
</li><li class="li-toc"><a href="#sec31">3.8&#XA0;&#XA0;Inheritance</a>
</li><li class="li-toc"><a href="#sec32">3.9&#XA0;&#XA0;Multiple inheritance</a>
</li><li class="li-toc"><a href="#sec33">3.10&#XA0;&#XA0;Parameterized classes</a>
</li><li class="li-toc"><a href="#sec34">3.11&#XA0;&#XA0;Polymorphic methods</a>
</li><li class="li-toc"><a href="#sec35">3.12&#XA0;&#XA0;Using coercions</a>
</li><li class="li-toc"><a href="#sec36">3.13&#XA0;&#XA0;Functional objects</a>
</li><li class="li-toc"><a href="#sec37">3.14&#XA0;&#XA0;Cloning objects</a>
</li><li class="li-toc"><a href="#sec38">3.15&#XA0;&#XA0;Recursive classes</a>
</li><li class="li-toc"><a href="#sec39">3.16&#XA0;&#XA0;Binary methods</a>
</li><li class="li-toc"><a href="#sec40">3.17&#XA0;&#XA0;Friends</a>
</li></ul>
</li><li class="li-toc"><a href="#sec41">Chapter&#XA0;4&#XA0;&#XA0;Labels and variants</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec42">4.1&#XA0;&#XA0;Labels</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec43">4.1.1&#XA0;&#XA0;Optional arguments</a>
</li><li class="li-toc"><a href="#sec44">4.1.2&#XA0;&#XA0;Labels and type inference</a>
</li><li class="li-toc"><a href="#sec45">4.1.3&#XA0;&#XA0;Suggestions for labeling</a>
</li></ul>
</li><li class="li-toc"><a href="#sec46">4.2&#XA0;&#XA0;Polymorphic variants</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec49">4.2.1&#XA0;&#XA0;Weaknesses of polymorphic variants</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec50">Chapter&#XA0;5&#XA0;&#XA0;Advanced examples with classes and modules</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec51">5.1&#XA0;&#XA0;Extended example: bank accounts</a>
</li><li class="li-toc"><a href="#sec52">5.2&#XA0;&#XA0;Simple modules as classes</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec53">5.2.1&#XA0;&#XA0;Strings</a>
</li><li class="li-toc"><a href="#sec55">5.2.2&#XA0;&#XA0;Hashtbl</a>
</li><li class="li-toc"><a href="#sec56">5.2.3&#XA0;&#XA0;Sets</a>
</li></ul>
</li><li class="li-toc"><a href="#sec57">5.3&#XA0;&#XA0;The subject/observer pattern</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec58">Part&#XA0;II&#XA0;&#XA0;The OCaml language</a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec59">Chapter&#XA0;6&#XA0;&#XA0;The OCaml language</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec62">6.1&#XA0;&#XA0;Lexical conventions</a>
</li><li class="li-toc"><a href="#sec75">6.2&#XA0;&#XA0;Values</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec76">6.2.1&#XA0;&#XA0;Base values</a>
</li><li class="li-toc"><a href="#sec81">6.2.2&#XA0;&#XA0;Tuples</a>
</li><li class="li-toc"><a href="#sec82">6.2.3&#XA0;&#XA0;Records</a>
</li><li class="li-toc"><a href="#sec83">6.2.4&#XA0;&#XA0;Arrays</a>
</li><li class="li-toc"><a href="#sec84">6.2.5&#XA0;&#XA0;Variant values</a>
</li><li class="li-toc"><a href="#sec85">6.2.6&#XA0;&#XA0;Polymorphic variants</a>
</li><li class="li-toc"><a href="#sec86">6.2.7&#XA0;&#XA0;Functions</a>
</li><li class="li-toc"><a href="#sec87">6.2.8&#XA0;&#XA0;Objects</a>
</li></ul>
</li><li class="li-toc"><a href="#sec88">6.3&#XA0;&#XA0;Names</a>
</li><li class="li-toc"><a href="#sec91">6.4&#XA0;&#XA0;Type expressions</a>
</li><li class="li-toc"><a href="#sec102">6.5&#XA0;&#XA0;Constants</a>
</li><li class="li-toc"><a href="#sec103">6.6&#XA0;&#XA0;Patterns</a>
</li><li class="li-toc"><a href="#s%3Avalue-expr">6.7&#XA0;&#XA0;Expressions</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec116">6.7.1&#XA0;&#XA0;Basic expressions</a>
</li><li class="li-toc"><a href="#sec124">6.7.2&#XA0;&#XA0;Control structures</a>
</li><li class="li-toc"><a href="#sec131">6.7.3&#XA0;&#XA0;Operations on data structures</a>
</li><li class="li-toc"><a href="#sec138">6.7.4&#XA0;&#XA0;Operators</a>
</li><li class="li-toc"><a href="#sec139">6.7.5&#XA0;&#XA0;Objects</a>
</li><li class="li-toc"><a href="#sec145">6.7.6&#XA0;&#XA0;Coercions</a>
</li></ul>
</li><li class="li-toc"><a href="#sec149">6.8&#XA0;&#XA0;Type and exception definitions</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec150">6.8.1&#XA0;&#XA0;Type definitions</a>
</li><li class="li-toc"><a href="#sec151">6.8.2&#XA0;&#XA0;Exception definitions</a>
</li></ul>
</li><li class="li-toc"><a href="#sec152">6.9&#XA0;&#XA0;Classes</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec153">6.9.1&#XA0;&#XA0;Class types</a>
</li><li class="li-toc"><a href="#sec162">6.9.2&#XA0;&#XA0;Class expressions</a>
</li><li class="li-toc"><a href="#sec175">6.9.3&#XA0;&#XA0;Class definitions</a>
</li><li class="li-toc"><a href="#sec178">6.9.4&#XA0;&#XA0;Class specifications</a>
</li><li class="li-toc"><a href="#sec179">6.9.5&#XA0;&#XA0;Class type definitions</a>
</li></ul>
</li><li class="li-toc"><a href="#sec180">6.10&#XA0;&#XA0;Module types (module specifications)</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec181">6.10.1&#XA0;&#XA0;Simple module types</a>
</li><li class="li-toc"><a href="#sec182">6.10.2&#XA0;&#XA0;Signatures</a>
</li><li class="li-toc"><a href="#sec192">6.10.3&#XA0;&#XA0;Functor types</a>
</li><li class="li-toc"><a href="#sec193">6.10.4&#XA0;&#XA0;The <span class="c007">with</span> operator</a>
</li></ul>
</li><li class="li-toc"><a href="#s%3Amodule-expr">6.11&#XA0;&#XA0;Module expressions (module implementations)</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec195">6.11.1&#XA0;&#XA0;Simple module expressions</a>
</li><li class="li-toc"><a href="#sec196">6.11.2&#XA0;&#XA0;Structures</a>
</li><li class="li-toc"><a href="#sec206">6.11.3&#XA0;&#XA0;Functors</a>
</li></ul>
</li><li class="li-toc"><a href="#sec209">6.12&#XA0;&#XA0;Compilation units</a>
</li></ul>
</li><li class="li-toc"><a href="#sec210">Chapter&#XA0;7&#XA0;&#XA0;Language extensions</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec211">7.1&#XA0;&#XA0;Integer literals for types <span class="c007">int32</span>, <span class="c007">int64</span>
and <span class="c007">nativeint</span></a>
</li><li class="li-toc"><a href="#sec212">7.2&#XA0;&#XA0;Streams and stream parsers</a>
</li><li class="li-toc"><a href="#sec213">7.3&#XA0;&#XA0;Recursive definitions of values</a>
</li><li class="li-toc"><a href="#sec214">7.4&#XA0;&#XA0;Range patterns</a>
</li><li class="li-toc"><a href="#sec215">7.5&#XA0;&#XA0;Assertion checking</a>
</li><li class="li-toc"><a href="#sec216">7.6&#XA0;&#XA0;Lazy evaluation</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec217">7.6.1&#XA0;&#XA0;Lazy expressions</a>
</li><li class="li-toc"><a href="#sec218">7.6.2&#XA0;&#XA0;Lazy patterns</a>
</li></ul>
</li><li class="li-toc"><a href="#sec219">7.7&#XA0;&#XA0;Local modules</a>
</li><li class="li-toc"><a href="#sec220">7.8&#XA0;&#XA0;Recursive modules</a>
</li><li class="li-toc"><a href="#sec221">7.9&#XA0;&#XA0;Private types</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec222">7.9.1&#XA0;&#XA0;Private variant and record types</a>
</li><li class="li-toc"><a href="#sec223">7.9.2&#XA0;&#XA0;Private type abbreviations</a>
</li><li class="li-toc"><a href="#sec224">7.9.3&#XA0;&#XA0;Private row types</a>
</li></ul>
</li><li class="li-toc"><a href="#sec225">7.10&#XA0;&#XA0;Local opens</a>
</li><li class="li-toc"><a href="#sec226">7.11&#XA0;&#XA0;Record notations</a>
</li><li class="li-toc"><a href="#sec227">7.12&#XA0;&#XA0;Explicit polymorphic type annotations</a>
</li><li class="li-toc"><a href="#sec228">7.13&#XA0;&#XA0;Locally abstract types</a>
</li><li class="li-toc"><a href="#sec230">7.14&#XA0;&#XA0;First-class modules</a>
</li><li class="li-toc"><a href="#sec233">7.15&#XA0;&#XA0;Recovering the type of a module</a>
</li><li class="li-toc"><a href="#sec234">7.16&#XA0;&#XA0;Substituting inside a signature</a>
</li><li class="li-toc"><a href="#sec235">7.17&#XA0;&#XA0;Explicit overriding in class definitions</a>
</li><li class="li-toc"><a href="#sec236">7.18&#XA0;&#XA0;Overriding in open statements</a>
</li><li class="li-toc"><a href="#sec237">7.19&#XA0;&#XA0;Generalized algebraic datatypes</a>
</li><li class="li-toc"><a href="#sec239">7.20&#XA0;&#XA0;Syntax for Bigarray access</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec240">Part&#XA0;III&#XA0;&#XA0;The OCaml tools</a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec241">Chapter&#XA0;8&#XA0;&#XA0;Batch compilation (ocamlc)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec242">8.1&#XA0;&#XA0;Overview of the compiler</a>
</li><li class="li-toc"><a href="#sec243">8.2&#XA0;&#XA0;Options</a>
</li><li class="li-toc"><a href="#sec244">8.3&#XA0;&#XA0;Modules and the file system</a>
</li><li class="li-toc"><a href="#sec245">8.4&#XA0;&#XA0;Common errors</a>
</li></ul>
</li><li class="li-toc"><a href="#sec246">Chapter&#XA0;9&#XA0;&#XA0;The toplevel system (ocaml)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec247">9.1&#XA0;&#XA0;Options</a>
</li><li class="li-toc"><a href="#sec248">9.2&#XA0;&#XA0;Toplevel directives</a>
</li><li class="li-toc"><a href="#sec249">9.3&#XA0;&#XA0;The toplevel and the module system</a>
</li><li class="li-toc"><a href="#sec250">9.4&#XA0;&#XA0;Common errors</a>
</li><li class="li-toc"><a href="#sec251">9.5&#XA0;&#XA0;Building custom toplevel systems: <span class="c007">ocamlmktop</span></a>
</li><li class="li-toc"><a href="#sec252">9.6&#XA0;&#XA0;Options</a>
</li></ul>
</li><li class="li-toc"><a href="#sec253">Chapter&#XA0;10&#XA0;&#XA0;The runtime system (ocamlrun)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec254">10.1&#XA0;&#XA0;Overview</a>
</li><li class="li-toc"><a href="#sec255">10.2&#XA0;&#XA0;Options</a>
</li><li class="li-toc"><a href="#sec256">10.3&#XA0;&#XA0;Dynamic loading of shared libraries</a>
</li><li class="li-toc"><a href="#sec257">10.4&#XA0;&#XA0;Common errors</a>
</li></ul>
</li><li class="li-toc"><a href="#sec258">Chapter&#XA0;11&#XA0;&#XA0;Native-code compilation (ocamlopt)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec259">11.1&#XA0;&#XA0;Overview of the compiler</a>
</li><li class="li-toc"><a href="#sec260">11.2&#XA0;&#XA0;Options</a>
</li><li class="li-toc"><a href="#sec264">11.3&#XA0;&#XA0;Common errors</a>
</li><li class="li-toc"><a href="#sec265">11.4&#XA0;&#XA0;Running executables produced by ocamlopt</a>
</li><li class="li-toc"><a href="#sec266">11.5&#XA0;&#XA0;Compatibility with the bytecode compiler</a>
</li></ul>
</li><li class="li-toc"><a href="#sec267">Chapter&#XA0;12&#XA0;&#XA0;Lexer and parser generators (ocamllex, ocamlyacc)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec268">12.1&#XA0;&#XA0;Overview of <span class="c007">ocamllex</span></a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec269">12.1.1&#XA0;&#XA0;Options</a>
</li></ul>
</li><li class="li-toc"><a href="#sec270">12.2&#XA0;&#XA0;Syntax of lexer definitions</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec271">12.2.1&#XA0;&#XA0;Header and trailer</a>
</li><li class="li-toc"><a href="#sec272">12.2.2&#XA0;&#XA0;Naming regular expressions</a>
</li><li class="li-toc"><a href="#sec273">12.2.3&#XA0;&#XA0;Entry points</a>
</li><li class="li-toc"><a href="#sec274">12.2.4&#XA0;&#XA0;Regular expressions</a>
</li><li class="li-toc"><a href="#sec275">12.2.5&#XA0;&#XA0;Actions</a>
</li><li class="li-toc"><a href="#sec276">12.2.6&#XA0;&#XA0;Variables in regular expressions</a>
</li><li class="li-toc"><a href="#sec277">12.2.7&#XA0;&#XA0;Reserved identifiers</a>
</li></ul>
</li><li class="li-toc"><a href="#sec278">12.3&#XA0;&#XA0;Overview of <span class="c007">ocamlyacc</span></a>
</li><li class="li-toc"><a href="#sec279">12.4&#XA0;&#XA0;Syntax of grammar definitions</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec280">12.4.1&#XA0;&#XA0;Header and trailer</a>
</li><li class="li-toc"><a href="#sec281">12.4.2&#XA0;&#XA0;Declarations</a>
</li><li class="li-toc"><a href="#sec282">12.4.3&#XA0;&#XA0;Rules</a>
</li><li class="li-toc"><a href="#sec283">12.4.4&#XA0;&#XA0;Error handling</a>
</li></ul>
</li><li class="li-toc"><a href="#sec284">12.5&#XA0;&#XA0;Options</a>
</li><li class="li-toc"><a href="#sec285">12.6&#XA0;&#XA0;A complete example</a>
</li><li class="li-toc"><a href="#sec286">12.7&#XA0;&#XA0;Common errors</a>
</li></ul>
</li><li class="li-toc"><a href="#sec287">Chapter&#XA0;13&#XA0;&#XA0;Dependency generator (ocamldep)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec288">13.1&#XA0;&#XA0;Options</a>
</li><li class="li-toc"><a href="#sec289">13.2&#XA0;&#XA0;A typical Makefile</a>
</li></ul>
</li><li class="li-toc"><a href="#sec290">Chapter&#XA0;14&#XA0;&#XA0;The browser/editor (ocamlbrowser)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec291">14.1&#XA0;&#XA0;Invocation</a>
</li><li class="li-toc"><a href="#sec292">14.2&#XA0;&#XA0;Viewer</a>
</li><li class="li-toc"><a href="#sec293">14.3&#XA0;&#XA0;Module browsing</a>
</li><li class="li-toc"><a href="#sec294">14.4&#XA0;&#XA0;File editor</a>
</li><li class="li-toc"><a href="#sec295">14.5&#XA0;&#XA0;Shell</a>
</li></ul>
</li><li class="li-toc"><a href="#sec296">Chapter&#XA0;15&#XA0;&#XA0;The documentation generator (ocamldoc)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec297">15.1&#XA0;&#XA0;Usage</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec298">15.1.1&#XA0;&#XA0;Invocation</a>
</li><li class="li-toc"><a href="#sec307">15.1.2&#XA0;&#XA0;Merging of module information</a>
</li><li class="li-toc"><a href="#sec308">15.1.3&#XA0;&#XA0;Coding rules</a>
</li></ul>
</li><li class="li-toc"><a href="#sec309">15.2&#XA0;&#XA0;Syntax of documentation comments</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec310">15.2.1&#XA0;&#XA0;Placement of documentation comments</a>
</li><li class="li-toc"><a href="#sec313">15.2.2&#XA0;&#XA0;The Stop special comment</a>
</li><li class="li-toc"><a href="#sec314">15.2.3&#XA0;&#XA0;Syntax of documentation comments</a>
</li><li class="li-toc"><a href="#sec315">15.2.4&#XA0;&#XA0;Text formatting</a>
</li><li class="li-toc"><a href="#sec321">15.2.5&#XA0;&#XA0;Documentation tags (@-tags)</a>
</li></ul>
</li><li class="li-toc"><a href="#sec324">15.3&#XA0;&#XA0;Custom generators</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec325">15.3.1&#XA0;&#XA0;The generator modules</a>
</li><li class="li-toc"><a href="#sec326">15.3.2&#XA0;&#XA0;Handling custom tags</a>
</li></ul>
</li><li class="li-toc"><a href="#sec329">15.4&#XA0;&#XA0;Adding command line options</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec330">15.4.1&#XA0;&#XA0;Compilation and usage</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec333">Chapter&#XA0;16&#XA0;&#XA0;The debugger (ocamldebug)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec334">16.1&#XA0;&#XA0;Compiling for debugging</a>
</li><li class="li-toc"><a href="#sec335">16.2&#XA0;&#XA0;Invocation</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec336">16.2.1&#XA0;&#XA0;Starting the debugger</a>
</li><li class="li-toc"><a href="#sec337">16.2.2&#XA0;&#XA0;Exiting the debugger</a>
</li></ul>
</li><li class="li-toc"><a href="#sec338">16.3&#XA0;&#XA0;Commands</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec339">16.3.1&#XA0;&#XA0;Getting help</a>
</li><li class="li-toc"><a href="#sec340">16.3.2&#XA0;&#XA0;Accessing the debugger state</a>
</li></ul>
</li><li class="li-toc"><a href="#sec341">16.4&#XA0;&#XA0;Executing a program</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec342">16.4.1&#XA0;&#XA0;Events</a>
</li><li class="li-toc"><a href="#sec343">16.4.2&#XA0;&#XA0;Starting the debugged program</a>
</li><li class="li-toc"><a href="#sec344">16.4.3&#XA0;&#XA0;Running the program</a>
</li><li class="li-toc"><a href="#sec345">16.4.4&#XA0;&#XA0;Time travel</a>
</li><li class="li-toc"><a href="#sec346">16.4.5&#XA0;&#XA0;Killing the program</a>
</li></ul>
</li><li class="li-toc"><a href="#sec347">16.5&#XA0;&#XA0;Breakpoints</a>
</li><li class="li-toc"><a href="#sec348">16.6&#XA0;&#XA0;The call stack</a>
</li><li class="li-toc"><a href="#sec349">16.7&#XA0;&#XA0;Examining variable values</a>
</li><li class="li-toc"><a href="#sec350">16.8&#XA0;&#XA0;Controlling the debugger</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec351">16.8.1&#XA0;&#XA0;Setting the program name and arguments</a>
</li><li class="li-toc"><a href="#sec352">16.8.2&#XA0;&#XA0;How programs are loaded</a>
</li><li class="li-toc"><a href="#sec353">16.8.3&#XA0;&#XA0;Search path for files</a>
</li><li class="li-toc"><a href="#sec354">16.8.4&#XA0;&#XA0;Working directory</a>
</li><li class="li-toc"><a href="#sec355">16.8.5&#XA0;&#XA0;Turning reverse execution on and off</a>
</li><li class="li-toc"><a href="#sec356">16.8.6&#XA0;&#XA0;Communication between the debugger and the program</a>
</li><li class="li-toc"><a href="#sec357">16.8.7&#XA0;&#XA0;Fine-tuning the debugger</a>
</li><li class="li-toc"><a href="#sec358">16.8.8&#XA0;&#XA0;User-defined printers</a>
</li></ul>
</li><li class="li-toc"><a href="#sec359">16.9&#XA0;&#XA0;Miscellaneous commands</a>
</li><li class="li-toc"><a href="#sec360">16.10&#XA0;&#XA0;Running the debugger under Emacs</a>
</li></ul>
</li><li class="li-toc"><a href="#sec361">Chapter&#XA0;17&#XA0;&#XA0;Profiling (ocamlprof)</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec362">17.1&#XA0;&#XA0;Compiling for profiling</a>
</li><li class="li-toc"><a href="#sec366">17.2&#XA0;&#XA0;Profiling an execution</a>
</li><li class="li-toc"><a href="#sec367">17.3&#XA0;&#XA0;Printing profiling information</a>
</li><li class="li-toc"><a href="#sec368">17.4&#XA0;&#XA0;Time profiling</a>
</li></ul>
</li><li class="li-toc"><a href="#sec370">Chapter&#XA0;18&#XA0;&#XA0;The ocamlbuild compilation manager</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec371">18.1&#XA0;&#XA0;Features of <span class="c007">ocamlbuild</span></a>
</li><li class="li-toc"><a href="#sec372">18.2&#XA0;&#XA0;Limitations</a>
</li><li class="li-toc"><a href="#sec373">18.3&#XA0;&#XA0;Using <span class="c007">ocamlbuild</span></a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec374">18.3.1&#XA0;&#XA0;Hygiene &amp; where is my code ?</a>
</li><li class="li-toc"><a href="#sec375">18.3.2&#XA0;&#XA0;Hello, world !</a>
</li><li class="li-toc"><a href="#sec376">18.3.3&#XA0;&#XA0;Executing my code</a>
</li><li class="li-toc"><a href="#sec377">18.3.4&#XA0;&#XA0;The log file, verbosity and debugging</a>
</li><li class="li-toc"><a href="#sec378">18.3.5&#XA0;&#XA0;Cleaning</a>
</li><li class="li-toc"><a href="#sec379">18.3.6&#XA0;&#XA0;Where and how to run <span class="c007">ocamlbuild</span>?</a>
</li><li class="li-toc"><a href="#sec380">18.3.7&#XA0;&#XA0;Dependencies</a>
</li><li class="li-toc"><a href="#sec381">18.3.8&#XA0;&#XA0;Native and byte-code</a>
</li><li class="li-toc"><a href="#sec382">18.3.9&#XA0;&#XA0;Compile flags</a>
</li><li class="li-toc"><a href="#sec383">18.3.10&#XA0;&#XA0;Link flags</a>
</li><li class="li-toc"><a href="#sec384">18.3.11&#XA0;&#XA0;Linking with external libraries</a>
</li><li class="li-toc"><a href="#sec385">18.3.12&#XA0;&#XA0;The <span class="c007">_tags</span> files</a>
</li><li class="li-toc"><a href="#sec387">18.3.13&#XA0;&#XA0;Glob patterns and expressions</a>
</li><li class="li-toc"><a href="#sec388">18.3.14&#XA0;&#XA0;Subdirectories</a>
</li><li class="li-toc"><a href="#sec390">18.3.15&#XA0;&#XA0;Grouping targets with <span class="c007">.itarget</span></a>
</li><li class="li-toc"><a href="#sec391">18.3.16&#XA0;&#XA0;Packing subdirectories into modules</a>
</li><li class="li-toc"><a href="#sec392">18.3.17&#XA0;&#XA0;Making an OCaml library</a>
</li><li class="li-toc"><a href="#sec393">18.3.18&#XA0;&#XA0;Making an OCaml toplevel</a>
</li><li class="li-toc"><a href="#sec394">18.3.19&#XA0;&#XA0;Preprocessor options and tags</a>
</li><li class="li-toc"><a href="#sec395">18.3.20&#XA0;&#XA0;Debugging byte code and profiling native code</a>
</li><li class="li-toc"><a href="#sec396">18.3.21&#XA0;&#XA0;Generating documentation using <span class="c007">ocamldoc</span></a>
</li><li class="li-toc"><a href="#sec397">18.3.22&#XA0;&#XA0;The display line</a>
</li><li class="li-toc"><a href="#sec398">18.3.23&#XA0;&#XA0;<span class="c007">ocamllex</span>, <span class="c007">ocamlyacc</span> and <span class="c007">menhir</span></a>
</li><li class="li-toc"><a href="#sec399">18.3.24&#XA0;&#XA0;Changing the compilers or tools</a>
</li><li class="li-toc"><a href="#sec400">18.3.25&#XA0;&#XA0;Interaction with version control systems</a>
</li><li class="li-toc"><a href="#sec401">18.3.26&#XA0;&#XA0;A shell script for driving it all?</a>
</li></ul>
</li><li class="li-toc"><a href="#sec402">18.4&#XA0;&#XA0;Appendix: Motivations</a>
</li><li class="li-toc"><a href="#sec403">18.5&#XA0;&#XA0;Appendix: Summary of default rules</a>
</li></ul>
</li><li class="li-toc"><a href="#c%3Aintf-c">Chapter&#XA0;19&#XA0;&#XA0;Interfacing C with OCaml</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec405">19.1&#XA0;&#XA0;Overview and compilation information</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec406">19.1.1&#XA0;&#XA0;Declaring primitives</a>
</li><li class="li-toc"><a href="#sec407">19.1.2&#XA0;&#XA0;Implementing primitives</a>
</li><li class="li-toc"><a href="#sec408">19.1.3&#XA0;&#XA0;Statically linking C code with OCaml code</a>
</li><li class="li-toc"><a href="#sec409">19.1.4&#XA0;&#XA0;Dynamically linking C code with OCaml code</a>
</li><li class="li-toc"><a href="#sec410">19.1.5&#XA0;&#XA0;Choosing between static linking and dynamic linking</a>
</li><li class="li-toc"><a href="#sec411">19.1.6&#XA0;&#XA0;Building standalone custom runtime systems</a>
</li></ul>
</li><li class="li-toc"><a href="#sec412">19.2&#XA0;&#XA0;The <span class="c007">value</span> type</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec413">19.2.1&#XA0;&#XA0;Integer values</a>
</li><li class="li-toc"><a href="#sec414">19.2.2&#XA0;&#XA0;Blocks</a>
</li><li class="li-toc"><a href="#sec415">19.2.3&#XA0;&#XA0;Pointers outside the heap</a>
</li></ul>
</li><li class="li-toc"><a href="#sec416">19.3&#XA0;&#XA0;Representation of OCaml data types</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec417">19.3.1&#XA0;&#XA0;Atomic types</a>
</li><li class="li-toc"><a href="#sec418">19.3.2&#XA0;&#XA0;Tuples and records</a>
</li><li class="li-toc"><a href="#sec419">19.3.3&#XA0;&#XA0;Arrays</a>
</li><li class="li-toc"><a href="#sec420">19.3.4&#XA0;&#XA0;Concrete data types</a>
</li><li class="li-toc"><a href="#sec421">19.3.5&#XA0;&#XA0;Objects</a>
</li><li class="li-toc"><a href="#sec422">19.3.6&#XA0;&#XA0;Polymorphic variants</a>
</li></ul>
</li><li class="li-toc"><a href="#sec423">19.4&#XA0;&#XA0;Operations on values</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec424">19.4.1&#XA0;&#XA0;Kind tests</a>
</li><li class="li-toc"><a href="#sec425">19.4.2&#XA0;&#XA0;Operations on integers</a>
</li><li class="li-toc"><a href="#sec426">19.4.3&#XA0;&#XA0;Accessing blocks</a>
</li><li class="li-toc"><a href="#sec427">19.4.4&#XA0;&#XA0;Allocating blocks</a>
</li><li class="li-toc"><a href="#sec430">19.4.5&#XA0;&#XA0;Raising exceptions</a>
</li></ul>
</li><li class="li-toc"><a href="#sec431">19.5&#XA0;&#XA0;Living in harmony with the garbage collector</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec432">19.5.1&#XA0;&#XA0;Simple interface</a>
</li><li class="li-toc"><a href="#sec437">19.5.2&#XA0;&#XA0;Low-level interface</a>
</li></ul>
</li><li class="li-toc"><a href="#sec438">19.6&#XA0;&#XA0;A complete example</a>
</li><li class="li-toc"><a href="#sec439">19.7&#XA0;&#XA0;Advanced topic: callbacks from C to OCaml</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec440">19.7.1&#XA0;&#XA0;Applying OCaml closures from C</a>
</li><li class="li-toc"><a href="#sec442">19.7.2&#XA0;&#XA0;Obtaining or registering OCaml closures for use in C functions</a>
</li><li class="li-toc"><a href="#sec443">19.7.3&#XA0;&#XA0;Registering OCaml exceptions for use in C functions</a>
</li><li class="li-toc"><a href="#sec444">19.7.4&#XA0;&#XA0;Main program in C</a>
</li><li class="li-toc"><a href="#sec445">19.7.5&#XA0;&#XA0;Embedding the OCaml code in the C code</a>
</li></ul>
</li><li class="li-toc"><a href="#sec448">19.8&#XA0;&#XA0;Advanced example with callbacks</a>
</li><li class="li-toc"><a href="#sec449">19.9&#XA0;&#XA0;Advanced topic: custom blocks</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec450">19.9.1&#XA0;&#XA0;The <span class="c007">struct custom_operations</span></a>
</li><li class="li-toc"><a href="#sec451">19.9.2&#XA0;&#XA0;Allocating custom blocks</a>
</li><li class="li-toc"><a href="#sec452">19.9.3&#XA0;&#XA0;Accessing custom blocks</a>
</li><li class="li-toc"><a href="#sec453">19.9.4&#XA0;&#XA0;Writing custom serialization and deserialization functions</a>
</li><li class="li-toc"><a href="#sec454">19.9.5&#XA0;&#XA0;Choosing identifiers</a>
</li><li class="li-toc"><a href="#sec455">19.9.6&#XA0;&#XA0;Finalized blocks</a>
</li></ul>
</li><li class="li-toc"><a href="#sec456">19.10&#XA0;&#XA0;Advanced topic: multithreading</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec457">19.10.1&#XA0;&#XA0;Registering threads created from C</a>
</li><li class="li-toc"><a href="#sec458">19.10.2&#XA0;&#XA0;Parallel execution of long-running C code</a>
</li></ul>
</li><li class="li-toc"><a href="#sec459">19.11&#XA0;&#XA0;Building mixed C/OCaml libraries: <span class="c007">ocamlmklib</span></a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec461">Part&#XA0;IV&#XA0;&#XA0;The OCaml library</a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec462">Chapter&#XA0;20&#XA0;&#XA0;The core library</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec464">20.1&#XA0;&#XA0;Built-in types and predefined exceptions</a>
</li><li class="li-toc"><a href="#sec467">20.2&#XA0;&#XA0;Module <span class="c007">Pervasives</span>: the initially opened module</a>
</li></ul>
</li><li class="li-toc"><a href="#sec468">Chapter&#XA0;21&#XA0;&#XA0;The standard library</a>
</li><li class="li-toc"><a href="#sec470">Chapter&#XA0;22&#XA0;&#XA0;The unix library: Unix system calls</a>
</li><li class="li-toc"><a href="#sec471">Chapter&#XA0;23&#XA0;&#XA0;The num library: arbitrary-precision rational arithmetic</a>
</li><li class="li-toc"><a href="#sec472">Chapter&#XA0;24&#XA0;&#XA0;The str library: regular expressions and string processing</a>
</li><li class="li-toc"><a href="#sec473">Chapter&#XA0;25&#XA0;&#XA0;The threads library</a>
</li><li class="li-toc"><a href="#sec474">Chapter&#XA0;26&#XA0;&#XA0;The graphics library</a>
</li><li class="li-toc"><a href="#sec475">Chapter&#XA0;27&#XA0;&#XA0;The dynlink library: dynamic loading and linking of object files</a>
</li><li class="li-toc"><a href="#sec476">Chapter&#XA0;28&#XA0;&#XA0;The LablTk library: Tcl/Tk GUI interface</a>
</li><li class="li-toc"><a href="#sec477">Chapter&#XA0;29&#XA0;&#XA0;The bigarray library</a>
<ul class="ftoc3"><li class="li-toc">
<a href="#sec478">29.1&#XA0;&#XA0;Module <span class="c007">Bigarray</span>: large, multi-dimensional, numerical arrays</a>
</li><li class="li-toc"><a href="#sec479">29.2&#XA0;&#XA0;Big arrays in the OCaml-C interface</a>
<ul class="ftoc4"><li class="li-toc">
<a href="#sec480">29.2.1&#XA0;&#XA0;Include file</a>
</li><li class="li-toc"><a href="#sec481">29.2.2&#XA0;&#XA0;Accessing an OCaml bigarray from C or Fortran</a>
</li><li class="li-toc"><a href="#sec482">29.2.3&#XA0;&#XA0;Wrapping a C or Fortran array as an OCaml big array</a>
</li></ul>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec483">Part&#XA0;V&#XA0;&#XA0;Appendix</a>
</li></ul><!--TOC chapter id="sec2" Foreword-->
<h1 class="chapter" id="sec2">Foreword</h1><!--SEC END --><!--NAME foreword.html-->
<p>This manual documents the release 4.01 of the OCaml
system. It is organized as follows.
</p><ul class="itemize"><li class="li-itemize">
Part&#XA0;<a href="#p%3Atutorials">I</a>, &#X201C;An introduction to OCaml&#X201D;,
gives an overview of the language.
</li><li class="li-itemize">Part&#XA0;<a href="#p%3Arefman">II</a>, &#X201C;The OCaml language&#X201D;, is the
reference description of the language.
</li><li class="li-itemize">Part&#XA0;<a href="#p%3Acommands">III</a>, &#X201C;The OCaml tools&#X201D;, documents
the compilers, toplevel system, and programming utilities.
</li><li class="li-itemize">Part&#XA0;<a href="#p%3Alibrary">IV</a>, &#X201C;The OCaml library&#X201D;, describes the
modules provided in the standard library.

</li></ul><!--TOC section id="sec3" Conventions-->
<h2 class="section" id="sec3">Conventions</h2><!--SEC END --><p>OCaml runs on several operating systems. The parts of
this manual that are specific to one operating system are presented as
shown below:</p><blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0; This is material specific to the Unix family of operating
systems, including Linux and MacOS&#XA0;X.
</blockquote><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0; This is material specific to Microsoft Windows (2000,
XP, Vista, Seven).
</blockquote><!--TOC section id="sec4" License-->
<h2 class="section" id="sec4">License</h2><!--SEC END --><p>The OCaml system is copyright &#XA9; 1996&#X2013;2013
Institut National de Recherche en Informatique et en
Automatique (INRIA).
INRIA holds all ownership rights to the OCaml system.</p><p>The OCaml system is open source and can be freely
redistributed. See the file <span class="c007">LICENSE</span> in the distribution for
licensing information.</p><p>The present documentation is copyright &#XA9; 2013
Institut National de Recherche en Informatique et en
Automatique (INRIA). The OCaml documentation and user&#X2019;s
manual may be reproduced and distributed in whole or
in part, subject to the following conditions:
</p><ul class="itemize"><li class="li-itemize">
The copyright notice above and this permission notice must be
preserved complete on all complete or partial copies.
</li><li class="li-itemize">Any translation or derivative work of the OCaml
documentation and user&#X2019;s manual must be approved by the authors in
writing before distribution.
</li><li class="li-itemize">If you distribute the OCaml
documentation and user&#X2019;s manual in part, instructions for obtaining
the complete version of this manual must be included, and a
means for obtaining a complete version provided.
</li><li class="li-itemize">Small portions may be reproduced as illustrations for reviews or
quotes in other works without this permission notice if proper
citation is given.
</li></ul><!--TOC section id="sec5" Availability-->
<h2 class="section" id="sec5">Availability</h2><!--SEC END --><p>
The complete OCaml distribution can be accessed via the
<a href="http://caml.inria.fr/">Caml Web site</a>.
The <a href="http://caml.inria.fr/">Caml Web site</a>
contains a lot of additional information on OCaml.

</p>
<!--TOC part id="sec6" An introduction to OCaml-->
<table class="center"><tr><td><h1 class="part" id="sec6">Part&#XA0;I<br>
An introduction to OCaml</h1></td></tr>
</table><!--SEC END --><p>
<a id="p:tutorials"></a>
</p>
<!--TOC chapter id="sec7" The core language-->
<h1 class="chapter" id="sec7">Chapter&#XA0;1&#XA0;&#XA0;The core language</h1><!--SEC END --><p> <a id="c:core-xamples"></a>

</p><!--NAME coreexamples.html-->
<p>This part of the manual is a tutorial introduction to the
OCaml language. A good familiarity with programming in a conventional
languages (say, Pascal or C) is assumed, but no prior exposure to
functional languages is required. The present chapter introduces the
core language. Chapter&#XA0;<a href="#c%3Amoduleexamples">2</a> deals with the
module system, chapter&#XA0;<a href="#c%3Aobjectexamples">3</a> with the
object-oriented features, chapter&#XA0;<a href="#c%3Alabl-examples">4</a> with
extensions to the core language (labeled arguments and polymorphic
variants), and chapter&#XA0;<a href="#c%3Aadvexamples">5</a> gives some advanced examples.</p>
<!--TOC section id="sec8" Basics-->
<h2 class="section" id="sec8">1.1&#XA0;&#XA0;Basics</h2><!--SEC END --><p>For this overview of OCaml, we use the interactive system, which
is started by running <span class="c007">ocaml</span> from the Unix shell, or by launching the
<span class="c007">OCamlwin.exe</span> application under Windows. This tutorial is presented
as the transcript of a session with the interactive system:
lines starting with <span class="c007">#</span> represent user input; the system responses are
printed below, without a leading <span class="c007">#</span>.</p><p>Under the interactive system, the user types OCaml phrases terminated
by <span class="c007">;;</span> in response to the <span class="c007">#</span> prompt, and the system compiles them
on the fly, executes them, and prints the outcome of evaluation.
Phrases are either simple expressions, or <span class="c007">let</span> definitions of
identifiers (either values or functions).
</p><pre><span class="c004">#</span><span class="c003"> 1+2*3;;
<span class="c006">- : int = 7

</span><span class="c004">#</span> let pi = 4.0 *. atan 1.0;;
<span class="c006">val pi : float = 3.14159265358979312

</span><span class="c004">#</span> let square x = x *. x;;
<span class="c006">val square : float -&gt; float = &lt;fun&gt;

</span><span class="c004">#</span> square (sin pi) +. square (cos pi);;
</span><span class="c006">- : float = 1.
</span></pre><p>
The OCaml system computes both the value and the type for
each phrase. Even function parameters need no explicit type declaration:
the system infers their types from their usage in the
function. Notice also that integers and floating-point numbers are
distinct types, with distinct operators: <span class="c007">+</span> and <span class="c007">*</span> operate on
integers, but <span class="c007">+.</span> and <span class="c007">*.</span> operate on floats.
</p><pre><span class="c004">#</span> <span class="c003"><U>1.0</U> * 2;;
</span><span class="c006">Error: This expression has type float but an expression was expected of type
         int
</span></pre><p>Recursive functions are defined with the <span class="c007">let rec</span> binding:
</p><pre><span class="c004">#</span><span class="c003"> let rec fib n =
    if n &lt; 2 then n else fib (n-1) + fib (n-2);;
<span class="c006">val fib : int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> fib 10;;
</span><span class="c006">- : int = 55
</span></pre>
<!--TOC section id="sec9" Data types-->
<h2 class="section" id="sec9">1.2&#XA0;&#XA0;Data types</h2><!--SEC END --><p>In addition to integers and floating-point numbers, OCaml offers the
usual basic data types: booleans, characters, and character strings.
</p><pre><span class="c004">#</span><span class="c003"> (1 &lt; 2) = false;;
<span class="c006">- : bool = false

</span><span class="c004">#</span> 'a';;
<span class="c006">- : char = 'a'

</span><span class="c004">#</span> "Hello world";;
</span><span class="c006">- : string = "Hello world"
</span></pre><p>Predefined data structures include tuples, arrays, and lists. General
mechanisms for defining your own data structures are also provided.
They will be covered in more details later; for now, we concentrate on lists.
Lists are either given in extension as a bracketed list of
semicolon-separated elements, or built from the empty list <span class="c007">[]</span>
(pronounce &#X201C;nil&#X201D;) by adding elements in front using the <span class="c007">::</span>
(&#X201C;cons&#X201D;) operator.
</p><pre><span class="c004">#</span><span class="c003"> let l = ["is"; "a"; "tale"; "told"; "etc."];;
<span class="c006">val l : string list = ["is"; "a"; "tale"; "told"; "etc."]

</span><span class="c004">#</span> "Life" :: l;;
</span><span class="c006">- : string list = ["Life"; "is"; "a"; "tale"; "told"; "etc."]
</span></pre><p>
As with all other OCaml data structures, lists do not need to be
explicitly allocated and deallocated from memory: all memory
management is entirely automatic in OCaml. Similarly, there is no
explicit handling of pointers: the OCaml compiler silently introduces
pointers where necessary.</p><p>As with most OCaml data structures, inspecting and destructuring lists
is performed by pattern-matching. List patterns have the exact same
shape as list expressions, with identifier representing unspecified
parts of the list. As an example, here is insertion sort on a list:
</p><pre><span class="c004">#</span><span class="c003"> let rec sort lst =
    match lst with
      [] -&gt; []
    | head :: tail -&gt; insert head (sort tail)
  and insert elt lst =
    match lst with
      [] -&gt; [elt]
    | head :: tail -&gt; if elt &lt;= head then elt :: lst else head :: insert elt tail
  ;;
<span class="c006">val sort : 'a list -&gt; 'a list = &lt;fun&gt;
val insert : 'a -&gt; 'a list -&gt; 'a list = &lt;fun&gt;

</span><span class="c004">#</span> sort l;;
</span><span class="c006">- : string list = ["a"; "etc."; "is"; "tale"; "told"]
</span></pre><p>The type inferred for <span class="c007">sort</span>, <span class="c007">'a list -&gt; 'a list</span>, means that <span class="c007">sort</span>
can actually apply to lists of any type, and returns a list of the
same type. The type <span class="c007">'a</span> is a <em>type variable</em>, and stands for any
given type. The reason why <span class="c007">sort</span> can apply to lists of any type is
that the comparisons (<span class="c007">=</span>, <span class="c007">&lt;=</span>, etc.) are <em>polymorphic</em> in OCaml:
they operate between any two values of the same type. This makes
<span class="c007">sort</span> itself polymorphic over all list types.
</p><pre><span class="c004">#</span><span class="c003"> sort [6;2;5;3];;
<span class="c006">- : int list = [2; 3; 5; 6]

</span><span class="c004">#</span> sort [3.14; 2.718];;
</span><span class="c006">- : float list = [2.718; 3.14]
</span></pre><p>The <span class="c007">sort</span> function above does not modify its input list: it builds
and returns a new list containing the same elements as the input list,
in ascending order. There is actually no way in OCaml to modify
in-place a list once it is built: we say that lists are <em>immutable</em>
data structures. Most OCaml data structures are immutable, but a few
(most notably arrays) are <em>mutable</em>, meaning that they can be
modified in-place at any time.</p>
<!--TOC section id="sec10" Functions as values-->
<h2 class="section" id="sec10">1.3&#XA0;&#XA0;Functions as values</h2><!--SEC END --><p>OCaml is a functional language: functions in the full mathematical
sense are supported and can be passed around freely just as any other
piece of data. For instance, here is a <span class="c007">deriv</span> function that takes any
float function as argument and returns an approximation of its
derivative function:
</p><pre><span class="c004">#</span><span class="c003"> let deriv f dx = function x -&gt; (f (x +. dx) -. f x) /. dx;;
<span class="c006">val deriv : (float -&gt; float) -&gt; float -&gt; float -&gt; float = &lt;fun&gt;

</span><span class="c004">#</span> let sin' = deriv sin 1e-6;;
<span class="c006">val sin' : float -&gt; float = &lt;fun&gt;

</span><span class="c004">#</span> sin' pi;;
</span><span class="c006">- : float = -1.00000000013961143
</span></pre><p>
Even function composition is definable:
</p><pre><span class="c004">#</span><span class="c003"> let compose f g = function x -&gt; f (g x);;
<span class="c006">val compose : ('a -&gt; 'b) -&gt; ('c -&gt; 'a) -&gt; 'c -&gt; 'b = &lt;fun&gt;

</span><span class="c004">#</span> let cos2 = compose square cos;;
</span><span class="c006">val cos2 : float -&gt; float = &lt;fun&gt;
</span></pre><p>Functions that take other functions as arguments are called
&#X201C;functionals&#X201D;, or &#X201C;higher-order functions&#X201D;. Functionals are
especially useful to provide iterators or similar generic operations
over a data structure. For instance, the standard OCaml library
provides a <span class="c007">List.map</span> functional that applies a given function to each
element of a list, and returns the list of the results:
</p><pre><span class="c004">#<span class="c003"> List.map (function n -&gt; n * 2 + 1) [0;1;2;3;4];;
<span class="c006">- : int list = [1; 3; 5; 7; 9]
</span></span></span></pre><p>
This functional, along with a number of other list and array
functionals, is predefined because it is often useful, but there is
nothing magic with it: it can easily be defined as follows.
</p><pre><span class="c004">#<span class="c003"> let rec map f l =
    match l with
      [] -&gt; []
    | hd :: tl -&gt; f hd :: map f tl;;
<span class="c006">val map : ('a -&gt; 'b) -&gt; 'a list -&gt; 'b list = &lt;fun&gt;
</span></span></span></pre>
<!--TOC section id="sec11" Records and variants-->
<h2 class="section" id="sec11">1.4&#XA0;&#XA0;Records and variants</h2><!--SEC END --><p>

<a id="s:tut-recvariants"></a></p><p>User-defined data structures include records and variants. Both are
defined with the <span class="c007">type</span> declaration. Here, we declare a record type to
represent rational numbers.
</p><pre><span class="c004">#</span><span class="c003"> type ratio = {num: int; denom: int};;
<span class="c006">type ratio = { num : int; denom : int; }

</span><span class="c004">#</span> let add_ratio r1 r2 =
    {num = r1.num * r2.denom + r2.num * r1.denom;
     denom = r1.denom * r2.denom};;
<span class="c006">val add_ratio : ratio -&gt; ratio -&gt; ratio = &lt;fun&gt;

</span><span class="c004">#</span> add_ratio {num=1; denom=3} {num=2; denom=5};;
</span><span class="c006">- : ratio = {num = 11; denom = 15}
</span></pre><p>The declaration of a variant type lists all possible shapes for values
of that type. Each case is identified by a name, called a constructor,
which serves both for constructing values of the variant type and
inspecting them by pattern-matching. Constructor names are capitalized
to distinguish them from variable names (which must start with a
lowercase letter). For instance, here is a variant
type for doing mixed arithmetic (integers and floats):
</p><pre><span class="c004">#<span class="c003"> type number = Int of int | Float of float | Error;;
<span class="c006">type number = Int of int | Float of float | Error
</span></span></span></pre><p>
This declaration expresses that a value of type <span class="c007">number</span> is either an
integer, a floating-point number, or the constant <span class="c007">Error</span> representing
the result of an invalid operation (e.g. a division by zero).</p><p>Enumerated types are a special case of variant types, where all
alternatives are constants:
</p><pre><span class="c004">#</span><span class="c003"> type sign = Positive | Negative;;
<span class="c006">type sign = Positive | Negative

</span><span class="c004">#</span> let sign_int n = if n &gt;= 0 then Positive else Negative;;
</span><span class="c006">val sign_int : int -&gt; sign = &lt;fun&gt;
</span></pre><p>To define arithmetic operations for the <span class="c007">number</span> type, we use
pattern-matching on the two numbers involved:
</p><pre><span class="c004">#</span><span class="c003"> let add_num n1 n2 =
    match (n1, n2) with
      (Int i1, Int i2) -&gt;
        (* Check for overflow of integer addition *)
        if sign_int i1 = sign_int i2 &amp;&amp; sign_int (i1 + i2) &lt;&gt; sign_int i1
        then Float(float i1 +. float i2)
        else Int(i1 + i2)
    | (Int i1, Float f2) -&gt; Float(float i1 +. f2)
    | (Float f1, Int i2) -&gt; Float(f1 +. float i2)
    | (Float f1, Float f2) -&gt; Float(f1 +. f2)
    | (Error, _) -&gt; Error
    | (_, Error) -&gt; Error;;
<span class="c006">val add_num : number -&gt; number -&gt; number = &lt;fun&gt;

</span><span class="c004">#</span> add_num (Int 123) (Float 3.14159);;
</span><span class="c006">- : number = Float 126.14159
</span></pre><p>The most common usage of variant types is to describe recursive data
structures. Consider for example the type of binary trees:
</p><pre><span class="c004">#<span class="c003"> type 'a btree = Empty | Node of 'a * 'a btree * 'a btree;;
<span class="c006">type 'a btree = Empty | Node of 'a * 'a btree * 'a btree
</span></span></span></pre><p>
This definition reads as follow: a binary tree containing values of
type <span class="c007">'a</span> (an arbitrary type) is either empty, or is a node containing
one value of type <span class="c007">'a</span> and two subtrees containing also values of type
<span class="c007">'a</span>, that is, two <span class="c007">'a btree</span>.</p><p>Operations on binary trees are naturally expressed as recursive functions
following the same structure as the type definition itself. For
instance, here are functions performing lookup and insertion in
ordered binary trees (elements increase from left to right):
</p><pre><span class="c004">#</span><span class="c003"> let rec member x btree =
    match btree with
      Empty -&gt; false
    | Node(y, left, right) -&gt;
        if x = y then true else
        if x &lt; y then member x left else member x right;;
<span class="c006">val member : 'a -&gt; 'a btree -&gt; bool = &lt;fun&gt;

</span><span class="c004">#</span> let rec insert x btree =
    match btree with
      Empty -&gt; Node(x, Empty, Empty)
    | Node(y, left, right) -&gt;
        if x &lt;= y then Node(y, insert x left, right)
                  else Node(y, left, insert x right);;
</span><span class="c006">val insert : 'a -&gt; 'a btree -&gt; 'a btree = &lt;fun&gt;
</span></pre>
<!--TOC section id="sec12" Imperative features-->
<h2 class="section" id="sec12">1.5&#XA0;&#XA0;Imperative features</h2><!--SEC END --><p>Though all examples so far were written in purely applicative style,
OCaml is also equipped with full imperative features. This includes the
usual <span class="c007">while</span> and <span class="c007">for</span> loops, as well as mutable data structures such
as arrays. Arrays are either given in extension between <span class="c007">[|</span> and <span class="c007">|]</span>
brackets, or allocated and initialized with the <span class="c007">Array.create</span>
function, then filled up later by assignments. For instance, the
function below sums two vectors (represented as float arrays) componentwise.
</p><pre><span class="c004">#</span><span class="c003"> let add_vect v1 v2 =
    let len = min (Array.length v1) (Array.length v2) in
    let res = Array.create len 0.0 in
    for i = 0 to len - 1 do
      res.(i) &lt;- v1.(i) +. v2.(i)
    done;
    res;;
<span class="c006">val add_vect : float array -&gt; float array -&gt; float array = &lt;fun&gt;

</span><span class="c004">#</span> add_vect [| 1.0; 2.0 |] [| 3.0; 4.0 |];;
</span><span class="c006">- : float array = [|4.; 6.|]
</span></pre><p>Record fields can also be modified by assignment, provided they are
declared <span class="c007">mutable</span> in the definition of the record type:
</p><pre><span class="c004">#</span><span class="c003"> type mutable_point = { mutable x: float; mutable y: float };;
<span class="c006">type mutable_point = { mutable x : float; mutable y : float; }

</span><span class="c004">#</span> let translate p dx dy =
    p.x &lt;- p.x +. dx; p.y &lt;- p.y +. dy;;
<span class="c006">val translate : mutable_point -&gt; float -&gt; float -&gt; unit = &lt;fun&gt;

</span><span class="c004">#</span> let mypoint = { x = 0.0; y = 0.0 };;
<span class="c006">val mypoint : mutable_point = {x = 0.; y = 0.}

</span><span class="c004">#</span> translate mypoint 1.0 2.0;;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> mypoint;;
</span><span class="c006">- : mutable_point = {x = 1.; y = 2.}
</span></pre><p>OCaml has no built-in notion of variable &#X2013; identifiers whose current
value can be changed by assignment. (The <span class="c007">let</span> binding is not an
assignment, it introduces a new identifier with a new scope.)
However, the standard library provides references, which are mutable
indirection cells (or one-element arrays), with operators <span class="c007">!</span> to fetch
the current contents of the reference and <span class="c007">:=</span> to assign the contents.
Variables can then be emulated by <span class="c007">let</span>-binding a reference. For
instance, here is an in-place insertion sort over arrays:
</p><pre><span class="c004">#<span class="c003"> let insertion_sort a =
    for i = 1 to Array.length a - 1 do
      let val_i = a.(i) in
      let j = ref i in
      while !j &gt; 0 &amp;&amp; val_i &lt; a.(!j - 1) do
        a.(!j) &lt;- a.(!j - 1);
        j := !j - 1
      done;
      a.(!j) &lt;- val_i
    done;;
<span class="c006">val insertion_sort : 'a array -&gt; unit = &lt;fun&gt;
</span></span></span></pre><p>References are also useful to write functions that maintain a current
state between two calls to the function. For instance, the following
pseudo-random number generator keeps the last returned number in a
reference:
</p><pre><span class="c004">#</span><span class="c003"> let current_rand = ref 0;;
<span class="c006">val current_rand : int ref = {contents = 0}

</span><span class="c004">#</span> let random () =
    current_rand := !current_rand * 25713 + 1345;
    !current_rand;;
</span><span class="c006">val random : unit -&gt; int = &lt;fun&gt;
</span></pre><p>Again, there is nothing magical with references: they are implemented as
a single-field mutable record, as follows.
</p><pre><span class="c004">#</span><span class="c003"> type 'a ref = { mutable contents: 'a };;
<span class="c006">type 'a ref = { mutable contents : 'a; }

</span><span class="c004">#</span> let ( ! ) r = r.contents;;
<span class="c006">val ( ! ) : 'a ref -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> let ( := ) r newval = r.contents &lt;- newval;;
</span><span class="c006">val ( := ) : 'a ref -&gt; 'a -&gt; unit = &lt;fun&gt;
</span></pre><p>In some special cases, you may need to store a polymorphic function in
a data structure, keeping its polymorphism. Without user-provided
type annotations, this is not allowed, as polymorphism is only
introduced on a global level. However, you can give explicitly
polymorphic types to record fields.
</p><pre><span class="c004">#</span><span class="c003"> type idref = { mutable id: 'a. 'a -&gt; 'a };;
<span class="c006">type idref = { mutable id : 'a. 'a -&gt; 'a; }

</span><span class="c004">#</span> let r = {id = fun x -&gt; x};;
<span class="c006">val r : idref = {id = &lt;fun&gt;}

</span><span class="c004">#</span> let g s = (s.id 1, s.id true);;
<span class="c006">val g : idref -&gt; int * bool = &lt;fun&gt;

</span><span class="c004">#</span> r.id &lt;- (fun x -&gt; print_string "called id\n"; x);;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> g r;;
</span><span class="c006">called id
called id
- : int * bool = (1, true)
</span></pre>
<!--TOC section id="sec13" Exceptions-->
<h2 class="section" id="sec13">1.6&#XA0;&#XA0;Exceptions</h2><!--SEC END --><p>OCaml provides exceptions for signalling and handling exceptional
conditions. Exceptions can also be used as a general-purpose non-local
control structure. Exceptions are declared with the <span class="c007">exception</span>
construct, and signalled with the <span class="c007">raise</span> operator. For instance, the
function below for taking the head of a list uses an exception to
signal the case where an empty list is given.
</p><pre><span class="c004">#</span><span class="c003"> exception Empty_list;;
<span class="c006">exception Empty_list

</span><span class="c004">#</span> let head l =
    match l with
      [] -&gt; raise Empty_list
    | hd :: tl -&gt; hd;;
<span class="c006">val head : 'a list -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> head [1;2];;
<span class="c006">- : int = 1

</span><span class="c004">#</span> head [];;
</span><span class="c006">Exception: Empty_list.
</span></pre><p>Exceptions are used throughout the standard library to signal cases
where the library functions cannot complete normally. For instance,
the <span class="c007">List.assoc</span> function, which returns the data associated with a
given key in a list of (key, data) pairs, raises the predefined
exception <span class="c007">Not_found</span> when the key does not appear in the list:
</p><pre><span class="c004">#</span><span class="c003"> List.assoc 1 [(0, "zero"); (1, "one")];;
<span class="c006">- : string = "one"

</span><span class="c004">#</span> List.assoc 2 [(0, "zero"); (1, "one")];;
</span><span class="c006">Exception: Not_found.
</span></pre><p>Exceptions can be trapped with the <span class="c007">try</span>&#X2026;<span class="c007">with</span> construct:
</p><pre><span class="c004">#</span><span class="c003"> let name_of_binary_digit digit =
    try
      List.assoc digit [0, "zero"; 1, "one"]
    with Not_found -&gt;
      "not a binary digit";;
<span class="c006">val name_of_binary_digit : int -&gt; string = &lt;fun&gt;

</span><span class="c004">#</span> name_of_binary_digit 0;;
<span class="c006">- : string = "zero"

</span><span class="c004">#</span> name_of_binary_digit (-1);;
</span><span class="c006">- : string = "not a binary digit"
</span></pre><p>The <span class="c007">with</span> part is actually a regular pattern-matching on the
exception value. Thus, several exceptions can be caught by one
<span class="c007">try</span>&#X2026;<span class="c007">with</span> construct. Also, finalization can be performed by
trapping all exceptions, performing the finalization, then raising
again the exception:
</p><pre><span class="c004">#<span class="c003"> let temporarily_set_reference ref newval funct =
    let oldval = !ref in
    try
      ref := newval;
      let res = funct () in
      ref := oldval;
      res
    with x -&gt;
      ref := oldval;
      raise x;;
<span class="c006">val temporarily_set_reference : 'a ref -&gt; 'a -&gt; (unit -&gt; 'b) -&gt; 'b = &lt;fun&gt;
</span></span></span></pre>
<!--TOC section id="sec14" Symbolic processing of expressions-->
<h2 class="section" id="sec14">1.7&#XA0;&#XA0;Symbolic processing of expressions</h2><!--SEC END --><p>We finish this introduction with a more complete example
representative of the use of OCaml for symbolic processing: formal
manipulations of arithmetic expressions containing variables. The
following variant type describes the expressions we shall manipulate:
</p><pre><span class="c004">#<span class="c003"> type expression =
      Const of float
    | Var of string
    | Sum of expression * expression    (* e1 + e2 *)
    | Diff of expression * expression   (* e1 - e2 *)
    | Prod of expression * expression   (* e1 * e2 *)
    | Quot of expression * expression   (* e1 / e2 *)
  ;;
<span class="c006">type expression =
    Const of float
  | Var of string
  | Sum of expression * expression
  | Diff of expression * expression
  | Prod of expression * expression
  | Quot of expression * expression
</span></span></span></pre><p>We first define a function to evaluate an expression given an
environment that maps variable names to their values. For simplicity,
the environment is represented as an association list.
</p><pre><span class="c004">#</span><span class="c003"> exception Unbound_variable of string;;
<span class="c006">exception Unbound_variable of string

</span><span class="c004">#</span> let rec eval env exp =
    match exp with
      Const c -&gt; c
    | Var v -&gt;
        (try List.assoc v env with Not_found -&gt; raise (Unbound_variable v))
    | Sum(f, g) -&gt; eval env f +. eval env g
    | Diff(f, g) -&gt; eval env f -. eval env g
    | Prod(f, g) -&gt; eval env f *. eval env g
    | Quot(f, g) -&gt; eval env f /. eval env g;;
<span class="c006">val eval : (string * float) list -&gt; expression -&gt; float = &lt;fun&gt;

</span><span class="c004">#</span> eval [("x", 1.0); ("y", 3.14)] (Prod(Sum(Var "x", Const 2.0), Var "y"));;
</span><span class="c006">- : float = 9.42
</span></pre><p>Now for a real symbolic processing, we define the derivative of an
expression with respect to a variable <span class="c007">dv</span>:
</p><pre><span class="c004">#</span><span class="c003"> let rec deriv exp dv =
    match exp with
      Const c -&gt; Const 0.0
    | Var v -&gt; if v = dv then Const 1.0 else Const 0.0
    | Sum(f, g) -&gt; Sum(deriv f dv, deriv g dv)
    | Diff(f, g) -&gt; Diff(deriv f dv, deriv g dv)
    | Prod(f, g) -&gt; Sum(Prod(f, deriv g dv), Prod(deriv f dv, g))
    | Quot(f, g) -&gt; Quot(Diff(Prod(deriv f dv, g), Prod(f, deriv g dv)),
                         Prod(g, g))
  ;;
<span class="c006">val deriv : expression -&gt; string -&gt; expression = &lt;fun&gt;

</span><span class="c004">#</span> deriv (Quot(Const 1.0, Var "x")) "x";;
</span><span class="c006">- : expression =
Quot (Diff (Prod (Const 0., Var "x"), Prod (Const 1., Const 1.)),
 Prod (Var "x", Var "x"))
</span></pre>
<!--TOC section id="sec15" Pretty-printing and parsing-->
<h2 class="section" id="sec15">1.8&#XA0;&#XA0;Pretty-printing and parsing</h2><!--SEC END --><p>As shown in the examples above, the internal representation (also
called <em>abstract syntax</em>) of expressions quickly becomes hard to
read and write as the expressions get larger. We need a printer and a
parser to go back and forth between the abstract syntax and the <em>concrete syntax</em>, which in the case of expressions is the familiar
algebraic notation (e.g. <span class="c007">2*x+1</span>).</p><p>For the printing function, we take into account the usual precedence
rules (i.e. <span class="c007">*</span> binds tighter than <span class="c007">+</span>) to avoid printing unnecessary
parentheses. To this end, we maintain the current operator precedence
and print parentheses around an operator only if its precedence is
less than the current precedence.
</p><pre><span class="c004">#</span><span class="c003"> let print_expr exp =
    (* Local function definitions *)
    let open_paren prec op_prec =
      if prec &gt; op_prec then print_string "(" in
    let close_paren prec op_prec =
      if prec &gt; op_prec then print_string ")" in
    let rec print prec exp =     (* prec is the current precedence *)
      match exp with
        Const c -&gt; print_float c
      | Var v -&gt; print_string v
      | Sum(f, g) -&gt;
          open_paren prec 0;
          print 0 f; print_string " + "; print 0 g;
          close_paren prec 0
      | Diff(f, g) -&gt;
          open_paren prec 0;
          print 0 f; print_string " - "; print 1 g;
          close_paren prec 0
      | Prod(f, g) -&gt;
          open_paren prec 2;
          print 2 f; print_string " * "; print 2 g;
          close_paren prec 2
      | Quot(f, g) -&gt;
          open_paren prec 2;
          print 2 f; print_string " / "; print 3 g;
          close_paren prec 2
    in print 0 exp;;
<span class="c006">val print_expr : expression -&gt; unit = &lt;fun&gt;

</span><span class="c004">#</span> let e = Sum(Prod(Const 2.0, Var "x"), Const 1.0);;
<span class="c006">val e : expression = Sum (Prod (Const 2., Var "x"), Const 1.)

</span><span class="c004">#</span> print_expr e; print_newline ();;
<span class="c006">2. * x + 1.
- : unit = ()

</span><span class="c004">#</span> print_expr (deriv e "x"); print_newline ();;
</span><span class="c006">2. * 1. + 0. * x + 0.
- : unit = ()
</span></pre><p>Parsing (transforming concrete syntax into abstract syntax) is usually
more delicate. OCaml offers several tools to help write parsers:
on the one hand, OCaml versions of the lexer generator Lex and the
parser generator Yacc (see chapter&#XA0;<a href="#c%3Aocamlyacc">12</a>), which handle
LALR(1) languages using push-down automata; on the other hand, a
predefined type of streams (of characters or tokens) and
pattern-matching over streams, which facilitate the writing of
recursive-descent parsers for LL(1) languages. An example using
<span class="c007">ocamllex</span> and <span class="c007">ocamlyacc</span> is given in
chapter&#XA0;<a href="#c%3Aocamlyacc">12</a>. Here, we will use stream parsers.
The syntactic support for stream parsers is provided by the Camlp4
preprocessor, which can be loaded into the interactive toplevel via
the <span class="c007">#load</span> directives below.</p><pre><span class="c004">#</span><span class="c003"> #load "dynlink.cma";;

  #load "camlp4o.cma";;
<span class="c006">	Camlp4 Parsing version 4.01.0+dev26-2013-09-06


</span><span class="c004">#</span> open Genlex;;

  let lexer = make_lexer ["("; ")"; "+"; "-"; "*"; "/"];;
</span><span class="c006">val lexer : char Stream.t -&gt; Genlex.token Stream.t = &lt;fun&gt;
</span></pre><p>
For the lexical analysis phase (transformation of the input text into
a stream of tokens), we use a &#X201C;generic&#X201D; lexer provided in the
standard library module <span class="c007">Genlex</span>. The <span class="c007">make_lexer</span> function takes a
list of keywords and returns a lexing function that &#X201C;tokenizes&#X201D; an
input stream of characters. Tokens are either identifiers, keywords,
or literals (integer, floats, characters, strings). Whitespace and
comments are skipped.
</p><pre><span class="c004">#</span><span class="c003"> let token_stream = lexer (Stream.of_string "1.0 +x");;
<span class="c006">val token_stream : Genlex.token Stream.t = &lt;abstr&gt;

</span><span class="c004">#</span> Stream.next token_stream;;
<span class="c006">- : Genlex.token = Float 1.

</span><span class="c004">#</span> Stream.next token_stream;;
<span class="c006">- : Genlex.token = Kwd "+"

</span><span class="c004">#</span> Stream.next token_stream;;
</span><span class="c006">- : Genlex.token = Ident "x"
</span></pre><p>The parser itself operates by pattern-matching on the stream of
tokens. As usual with recursive descent parsers, we use several
intermediate parsing functions to reflect the precedence and
associativity of operators. Pattern-matching over streams is more
powerful than on regular data structures, as it allows recursive calls
to parsing functions inside the patterns, for matching sub-components of
the input stream. See the Camlp4 documentation for more details.</p><pre><span class="c004">#</span><span class="c003"> let rec parse_expr = parser
      [&lt; e1 = parse_mult; e = parse_more_adds e1 &gt;] -&gt; e
  and parse_more_adds e1 = parser
      [&lt; 'Kwd "+"; e2 = parse_mult; e = parse_more_adds (Sum(e1, e2)) &gt;] -&gt; e
    | [&lt; 'Kwd "-"; e2 = parse_mult; e = parse_more_adds (Diff(e1, e2)) &gt;] -&gt; e
    | [&lt; &gt;] -&gt; e1
  and parse_mult = parser
      [&lt; e1 = parse_simple; e = parse_more_mults e1 &gt;] -&gt; e
  and parse_more_mults e1 = parser
      [&lt; 'Kwd "*"; e2 = parse_simple; e = parse_more_mults (Prod(e1, e2)) &gt;] -&gt; e
    | [&lt; 'Kwd "/"; e2 = parse_simple; e = parse_more_mults (Quot(e1, e2)) &gt;] -&gt; e
    | [&lt; &gt;] -&gt; e1
  and parse_simple = parser
      [&lt; 'Ident s &gt;] -&gt; Var s
    | [&lt; 'Int i &gt;] -&gt; Const(float i)
    | [&lt; 'Float f &gt;] -&gt; Const f
    | [&lt; 'Kwd "("; e = parse_expr; 'Kwd ")" &gt;] -&gt; e;;
<span class="c006">val parse_expr : Genlex.token Stream.t -&gt; expression = &lt;fun&gt;
val parse_more_adds : expression -&gt; Genlex.token Stream.t -&gt; expression =
  &lt;fun&gt;
val parse_mult : Genlex.token Stream.t -&gt; expression = &lt;fun&gt;
val parse_more_mults : expression -&gt; Genlex.token Stream.t -&gt; expression =
  &lt;fun&gt;
val parse_simple : Genlex.token Stream.t -&gt; expression = &lt;fun&gt;

</span><span class="c004">#</span> let parse_expression = parser [&lt; e = parse_expr; _ = Stream.empty &gt;] -&gt; e;;
</span><span class="c006">val parse_expression : Genlex.token Stream.t -&gt; expression = &lt;fun&gt;
</span></pre><p>Composing the lexer and parser, we finally obtain a function to read
an expression from a character string:
</p><pre><span class="c004">#</span><span class="c003"> let read_expression s = parse_expression (lexer (Stream.of_string s));;
<span class="c006">val read_expression : string -&gt; expression = &lt;fun&gt;

</span><span class="c004">#</span> read_expression "2*(x+y)";;
</span><span class="c006">- : expression = Prod (Const 2., Sum (Var "x", Var "y"))
</span></pre><p>
A small puzzle: why do we get different results in the following two
examples?
</p><pre><span class="c004">#</span><span class="c003"> read_expression "x - 1";;
<span class="c006">- : expression = Diff (Var "x", Const 1.)

</span><span class="c004">#</span> read_expression "x-1";;
</span><span class="c006">Exception: Stream.Error "".
</span></pre><p>
Answer: the generic lexer provided by <span class="c007">Genlex</span> recognizes negative
integer literals as one integer token. Hence, <span class="c007">x-1</span> is read as
the token <span class="c007">Ident "x"</span> followed by the token <span class="c007">Int(-1)</span>; this sequence
does not match any of the parser rules. On the other hand,
the second space in <span class="c007">x - 1</span> causes the lexer to return the three
expected tokens: <span class="c007">Ident "x"</span>, then <span class="c007">Kwd "-"</span>, then <span class="c007">Int(1)</span>.</p>
<!--TOC section id="sec16" Standalone OCaml programs-->
<h2 class="section" id="sec16">1.9&#XA0;&#XA0;Standalone OCaml programs</h2><!--SEC END --><p>All examples given so far were executed under the interactive system.
OCaml code can also be compiled separately and executed
non-interactively using the batch compilers <span class="c007">ocamlc</span> and <span class="c007">ocamlopt</span>.
The source code must be put in a file with extension <span class="c007">.ml</span>. It
consists of a sequence of phrases, which will be evaluated at runtime
in their order of appearance in the source file. Unlike in interactive
mode, types and values are not printed automatically; the program must
call printing functions explicitly to produce some output. Here is a
sample standalone program to print Fibonacci numbers:
</p><pre>(* File fib.ml *)
let rec fib n =
  if n &lt; 2 then 1 else fib (n-1) + fib (n-2);;
let main () =
  let arg = int_of_string Sys.argv.(1) in
  print_int (fib arg);
  print_newline ();
  exit 0;;
main ();;
</pre><p><span class="c007">Sys.argv</span> is an array of strings containing the command-line
parameters. <span class="c007">Sys.argv.(1)</span> is thus the first command-line parameter.
The program above is compiled and executed with the following shell
commands:
</p><pre>$ ocamlc -o fib fib.ml
$ ./fib 10
89
$ ./fib 20
10946
</pre><p>
More complex standalone OCaml programs are typically composed of
multiple source files, and can link with precompiled libraries.
Chapters&#XA0;<a href="#c%3Acamlc">8</a> and&#XA0;<a href="#c%3Anativecomp">11</a> explain how to use the
batch compilers <span class="c007">ocamlc</span> and <span class="c007">ocamlopt</span>. Recompilation of
multi-file OCaml projects can be automated using the <span class="c007">ocamlbuild</span>
compilation manager, documented in chapter&#XA0;<a href="#c%3Aocamlbuild">18</a>.

</p>
<!--TOC chapter id="sec17" The module system-->
<h1 class="chapter" id="sec17">Chapter&#XA0;2&#XA0;&#XA0;The module system</h1><!--SEC END --><p> <a id="c:moduleexamples"></a>

</p><!--NAME moduleexamples.html-->
<p>This chapter introduces the module system of OCaml.</p>
<!--TOC section id="sec18" Structures-->
<h2 class="section" id="sec18">2.1&#XA0;&#XA0;Structures</h2><!--SEC END --><p>A primary motivation for modules is to package together related
definitions (such as the definitions of a data type and associated
operations over that type) and enforce a consistent naming scheme for
these definitions. This avoids running out of names or accidentally
confusing names. Such a package is called a <em>structure</em> and
is introduced by the <span class="c007">struct</span>&#X2026;<span class="c007">end</span> construct, which contains an
arbitrary sequence of definitions. The structure is usually given a
name with the <span class="c007">module</span> binding. Here is for instance a structure
packaging together a type of priority queues and their operations:
</p><pre><span class="c004">#<span class="c003"> module PrioQueue =
    struct
      type priority = int
      type 'a queue = Empty | Node of priority * 'a * 'a queue * 'a queue
      let empty = Empty
      let rec insert queue prio elt =
        match queue with
          Empty -&gt; Node(prio, elt, Empty, Empty)
        | Node(p, e, left, right) -&gt;
            if prio &lt;= p
            then Node(prio, elt, insert right p e, left)
            else Node(p, e, insert right prio elt, left)
      exception Queue_is_empty
      let rec remove_top = function
          Empty -&gt; raise Queue_is_empty
        | Node(prio, elt, left, Empty) -&gt; left
        | Node(prio, elt, Empty, right) -&gt; right
        | Node(prio, elt, (Node(lprio, lelt, _, _) as left),
                          (Node(rprio, relt, _, _) as right)) -&gt;
            if lprio &lt;= rprio
            then Node(lprio, lelt, remove_top left, right)
            else Node(rprio, relt, left, remove_top right)
      let extract = function
          Empty -&gt; raise Queue_is_empty
        | Node(prio, elt, _, _) as queue -&gt; (prio, elt, remove_top queue)
    end;;
<span class="c006">module PrioQueue :
  sig
    type priority = int
    type 'a queue = Empty | Node of priority * 'a * 'a queue * 'a queue
    val empty : 'a queue
    val insert : 'a queue -&gt; priority -&gt; 'a -&gt; 'a queue
    exception Queue_is_empty
    val remove_top : 'a queue -&gt; 'a queue
    val extract : 'a queue -&gt; priority * 'a * 'a queue
  end
</span></span></span></pre><p>
Outside the structure, its components can be referred to using the
&#X201C;dot notation&#X201D;, that is, identifiers qualified by a structure name.
For instance, <span class="c007">PrioQueue.insert</span> is the function <span class="c007">insert</span> defined
inside the structure <span class="c007">PrioQueue</span> and <span class="c007">PrioQueue.queue</span> is the type
<span class="c007">queue</span> defined in <span class="c007">PrioQueue</span>.
</p><pre><span class="c004">#<span class="c003"> PrioQueue.insert PrioQueue.empty 1 "hello";;
<span class="c006">- : string PrioQueue.queue =
PrioQueue.Node (1, "hello", PrioQueue.Empty, PrioQueue.Empty)
</span></span></span></pre>
<!--TOC section id="sec19" Signatures-->
<h2 class="section" id="sec19">2.2&#XA0;&#XA0;Signatures</h2><!--SEC END --><p>Signatures are interfaces for structures. A signature specifies
which components of a structure are accessible from the outside, and
with which type. It can be used to hide some components of a structure
(e.g. local function definitions) or export some components with a
restricted type. For instance, the signature below specifies the three
priority queue operations <span class="c007">empty</span>, <span class="c007">insert</span> and <span class="c007">extract</span>, but not the
auxiliary function <span class="c007">remove_top</span>. Similarly, it makes the <span class="c007">queue</span> type
abstract (by not providing its actual representation as a concrete type).
</p><pre><span class="c004">#<span class="c003"> module type PRIOQUEUE =
    sig
      type priority = int         (* still concrete *)
      type 'a queue               (* now abstract *)
      val empty : 'a queue
      val insert : 'a queue -&gt; int -&gt; 'a -&gt; 'a queue
      val extract : 'a queue -&gt; int * 'a * 'a queue
      exception Queue_is_empty
    end;;
<span class="c006">module type PRIOQUEUE =
  sig
    type priority = int
    type 'a queue
    val empty : 'a queue
    val insert : 'a queue -&gt; int -&gt; 'a -&gt; 'a queue
    val extract : 'a queue -&gt; int * 'a * 'a queue
    exception Queue_is_empty
  end
</span></span></span></pre><p>
Restricting the <span class="c007">PrioQueue</span> structure by this signature results in
another view of the <span class="c007">PrioQueue</span> structure where the <span class="c007">remove_top</span>
function is not accessible and the actual representation of priority
queues is hidden:
</p><pre><span class="c004">#</span><span class="c003"> module AbstractPrioQueue = (PrioQueue : PRIOQUEUE);;
<span class="c006">module AbstractPrioQueue : PRIOQUEUE

</span><span class="c004">#</span> <U>AbstractPrioQueue.remove_top</U>;;
<span class="c006">Error: Unbound value AbstractPrioQueue.remove_top

</span><span class="c004">#</span> AbstractPrioQueue.insert AbstractPrioQueue.empty 1 "hello";;
</span><span class="c006">- : string AbstractPrioQueue.queue = &lt;abstr&gt;
</span></pre><p>
The restriction can also be performed during the definition of the
structure, as in
</p><pre>module PrioQueue = (struct ... end : PRIOQUEUE);;
</pre><p>An alternate syntax is provided for the above:
</p><pre>module PrioQueue : PRIOQUEUE = struct ... end;;
</pre>
<!--TOC section id="sec20" Functors-->
<h2 class="section" id="sec20">2.3&#XA0;&#XA0;Functors</h2><!--SEC END --><p>Functors are &#X201C;functions&#X201D; from structures to structures. They are used to
express parameterized structures: a structure <span class="c013">A</span> parameterized by a
structure <span class="c013">B</span> is simply a functor <span class="c013">F</span> with a formal parameter
<span class="c013">B</span> (along with the expected signature for <span class="c013">B</span>) which returns
the actual structure <span class="c013">A</span> itself. The functor <span class="c013">F</span> can then be
applied to one or several implementations <span class="c013">B</span><sub>1</sub> &#X2026;<span class="c013">B</span><sub><span class="c013">n</span></sub>
of <span class="c013">B</span>, yielding the corresponding structures
<span class="c013">A</span><sub>1</sub> &#X2026;<span class="c013">A</span><sub><span class="c013">n</span></sub>.</p><p>For instance, here is a structure implementing sets as sorted lists,
parameterized by a structure providing the type of the set elements
and an ordering function over this type (used to keep the sets
sorted):
</p><pre><span class="c004">#</span><span class="c003"> type comparison = Less | Equal | Greater;;
<span class="c006">type comparison = Less | Equal | Greater

</span><span class="c004">#</span> module type ORDERED_TYPE =
    sig
      type t
      val compare: t -&gt; t -&gt; comparison
    end;;
<span class="c006">module type ORDERED_TYPE = sig type t val compare : t -&gt; t -&gt; comparison end

</span><span class="c004">#</span> module Set =
    functor (Elt: ORDERED_TYPE) -&gt;
      struct
        type element = Elt.t
        type set = element list
        let empty = []
        let rec add x s =
          match s with
            [] -&gt; [x]
          | hd::tl -&gt;
             match Elt.compare x hd with
               Equal   -&gt; s         (* x is already in s *)
             | Less    -&gt; x :: s    (* x is smaller than all elements of s *)
             | Greater -&gt; hd :: add x tl
        let rec member x s =
          match s with
            [] -&gt; false
          | hd::tl -&gt;
              match Elt.compare x hd with
                Equal   -&gt; true     (* x belongs to s *)
              | Less    -&gt; false    (* x is smaller than all elements of s *)
              | Greater -&gt; member x tl
      end;;
</span><span class="c006">module Set :
  functor (Elt : ORDERED_TYPE) -&gt;
    sig
      type element = Elt.t
      type set = element list
      val empty : 'a list
      val add : Elt.t -&gt; Elt.t list -&gt; Elt.t list
      val member : Elt.t -&gt; Elt.t list -&gt; bool
    end
</span></pre><p>
By applying the <span class="c007">Set</span> functor to a structure implementing an ordered
type, we obtain set operations for this type:
</p><pre><span class="c004">#</span><span class="c003"> module OrderedString =
    struct
      type t = string
      let compare x y = if x = y then Equal else if x &lt; y then Less else Greater
    end;;
<span class="c006">module OrderedString :
  sig type t = string val compare : 'a -&gt; 'a -&gt; comparison end

</span><span class="c004">#</span> module StringSet = Set(OrderedString);;
<span class="c006">module StringSet :
  sig
    type element = OrderedString.t
    type set = element list
    val empty : 'a list
    val add : OrderedString.t -&gt; OrderedString.t list -&gt; OrderedString.t list
    val member : OrderedString.t -&gt; OrderedString.t list -&gt; bool
  end

</span><span class="c004">#</span> StringSet.member "bar" (StringSet.add "foo" StringSet.empty);;
</span><span class="c006">- : bool = false
</span></pre>
<!--TOC section id="sec21" Functors and type abstraction-->
<h2 class="section" id="sec21">2.4&#XA0;&#XA0;Functors and type abstraction</h2><!--SEC END --><p>As in the <span class="c007">PrioQueue</span> example, it would be good style to hide the
actual implementation of the type <span class="c007">set</span>, so that users of the
structure will not rely on sets being lists, and we can switch later
to another, more efficient representation of sets without breaking
their code. This can be achieved by restricting <span class="c007">Set</span> by a suitable
functor signature:
</p><pre><span class="c004">#</span><span class="c003"> module type SETFUNCTOR =
    functor (Elt: ORDERED_TYPE) -&gt;
      sig
        type element = Elt.t      (* concrete *)
        type set                  (* abstract *)
        val empty : set
        val add : element -&gt; set -&gt; set
        val member : element -&gt; set -&gt; bool
      end;;
<span class="c006">module type SETFUNCTOR =
  functor (Elt : ORDERED_TYPE) -&gt;
    sig
      type element = Elt.t
      type set
      val empty : set
      val add : element -&gt; set -&gt; set
      val member : element -&gt; set -&gt; bool
    end

</span><span class="c004">#</span> module AbstractSet = (Set : SETFUNCTOR);;
<span class="c006">module AbstractSet : SETFUNCTOR

</span><span class="c004">#</span> module AbstractStringSet = AbstractSet(OrderedString);;
<span class="c006">module AbstractStringSet :
  sig
    type element = OrderedString.t
    type set = AbstractSet(OrderedString).set
    val empty : set
    val add : element -&gt; set -&gt; set
    val member : element -&gt; set -&gt; bool
  end

</span><span class="c004">#</span> AbstractStringSet.add "gee" AbstractStringSet.empty;;
</span><span class="c006">- : AbstractStringSet.set = &lt;abstr&gt;
</span></pre><p>In an attempt to write the type constraint above more elegantly,
one may wish to name the signature of the structure
returned by the functor, then use that signature in the constraint:
</p><pre><span class="c004">#</span><span class="c003"> module type SET =
    sig
      type element
      type set
      val empty : set
      val add : element -&gt; set -&gt; set
      val member : element -&gt; set -&gt; bool
    end;;
<span class="c006">module type SET =
  sig
    type element
    type set
    val empty : set
    val add : element -&gt; set -&gt; set
    val member : element -&gt; set -&gt; bool
  end

</span><span class="c004">#</span> module WrongSet = (Set : functor(Elt: ORDERED_TYPE) -&gt; SET);;
<span class="c006">module WrongSet : functor (Elt : ORDERED_TYPE) -&gt; SET

</span><span class="c004">#</span> module WrongStringSet = WrongSet(OrderedString);;
<span class="c006">module WrongStringSet :
  sig
    type element = WrongSet(OrderedString).element
    type set = WrongSet(OrderedString).set
    val empty : set
    val add : element -&gt; set -&gt; set
    val member : element -&gt; set -&gt; bool
  end

</span><span class="c004">#</span> WrongStringSet.add <U>"gee"</U> WrongStringSet.empty;;
</span><span class="c006">Error: This expression has type string but an expression was expected of type
         WrongStringSet.element = WrongSet(OrderedString).element
</span></pre><p>
The problem here is that <span class="c007">SET</span> specifies the type <span class="c007">element</span>
abstractly, so that the type equality between <span class="c007">element</span> in the result
of the functor and <span class="c007">t</span> in its argument is forgotten. Consequently,
<span class="c007">WrongStringSet.element</span> is not the same type as <span class="c007">string</span>, and the
operations of <span class="c007">WrongStringSet</span> cannot be applied to strings.
As demonstrated above, it is important that the type <span class="c007">element</span> in the
signature <span class="c007">SET</span> be declared equal to <span class="c007">Elt.t</span>; unfortunately, this is
impossible above since <span class="c007">SET</span> is defined in a context where <span class="c007">Elt</span> does
not exist. To overcome this difficulty, OCaml provides a
<span class="c007">with type</span> construct over signatures that allows enriching a signature
with extra type equalities:
</p><pre><span class="c004">#<span class="c003"> module AbstractSet2 =
    (Set : functor(Elt: ORDERED_TYPE) -&gt; (SET with type element = Elt.t));;
<span class="c006">module AbstractSet2 :
  functor (Elt : ORDERED_TYPE) -&gt;
    sig
      type element = Elt.t
      type set
      val empty : set
      val add : element -&gt; set -&gt; set
      val member : element -&gt; set -&gt; bool
    end
</span></span></span></pre><p>As in the case of simple structures, an alternate syntax is provided
for defining functors and restricting their result:
</p><pre>module AbstractSet2(Elt: ORDERED_TYPE) : (SET with type element = Elt.t) =
  struct ... end;;
</pre><p>
Abstracting a type component in a functor result is a powerful
technique that provides a high degree of type safety, as we now
illustrate. Consider an ordering over character strings that is
different from the standard ordering implemented in the
<span class="c007">OrderedString</span> structure. For instance, we compare strings without
distinguishing upper and lower case.
</p><pre><span class="c004">#</span><span class="c003"> module NoCaseString =
    struct
      type t = string
      let compare s1 s2 =
        OrderedString.compare (String.lowercase s1) (String.lowercase s2)
    end;;
<span class="c006">module NoCaseString :
  sig type t = string val compare : string -&gt; string -&gt; comparison end

</span><span class="c004">#</span> module NoCaseStringSet = AbstractSet(NoCaseString);;
<span class="c006">module NoCaseStringSet :
  sig
    type element = NoCaseString.t
    type set = AbstractSet(NoCaseString).set
    val empty : set
    val add : element -&gt; set -&gt; set
    val member : element -&gt; set -&gt; bool
  end

</span><span class="c004">#</span> NoCaseStringSet.add "FOO" <U>AbstractStringSet.empty</U>;;
</span><span class="c006">Error: This expression has type
         AbstractStringSet.set = AbstractSet(OrderedString).set
       but an expression was expected of type
         NoCaseStringSet.set = AbstractSet(NoCaseString).set
</span></pre><p>
Note that the two types <span class="c007">AbstractStringSet.set</span> and
<span class="c007">NoCaseStringSet.set</span> are not compatible, and values of these
two types do not match. This is the correct behavior: even though both
set types contain elements of the same type (strings), they are built
upon different orderings of that type, and different invariants need
to be maintained by the operations (being strictly increasing for the
standard ordering and for the case-insensitive ordering). Applying
operations from <span class="c007">AbstractStringSet</span> to values of type
<span class="c007">NoCaseStringSet.set</span> could give incorrect results, or build
lists that violate the invariants of <span class="c007">NoCaseStringSet</span>.</p>
<!--TOC section id="sec22" Modules and separate compilation-->
<h2 class="section" id="sec22">2.5&#XA0;&#XA0;Modules and separate compilation</h2><!--SEC END --><p>All examples of modules so far have been given in the context of the
interactive system. However, modules are most useful for large,
batch-compiled programs. For these programs, it is a practical
necessity to split the source into several files, called compilation
units, that can be compiled separately, thus minimizing recompilation
after changes.</p><p>In OCaml, compilation units are special cases of structures
and signatures, and the relationship between the units can be
explained easily in terms of the module system. A compilation unit <span class="c013">A</span>
comprises two files:
</p><ul class="itemize"><li class="li-itemize">
the implementation file <span class="c013">A</span><span class="c007">.ml</span>, which contains a sequence
of definitions, analogous to the inside of a <span class="c007">struct</span>&#X2026;<span class="c007">end</span>
construct;
</li><li class="li-itemize">the interface file <span class="c013">A</span><span class="c007">.mli</span>, which contains a sequence of
specifications, analogous to the inside of a <span class="c007">sig</span>&#X2026;<span class="c007">end</span>
construct.
</li></ul><p>
These two files together define a structure named <span class="c013">A</span> as if
the following definition was entered at top-level:
</p><pre>
module <span class="c013">A</span>: sig (* contents of file <span class="c013">A</span>.mli *) end
        = struct (* contents of file <span class="c013">A</span>.ml *) end;;
</pre><p>
The files that define the compilation units can be compiled separately
using the <span class="c007">ocamlc -c</span> command (the <span class="c007">-c</span> option means &#X201C;compile only, do
not try to link&#X201D;); this produces compiled interface files (with
extension <span class="c007">.cmi</span>) and compiled object code files (with extension
<span class="c007">.cmo</span>). When all units have been compiled, their <span class="c007">.cmo</span> files are
linked together using the <span class="c007">ocamlc</span> command. For instance, the following
commands compile and link a program composed of two compilation units
<span class="c007">Aux</span> and <span class="c007">Main</span>:
</p><pre>$ ocamlc -c Aux.mli                     # produces aux.cmi
$ ocamlc -c Aux.ml                      # produces aux.cmo
$ ocamlc -c Main.mli                    # produces main.cmi
$ ocamlc -c Main.ml                     # produces main.cmo
$ ocamlc -o theprogram Aux.cmo Main.cmo
</pre><p>The program behaves exactly as if the following phrases were entered
at top-level:
</p><pre>
module Aux: sig (* contents of Aux.mli *) end
          = struct (* contents of Aux.ml *) end;;
module Main: sig (* contents of Main.mli *) end
           = struct (* contents of Main.ml *) end;;
</pre><p>
In particular, <span class="c007">Main</span> can refer to <span class="c007">Aux</span>: the definitions and
declarations contained in <span class="c007">Main.ml</span> and <span class="c007">Main.mli</span> can refer to
definition in <span class="c007">Aux.ml</span>, using the <span class="c007">Aux.</span><span class="c013">ident</span> notation, provided
these definitions are exported in <span class="c007">Aux.mli</span>.</p><p>The order in which the <span class="c007">.cmo</span> files are given to <span class="c007">ocamlc</span> during the
linking phase determines the order in which the module definitions
occur. Hence, in the example above, <span class="c007">Aux</span> appears first and <span class="c007">Main</span> can
refer to it, but <span class="c007">Aux</span> cannot refer to <span class="c007">Main</span>.</p><p>Note that only top-level structures can be mapped to
separately-compiled files, but neither functors nor module types.
However, all module-class objects can appear as components of a
structure, so the solution is to put the functor or module type
inside a structure, which can then be mapped to a file.

</p>
<!--TOC chapter id="sec23" Objects in OCaml-->
<h1 class="chapter" id="sec23">Chapter&#XA0;3&#XA0;&#XA0;Objects in OCaml</h1><!--SEC END --><p>
<a id="c:objectexamples"></a>

</p><!--NAME objectexamples.html-->
<p>
<span class="c013">(Chapter written by J&#XE9;r&#XF4;me Vouillon, Didier R&#XE9;my and Jacques Garrigue)</span></p><p><br>
<br>
</p><p>This chapter gives an overview of the object-oriented features of
OCaml. Note that the relation between object, class and type
in OCaml is very different from that in mainstream
object-oriented languages like Java or C++, so that you should not
assume that similar keywords mean the same thing.</p><p><a href="#ss%3Aclasses-and-objects">3.1</a> Classes and objects <br>
<a href="#ss%3Aimmediate-objects">3.2</a> Immediate objects <br>
<a href="#ss%3Areference-to-self">3.3</a> Reference to self <br>
<a href="#ss%3Ainitializers">3.4</a> Initializers <br>
<a href="#ss%3Avirtual-methods">3.5</a> Virtual methods <br>
<a href="#ss%3Aprivate-methods">3.6</a> Private methods <br>
<a href="#ss%3Aclass-interfaces">3.7</a> Class interfaces <br>
<a href="#ss%3Ainheritance">3.8</a> Inheritance <br>
<a href="#ss%3Amultiple-inheritance">3.9</a> Multiple inheritance <br>
<a href="#ss%3Aparameterized-classes">3.10</a> Parameterized classes <br>
<a href="#ss%3Apolymorphic-methods">3.11</a> Polymorphic methods <br>
<a href="#ss%3Ausing-coercions">3.12</a> Using coercions <br>
<a href="#ss%3Afunctional-objects">3.13</a> Functional objects <br>
<a href="#ss%3Acloning-objects">3.14</a> Cloning objects <br>
<a href="#ss%3Arecursive-classes">3.15</a> Recursive classes <br>
<a href="#ss%3Abinary-methods">3.16</a> Binary methods <br>
<a href="#ss%3Afriends">3.17</a> Friends <br>

</p>
<!--TOC section id="sec24" Classes and objects-->
<h2 class="section" id="sec24">3.1&#XA0;&#XA0;Classes and objects</h2><!--SEC END --><p>

<a id="ss:classes-and-objects"></a></p><p>The class <span class="c007">point</span> below defines one instance variable <span class="c007">x</span> and two methods
<span class="c007">get_x</span> and <span class="c007">move</span>. The initial value of the instance variable is <span class="c007">0</span>.
The variable <span class="c007">x</span> is declared mutable, so the method <span class="c007">move</span> can change
its value.
</p><pre><span class="c004">#<span class="c003"> class point =
    object
      val mutable x = 0
      method get_x = x
      method move d = x &lt;- x + d
    end;;
<span class="c006">class point :
  object val mutable x : int method get_x : int method move : int -&gt; unit end
</span></span></span></pre><p>We now create a new point <span class="c007">p</span>, instance of the <span class="c007">point</span> class.
</p><pre><span class="c004">#<span class="c003"> let p = new point;;
<span class="c006">val p : point = &lt;obj&gt;
</span></span></span></pre><p>
Note that the type of <span class="c007">p</span> is <span class="c007">point</span>. This is an abbreviation
automatically defined by the class definition above. It stands for the
object type <span class="c007">&lt;get_x : int; move : int -&gt; unit&gt;</span>, listing the methods
of class <span class="c007">point</span> along with their types.</p><p>We now invoke some methods to <span class="c007">p</span>:
</p><pre><span class="c004">#</span><span class="c003"> p#get_x;;
<span class="c006">- : int = 0

</span><span class="c004">#</span> p#move 3;;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> p#get_x;;
</span><span class="c006">- : int = 3
</span></pre><p>The evaluation of the body of a class only takes place at object
creation time. Therefore, in the following example, the instance
variable <span class="c007">x</span> is initialized to different values for two different
objects.
</p><pre><span class="c004">#</span><span class="c003"> let x0 = ref 0;;
<span class="c006">val x0 : int ref = {contents = 0}

</span><span class="c004">#</span> class point =
    object
      val mutable x = incr x0; !x0
      method get_x = x
      method move d = x &lt;- x + d
    end;;
<span class="c006">class point :
  object val mutable x : int method get_x : int method move : int -&gt; unit end

</span><span class="c004">#</span> new point#get_x;;
<span class="c006">- : int = 1

</span><span class="c004">#</span> new point#get_x;;
</span><span class="c006">- : int = 2
</span></pre><p>The class <span class="c007">point</span> can also be abstracted over the initial values of
the <span class="c007">x</span> coordinate.
</p><pre><span class="c004">#<span class="c003"> class point = fun x_init -&gt;
    object
      val mutable x = x_init
      method get_x = x
      method move d = x &lt;- x + d
    end;;
<span class="c006">class point :
  int -&gt;
  object val mutable x : int method get_x : int method move : int -&gt; unit end
</span></span></span></pre><p>
Like in function definitions, the definition above can be
abbreviated as:
</p><pre><span class="c004">#<span class="c003"> class point x_init =
    object
      val mutable x = x_init
      method get_x = x
      method move d = x &lt;- x + d
    end;;
<span class="c006">class point :
  int -&gt;
  object val mutable x : int method get_x : int method move : int -&gt; unit end
</span></span></span></pre><p>
An instance of the class <span class="c007">point</span> is now a function that expects an
initial parameter to create a point object:
</p><pre><span class="c004">#</span><span class="c003"> new point;;
<span class="c006">- : int -&gt; point = &lt;fun&gt;

</span><span class="c004">#</span> let p = new point 7;;
</span><span class="c006">val p : point = &lt;obj&gt;
</span></pre><p>
The parameter <span class="c007">x_init</span> is, of course, visible in the whole body of the
definition, including methods. For instance, the method <span class="c007">get_offset</span>
in the class below returns the position of the object relative to its
initial position.
</p><pre><span class="c004">#<span class="c003"> class point x_init =
    object
      val mutable x = x_init
      method get_x = x
      method get_offset = x - x_init
      method move d = x &lt;- x + d
    end;;
<span class="c006">class point :
  int -&gt;
  object
    val mutable x : int
    method get_offset : int
    method get_x : int
    method move : int -&gt; unit
  end
</span></span></span></pre><p>
Expressions can be evaluated and bound before defining the object body
of the class. This is useful to enforce invariants. For instance,
points can be automatically adjusted to the nearest point on a grid,
as follows:
</p><pre><span class="c004">#<span class="c003"> class adjusted_point x_init =
    let origin = (x_init / 10) * 10 in
    object
      val mutable x = origin
      method get_x = x
      method get_offset = x - origin
      method move d = x &lt;- x + d
    end;;
<span class="c006">class adjusted_point :
  int -&gt;
  object
    val mutable x : int
    method get_offset : int
    method get_x : int
    method move : int -&gt; unit
  end
</span></span></span></pre><p>
(One could also raise an exception if the <span class="c007">x_init</span> coordinate is not
on the grid.) In fact, the same effect could here be obtained by
calling the definition of class <span class="c007">point</span> with the value of the
<span class="c007">origin</span>.
</p><pre><span class="c004">#<span class="c003"> class adjusted_point x_init =  point ((x_init / 10) * 10);;
<span class="c006">class adjusted_point : int -&gt; point
</span></span></span></pre><p>
An alternate solution would have been to define the adjustment in
a special allocation function:
</p><pre><span class="c004">#<span class="c003"> let new_adjusted_point x_init = new point ((x_init / 10) * 10);;
<span class="c006">val new_adjusted_point : int -&gt; point = &lt;fun&gt;
</span></span></span></pre><p>
However, the former pattern is generally more appropriate, since
the code for adjustment is part of the definition of the class and will be
inherited.</p><p>This ability provides class constructors as can be found in other
languages. Several constructors can be defined this way to build objects of
the same class but with different initialization patterns; an
alternative is to use initializers, as decribed below in section
<a href="#ss%3Ainitializers">3.4</a>.</p>
<!--TOC section id="sec25" Immediate objects-->
<h2 class="section" id="sec25">3.2&#XA0;&#XA0;Immediate objects</h2><!--SEC END --><p>

<a id="ss:immediate-objects"></a></p><p>There is another, more direct way to create an object: create it
without going through a class.</p><p>The syntax is exactly the same as for class expressions, but the
result is a single object rather than a class. All the constructs
described in the rest of this section also apply to immediate objects.
</p><pre><span class="c004">#</span><span class="c003"> let p =
    object
      val mutable x = 0
      method get_x = x
      method move d = x &lt;- x + d
    end;;
<span class="c006">val p : &lt; get_x : int; move : int -&gt; unit &gt; = &lt;obj&gt;

</span><span class="c004">#</span> p#get_x;;
<span class="c006">- : int = 0

</span><span class="c004">#</span> p#move 3;;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> p#get_x;;
</span><span class="c006">- : int = 3
</span></pre><p>Unlike classes, which cannot be defined inside an expression,
immediate objects can appear anywhere, using variables from their
environment.
</p><pre><span class="c004">#<span class="c003"> let minmax x y =
    if x &lt; y then object method min = x method max = y end
    else object method min = y method max = x end;;
<span class="c006">val minmax : 'a -&gt; 'a -&gt; &lt; max : 'a; min : 'a &gt; = &lt;fun&gt;
</span></span></span></pre><p>Immediate objects have two weaknesses compared to classes: their types
are not abbreviated, and you cannot inherit from them. But these two
weaknesses can be advantages in some situations, as we will see
in sections <a href="#ss%3Areference-to-self">3.3</a> and <a href="#ss%3Aparameterized-classes">3.10</a>.</p>
<!--TOC section id="sec26" Reference to self-->
<h2 class="section" id="sec26">3.3&#XA0;&#XA0;Reference to self</h2><!--SEC END --><p>

<a id="ss:reference-to-self"></a></p><p>A method or an initializer can send messages to self (that is,
the current object). For that, self must be explicitly bound, here to
the variable <span class="c007">s</span> (<span class="c007">s</span> could be any identifier, even though we will
often choose the name <span class="c007">self</span>.)
</p><pre><span class="c004">#</span><span class="c003"> class printable_point x_init =
    object (s)
      val mutable x = x_init
      method get_x = x
      method move d = x &lt;- x + d
      method print = print_int s#get_x
    end;;
<span class="c006">class printable_point :
  int -&gt;
  object
    val mutable x : int
    method get_x : int
    method move : int -&gt; unit
    method print : unit
  end

</span><span class="c004">#</span> let p = new printable_point 7;;
<span class="c006">val p : printable_point = &lt;obj&gt;

</span><span class="c004">#</span> p#print;;
</span><span class="c006">7- : unit = ()
</span></pre><p>
Dynamically, the variable <span class="c007">s</span> is bound at the invocation of a method. In
particular, when the class <span class="c007">printable_point</span> is inherited, the variable
<span class="c007">s</span> will be correctly bound to the object of the subclass.</p><p>A common problem with self is that, as its type may be extended in
subclasses, you cannot fix it in advance. Here is a simple example.
</p><pre><span class="c004">#</span><span class="c003"> let ints = ref [];;
<span class="c006">val ints : '_a list ref = {contents = []}

</span><span class="c004">#</span> class my_int =
    object (self)
      method n = 1
      method register = ints := <U>self</U> :: !ints
    end;;
</span><span class="c006">Error: This expression has type &lt; n : int; register : 'b; .. &gt; as 'a
       but an expression was expected of type 'a
       Self type cannot escape its class
</span></pre><p>
You can ignore the first two lines of the error message. What matters
is the last one: putting self into an external reference would make it
impossible to extend it through inheritance.
We will see in section <a href="#ss%3Ausing-coercions">3.12</a> a workaround to this
problem.
Note however that, since immediate objects are not extensible, the
problem does not occur with them.
</p><pre><span class="c004">#<span class="c003"> let my_int =
    object (self)
      method n = 1
      method register = ints := self :: !ints
    end;;
<span class="c006">val my_int : &lt; n : int; register : unit &gt; = &lt;obj&gt;
</span></span></span></pre>
<!--TOC section id="sec27" Initializers-->
<h2 class="section" id="sec27">3.4&#XA0;&#XA0;Initializers</h2><!--SEC END --><p>

<a id="ss:initializers"></a></p><p>Let-bindings within class definitions are evaluated before the object
is constructed. It is also possible to evaluate an expression
immediately after the object has been built. Such code is written as
an anonymous hidden method called an initializer. Therefore, it can
access self and the instance variables.
</p><pre><span class="c004">#</span><span class="c003"> class printable_point x_init =
    let origin = (x_init / 10) * 10 in
    object (self)
      val mutable x = origin
      method get_x = x
      method move d = x &lt;- x + d
      method print = print_int self#get_x
      initializer print_string "new point at "; self#print; print_newline ()
    end;;
<span class="c006">class printable_point :
  int -&gt;
  object
    val mutable x : int
    method get_x : int
    method move : int -&gt; unit
    method print : unit
  end

</span><span class="c004">#</span> let p = new printable_point 17;;
</span><span class="c006">new point at 10
val p : printable_point = &lt;obj&gt;
</span></pre><p>
Initializers cannot be overridden. On the contrary, all initializers are
evaluated sequentially.
Initializers are particularly useful to enforce invariants.
Another example can be seen in section <a href="#ss%3Abank-accounts">5.1</a>.</p>
<!--TOC section id="sec28" Virtual methods-->
<h2 class="section" id="sec28">3.5&#XA0;&#XA0;Virtual methods</h2><!--SEC END --><p>

<a id="ss:virtual-methods"></a></p><p>It is possible to declare a method without actually defining it, using
the keyword <span class="c007">virtual</span>. This method will be provided later in
subclasses. A class containing virtual methods must be flagged
<span class="c007">virtual</span>, and cannot be instantiated (that is, no object of this class
can be created). It still defines type abbreviations (treating virtual methods
as other methods.)
</p><pre><span class="c004">#</span><span class="c003"> class virtual abstract_point x_init =
    object (self)
      method virtual get_x : int
      method get_offset = self#get_x - x_init
      method virtual move : int -&gt; unit
    end;;
<span class="c006">class virtual abstract_point :
  int -&gt;
  object
    method get_offset : int
    method virtual get_x : int
    method virtual move : int -&gt; unit
  end

</span><span class="c004">#</span> class point x_init =
    object
      inherit abstract_point x_init
      val mutable x = x_init
      method get_x = x
      method move d = x &lt;- x + d
    end;;
</span><span class="c006">class point :
  int -&gt;
  object
    val mutable x : int
    method get_offset : int
    method get_x : int
    method move : int -&gt; unit
  end
</span></pre><p>Instance variables can also be declared as virtual, with the same effect
as with methods.
</p><pre><span class="c004">#</span><span class="c003"> class virtual abstract_point2 =
    object
      val mutable virtual x : int
      method move d = x &lt;- x + d
    end;;
<span class="c006">class virtual abstract_point2 :
  object val mutable virtual x : int method move : int -&gt; unit end

</span><span class="c004">#</span> class point2 x_init =
    object
      inherit abstract_point2
      val mutable x = x_init
      method get_offset = x - x_init
    end;;
</span><span class="c006">class point2 :
  int -&gt;
  object
    val mutable x : int
    method get_offset : int
    method move : int -&gt; unit
  end
</span></pre>
<!--TOC section id="sec29" Private methods-->
<h2 class="section" id="sec29">3.6&#XA0;&#XA0;Private methods</h2><!--SEC END --><p>

<a id="ss:private-methods"></a></p><p>Private methods are methods that do not appear in object interfaces.
They can only be invoked from other methods of the same object.
</p><pre><span class="c004">#</span><span class="c003"> class restricted_point x_init =
    object (self)
      val mutable x = x_init
      method get_x = x
      method private move d = x &lt;- x + d
      method bump = self#move 1
    end;;
<span class="c006">class restricted_point :
  int -&gt;
  object
    val mutable x : int
    method bump : unit
    method get_x : int
    method private move : int -&gt; unit
  end

</span><span class="c004">#</span> let p = new restricted_point 0;;
<span class="c006">val p : restricted_point = &lt;obj&gt;

</span><span class="c004">#</span> <U>p</U>#move 10;;
<span class="c006">Error: This expression has type restricted_point
       It has no method move

</span><span class="c004">#</span> p#bump;;
</span><span class="c006">- : unit = ()
</span></pre><p>
Note that this is not the same thing as private and protected methods
in Java or C++, which can be called from other objects of the same
class. This is a direct consequence of the independence between types
and classes in OCaml: two unrelated classes may produce
objects of the same type, and there is no way at the type level to
ensure that an object comes from a specific class. However a possible
encoding of friend methods is given in section <a href="#ss%3Afriends">3.17</a>.</p><p>Private methods are inherited (they are by default visible in subclasses),
unless they are hidden by signature matching, as described below.</p><p>Private methods can be made public in a subclass.
</p><pre><span class="c004">#<span class="c003"> class point_again x =
    object (self)
      inherit restricted_point x
      method virtual move : _
    end;;
<span class="c006">class point_again :
  int -&gt;
  object
    val mutable x : int
    method bump : unit
    method get_x : int
    method move : int -&gt; unit
  end
</span></span></span></pre><p>
The annotation <span class="c007">virtual</span> here is only used to mention a method without
providing its definition. Since we didn&#X2019;t add the <span class="c007">private</span>
annotation, this makes the method public, keeping the original
definition.</p><p>An alternative definition is
</p><pre><span class="c004">#<span class="c003"> class point_again x =
    object (self : &lt; move : _; ..&gt; )
      inherit restricted_point x
    end;;
<span class="c006">class point_again :
  int -&gt;
  object
    val mutable x : int
    method bump : unit
    method get_x : int
    method move : int -&gt; unit
  end
</span></span></span></pre><p>
The constraint on self&#X2019;s type is requiring a public <span class="c007">move</span> method, and
this is sufficient to override <span class="c007">private</span>.</p><p>One could think that a private method should remain private in a subclass.
However, since the method is visible in a subclass, it is always possible
to pick its code and define a method of the same name that runs that
code, so yet another (heavier) solution would be:
</p><pre><span class="c004">#<span class="c003"> class point_again x =
    object
      inherit restricted_point x as super
      method move = super#move
    end;;
<span class="c006">class point_again :
  int -&gt;
  object
    val mutable x : int
    method bump : unit
    method get_x : int
    method move : int -&gt; unit
  end
</span></span></span></pre><p>Of course, private methods can also be virtual. Then, the keywords must
appear in this order <span class="c007">method private virtual</span>.</p>
<!--TOC section id="sec30" Class interfaces-->
<h2 class="section" id="sec30">3.7&#XA0;&#XA0;Class interfaces</h2><!--SEC END --><p>

<a id="ss:class-interfaces"></a></p><p>Class interfaces are inferred from class definitions. They may also
be defined directly and used to restrict the type of a class. Like class
declarations, they also define a new type abbreviation.
</p><pre><span class="c004">#</span><span class="c003"> class type restricted_point_type =
    object
      method get_x : int
      method bump : unit
  end;;
<span class="c006">class type restricted_point_type =
  object method bump : unit method get_x : int end

</span><span class="c004">#</span> fun (x : restricted_point_type) -&gt; x;;
</span><span class="c006">- : restricted_point_type -&gt; restricted_point_type = &lt;fun&gt;
</span></pre><p>
In addition to program documentation, class interfaces can be used to
constrain the type of a class. Both concrete instance variables and concrete
private methods can be hidden by a class type constraint. Public
methods and virtual members, however, cannot.
</p><pre><span class="c004">#<span class="c003"> class restricted_point' x = (restricted_point x : restricted_point_type);;
<span class="c006">class restricted_point' : int -&gt; restricted_point_type
</span></span></span></pre><p>
Or, equivalently:
</p><pre><span class="c004">#<span class="c003"> class restricted_point' = (restricted_point : int -&gt; restricted_point_type);;
<span class="c006">class restricted_point' : int -&gt; restricted_point_type
</span></span></span></pre><p>
The interface of a class can also be specified in a module
signature, and used to restrict the inferred signature of a module.
</p><pre><span class="c004">#</span><span class="c003"> module type POINT = sig
    class restricted_point' : int -&gt;
      object
        method get_x : int
        method bump : unit
      end
  end;;
<span class="c006">module type POINT =
  sig
    class restricted_point' :
      int -&gt; object method bump : unit method get_x : int end
  end

</span><span class="c004">#</span> module Point : POINT = struct
    class restricted_point' = restricted_point
  end;;
</span><span class="c006">module Point : POINT
</span></pre>
<!--TOC section id="sec31" Inheritance-->
<h2 class="section" id="sec31">3.8&#XA0;&#XA0;Inheritance</h2><!--SEC END --><p>

<a id="ss:inheritance"></a></p><p>We illustrate inheritance by defining a class of colored points that
inherits from the class of points. This class has all instance
variables and all methods of class <span class="c007">point</span>, plus a new instance
variable <span class="c007">c</span> and a new method <span class="c007">color</span>.
</p><pre><span class="c004">#</span><span class="c003"> class colored_point x (c : string) =
    object
      inherit point x
      val c = c
      method color = c
    end;;
<span class="c006">class colored_point :
  int -&gt;
  string -&gt;
  object
    val c : string
    val mutable x : int
    method color : string
    method get_offset : int
    method get_x : int
    method move : int -&gt; unit
  end

</span><span class="c004">#</span> let p' = new colored_point 5 "red";;
<span class="c006">val p' : colored_point = &lt;obj&gt;

</span><span class="c004">#</span> p'#get_x, p'#color;;
</span><span class="c006">- : int * string = (5, "red")
</span></pre><p>
A point and a colored point have incompatible types, since a point has
no method <span class="c007">color</span>. However, the function <span class="c007">get_x</span> below is a generic
function applying method <span class="c007">get_x</span> to any object <span class="c007">p</span> that has this
method (and possibly some others, which are represented by an ellipsis
in the type). Thus, it applies to both points and colored points.
</p><pre><span class="c004">#</span><span class="c003"> let get_succ_x p = p#get_x + 1;;
<span class="c006">val get_succ_x : &lt; get_x : int; .. &gt; -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> get_succ_x p + get_succ_x p';;
</span><span class="c006">- : int = 8
</span></pre><p>
Methods need not be declared previously, as shown by the example:
</p><pre><span class="c004">#</span><span class="c003"> let set_x p = p#set_x;;
<span class="c006">val set_x : &lt; set_x : 'a; .. &gt; -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> let incr p = set_x p (get_succ_x p);;
</span><span class="c006">val incr : &lt; get_x : int; set_x : int -&gt; 'a; .. &gt; -&gt; 'a = &lt;fun&gt;
</span></pre>
<!--TOC section id="sec32" Multiple inheritance-->
<h2 class="section" id="sec32">3.9&#XA0;&#XA0;Multiple inheritance</h2><!--SEC END --><p>

<a id="ss:multiple-inheritance"></a></p><p>Multiple inheritance is allowed. Only the last definition of a method
is kept: the redefinition in a subclass of a method that was visible in
the parent class overrides the definition in the parent class.
Previous definitions of a method can be reused by binding the related
ancestor. Below, <span class="c007">super</span> is bound to the ancestor <span class="c007">printable_point</span>.
The name <span class="c007">super</span> is a pseudo value identifier that can only be used to
invoke a super-class method, as in <span class="c007">super#print</span>.
</p><pre><span class="c004">#</span><span class="c003"> class printable_colored_point y c =
    object (self)
      val c = c
      method color = c
      inherit printable_point y as super
      method print =
        print_string "(";
        super#print;
        print_string ", ";
        print_string (self#color);
        print_string ")"
    end;;
<span class="c006">class printable_colored_point :
  int -&gt;
  string -&gt;
  object
    val c : string
    val mutable x : int
    method color : string
    method get_x : int
    method move : int -&gt; unit
    method print : unit
  end

</span><span class="c004">#</span> let p' = new printable_colored_point 17 "red";;
<span class="c006">new point at (10, red)
val p' : printable_colored_point = &lt;obj&gt;

</span><span class="c004">#</span> p'#print;;
</span><span class="c006">(10, red)- : unit = ()
</span></pre><p>
A private method that has been hidden in the parent class is no longer
visible, and is thus not overridden. Since initializers are treated as
private methods, all initializers along the class hierarchy are evaluated,
in the order they are introduced.</p>
<!--TOC section id="sec33" Parameterized classes-->
<h2 class="section" id="sec33">3.10&#XA0;&#XA0;Parameterized classes</h2><!--SEC END --><p>

<a id="ss:parameterized-classes"></a></p><p>Reference cells can be implemented as objects.
The naive definition fails to typecheck:
</p><pre><span class="c004">#</span><span class="c003"> class <U>ref x_init =
    object
      val mutable x = x_init
      method get = x
      method set y = x &lt;- y
    end</U>;;
</span><span class="c006">Error: Some type variables are unbound in this type:
         class ref :
           'a -&gt;
           object
             val mutable x : 'a
             method get : 'a
             method set : 'a -&gt; unit
           end
       The method get has type 'a where 'a is unbound
</span></pre><p>
The reason is that at least one of the methods has a polymorphic type
(here, the type of the value stored in the reference cell), thus
either the class should be parametric, or the method type should be
constrained to a monomorphic type. A monomorphic instance of the class could
be defined by:
</p><pre><span class="c004">#<span class="c003"> class ref (x_init:int) =
    object
      val mutable x = x_init
      method get = x
      method set y = x &lt;- y
    end;;
<span class="c006">class ref :
  int -&gt;
  object val mutable x : int method get : int method set : int -&gt; unit end
</span></span></span></pre><p>
Note that since immediate objects do not define a class type, they have
no such restriction.
</p><pre><span class="c004">#<span class="c003"> let new_ref x_init =
    object
      val mutable x = x_init
      method get = x
      method set y = x &lt;- y
    end;;
<span class="c006">val new_ref : 'a -&gt; &lt; get : 'a; set : 'a -&gt; unit &gt; = &lt;fun&gt;
</span></span></span></pre><p>
On the other hand, a class for polymorphic references must explicitly
list the type parameters in its declaration. Class type parameters are
listed between <span class="c007">[</span> and <span class="c007">]</span>. The type parameters must also be
bound somewhere in the class body by a type constraint.
</p><pre><span class="c004">#</span><span class="c003"> class ['a] ref x_init =
    object
      val mutable x = (x_init : 'a)
      method get = x
      method set y = x &lt;- y
    end;;
<span class="c006">class ['a] ref :
  'a -&gt; object val mutable x : 'a method get : 'a method set : 'a -&gt; unit end

</span><span class="c004">#</span> let r = new ref 1 in r#set 2; (r#get);;
</span><span class="c006">- : int = 2
</span></pre><p>
The type parameter in the declaration may actually be constrained in the
body of the class definition. In the class type, the actual value of
the type parameter is displayed in the <span class="c007">constraint</span> clause.
</p><pre><span class="c004">#<span class="c003"> class ['a] ref_succ (x_init:'a) =
    object
      val mutable x = x_init + 1
      method get = x
      method set y = x &lt;- y
    end;;
<span class="c006">class ['a] ref_succ :
  'a -&gt;
  object
    constraint 'a = int
    val mutable x : int
    method get : int
    method set : int -&gt; unit
  end
</span></span></span></pre><p>
Let us consider a more complex example: define a circle, whose center
may be any kind of point. We put an additional type
constraint in method <span class="c007">move</span>, since no free variables must remain
unaccounted for by the class type parameters.
</p><pre><span class="c004">#<span class="c003"> class ['a] circle (c : 'a) =
    object
      val mutable center = c
      method center = center
      method set_center c = center &lt;- c
      method move = (center#move : int -&gt; unit)
    end;;
<span class="c006">class ['a] circle :
  'a -&gt;
  object
    constraint 'a = &lt; move : int -&gt; unit; .. &gt;
    val mutable center : 'a
    method center : 'a
    method move : int -&gt; unit
    method set_center : 'a -&gt; unit
  end
</span></span></span></pre><p>
An alternate definition of <span class="c007">circle</span>, using a <span class="c007">constraint</span> clause in
the class definition, is shown below. The type <span class="c007">#point</span> used below in
the <span class="c007">constraint</span> clause is an abbreviation produced by the definition
of class <span class="c007">point</span>. This abbreviation unifies with the type of any
object belonging to a subclass of class <span class="c007">point</span>. It actually expands to
<span class="c007">&lt; get_x : int; move : int -&gt; unit; .. &gt;</span>. This leads to the following
alternate definition of <span class="c007">circle</span>, which has slightly stronger
constraints on its argument, as we now expect <span class="c007">center</span> to have a
method <span class="c007">get_x</span>.
</p><pre><span class="c004">#<span class="c003"> class ['a] circle (c : 'a) =
    object
      constraint 'a = #point
      val mutable center = c
      method center = center
      method set_center c = center &lt;- c
      method move = center#move
    end;;
<span class="c006">class ['a] circle :
  'a -&gt;
  object
    constraint 'a = #point
    val mutable center : 'a
    method center : 'a
    method move : int -&gt; unit
    method set_center : 'a -&gt; unit
  end
</span></span></span></pre><p>
The class <span class="c007">colored_circle</span> is a specialized version of class
<span class="c007">circle</span> that requires the type of the center to unify with
<span class="c007">#colored_point</span>, and adds a method <span class="c007">color</span>. Note that when specializing a
parameterized class, the instance of type parameter must always be
explicitly given. It is again written between <span class="c007">[</span> and <span class="c007">]</span>.
</p><pre><span class="c004">#<span class="c003"> class ['a] colored_circle c =
    object
      constraint 'a = #colored_point
      inherit ['a] circle c
      method color = center#color
    end;;
<span class="c006">class ['a] colored_circle :
  'a -&gt;
  object
    constraint 'a = #colored_point
    val mutable center : 'a
    method center : 'a
    method color : string
    method move : int -&gt; unit
    method set_center : 'a -&gt; unit
  end
</span></span></span></pre>
<!--TOC section id="sec34" Polymorphic methods-->
<h2 class="section" id="sec34">3.11&#XA0;&#XA0;Polymorphic methods</h2><!--SEC END --><p>

<a id="ss:polymorphic-methods"></a></p><p>While parameterized classes may be polymorphic in their contents, they
are not enough to allow polymorphism of method use.</p><p>A classical example is defining an iterator.
</p><pre><span class="c004">#</span><span class="c003"> List.fold_left;;
<span class="c006">- : ('a -&gt; 'b -&gt; 'a) -&gt; 'a -&gt; 'b list -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> class ['a] intlist (l : int list) =
    object
      method empty = (l = [])
      method fold f (accu : 'a) = List.fold_left f accu l
    end;;
</span><span class="c006">class ['a] intlist :
  int list -&gt;
  object method empty : bool method fold : ('a -&gt; int -&gt; 'a) -&gt; 'a -&gt; 'a end
</span></pre><p>
At first look, we seem to have a polymorphic iterator, however this
does not work in practice.
</p><pre><span class="c004">#</span><span class="c003"> let l = new intlist [1; 2; 3];;
<span class="c006">val l : '_a intlist = &lt;obj&gt;

</span><span class="c004">#</span> l#fold (fun x y -&gt; x+y) 0;;
<span class="c006">- : int = 6

</span><span class="c004">#</span> l;;
<span class="c006">- : int intlist = &lt;obj&gt;

</span><span class="c004">#</span> l#fold (fun s x -&gt; <U>s</U> ^ string_of_int x ^ " ") "";;
</span><span class="c006">Error: This expression has type int but an expression was expected of type
         string
</span></pre><p>
Our iterator works, as shows its first use for summation. However,
since objects themselves are not polymorphic (only their constructors
are), using the <span class="c007">fold</span> method fixes its type for this individual object.
Our next attempt to use it as a string iterator fails.</p><p>The problem here is that quantification was wrongly located: it is
not the class we want to be polymorphic, but the <span class="c007">fold</span> method.
This can be achieved by giving an explicitly polymorphic type in the
method definition.
</p><pre><span class="c004">#</span><span class="c003"> class intlist (l : int list) =
    object
      method empty = (l = [])
      method fold : 'a. ('a -&gt; int -&gt; 'a) -&gt; 'a -&gt; 'a =
        fun f accu -&gt; List.fold_left f accu l
    end;;
<span class="c006">class intlist :
  int list -&gt;
  object method empty : bool method fold : ('a -&gt; int -&gt; 'a) -&gt; 'a -&gt; 'a end

</span><span class="c004">#</span> let l = new intlist [1; 2; 3];;
<span class="c006">val l : intlist = &lt;obj&gt;

</span><span class="c004">#</span> l#fold (fun x y -&gt; x+y) 0;;
<span class="c006">- : int = 6

</span><span class="c004">#</span> l#fold (fun s x -&gt; s ^ string_of_int x ^ " ") "";;
</span><span class="c006">- : string = "1 2 3 "
</span></pre><p>
As you can see in the class type shown by the compiler, while
polymorphic method types must be fully explicit in class definitions
(appearing immediately after the method name), quantified type
variables can be left implicit in class descriptions. Why require types
to be explicit? The problem is that <span class="c007">(int -&gt; int -&gt; int) -&gt; int -&gt; int</span> would also be a valid type for <span class="c007">fold</span>, and it happens to be
incompatible with the polymorphic type we gave (automatic
instantiation only works for toplevel types variables, not for inner
quantifiers, where it becomes an undecidable problem.) So the compiler
cannot choose between those two types, and must be helped.</p><p>However, the type can be completely omitted in the class definition if
it is already known, through inheritance or type constraints on self.
Here is an example of method overriding.
</p><pre><span class="c004">#<span class="c003"> class intlist_rev l =
    object
      inherit intlist l
      method fold f accu = List.fold_left f accu (List.rev l)
    end;;
</span></span></pre><p>
The following idiom separates description and definition.
</p><pre><span class="c004">#<span class="c003"> class type ['a] iterator =
    object method fold : ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b end;;

  class intlist l =
    object (self : int #iterator)
      method empty = (l = [])
      method fold f accu = List.fold_left f accu l
    end;;
</span></span></pre><p>
Note here the <span class="c007">(self : int #iterator)</span> idiom, which ensures that this
object implements the interface <span class="c007">iterator</span>.</p><p>Polymorphic methods are called in exactly the same way as normal
methods, but you should be aware of some limitations of type
inference. Namely, a polymorphic method can only be called if its
type is known at the call site. Otherwise, the method will be assumed
to be monomorphic, and given an incompatible type.
</p><pre><span class="c004">#</span><span class="c003"> let sum lst = lst#fold (fun x y -&gt; x+y) 0;;
<span class="c006">val sum : &lt; fold : (int -&gt; int -&gt; int) -&gt; int -&gt; 'a; .. &gt; -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> sum <U>l</U>;;
</span><span class="c006">Error: This expression has type intlist
       but an expression was expected of type
         &lt; fold : (int -&gt; int -&gt; int) -&gt; int -&gt; 'a; .. &gt;
       Types for method fold are incompatible
</span></pre><p>
The workaround is easy: you should put a type constraint on the
parameter.
</p><pre><span class="c004">#<span class="c003"> let sum (lst : _ #iterator) = lst#fold (fun x y -&gt; x+y) 0;;
<span class="c006">val sum : int #iterator -&gt; int = &lt;fun&gt;
</span></span></span></pre><p>
Of course the constraint may also be an explicit method type.
Only occurences of quantified variables are required.
</p><pre><span class="c004">#<span class="c003"> let sum lst =
    (lst : &lt; fold : 'a. ('a -&gt; _ -&gt; 'a) -&gt; 'a -&gt; 'a; .. &gt;)#fold (+) 0;;
<span class="c006">val sum : &lt; fold : 'a. ('a -&gt; int -&gt; 'a) -&gt; 'a -&gt; 'a; .. &gt; -&gt; int = &lt;fun&gt;
</span></span></span></pre><p>Another use of polymorphic methods is to allow some form of implicit
subtyping in method arguments. We have already seen in section
<a href="#ss%3Ainheritance">3.8</a> how some functions may be polymorphic in the
class of their argument. This can be extended to methods.
</p><pre><span class="c004">#</span><span class="c003"> class type point0 = object method get_x : int end;;
<span class="c006">class type point0 = object method get_x : int end

</span><span class="c004">#</span> class distance_point x =
    object
      inherit point x
      method distance : 'a. (#point0 as 'a) -&gt; int =
        fun other -&gt; abs (other#get_x - x)
    end;;
<span class="c006">class distance_point :
  int -&gt;
  object
    val mutable x : int
    method distance : #point0 -&gt; int
    method get_offset : int
    method get_x : int
    method move : int -&gt; unit
  end

</span><span class="c004">#</span> let p = new distance_point 3 in
  (p#distance (new point 8), p#distance (new colored_point 1 "blue"));;
</span><span class="c006">- : int * int = (5, 2)
</span></pre><p>
Note here the special syntax <span class="c007">(#point0 as 'a)</span> we have to use to
quantify the extensible part of <span class="c007">#point0</span>. As for the variable binder,
it can be omitted in class specifications. If you want polymorphism
inside object field it must be quantified independently.
</p><pre><span class="c004">#<span class="c003"> class multi_poly =
    object
      method m1 : 'a. (&lt; n1 : 'b. 'b -&gt; 'b; .. &gt; as 'a) -&gt; _ =
        fun o -&gt; o#n1 true, o#n1 "hello"
      method m2 : 'a 'b. (&lt; n2 : 'b -&gt; bool; .. &gt; as 'a) -&gt; 'b -&gt; _ =
        fun o x -&gt; o#n2 x
    end;;
<span class="c006">class multi_poly :
  object
    method m1 : &lt; n1 : 'b. 'b -&gt; 'b; .. &gt; -&gt; bool * string
    method m2 : &lt; n2 : 'b -&gt; bool; .. &gt; -&gt; 'b -&gt; bool
  end
</span></span></span></pre><p>
In method <span class="c007">m1</span>, <span class="c007">o</span> must be an object with at least a method <span class="c007">n1</span>,
itself polymorphic. In method <span class="c007">m2</span>, the argument of <span class="c007">n2</span> and <span class="c007">x</span> must
have the same type, which is quantified at the same level as <span class="c007">'a</span>.</p>
<!--TOC section id="sec35" Using coercions-->
<h2 class="section" id="sec35">3.12&#XA0;&#XA0;Using coercions</h2><!--SEC END --><p>

<a id="ss:using-coercions"></a></p><p>Subtyping is never implicit. There are, however, two ways to perform
subtyping. The most general construction is fully explicit: both the
domain and the codomain of the type coercion must be given.</p><p>We have seen that points and colored points have incompatible types.
For instance, they cannot be mixed in the same list. However, a
colored point can be coerced to a point, hiding its <span class="c007">color</span> method:
</p><pre><span class="c004">#</span><span class="c003"> let colored_point_to_point cp = (cp : colored_point :&gt; point);;
<span class="c006">val colored_point_to_point : colored_point -&gt; point = &lt;fun&gt;

</span><span class="c004">#</span> let p = new point 3 and q = new colored_point 4 "blue";;
<span class="c006">val p : point = &lt;obj&gt;
val q : colored_point = &lt;obj&gt;

</span><span class="c004">#</span> let l = [p; (colored_point_to_point q)];;
</span><span class="c006">val l : point list = [&lt;obj&gt;; &lt;obj&gt;]
</span></pre><p>
An object of type <span class="c007">t</span> can be seen as an object of type <span class="c007">t'</span>
only if <span class="c007">t</span> is a subtype of <span class="c007">t'</span>. For instance, a point cannot be
seen as a colored point.
</p><pre><span class="c004">#</span> <span class="c003"><U>(p : point :&gt; colored_point)</U>;;
</span><span class="c006">Error: Type point = &lt; get_offset : int; get_x : int; move : int -&gt; unit &gt;
       is not a subtype of
         colored_point =
           &lt; color : string; get_offset : int; get_x : int;
             move : int -&gt; unit &gt; 
</span></pre><p>
Indeed, narrowing coercions without runtime checks would be unsafe.
Runtime type checks might raise exceptions, and they would require
the presence of type information at runtime, which is not the case in
the OCaml system.
For these reasons, there is no such operation available in the language.</p><p>Be aware that subtyping and inheritance are not related. Inheritance is a
syntactic relation between classes while subtyping is a semantic relation
between types. For instance, the class of colored points could have been
defined directly, without inheriting from the class of points; the type of
colored points would remain unchanged and thus still be a subtype of
points.
</p><p>The domain of a coercion can often be omitted. For instance, one can
define:
</p><pre><span class="c004">#<span class="c003"> let to_point cp = (cp :&gt; point);;
<span class="c006">val to_point : #point -&gt; point = &lt;fun&gt;
</span></span></span></pre><p>
In this case, the function <span class="c007">colored_point_to_point</span> is an instance of the
function <span class="c007">to_point</span>. This is not always true, however. The fully
explicit coercion is more precise and is sometimes unavoidable.
Consider, for example, the following class:
</p><pre><span class="c004">#<span class="c003"> class c0 = object method m = {&lt; &gt;} method n = 0 end;;
<span class="c006">class c0 : object ('a) method m : 'a method n : int end
</span></span></span></pre><p>
The object type <span class="c007">c0</span> is an abbreviation for <span class="c007">&lt;m : 'a; n : int&gt; as 'a</span>.
Consider now the type declaration:
</p><pre><span class="c004">#<span class="c003"> class type c1 =  object method m : c1 end;;
<span class="c006">class type c1 = object method m : c1 end
</span></span></span></pre><p>
The object type <span class="c007">c1</span> is an abbreviation for the type <span class="c007">&lt;m : 'a&gt; as 'a</span>.
The coercion from an object of type <span class="c007">c0</span> to an object of type <span class="c007">c1</span> is
correct:
</p><pre><span class="c004">#<span class="c003"> fun (x:c0) -&gt; (x : c0 :&gt; c1);;
<span class="c006">- : c0 -&gt; c1 = &lt;fun&gt;
</span></span></span></pre><p>
However, the domain of the coercion cannot always be omitted.
In that case, the solution is to use the explicit form.
Sometimes, a change in the class-type definition can also solve the problem
</p><pre><span class="c004">#</span><span class="c003"> class type c2 = object ('a) method m : 'a end;;
<span class="c006">class type c2 = object ('a) method m : 'a end

</span><span class="c004">#</span> fun (x:c0) -&gt; (x :&gt; c2);;
</span><span class="c006">- : c0 -&gt; c2 = &lt;fun&gt;
</span></pre><p>
While class types <span class="c007">c1</span> and <span class="c007">c2</span> are different, both object types
<span class="c007">c1</span> and <span class="c007">c2</span> expand to the same object type (same method names and types).
Yet, when the domain of a coercion is left implicit and its co-domain
is an abbreviation of a known class type, then the class type, rather
than the object type, is used to derive the coercion function. This
allows leaving the domain implicit in most cases when coercing form a
subclass to its superclass.
The type of a coercion can always be seen as below:
</p><pre><span class="c004">#</span><span class="c003"> let to_c1 x = (x :&gt; c1);;
<span class="c006">val to_c1 : &lt; m : #c1; .. &gt; -&gt; c1 = &lt;fun&gt;

</span><span class="c004">#</span> let to_c2 x = (x :&gt; c2);;
</span><span class="c006">val to_c2 : #c2 -&gt; c2 = &lt;fun&gt;
</span></pre><p>
Note the difference between these two coercions: in the case of <span class="c007">to_c2</span>,
the type
<span class="c007">#c2 = &lt; m : 'a; .. &gt; as 'a</span> is polymorphically recursive (according
to the explicit recursion in the class type of <span class="c007">c2</span>); hence the
success of applying this coercion to an object of class <span class="c007">c0</span>.
On the other hand, in the first case, <span class="c007">c1</span> was only expanded and
unrolled twice to obtain <span class="c007">&lt; m : &lt; m : c1; .. &gt;; .. &gt;</span> (remember <span class="c007">#c1 = &lt; m : c1; .. &gt;</span>), without introducing recursion.
You may also note that the type of <span class="c007">to_c2</span> is <span class="c007">#c2 -&gt; c2</span> while
the type of <span class="c007">to_c1</span> is more general than <span class="c007">#c1 -&gt; c1</span>. This is not always true,
since there are class types for which some instances of <span class="c007">#c</span> are not subtypes
of <span class="c007">c</span>, as explained in section&#XA0;<a href="#ss%3Abinary-methods">3.16</a>. Yet, for
parameterless classes the coercion <span class="c007">(_ :&gt; c)</span> is always more general than
<span class="c007">(_ : #c :&gt; c)</span>.
</p><p>A common problem may occur when one tries to define a coercion to a
class <span class="c007">c</span> while defining class <span class="c007">c</span>. The problem is due to the type
abbreviation not being completely defined yet, and so its subtypes are not
clearly known. Then, a coercion <span class="c007">(_ :&gt; c)</span> or <span class="c007">(_ : #c :&gt; c)</span> is taken to be
the identity function, as in
</p><pre><span class="c004">#<span class="c003"> function x -&gt; (x :&gt; 'a);;
<span class="c006">- : 'a -&gt; 'a = &lt;fun&gt;
</span></span></span></pre><p>
As a consequence, if the coercion is applied to <span class="c007">self</span>, as in the
following example, the type of <span class="c007">self</span> is unified with the closed type
<span class="c007">c</span> (a closed object type is an object type without ellipsis). This
would constrain the type of self be closed and is thus rejected.
Indeed, the type of self cannot be closed: this would prevent any
further extension of the class. Therefore, a type error is generated
when the unification of this type with another type would result in a
closed object type.
</p><pre><span class="c004">#</span><span class="c003"> class c = object method m = 1 end
  and d = object (self)
    inherit c
    method n = 2
    method as_c = (<U>self</U> :&gt; c)
  end;;
</span><span class="c006">Error: This expression cannot be coerced to type c = &lt; m : int &gt;; it has type
         &lt; as_c : c; m : int; n : int; .. &gt;
       but is here used with type c
       Self type cannot escape its class
</span></pre><p>
However, the most common instance of this problem, coercing self to
its current class, is detected as a special case by the type checker,
and properly typed.
</p><pre><span class="c004">#<span class="c003"> class c = object (self) method m = (self :&gt; c) end;;
<span class="c006">class c : object method m : c end
</span></span></span></pre><p>
This allows the following idiom, keeping a list of all objects
belonging to a class or its subclasses:
</p><pre><span class="c004">#</span><span class="c003"> let all_c = ref [];;
<span class="c006">val all_c : '_a list ref = {contents = []}

</span><span class="c004">#</span> class c (m : int) =
    object (self)
      method m = m
      initializer all_c := (self :&gt; c) :: !all_c
    end;;
</span><span class="c006">class c : int -&gt; object method m : int end
</span></pre><p>
This idiom can in turn be used to retrieve an object whose type has
been weakened:
</p><pre><span class="c004">#</span><span class="c003"> let rec lookup_obj obj = function [] -&gt; raise Not_found
    | obj' :: l -&gt;
       if (obj :&gt; &lt; &gt;) = (obj' :&gt; &lt; &gt;) then obj' else lookup_obj obj l ;;
<span class="c006">val lookup_obj : &lt; .. &gt; -&gt; (&lt; .. &gt; as 'a) list -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> let lookup_c obj = lookup_obj obj !all_c;;
</span><span class="c006">val lookup_c : &lt; .. &gt; -&gt; &lt; m : int &gt; = &lt;fun&gt;
</span></pre><p>
The type <span class="c007">&lt; m : int &gt;</span> we see here is just the expansion of <span class="c007">c</span>, due
to the use of a reference; we have succeeded in getting back an object
of type <span class="c007">c</span>.</p><p><br>
The previous coercion problem can often be avoided by first
defining the abbreviation, using a class type:
</p><pre><span class="c004">#</span><span class="c003"> class type c' = object method m : int end;;
<span class="c006">class type c' = object method m : int end

</span><span class="c004">#</span> class c : c' = object method m = 1 end
  and d = object (self)
    inherit c
    method n = 2
    method as_c = (self :&gt; c')
  end;;
</span><span class="c006">class c : c'
and d : object method as_c : c' method m : int method n : int end
</span></pre><p>
It is also possible to use a virtual class. Inheriting from this class
simultaneously forces all methods of <span class="c007">c</span> to have the same
type as the methods of <span class="c007">c'</span>.
</p><pre><span class="c004">#</span><span class="c003"> class virtual c' = object method virtual m : int end;;
<span class="c006">class virtual c' : object method virtual m : int end

</span><span class="c004">#</span> class c = object (self) inherit c' method m = 1 end;;
</span><span class="c006">class c : object method m : int end
</span></pre><p>
One could think of defining the type abbreviation directly:
</p><pre><span class="c004">#<span class="c003"> type c' = &lt;m : int&gt;;;
</span></span></pre><p>
However, the abbreviation <span class="c007">#c'</span> cannot be defined directly in a similar way.
It can only be defined by a class or a class-type definition.
This is because a <span class="c007">#</span>-abbreviation carries an implicit anonymous
variable <span class="c007">..</span> that cannot be explicitly named.
The closer you get to it is:
</p><pre><span class="c004">#<span class="c003"> type 'a c'_class = 'a constraint 'a = &lt; m : int; .. &gt;;;
</span></span></pre><p>
with an extra type variable capturing the open object type.</p>
<!--TOC section id="sec36" Functional objects-->
<h2 class="section" id="sec36">3.13&#XA0;&#XA0;Functional objects</h2><!--SEC END --><p>

<a id="ss:functional-objects"></a></p><p>It is possible to write a version of class <span class="c007">point</span> without assignments
on the instance variables. The override construct <span class="c007">{&lt; ... &gt;}</span> returns a copy of
&#X201C;self&#X201D; (that is, the current object), possibly changing the value of
some instance variables.
</p><pre><span class="c004">#</span><span class="c003"> class functional_point y =
    object
      val x = y
      method get_x = x
      method move d = {&lt; x = x + d &gt;}
    end;;
<span class="c006">class functional_point :
  int -&gt;
  object ('a) val x : int method get_x : int method move : int -&gt; 'a end

</span><span class="c004">#</span> let p = new functional_point 7;;
<span class="c006">val p : functional_point = &lt;obj&gt;

</span><span class="c004">#</span> p#get_x;;
<span class="c006">- : int = 7

</span><span class="c004">#</span> (p#move 3)#get_x;;
<span class="c006">- : int = 10

</span><span class="c004">#</span> p#get_x;;
</span><span class="c006">- : int = 7
</span></pre><p>
Note that the type abbreviation <span class="c007">functional_point</span> is recursive, which can
be seen in the class type of <span class="c007">functional_point</span>: the type of self is <span class="c007">'a</span>
and <span class="c007">'a</span> appears inside the type of the method <span class="c007">move</span>.</p><p>The above definition of <span class="c007">functional_point</span> is not equivalent
to the following:
</p><pre><span class="c004">#<span class="c003"> class bad_functional_point y =
    object
      val x = y
      method get_x = x
      method move d = new bad_functional_point (x+d)
    end;;
<span class="c006">class bad_functional_point :
  int -&gt;
  object
    val x : int
    method get_x : int
    method move : int -&gt; bad_functional_point
  end
</span></span></span></pre><p>
While objects of either class will behave the same, objects of their
subclasses will be different. In a subclass of <span class="c007">bad_functional_point</span>,
the method <span class="c007">move</span> will
keep returning an object of the parent class. On the contrary, in a
subclass of <span class="c007">functional_point</span>, the method <span class="c007">move</span> will return an
object of the subclass.</p><p>Functional update is often used in conjunction with binary methods
as illustrated in section <a href="#module%3Astring">5.2.1</a>.</p>
<!--TOC section id="sec37" Cloning objects-->
<h2 class="section" id="sec37">3.14&#XA0;&#XA0;Cloning objects</h2><!--SEC END --><p>

<a id="ss:cloning-objects"></a></p><p>Objects can also be cloned, whether they are functional or imperative.
The library function <span class="c007">Oo.copy</span> makes a shallow copy of an object. That is,
it returns a new object that has the same methods and instance
variables as its argument. The
instance variables are copied but their contents are shared.
Assigning a new value to an instance variable of the copy (using a method
call) will not affect instance variables of the original, and conversely.
A deeper assignment (for example if the instance variable is a reference cell)
will of course affect both the original and the copy.</p><p>The type of <span class="c007">Oo.copy</span> is the following:
</p><pre><span class="c004">#<span class="c003"> Oo.copy;;
<span class="c006">- : (&lt; .. &gt; as 'a) -&gt; 'a = &lt;fun&gt;
</span></span></span></pre><p>
The keyword <span class="c007">as</span> in that type binds the type variable <span class="c007">'a</span> to
the object type <span class="c007">&lt; .. &gt;</span>. Therefore, <span class="c007">Oo.copy</span> takes an object with
any methods (represented by the ellipsis), and returns an object of
the same type. The type of <span class="c007">Oo.copy</span> is different from type <span class="c007">&lt; .. &gt; -&gt; &lt; .. &gt;</span> as each ellipsis represents a different set of methods.
Ellipsis actually behaves as a type variable.
</p><pre><span class="c004">#</span><span class="c003"> let p = new point 5;;
<span class="c006">val p : point = &lt;obj&gt;

</span><span class="c004">#</span> let q = Oo.copy p;;
<span class="c006">val q : point = &lt;obj&gt;

</span><span class="c004">#</span> q#move 7; (p#get_x, q#get_x);;
</span><span class="c006">- : int * int = (5, 12)
</span></pre><p>
In fact, <span class="c007">Oo.copy p</span> will behave as <span class="c007">p#copy</span> assuming that a public
method <span class="c007">copy</span> with body <span class="c007">{&lt; &gt;}</span> has been defined in the class of <span class="c007">p</span>.</p><p>Objects can be compared using the generic comparison functions <span class="c007">=</span> and <span class="c007">&lt;&gt;</span>.
Two objects are equal if and only if they are physically equal. In
particular, an object and its copy are not equal.
</p><pre><span class="c004">#</span><span class="c003"> let q = Oo.copy p;;
<span class="c006">val q : point = &lt;obj&gt;

</span><span class="c004">#</span> p = q, p = p;;
</span><span class="c006">- : bool * bool = (false, true)
</span></pre><p>
Other generic comparisons such as (<span class="c007">&lt;</span>, <span class="c007">&lt;=</span>, ...) can also be used on
objects. The
relation <span class="c007">&lt;</span> defines an unspecified but strict ordering on objets. The
ordering relationship between two objects is fixed once for all after the
two objects have been created and it is not affected by mutation of fields.</p><p>Cloning and override have a non empty intersection.
They are interchangeable when used within an object and without
overriding any field:
</p><pre><span class="c004">#</span><span class="c003"> class copy =
    object
      method copy = {&lt; &gt;}
    end;;
<span class="c006">class copy : object ('a) method copy : 'a end

</span><span class="c004">#</span> class copy =
    object (self)
      method copy = Oo.copy self
    end;;
</span><span class="c006">class copy : object ('a) method copy : 'a end
</span></pre><p>
Only the override can be used to actually override fields, and
only the <span class="c007">Oo.copy</span> primitive can be used externally.</p><p>Cloning can also be used to provide facilities for saving and
restoring the state of objects.
</p><pre><span class="c004">#<span class="c003"> class backup =
    object (self : 'mytype)
      val mutable copy = None
      method save = copy &lt;- Some {&lt; copy = None &gt;}
      method restore = match copy with Some x -&gt; x | None -&gt; self
    end;;
<span class="c006">class backup :
  object ('a)
    val mutable copy : 'a option
    method restore : 'a
    method save : unit
  end
</span></span></span></pre><p>
The above definition will only backup one level.
The backup facility can be added to any class by using multiple inheritance.
</p><pre><span class="c004">#</span><span class="c003"> class ['a] backup_ref x = object inherit ['a] ref x inherit backup end;;
<span class="c006">class ['a] backup_ref :
  'a -&gt;
  object ('b)
    val mutable copy : 'b option
    val mutable x : 'a
    method get : 'a
    method restore : 'b
    method save : unit
    method set : 'a -&gt; unit
  end

</span><span class="c004">#</span> let rec get p n = if n = 0 then p # get else get (p # restore) (n-1);;
<span class="c006">val get : (&lt; get : 'b; restore : 'a; .. &gt; as 'a) -&gt; int -&gt; 'b = &lt;fun&gt;

</span><span class="c004">#</span> let p = new backup_ref 0  in
  p # save; p # set 1; p # save; p # set 2;
  [get p 0; get p 1; get p 2; get p 3; get p 4];;
</span><span class="c006">- : int list = [2; 1; 1; 1; 1]
</span></pre><p>
We can define a variant of backup that retains all copies. (We also
add a method <span class="c007">clear</span> to manually erase all copies.)
</p><pre><span class="c004">#<span class="c003"> class backup =
    object (self : 'mytype)
      val mutable copy = None
      method save = copy &lt;- Some {&lt; &gt;}
      method restore = match copy with Some x -&gt; x | None -&gt; self
      method clear = copy &lt;- None
    end;;
<span class="c006">class backup :
  object ('a)
    val mutable copy : 'a option
    method clear : unit
    method restore : 'a
    method save : unit
  end
</span></span></span></pre><pre><span class="c004">#</span><span class="c003"> class ['a] backup_ref x = object inherit ['a] ref x inherit backup end;;
<span class="c006">class ['a] backup_ref :
  'a -&gt;
  object ('b)
    val mutable copy : 'b option
    val mutable x : 'a
    method clear : unit
    method get : 'a
    method restore : 'b
    method save : unit
    method set : 'a -&gt; unit
  end

</span><span class="c004">#</span> let p = new backup_ref 0  in
  p # save; p # set 1; p # save; p # set 2;
  [get p 0; get p 1; get p 2; get p 3; get p 4];;
</span><span class="c006">- : int list = [2; 1; 0; 0; 0]
</span></pre>
<!--TOC section id="sec38" Recursive classes-->
<h2 class="section" id="sec38">3.15&#XA0;&#XA0;Recursive classes</h2><!--SEC END --><p>

<a id="ss:recursive-classes"></a></p><p>Recursive classes can be used to define objects whose types are
mutually recursive.
</p><pre><span class="c004">#<span class="c003"> class window =
    object
      val mutable top_widget = (None : widget option)
      method top_widget = top_widget
    end
  and widget (w : window) =
    object
      val window = w
      method window = window
    end;;
<span class="c006">class window :
  object
    val mutable top_widget : widget option
    method top_widget : widget option
  end
and widget : window -&gt; object val window : window method window : window end
</span></span></span></pre><p>
Although their types are mutually recursive, the classes <span class="c007">widget</span> and
<span class="c007">window</span> are themselves independent.</p>
<!--TOC section id="sec39" Binary methods-->
<h2 class="section" id="sec39">3.16&#XA0;&#XA0;Binary methods</h2><!--SEC END --><p>

<a id="ss:binary-methods"></a></p><p>A binary method is a method which takes an argument of the same type
as self. The class <span class="c007">comparable</span> below is a template for classes with a
binary method <span class="c007">leq</span> of type <span class="c007">'a -&gt; bool</span> where the type variable <span class="c007">'a</span>
is bound to the type of self. Therefore, <span class="c007">#comparable</span> expands to <span class="c007">&lt; leq : 'a -&gt; bool; .. &gt; as 'a</span>. We see here that the binder <span class="c007">as</span> also
allows writing recursive types.
</p><pre><span class="c004">#<span class="c003"> class virtual comparable =
    object (_ : 'a)
      method virtual leq : 'a -&gt; bool
    end;;
<span class="c006">class virtual comparable : object ('a) method virtual leq : 'a -&gt; bool end
</span></span></span></pre><p>
We then define a subclass <span class="c007">money</span> of <span class="c007">comparable</span>. The class <span class="c007">money</span>
simply wraps floats as comparable objects. We will extend it below with
more operations. We have to use a type constraint on the class parameter <span class="c007">x</span>
because the primitive <span class="c007">&lt;=</span> is a polymorphic function in
OCaml. The <span class="c007">inherit</span> clause ensures that the type of objects
of this class is an instance of <span class="c007">#comparable</span>.
</p><pre><span class="c004">#<span class="c003"> class money (x : float) =
    object
      inherit comparable
      val repr = x
      method value = repr
      method leq p = repr &lt;= p#value
    end;;
<span class="c006">class money :
  float -&gt;
  object ('a)
    val repr : float
    method leq : 'a -&gt; bool
    method value : float
  end
</span></span></span></pre><p>
Note that the type <span class="c007">money</span> is not a subtype of type
<span class="c007">comparable</span>, as the self type appears in contravariant position
in the type of method <span class="c007">leq</span>.
Indeed, an object <span class="c007">m</span> of class <span class="c007">money</span> has a method <span class="c007">leq</span>
that expects an argument of type <span class="c007">money</span> since it accesses
its <span class="c007">value</span> method. Considering <span class="c007">m</span> of type <span class="c007">comparable</span> would allow a
call to method <span class="c007">leq</span> on <span class="c007">m</span> with an argument that does not have a method
<span class="c007">value</span>, which would be an error.</p><p>Similarly, the type <span class="c007">money2</span> below is not a subtype of type <span class="c007">money</span>.
</p><pre><span class="c004">#<span class="c003"> class money2 x =
    object
      inherit money x
      method times k = {&lt; repr = k *. repr &gt;}
    end;;
<span class="c006">class money2 :
  float -&gt;
  object ('a)
    val repr : float
    method leq : 'a -&gt; bool
    method times : float -&gt; 'a
    method value : float
  end
</span></span></span></pre><p>
It is however possible to define functions that manipulate objects of
type either <span class="c007">money</span> or <span class="c007">money2</span>: the function <span class="c007">min</span>
will return the minimum of any two objects whose type unifies with
<span class="c007">#comparable</span>. The type of <span class="c007">min</span> is not the same as <span class="c007">#comparable -&gt; #comparable -&gt; #comparable</span>, as the abbreviation <span class="c007">#comparable</span> hides a
type variable (an ellipsis). Each occurrence of this abbreviation
generates a new variable.
</p><pre><span class="c004">#<span class="c003"> let min (x : #comparable) y =
    if x#leq y then x else y;;
<span class="c006">val min : (#comparable as 'a) -&gt; 'a -&gt; 'a = &lt;fun&gt;
</span></span></span></pre><p>
This function can be applied to objects of type <span class="c007">money</span>
or <span class="c007">money2</span>.
</p><pre><span class="c004">#</span><span class="c003"> (min (new money  1.3) (new money 3.1))#value;;
<span class="c006">- : float = 1.3

</span><span class="c004">#</span> (min (new money2 5.0) (new money2 3.14))#value;;
</span><span class="c006">- : float = 3.14
</span></pre><p>More examples of binary methods can be found in sections
<a href="#module%3Astring">5.2.1</a> and <a href="#module%3Aset">5.2.3</a>.</p><p>Note the use of override for method <span class="c007">times</span>.
Writing <span class="c007">new money2 (k *. repr)</span> instead of <span class="c007">{&lt; repr = k *. repr &gt;}</span>
would not behave well with inheritance: in a subclass <span class="c007">money3</span> of <span class="c007">money2</span>
the <span class="c007">times</span> method would return an object of class <span class="c007">money2</span> but not of class
<span class="c007">money3</span> as would be expected.</p><p>The class <span class="c007">money</span> could naturally carry another binary method. Here is a
direct definition:
</p><pre><span class="c004">#<span class="c003"> class money x =
    object (self : 'a)
      val repr = x
      method value = repr
      method print = print_float repr
      method times k = {&lt; repr = k *. x &gt;}
      method leq (p : 'a) = repr &lt;= p#value
      method plus (p : 'a) = {&lt; repr = x +. p#value &gt;}
    end;;
<span class="c006">class money :
  float -&gt;
  object ('a)
    val repr : float
    method leq : 'a -&gt; bool
    method plus : 'a -&gt; 'a
    method print : unit
    method times : float -&gt; 'a
    method value : float
  end
</span></span></span></pre>
<!--TOC section id="sec40" Friends-->
<h2 class="section" id="sec40">3.17&#XA0;&#XA0;Friends</h2><!--SEC END --><p>

<a id="ss:friends"></a></p><p>The above class <span class="c007">money</span> reveals a problem that often occurs with binary
methods. In order to interact with other objects of the same class, the
representation of <span class="c007">money</span> objects must be revealed, using a method such as
<span class="c007">value</span>. If we remove all binary methods (here <span class="c007">plus</span> and <span class="c007">leq</span>),
the representation can easily be hidden inside objects by removing the method
<span class="c007">value</span> as well. However, this is not possible as soon as some binary
method requires access to the representation of objects of the same
class (other than self).
</p><pre><span class="c004">#<span class="c003"> class safe_money x =
    object (self : 'a)
      val repr = x
      method print = print_float repr
      method times k = {&lt; repr = k *. x &gt;}
    end;;
<span class="c006">class safe_money :
  float -&gt;
  object ('a)
    val repr : float
    method print : unit
    method times : float -&gt; 'a
  end
</span></span></span></pre><p>
Here, the representation of the object is known only to a particular object.
To make it available to other objects of the same class, we are forced to
make it available to the whole world. However we can easily restrict the
visibility of the representation using the module system.
</p><pre><span class="c004">#<span class="c003"> module type MONEY =
    sig
      type t
      class c : float -&gt;
        object ('a)
          val repr : t
          method value : t
          method print : unit
          method times : float -&gt; 'a
          method leq : 'a -&gt; bool
          method plus : 'a -&gt; 'a
        end
    end;;

  module Euro : MONEY =
    struct
      type t = float
      class c x =
        object (self : 'a)
          val repr = x
          method value = repr
          method print = print_float repr
          method times k = {&lt; repr = k *. x &gt;}
          method leq (p : 'a) = repr &lt;= p#value
          method plus (p : 'a) = {&lt; repr = x +. p#value &gt;}
        end
    end;;
</span></span></pre><p>
Another example of friend functions may be found in section
<a href="#module%3Aset">5.2.3</a>. These examples occur when a group of objects (here
objects of the same class) and functions should see each others internal
representation, while their representation should be hidden from the
outside. The solution is always to define all friends in the same module,
give access to the representation and use a signature constraint to make the
representation abstract outside the module.</p>
<!--TOC chapter id="sec41" Labels and variants-->
<h1 class="chapter" id="sec41">Chapter&#XA0;4&#XA0;&#XA0;Labels and variants</h1><!--SEC END --><p> <a id="c:labl-examples"></a>

</p><!--NAME lablexamples.html-->
<p>
<span class="c013">(Chapter written by Jacques Garrigue)</span></p><p><br>
<br>
</p><p>This chapter gives an overview of the new features in
OCaml 3: labels, and polymorphic variants.</p>
<!--TOC section id="sec42" Labels-->
<h2 class="section" id="sec42">4.1&#XA0;&#XA0;Labels</h2><!--SEC END --><p>If you have a look at modules ending in <span class="c007">Labels</span> in the standard
library, you will see that function types have annotations you did not
have in the functions you defined yourself.</p><pre><span class="c004">#</span><span class="c003"> ListLabels.map;;
<span class="c006">- : f:('a -&gt; 'b) -&gt; 'a list -&gt; 'b list = &lt;fun&gt;

</span><span class="c004">#</span> StringLabels.sub;;
</span><span class="c006">- : string -&gt; pos:int -&gt; len:int -&gt; string = &lt;fun&gt;
</span></pre><p>Such annotations of the form <span class="c007">name:</span> are called <em>labels</em>. They are
meant to document the code, allow more checking, and give more
flexibility to function application.
You can give such names to arguments in your programs, by prefixing them
with a tilde <span class="c007">~</span>.</p><pre><span class="c004">#</span><span class="c003"> let f ~x ~y = x - y;;
<span class="c006">val f : x:int -&gt; y:int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> let x = 3 and y = 2 in f ~x ~y;;
</span><span class="c006">- : int = 1
</span></pre><p>When you want to use distinct names for the variable and the label
appearing in the type, you can use a naming label of the form
<span class="c007">~name:</span>. This also applies when the argument is not a variable.</p><pre><span class="c004">#</span><span class="c003"> let f ~x:x1 ~y:y1 = x1 - y1;;
<span class="c006">val f : x:int -&gt; y:int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> f ~x:3 ~y:2;;
</span><span class="c006">- : int = 1
</span></pre><p>Labels obey the same rules as other identifiers in OCaml, that is you
cannot use a reserved keyword (like <span class="c007">in</span> or <span class="c007">to</span>) as label.</p><p>Formal parameters and arguments are matched according to their
respective labels<sup><a id="text1" href="#note1">1</a></sup>, the absence of label
being interpreted as the empty label.
This allows commuting arguments in applications. One can also
partially apply a function on any argument, creating a new function of
the remaining parameters.</p><pre><span class="c004">#</span><span class="c003"> let f ~x ~y = x - y;;
<span class="c006">val f : x:int -&gt; y:int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> f ~y:2 ~x:3;;
<span class="c006">- : int = 1

</span><span class="c004">#</span> ListLabels.fold_left;;
<span class="c006">- : f:('a -&gt; 'b -&gt; 'a) -&gt; init:'a -&gt; 'b list -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> ListLabels.fold_left [1;2;3] ~init:0 ~f:( + );;
<span class="c006">- : int = 6

</span><span class="c004">#</span> ListLabels.fold_left ~init:0;;
</span><span class="c006">- : f:(int -&gt; 'a -&gt; int) -&gt; 'a list -&gt; int = &lt;fun&gt;
</span></pre><p>If several arguments of a function bear the same label (or no label),
they will not commute among themselves, and order matters. But they
can still commute with other arguments.</p><pre><span class="c004">#</span><span class="c003"> let hline ~x:x1 ~x:x2 ~y = (x1, x2, y);;
<span class="c006">val hline : x:'a -&gt; x:'b -&gt; y:'c -&gt; 'a * 'b * 'c = &lt;fun&gt;

</span><span class="c004">#</span> hline ~x:3 ~y:2 ~x:5;;
</span><span class="c006">- : int * int * int = (3, 5, 2)
</span></pre><p>As an exception to the above parameter matching rules, if an
application is total (omitting all optional arguments), labels may be
omitted.
In practice, many applications are total, so that labels can often be
omitted.
</p><pre><span class="c004">#</span><span class="c003"> f 3 2;;
<span class="c006">- : int = 1

</span><span class="c004">#</span> ListLabels.map succ [1;2;3];;
</span><span class="c006">- : int list = [2; 3; 4]
</span></pre><p>
But beware that functions like <span class="c007">ListLabels.fold_left</span> whose result
type is a type variable will never be considered as totally applied.
</p><pre><span class="c004">#</span><span class="c003"> ListLabels.fold_left <U>( + )</U> 0 [1;2;3];;
</span><span class="c006">Error: This expression has type int -&gt; int -&gt; int
       but an expression was expected of type 'a list
</span></pre><p>When a function is passed as an argument to a higher-order function,
labels must match in both types. Neither adding nor removing labels
are allowed.
</p><pre><span class="c004">#</span><span class="c003"> let h g = g ~x:3 ~y:2;;
<span class="c006">val h : (x:int -&gt; y:int -&gt; 'a) -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> h f;;
<span class="c006">- : int = 1

</span><span class="c004">#</span> h <U>( + )</U>;;
</span><span class="c006">Error: This expression has type int -&gt; int -&gt; int
       but an expression was expected of type x:int -&gt; y:int -&gt; 'a
</span></pre><p>
Note that when you don&#X2019;t need an argument, you can still use a wildcard
pattern, but you must prefix it with the label.
</p><pre><span class="c004">#<span class="c003"> h (fun ~x:_ ~y -&gt; y+1);;
<span class="c006">- : int = 3
</span></span></span></pre>
<!--TOC subsection id="sec43" Optional arguments-->
<h3 class="subsection" id="sec43">4.1.1&#XA0;&#XA0;Optional arguments</h3><!--SEC END --><p>An interesting feature of labeled arguments is that they can be made
optional. For optional parameters, the question mark <span class="c007">?</span> replaces the
tilde <span class="c007">~</span> of non-optional ones, and the label is also prefixed by <span class="c007">?</span>
in the function type.
Default values may be given for such optional parameters.</p><pre><span class="c004">#</span><span class="c003"> let bump ?(step = 1) x = x + step;;
<span class="c006">val bump : ?step:int -&gt; int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> bump 2;;
<span class="c006">- : int = 3

</span><span class="c004">#</span> bump ~step:3 2;;
</span><span class="c006">- : int = 5
</span></pre><p>A function taking some optional arguments must also take at least one
non-optional argument. The criterion for deciding whether an optional
argument has been omitted is the non-labeled application of an
argument appearing after this optional argument in the function type.
Note that if that argument is labeled, you will only be able to
eliminate optional arguments through the special case for total
applications.</p><pre><span class="c004">#</span><span class="c003"> let test ?(x = 0) ?(y = 0) () ?(z = 0) () = (x, y, z);;
<span class="c006">val test : ?x:int -&gt; ?y:int -&gt; unit -&gt; ?z:int -&gt; unit -&gt; int * int * int =
  &lt;fun&gt;

</span><span class="c004">#</span> test ();;
<span class="c006">- : ?z:int -&gt; unit -&gt; int * int * int = &lt;fun&gt;

</span><span class="c004">#</span> test ~x:2 () ~z:3 ();;
</span><span class="c006">- : int * int * int = (2, 0, 3)
</span></pre><p>Optional parameters may also commute with non-optional or unlabeled
ones, as long as they are applied simultaneously. By nature, optional
arguments do not commute with unlabeled arguments applied
independently.
</p><pre><span class="c004">#</span><span class="c003"> test ~y:2 ~x:3 () ();;
<span class="c006">- : int * int * int = (3, 2, 0)

</span><span class="c004">#</span> test () () ~z:1 ~y:2 ~x:3;;
<span class="c006">- : int * int * int = (3, 2, 1)

</span><span class="c004">#</span> <U>(test () ())</U> ~z:1;;
</span><span class="c006">Error: This expression has type int * int * int
       This is not a function; it cannot be applied.
</span></pre><p>
Here <span class="c007">(test () ())</span> is already <span class="c007">(0,0,0)</span> and cannot be further
applied.</p><p>Optional arguments are actually implemented as option types. If
you do not give a default value, you have access to their internal
representation, <span class="c007">type 'a option = None | Some of 'a</span>. You can then
provide different behaviors when an argument is present or not.</p><pre><span class="c004">#<span class="c003"> let bump ?step x =
    match step with
    | None -&gt; x * 2
    | Some y -&gt; x + y
  ;;
<span class="c006">val bump : ?step:int -&gt; int -&gt; int = &lt;fun&gt;
</span></span></span></pre><p>It may also be useful to relay an optional argument from a function
call to another. This can be done by prefixing the applied argument
with <span class="c007">?</span>. This question mark disables the wrapping of optional
argument in an option type.</p><pre><span class="c004">#</span><span class="c003"> let test2 ?x ?y () = test ?x ?y () ();;
<span class="c006">val test2 : ?x:int -&gt; ?y:int -&gt; unit -&gt; int * int * int = &lt;fun&gt;

</span><span class="c004">#</span> test2 ?x:None;;
</span><span class="c006">- : ?y:int -&gt; unit -&gt; int * int * int = &lt;fun&gt;
</span></pre>
<!--TOC subsection id="sec44" Labels and type inference-->
<h3 class="subsection" id="sec44">4.1.2&#XA0;&#XA0;Labels and type inference</h3><!--SEC END --><p>
<a id="ss:label-inference"></a></p><p>While they provide an increased comfort for writing function
applications, labels and optional arguments have the pitfall that they
cannot be inferred as completely as the rest of the language.</p><p>You can see it in the following two examples.
</p><pre><span class="c004">#</span><span class="c003"> let h' g = g ~y:2 ~x:3;;
<span class="c006">val h' : (y:int -&gt; x:int -&gt; 'a) -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> h' <U>f</U>;;
<span class="c006">Error: This expression has type x:int -&gt; y:int -&gt; int
       but an expression was expected of type y:int -&gt; x:int -&gt; 'a

</span><span class="c004">#</span> let bump_it bump x =
    bump ~step:2 x;;
<span class="c006">val bump_it : (step:int -&gt; 'a -&gt; 'b) -&gt; 'a -&gt; 'b = &lt;fun&gt;

</span><span class="c004">#</span> bump_it <U>bump</U> 1;;
</span><span class="c006">Error: This expression has type ?step:int -&gt; int -&gt; int
       but an expression was expected of type step:int -&gt; 'a -&gt; 'b
</span></pre><p>
The first case is simple: <span class="c007">g</span> is passed <span class="c007">~y</span> and then <span class="c007">~x</span>, but <span class="c007">f</span>
expects <span class="c007">~x</span> and then <span class="c007">~y</span>. This is correctly handled if we know the
type of <span class="c007">g</span> to be <span class="c007">x:int -&gt; y:int -&gt; int</span> in advance, but otherwise
this causes the above type clash. The simplest workaround is to apply
formal parameters in a standard order.</p><p>The second example is more subtle: while we intended the argument
<span class="c007">bump</span> to be of type <span class="c007">?step:int -&gt; int -&gt; int</span>, it is inferred as
<span class="c007">step:int -&gt; int -&gt; 'a</span>.
These two types being incompatible (internally normal and optional
arguments are different), a type error occurs when applying <span class="c007">bump_it</span>
to the real <span class="c007">bump</span>.</p><p>We will not try here to explain in detail how type inference works.
One must just understand that there is not enough information in the
above program to deduce the correct type of <span class="c007">g</span> or <span class="c007">bump</span>. That is,
there is no way to know whether an argument is optional or not, or
which is the correct order, by looking only at how a function is
applied. The strategy used by the compiler is to assume that there are
no optional arguments, and that applications are done in the right
order.</p><p>The right way to solve this problem for optional parameters is to add
a type annotation to the argument <span class="c007">bump</span>.
</p><pre><span class="c004">#</span><span class="c003"> let bump_it (bump : ?step:int -&gt; int -&gt; int) x =
    bump ~step:2 x;;
<span class="c006">val bump_it : (?step:int -&gt; int -&gt; int) -&gt; int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> bump_it bump 1;;
</span><span class="c006">- : int = 3
</span></pre><p>
In practice, such problems appear mostly when using objects whose
methods have optional arguments, so that writing the type of object
arguments is often a good idea.</p><p>Normally the compiler generates a type error if you attempt to pass to
a function a parameter whose type is different from the expected one.
However, in the specific case where the expected type is a non-labeled
function type, and the argument is a function expecting optional
parameters, the compiler will attempt to transform the argument to
have it match the expected type, by passing <span class="c007">None</span> for all optional
parameters.</p><pre><span class="c004">#</span><span class="c003"> let twice f (x : int) = f(f x);;
<span class="c006">val twice : (int -&gt; int) -&gt; int -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> twice bump 2;;
</span><span class="c006">- : int = 8
</span></pre><p>This transformation is coherent with the intended semantics,
including side-effects. That is, if the application of optional
parameters shall produce side-effects, these are delayed until the
received function is really applied to an argument.</p>
<!--TOC subsection id="sec45" Suggestions for labeling-->
<h3 class="subsection" id="sec45">4.1.3&#XA0;&#XA0;Suggestions for labeling</h3><!--SEC END --><p>Like for names, choosing labels for functions is not an easy task. A
good labeling is a labeling which</p><ul class="itemize"><li class="li-itemize">
makes programs more readable,
</li><li class="li-itemize">is easy to remember,
</li><li class="li-itemize">when possible, allows useful partial applications.
</li></ul><p>We explain here the rules we applied when labeling OCaml
libraries.</p><p>To speak in an &#X201C;object-oriented&#X201D; way, one can consider that each
function has a main argument, its <em>object</em>, and other arguments
related with its action, the <em>parameters</em>. To permit the
combination of functions through functionals in commuting label mode, the
object will not be labeled. Its role is clear from the function
itself. The parameters are labeled with names reminding of
their nature or their role. The best labels combine nature and
role. When this is not possible the role is to be preferred, since the
nature will
often be given by the type itself. Obscure abbreviations should be
avoided.
</p><pre>
<span class="c007">ListLabels.map : f:('a -&gt; 'b) -&gt; 'a list -&gt; 'b list</span>
UnixLabels.write : file_descr -&gt; buf:string -&gt; pos:int -&gt; len:int -&gt; unit
</pre><p>When there are several objects of same nature and role, they are all
left unlabeled.
</p><pre>
<span class="c007">ListLabels.iter2 : f:('a -&gt; 'b -&gt; 'c) -&gt; 'a list -&gt; 'b list -&gt; unit</span>
</pre><p>When there is no preferable object, all arguments are labeled.
</p><pre>
StringLabels.blit :
  src:string -&gt; src_pos:int -&gt; dst:string -&gt; dst_pos:int -&gt; len:int -&gt; unit
</pre><p>However, when there is only one argument, it is often left unlabeled.
</p><pre>
StringLabels.create : int -&gt; string
</pre><p>
This principle also applies to functions of several arguments whose
return type is a type variable, as long as the role of each argument
is not ambiguous. Labeling such functions may lead to awkward error
messages when one attempts to omit labels in an application, as we
have seen with <span class="c007">ListLabels.fold_left</span>.</p><p>Here are some of the label names you will find throughout the
libraries.</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Label</span></td><td class="c021"><span class="c019">Meaning</span> </td></tr>
<tr><td class="c023">
<span class="c007">f:</span></td><td class="c023">a function to be applied </td></tr>
<tr><td class="c023"><span class="c007">pos:</span></td><td class="c023">a position in a string or array </td></tr>
<tr><td class="c023"><span class="c007">len:</span></td><td class="c023">a length </td></tr>
<tr><td class="c023"><span class="c007">buf:</span></td><td class="c023">a string used as buffer </td></tr>
<tr><td class="c023"><span class="c007">src:</span></td><td class="c023">the source of an operation </td></tr>
<tr><td class="c023"><span class="c007">dst:</span></td><td class="c023">the destination of an operation </td></tr>
<tr><td class="c023"><span class="c007">init:</span></td><td class="c023">the initial value for an iterator </td></tr>
<tr><td class="c023"><span class="c007">cmp:</span></td><td class="c023">a comparison function, <span class="c013">e.g.</span> <span class="c007">Pervasives.compare</span> </td></tr>
<tr><td class="c023"><span class="c007">mode:</span></td><td class="c023">an operation mode or a flag list </td></tr>
</table></div><p>All these are only suggestions, but keep in mind that the
choice of labels is essential for readability. Bizarre choices will
make the program harder to maintain.</p><p>In the ideal, the right function name with right labels sould be
enough to understand the function&#X2019;s meaning. Since one can get this
information with OCamlBrowser or the <span class="c007">ocaml</span> toplevel, the documentation
is only used when a more detailed specification is needed.</p>
<!--TOC section id="sec46" Polymorphic variants-->
<h2 class="section" id="sec46">4.2&#XA0;&#XA0;Polymorphic variants</h2><!--SEC END --><p>Variants as presented in section&#XA0;<a href="#s%3Atut-recvariants">1.4</a> are a
powerful tool to build data structures and algorithms. However they
sometimes lack flexibility when used in modular programming. This is
due to the fact every constructor reserves a name to be used with a
unique type. One cannot use the same name in another type, or consider
a value of some type to belong to some other type with more
constructors.</p><p>With polymorphic variants, this original assumption is removed. That
is, a variant tag does not belong to any type in particular, the type
system will just check that it is an admissible value according to its
use. You need not define a type before using a variant tag. A variant
type will be inferred independently for each of its uses.</p><!--TOC subsection id="sec47" Basic use-->
<h3 class="subsection" id="sec47">Basic use</h3><!--SEC END --><p>In programs, polymorphic variants work like usual ones. You just have
to prefix their names with a backquote character <span class="c007">`</span>.
</p><pre><span class="c004">#</span><span class="c003"> [`On; `Off];;
<span class="c006">- : [&gt; `Off | `On ] list = [`On; `Off]

</span><span class="c004">#</span> `Number 1;;
<span class="c006">- : [&gt; `Number of int ] = `Number 1

</span><span class="c004">#</span> let f = function `On -&gt; 1 | `Off -&gt; 0 | `Number n -&gt; n;;
<span class="c006">val f : [&lt; `Number of int | `Off | `On ] -&gt; int = &lt;fun&gt;

</span><span class="c004">#</span> List.map f [`On; `Off];;
</span><span class="c006">- : int list = [1; 0]
</span></pre><p>
<span class="c007">[&gt;`Off|`On] list</span> means that to match this list, you should at
least be able to match <span class="c007">`Off</span> and <span class="c007">`On</span>, without argument.
<span class="c007">[&lt;`On|`Off|`Number of int]</span> means that <span class="c007">f</span> may be applied to <span class="c007">`Off</span>,
<span class="c007">`On</span> (both without argument), or <span class="c007">`Number</span> <span class="c013">n</span> where
<span class="c013">n</span> is an integer.
The <span class="c007">&gt;</span> and <span class="c007">&lt;</span> inside the variant types show that they may still be
refined, either by defining more tags or by allowing less. As such, they
contain an implicit type variable. Because each of the variant types
appears only once in the whole type, their implicit type variables are
not shown.</p><p>The above variant types were polymorphic, allowing further refinement.
When writing type annotations, one will most often describe fixed
variant types, that is types that cannot be refined. This is
also the case for type abbreviations. Such types do not contain <span class="c007">&lt;</span> or
<span class="c007">&gt;</span>, but just an enumeration of the tags and their associated types,
just like in a normal datatype definition.
</p><pre><span class="c004">#</span><span class="c003"> type 'a vlist = [`Nil | `Cons of 'a * 'a vlist];;
<span class="c006">type 'a vlist = [ `Cons of 'a * 'a vlist | `Nil ]

</span><span class="c004">#</span> let rec map f : 'a vlist -&gt; 'b vlist = function
    | `Nil -&gt; `Nil
    | `Cons(a, l) -&gt; `Cons(f a, map f l)
  ;;
</span><span class="c006">val map : ('a -&gt; 'b) -&gt; 'a vlist -&gt; 'b vlist = &lt;fun&gt;
</span></pre><!--TOC subsection id="sec48" Advanced use-->
<h3 class="subsection" id="sec48">Advanced use</h3><!--SEC END --><p>Type-checking polymorphic variants is a subtle thing, and some
expressions may result in more complex type information.</p><pre><span class="c004">#</span><span class="c003"> let f = function `A -&gt; `C | `B -&gt; `D | x -&gt; x;;
<span class="c006">val f : ([&gt; `A | `B | `C | `D ] as 'a) -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> f `E;;
</span><span class="c006">- : [&gt; `A | `B | `C | `D | `E ] = `E
</span></pre><p>
Here we are seeing two phenomena. First, since this matching is open
(the last case catches any tag), we obtain the type <span class="c007">[&gt; `A | `B]</span>
rather than <span class="c007">[&lt; `A | `B]</span> in a closed matching. Then, since <span class="c007">x</span> is
returned as is, input and return types are identical. The notation <span class="c007">as 'a</span> denotes such type sharing. If we apply <span class="c007">f</span> to yet another tag
<span class="c007">`E</span>, it gets added to the list.</p><pre><span class="c004">#</span><span class="c003"> let f1 = function `A x -&gt; x = 1 | `B -&gt; true | `C -&gt; false
  let f2 = function `A x -&gt; x = "a" | `B -&gt; true ;;
<span class="c006">val f1 : [&lt; `A of int | `B | `C ] -&gt; bool = &lt;fun&gt;
val f2 : [&lt; `A of string | `B ] -&gt; bool = &lt;fun&gt;

</span><span class="c004">#</span> let f x = f1 x &amp;&amp; f2 x;;
</span><span class="c006">val f : [&lt; `A of string &amp; int | `B ] -&gt; bool = &lt;fun&gt;
</span></pre><p>
Here <span class="c007">f1</span> and <span class="c007">f2</span> both accept the variant tags <span class="c007">`A</span> and <span class="c007">`B</span>, but the
argument of <span class="c007">`A</span> is <span class="c007">int</span> for <span class="c007">f1</span> and <span class="c007">string</span> for <span class="c007">f2</span>. In <span class="c007">f</span>&#X2019;s
type <span class="c007">`C</span>, only accepted by <span class="c007">f1</span>, disappears, but both argument types
appear for <span class="c007">`A</span> as <span class="c007">int &amp; string</span>. This means that if we
pass the variant tag <span class="c007">`A</span> to <span class="c007">f</span>, its argument should be <em>both</em>
<span class="c007">int</span> and <span class="c007">string</span>. Since there is no such value, <span class="c007">f</span> cannot be
applied to <span class="c007">`A</span>, and <span class="c007">`B</span> is the only accepted input.</p><p>Even if a value has a fixed variant type, one can still give it a
larger type through coercions. Coercions are normally written with
both the source type and the destination type, but in simple cases the
source type may be omitted.
</p><pre><span class="c004">#</span><span class="c003"> type 'a wlist = [`Nil | `Cons of 'a * 'a wlist | `Snoc of 'a wlist * 'a];;
<span class="c006">type 'a wlist = [ `Cons of 'a * 'a wlist | `Nil | `Snoc of 'a wlist * 'a ]

</span><span class="c004">#</span> let wlist_of_vlist  l = (l : 'a vlist :&gt; 'a wlist);;
<span class="c006">val wlist_of_vlist : 'a vlist -&gt; 'a wlist = &lt;fun&gt;

</span><span class="c004">#</span> let open_vlist l = (l : 'a vlist :&gt; [&gt; 'a vlist]);;
<span class="c006">val open_vlist : 'a vlist -&gt; [&gt; 'a vlist ] = &lt;fun&gt;

</span><span class="c004">#</span> fun x -&gt; (x :&gt; [`A|`B|`C]);;
</span><span class="c006">- : [&lt; `A | `B | `C ] -&gt; [ `A | `B | `C ] = &lt;fun&gt;
</span></pre><p>You may also selectively coerce values through pattern matching.
</p><pre><span class="c004">#<span class="c003"> let split_cases = function
    | `Nil | `Cons _ as x -&gt; `A x
    | `Snoc _ as x -&gt; `B x
  ;;
<span class="c006">val split_cases :
  [&lt; `Cons of 'a | `Nil | `Snoc of 'b ] -&gt;
  [&gt; `A of [&gt; `Cons of 'a | `Nil ] | `B of [&gt; `Snoc of 'b ] ] = &lt;fun&gt;
</span></span></span></pre><p>
When an or-pattern composed of variant tags is wrapped inside an
alias-pattern, the alias is given a type containing only the tags
enumerated in the or-pattern. This allows for many useful idioms, like
incremental definition of functions.</p><pre><span class="c004">#</span><span class="c003"> let num x = `Num x
  let eval1 eval (`Num x) = x
  let rec eval x = eval1 eval x ;;
<span class="c006">val num : 'a -&gt; [&gt; `Num of 'a ] = &lt;fun&gt;
val eval1 : 'a -&gt; [&lt; `Num of 'b ] -&gt; 'b = &lt;fun&gt;
val eval : [&lt; `Num of 'a ] -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> let plus x y = `Plus(x,y)
  let eval2 eval = function
    | `Plus(x,y) -&gt; eval x + eval y
    | `Num _ as x -&gt; eval1 eval x
  let rec eval x = eval2 eval x ;;
</span><span class="c006">val plus : 'a -&gt; 'b -&gt; [&gt; `Plus of 'a * 'b ] = &lt;fun&gt;
val eval2 : ('a -&gt; int) -&gt; [&lt; `Num of int | `Plus of 'a * 'a ] -&gt; int = &lt;fun&gt;
val eval : ([&lt; `Num of int | `Plus of 'a * 'a ] as 'a) -&gt; int = &lt;fun&gt;
</span></pre><p>To make this even more comfortable, you may use type definitions as
abbreviations for or-patterns. That is, if you have defined <span class="c007">type myvariant = [`Tag1 of int | `Tag2 of bool]</span>, then the pattern <span class="c007">#myvariant</span> is
equivalent to writing <span class="c007">(`Tag1(_ : int) | `Tag2(_ : bool))</span>.</p><p>Such abbreviations may be used alone,
</p><pre><span class="c004">#<span class="c003"> let f = function
    | #myvariant -&gt; "myvariant"
    | `Tag3 -&gt; "Tag3";;
<span class="c006">val f : [&lt; `Tag1 of int | `Tag2 of bool | `Tag3 ] -&gt; string = &lt;fun&gt;
</span></span></span></pre><p>
or combined with with aliases.
</p><pre><span class="c004">#</span><span class="c003"> let g1 = function `Tag1 _ -&gt; "Tag1" | `Tag2 _ -&gt; "Tag2";;
<span class="c006">val g1 : [&lt; `Tag1 of 'a | `Tag2 of 'b ] -&gt; string = &lt;fun&gt;

</span><span class="c004">#</span> let g = function
    | #myvariant as x -&gt; g1 x
    | `Tag3 -&gt; "Tag3";;
</span><span class="c006">val g : [&lt; `Tag1 of int | `Tag2 of bool | `Tag3 ] -&gt; string = &lt;fun&gt;
</span></pre>
<!--TOC subsection id="sec49" Weaknesses of polymorphic variants-->
<h3 class="subsection" id="sec49">4.2.1&#XA0;&#XA0;Weaknesses of polymorphic variants</h3><!--SEC END --><p>After seeing the power of polymorphic variants, one may wonder why
they were added to core language variants, rather than replacing them.</p><p>The answer is twofold. One first aspect is that while being pretty
efficient, the lack of static type information allows for less
optimizations, and makes polymorphic variants slightly heavier than
core language ones. However noticeable differences would only
appear on huge data structures.</p><p>More important is the fact that polymorphic variants, while being
type-safe, result in a weaker type discipline. That is, core language
variants do actually much more than ensuring type-safety, they also
check that you use only declared constructors, that all constructors
present in a data-structure are compatible, and they enforce typing
constraints to their parameters.</p><p>For this reason, you must be more careful about making types explicit
when you use polymorphic variants. When you write a library, this is
easy since you can describe exact types in interfaces, but for simple
programs you are probably better off with core language variants.</p><p>Beware also that some idioms make trivial errors very hard to find.
For instance, the following code is probably wrong but the compiler
has no way to see it.
</p><pre><span class="c004">#</span><span class="c003"> type abc = [`A | `B | `C] ;;
<span class="c006">type abc = [ `A | `B | `C ]

</span><span class="c004">#</span> let f = function
    | `As -&gt; "A"
    | #abc -&gt; "other" ;;
<span class="c006">val f : [&lt; `A | `As | `B | `C ] -&gt; string = &lt;fun&gt;

</span><span class="c004">#</span> let f : abc -&gt; string = f ;;
</span><span class="c006">val f : abc -&gt; string = &lt;fun&gt;
</span></pre><p>
You can avoid such risks by annotating the definition itself.
</p><pre><span class="c004">#</span><span class="c003"> let f : abc -&gt; string = function
    | <U>`As</U> -&gt; "A"
    | #abc -&gt; "other" ;;
</span><span class="c006">Error: This pattern matches values of type [? `As ]
       but a pattern was expected which matches values of type abc
       The second variant type does not allow tag(s) `As
</span></pre>
<!--BEGIN NOTES chapter-->
<hr class="ffootnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note1" href="#text1">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">This correspond to the commuting label mode
of Objective Caml 3.00 through 3.02, with some additional flexibility
on total applications. The so-called classic mode (<span class="c007">-nolabels</span>
options) is now deprecated for normal use.</div>
</dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec50" Advanced examples with classes and modules-->
<h1 class="chapter" id="sec50">Chapter&#XA0;5&#XA0;&#XA0;Advanced examples with classes and modules</h1><!--SEC END --><!--NAME advexamples.html-->
<p>
<a id="c:advexamples"></a></p><p><span class="c013">(Chapter written by Didier R&#XE9;my)</span></p><p><br>
<br>
</p><p>In this chapter, we show some larger examples using objects, classes
and modules. We review many of the object features simultaneously on
the example of a bank account. We show how modules taken from the
standard library can be expressed as classes. Lastly, we describe a
programming pattern know of as <em>virtual types</em> through the example
of window managers.</p>
<!--TOC section id="sec51" Extended example: bank accounts-->
<h2 class="section" id="sec51">5.1&#XA0;&#XA0;Extended example: bank accounts</h2><!--SEC END --><p>

<a id="ss:bank-accounts"></a></p><p>In this section, we illustrate most aspects of Object and inheritance
by refining, debugging, and specializing the following
initial naive definition of a simple bank account. (We reuse the
module <span class="c007">Euro</span> defined at the end of chapter&#XA0;<a href="#c%3Aobjectexamples">3</a>.)
</p><pre><span class="c004">#</span><span class="c003"> let euro = new Euro.c;;
<span class="c006">val euro : float -&gt; Euro.c = &lt;fun&gt;

</span><span class="c004">#</span> let zero = euro 0.;;
<span class="c006">val zero : Euro.c = &lt;obj&gt;

</span><span class="c004">#</span> let neg x = x#times (-1.);;
<span class="c006">val neg : &lt; times : float -&gt; 'a; .. &gt; -&gt; 'a = &lt;fun&gt;

</span><span class="c004">#</span> class account =
    object
      val mutable balance = zero
      method balance = balance
      method deposit x = balance &lt;- balance # plus x
      method withdraw x =
        if x#leq balance then (balance &lt;- balance # plus (neg x); x) else zero
    end;;
<span class="c006">class account :
  object
    val mutable balance : Euro.c
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method withdraw : Euro.c -&gt; Euro.c
  end

</span><span class="c004">#</span> let c = new account in c # deposit (euro 100.); c # withdraw (euro 50.);;
</span><span class="c006">- : Euro.c = &lt;obj&gt;
</span></pre><p>
We now refine this definition with a method to compute interest.
</p><pre><span class="c004">#<span class="c003"> class account_with_interests =
    object (self)
      inherit account
      method private interest = self # deposit (self # balance # times 0.03)
    end;;
<span class="c006">class account_with_interests :
  object
    val mutable balance : Euro.c
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method private interest : unit
    method withdraw : Euro.c -&gt; Euro.c
  end
</span></span></span></pre><p>
We make the method <span class="c007">interest</span> private, since clearly it should not be
called freely from the outside. Here, it is only made accessible to subclasses
that will manage monthly or yearly updates of the account.</p><p>We should soon fix a bug in the current definition: the deposit method can
be used for withdrawing money by depositing negative amounts. We can
fix this directly:
</p><pre><span class="c004">#<span class="c003"> class safe_account =
    object
      inherit account
      method deposit x = if zero#leq x then balance &lt;- balance#plus x
    end;;
<span class="c006">class safe_account :
  object
    val mutable balance : Euro.c
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method withdraw : Euro.c -&gt; Euro.c
  end
</span></span></span></pre><p>
However, the bug might be fixed more safely by the following definition:
</p><pre><span class="c004">#<span class="c003"> class safe_account =
    object
      inherit account as unsafe
      method deposit x =
        if zero#leq x then unsafe # deposit x
        else raise (Invalid_argument "deposit")
    end;;
<span class="c006">class safe_account :
  object
    val mutable balance : Euro.c
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method withdraw : Euro.c -&gt; Euro.c
  end
</span></span></span></pre><p>
In particular, this does not require the knowledge of the implementation of
the method <span class="c007">deposit</span>.</p><p>To keep track of operations, we extend the class with a mutable field
<span class="c007">history</span> and a private method <span class="c007">trace</span> to add an operation in the
log. Then each method to be traced is redefined.
</p><pre><span class="c004">#</span><span class="c003"> type 'a operation = Deposit of 'a | Retrieval of 'a;;
<span class="c006">type 'a operation = Deposit of 'a | Retrieval of 'a

</span><span class="c004">#</span> class account_with_history =
    object (self)
      inherit safe_account as super
      val mutable history = []
      method private trace x = history &lt;- x :: history
      method deposit x = self#trace (Deposit x);  super#deposit x
      method withdraw x = self#trace (Retrieval x); super#withdraw x
      method history = List.rev history
    end;;
</span><span class="c006">class account_with_history :
  object
    val mutable balance : Euro.c
    val mutable history : Euro.c operation list
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method history : Euro.c operation list
    method private trace : Euro.c operation -&gt; unit
    method withdraw : Euro.c -&gt; Euro.c
  end
</span></pre><p>
One may wish to open an account and simultaneously deposit some initial
amount. Although the initial implementation did not address this
requirement, it can be achieved by using an initializer.
</p><pre><span class="c004">#<span class="c003"> class account_with_deposit x =
    object
      inherit account_with_history
      initializer balance &lt;- x
    end;;
<span class="c006">class account_with_deposit :
  Euro.c -&gt;
  object
    val mutable balance : Euro.c
    val mutable history : Euro.c operation list
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method history : Euro.c operation list
    method private trace : Euro.c operation -&gt; unit
    method withdraw : Euro.c -&gt; Euro.c
  end
</span></span></span></pre><p>
A better alternative is:
</p><pre><span class="c004">#<span class="c003"> class account_with_deposit x =
    object (self)
      inherit account_with_history
      initializer self#deposit x
    end;;
<span class="c006">class account_with_deposit :
  Euro.c -&gt;
  object
    val mutable balance : Euro.c
    val mutable history : Euro.c operation list
    method balance : Euro.c
    method deposit : Euro.c -&gt; unit
    method history : Euro.c operation list
    method private trace : Euro.c operation -&gt; unit
    method withdraw : Euro.c -&gt; Euro.c
  end
</span></span></span></pre><p>
Indeed, the latter is safer since the call to <span class="c007">deposit</span> will automatically
benefit from safety checks and from the trace.
Let&#X2019;s test it:
</p><pre><span class="c004">#<span class="c003"> let ccp = new account_with_deposit (euro 100.) in
  let _balance = ccp#withdraw (euro 50.) in
  ccp#history;;
<span class="c006">- : Euro.c operation list = [Deposit &lt;obj&gt;; Retrieval &lt;obj&gt;]
</span></span></span></pre><p>
Closing an account can be done with the following polymorphic function:
</p><pre><span class="c004">#<span class="c003"> let close c = c#withdraw c#balance;;
<span class="c006">val close : &lt; balance : 'a; withdraw : 'a -&gt; 'b; .. &gt; -&gt; 'b = &lt;fun&gt;
</span></span></span></pre><p>
Of course, this applies to all sorts of accounts.</p><p>Finally, we gather several versions of the account into a module <span class="c007">Account</span>
abstracted over some currency.
</p><pre><span class="c004">#</span><span class="c003"> let today () = (01,01,2000) (* an approximation *)
  module Account (M:MONEY) =
    struct
      type m = M.c
      let m = new M.c
      let zero = m 0.

      class bank =
        object (self)
          val mutable balance = zero
          method balance = balance
          val mutable history = []
          method private trace x = history &lt;- x::history
          method deposit x =
            self#trace (Deposit x);
            if zero#leq x then balance &lt;- balance # plus x
            else raise (Invalid_argument "deposit")
          method withdraw x =
            if x#leq balance then
              (balance &lt;- balance # plus (neg x); self#trace (Retrieval x); x)
            else zero
          method history = List.rev history
        end

      class type client_view =
        object
          method deposit : m -&gt; unit
          method history : m operation list
          method withdraw : m -&gt; m
          method balance : m
        end

      class virtual check_client x =
        let y = if (m 100.)#leq x then x
        else raise (Failure "Insufficient initial deposit") in
        object (self) initializer <U>self#deposit</U> y end

      module Client (B : sig class bank : client_view end) =
        struct
          class account x : client_view =
            object
              inherit B.bank
              inherit check_client x
            end

          let discount x =
            let c = new account x in
            if today() &lt; (1998,10,30) then c # deposit (m 100.); c
        end
    end;;
</span></pre><p>
This shows the use of modules to group several class definitions that can in
fact be thought of as a single unit. This unit would be provided by a bank
for both internal and external uses.
This is implemented as a functor that abstracts over the currency so that
the same code can be used to provide accounts in different currencies.</p><p>The class <span class="c007">bank</span> is the <em>real</em> implementation of the bank account (it
could have been inlined). This is the one that will be used for further
extensions, refinements, etc. Conversely, the client will only be given the client view.
</p><pre><span class="c004">#<span class="c003"> module Euro_account = Account(Euro);;

  module Client = Euro_account.Client (Euro_account);;

  new Client.account (new Euro.c 100.);;
</span></span></pre><p>
Hence, the clients do not have direct access to the <span class="c007">balance</span>, nor the
<span class="c007">history</span> of their own accounts. Their only way to change their balance is
to deposit or withdraw money. It is important to give the clients
a class and not just the ability to create accounts (such as the
promotional <span class="c007">discount</span> account), so that they can
personalize their account.
For instance, a client may refine the <span class="c007">deposit</span> and <span class="c007">withdraw</span> methods
so as to do his own financial bookkeeping, automatically. On the
other hand, the function <span class="c007">discount</span> is given as such, with no
possibility for further personalization.</p><p>It is important to provide the client&#X2019;s view as a functor
<span class="c007">Client</span> so that client accounts can still be built after a possible
specialization of the <span class="c007">bank</span>.
The functor <span class="c007">Client</span> may remain unchanged and be passed
the new definition to initialize a client&#X2019;s view of the extended account.
</p><pre><span class="c004">#<span class="c003"> module Investment_account (M : MONEY) =
    struct
      type m = M.c
      module A = Account(M)

      class bank =
        object
          inherit A.bank as super
          method deposit x =
            if (new M.c 1000.)#leq x then
              print_string "Would you like to invest?";
            super#deposit x
        end

      module Client = A.Client
    end;;
</span></span></pre><p>
The functor <span class="c007">Client</span> may also be redefined when some new features of the
account can be given to the client.
</p><pre><span class="c004">#<span class="c003"> module Internet_account (M : MONEY) =
    struct
      type m = M.c
      module A = Account(M)

      class bank =
        object
          inherit A.bank
          method mail s = print_string s
        end

      class type client_view =
        object
          method deposit : m -&gt; unit
          method history : m operation list
          method withdraw : m -&gt; m
          method balance : m
          method mail : string -&gt; unit
        end

      module Client (B : sig class bank : client_view end) =
        struct
          class account x : client_view =
            object
              inherit B.bank
              inherit A.check_client x
            end
        end
    end;;
</span></span></pre>
<!--TOC section id="sec52" Simple modules as classes-->
<h2 class="section" id="sec52">5.2&#XA0;&#XA0;Simple modules as classes</h2><!--SEC END --><p>

<a id="ss:modules-as-classes"></a></p><p>One may wonder whether it is possible to treat primitive types such as
integers and strings as objects. Although this is usually uninteresting
for integers or strings, there may be some situations where
this is desirable. The class <span class="c007">money</span> above is such an example.
We show here how to do it for strings.</p>
<!--TOC subsection id="sec53" Strings-->
<h3 class="subsection" id="sec53">5.2.1&#XA0;&#XA0;Strings</h3><!--SEC END --><p>
<a id="module:string"></a></p><p>A naive definition of strings as objects could be:
</p><pre><span class="c004">#<span class="c003"> class ostring s =
    object
       method get n = String.get s n
       method set n c = String.set s n c
       method print = print_string s
       method copy = new ostring (String.copy s)
    end;;
<span class="c006">class ostring :
  string -&gt;
  object
    method copy : ostring
    method get : int -&gt; char
    method print : unit
    method set : int -&gt; char -&gt; unit
  end
</span></span></span></pre><p>
However, the method <span class="c007">copy</span> returns an object of the class <span class="c007">ostring</span>,
and not an objet of the current class. Hence, if the class is further
extended, the method <span class="c007">copy</span> will only return an object of the parent
class.
</p><pre><span class="c004">#<span class="c003"> class sub_string s =
    object
       inherit ostring s
       method sub start len = new sub_string (String.sub s  start len)
    end;;
<span class="c006">class sub_string :
  string -&gt;
  object
    method copy : ostring
    method get : int -&gt; char
    method print : unit
    method set : int -&gt; char -&gt; unit
    method sub : int -&gt; int -&gt; sub_string
  end
</span></span></span></pre><p>
As seen in section <a href="#ss%3Abinary-methods">3.16</a>, the solution is to use
functional update instead. We need to create an instance variable
containing the representation <span class="c007">s</span> of the string.
</p><pre><span class="c004">#<span class="c003"> class better_string s =
    object
       val repr = s
       method get n = String.get repr n
       method set n c = String.set repr n c
       method print = print_string repr
       method copy = {&lt; repr = String.copy repr &gt;}
       method sub start len = {&lt; repr = String.sub s  start len &gt;}
    end;;
<span class="c006">class better_string :
  string -&gt;
  object ('a)
    val repr : string
    method copy : 'a
    method get : int -&gt; char
    method print : unit
    method set : int -&gt; char -&gt; unit
    method sub : int -&gt; int -&gt; 'a
  end
</span></span></span></pre><p>
As shown in the inferred type, the methods <span class="c007">copy</span> and <span class="c007">sub</span> now return
objects of the same type as the one of the class.</p><p>Another difficulty is the implementation of the method <span class="c007">concat</span>.
In order to concatenate a string with another string of the same class,
one must be able to access the instance variable externally. Thus, a method
<span class="c007">repr</span> returning s must be defined. Here is the correct definition of
strings:
</p><pre><span class="c004">#<span class="c003"> class ostring s =
    object (self : 'mytype)
       val repr = s
       method repr = repr
       method get n = String.get repr n
       method set n c = String.set repr n c
       method print = print_string repr
       method copy = {&lt; repr = String.copy repr &gt;}
       method sub start len = {&lt; repr = String.sub s start len &gt;}
       method concat (t : 'mytype) = {&lt; repr = repr ^ t#repr &gt;}
    end;;
<span class="c006">class ostring :
  string -&gt;
  object ('a)
    val repr : string
    method concat : 'a -&gt; 'a
    method copy : 'a
    method get : int -&gt; char
    method print : unit
    method repr : string
    method set : int -&gt; char -&gt; unit
    method sub : int -&gt; int -&gt; 'a
  end
</span></span></span></pre><p>
Another constructor of the class string can be defined to return an
uninitialized string of a given length:
</p><pre><span class="c004">#<span class="c003"> class cstring n = ostring (String.create n);;
<span class="c006">class cstring : int -&gt; ostring
</span></span></span></pre><p>
Here, exposing the representation of strings is probably harmless. We do
could also hide the representation of strings as we hid the currency in the
class <span class="c007">money</span> of section&#XA0;<a href="#ss%3Afriends">3.17</a>.</p>
<!--TOC subsubsection id="sec54" Stacks-->
<h4 class="subsubsection" id="sec54">Stacks</h4><!--SEC END --><p>
<a id="module:stack"></a></p><p>There is sometimes an alternative between using modules or classes for
parametric data types.
Indeed, there are situations when the two approaches are quite similar.
For instance, a stack can be straightforwardly implemented as a class:
</p><pre><span class="c004">#</span><span class="c003"> exception Empty;;
<span class="c006">exception Empty

</span><span class="c004">#</span> class ['a] stack =
    object
      val mutable l = ([] : 'a list)
      method push x = l &lt;- x::l
      method pop = match l with [] -&gt; raise Empty | a::l' -&gt; l &lt;- l'; a
      method clear = l &lt;- []
      method length = List.length l
    end;;
</span><span class="c006">class ['a] stack :
  object
    val mutable l : 'a list
    method clear : unit
    method length : int
    method pop : 'a
    method push : 'a -&gt; unit
  end
</span></pre><p>
However, writing a method for iterating over a stack is more
problematic. A method <span class="c007">fold</span> would have type
<span class="c007">('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b</span>. Here <span class="c007">'a</span> is the parameter of the stack.
The parameter <span class="c007">'b</span> is not related to the class <span class="c007">'a stack</span> but to the
argument that will be passed to the method <span class="c007">fold</span>.
A naive approach is to make <span class="c007">'b</span> an extra parameter of class <span class="c007">stack</span>:
</p><pre><span class="c004">#<span class="c003"> class ['a, 'b] stack2 =
    object
      inherit ['a] stack
      method fold f (x : 'b) = List.fold_left f x l
    end;;
<span class="c006">class ['a, 'b] stack2 :
  object
    val mutable l : 'a list
    method clear : unit
    method fold : ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b
    method length : int
    method pop : 'a
    method push : 'a -&gt; unit
  end
</span></span></span></pre><p>
However, the method <span class="c007">fold</span> of a given object can only be
applied to functions that all have the same type:
</p><pre><span class="c004">#</span><span class="c003"> let s = new stack2;;
<span class="c006">val s : ('_a, '_b) stack2 = &lt;obj&gt;

</span><span class="c004">#</span> s#fold ( + ) 0;;
<span class="c006">- : int = 0

</span><span class="c004">#</span> s;;
</span><span class="c006">- : (int, int) stack2 = &lt;obj&gt;
</span></pre><p>
A better solution is to use polymorphic methods, which were
introduced in OCaml version 3.05. Polymorphic methods makes
it possible to treat the type variable <span class="c007">'b</span> in the type of <span class="c007">fold</span> as
universally quantified, giving <span class="c007">fold</span> the polymorphic type
<span class="c007">Forall 'b. ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b</span>.
An explicit type declaration on the method <span class="c007">fold</span> is required, since
the type checker cannot infer the polymorphic type by itself.
</p><pre><span class="c004">#<span class="c003"> class ['a] stack3 =
    object
      inherit ['a] stack
      method fold : 'b. ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b
                  = fun f x -&gt; List.fold_left f x l
    end;;
<span class="c006">class ['a] stack3 :
  object
    val mutable l : 'a list
    method clear : unit
    method fold : ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b
    method length : int
    method pop : 'a
    method push : 'a -&gt; unit
  end
</span></span></span></pre>
<!--TOC subsection id="sec55" Hashtbl-->
<h3 class="subsection" id="sec55">5.2.2&#XA0;&#XA0;Hashtbl</h3><!--SEC END --><p>
<a id="module:hashtbl"></a></p><p>A simplified version of object-oriented hash tables should have the
following class type.
</p><pre><span class="c004">#<span class="c003"> class type ['a, 'b] hash_table =
    object
      method find : 'a -&gt; 'b
      method add : 'a -&gt; 'b -&gt; unit
    end;;
<span class="c006">class type ['a, 'b] hash_table =
  object method add : 'a -&gt; 'b -&gt; unit method find : 'a -&gt; 'b end
</span></span></span></pre><p>
A simple implementation, which is quite reasonable for small hastables is
to use an association list:
</p><pre><span class="c004">#<span class="c003"> class ['a, 'b] small_hashtbl : ['a, 'b] hash_table =
    object
      val mutable table = []
      method find key = List.assoc key table
      method add key valeur = table &lt;- (key, valeur) :: table
    end;;
<span class="c006">class ['a, 'b] small_hashtbl : ['a, 'b] hash_table
</span></span></span></pre><p>
A better implementation, and one that scales up better, is to use a
true hash tables&#X2026; whose elements are small hash tables!
</p><pre><span class="c004">#<span class="c003"> class ['a, 'b] hashtbl size : ['a, 'b] hash_table =
    object (self)
      val table = Array.init size (fun i -&gt; new small_hashtbl)
      method private hash key =
        (Hashtbl.hash key) mod (Array.length table)
      method find key = table.(self#hash key) # find key
      method add key = table.(self#hash key) # add key
    end;;
<span class="c006">class ['a, 'b] hashtbl : int -&gt; ['a, 'b] hash_table
</span></span></span></pre>
<!--TOC subsection id="sec56" Sets-->
<h3 class="subsection" id="sec56">5.2.3&#XA0;&#XA0;Sets</h3><!--SEC END --><p>
<a id="module:set"></a></p><p>Implementing sets leads to another difficulty. Indeed, the method
<span class="c007">union</span> needs to be able to access the internal representation of
another object of the same class.</p><p>This is another instance of friend functions as seen in section
<a href="#ss%3Afriends">3.17</a>. Indeed, this is the same mechanism used in the module
<span class="c007">Set</span> in the absence of objects.</p><p>In the object-oriented version of sets, we only need to add an additional
method <span class="c007">tag</span> to return the representation of a set. Since sets are
parametric in the type of elements, the method <span class="c007">tag</span> has a parametric type
<span class="c007">'a tag</span>, concrete within
the module definition but abstract in its signature.
From outside, it will then be guaranteed that two objects with a method <span class="c007">tag</span>
of the same type will share the same representation.
</p><pre><span class="c004">#<span class="c003"> module type SET =
    sig
      type 'a tag
      class ['a] c :
        object ('b)
          method is_empty : bool
          method mem : 'a -&gt; bool
          method add : 'a -&gt; 'b
          method union : 'b -&gt; 'b
          method iter : ('a -&gt; unit) -&gt; unit
          method tag : 'a tag
        end
    end;;

  module Set : SET =
    struct
      let rec merge l1 l2 =
        match l1 with
          [] -&gt; l2
        | h1 :: t1 -&gt;
            match l2 with
              [] -&gt; l1
            | h2 :: t2 -&gt;
                if h1 &lt; h2 then h1 :: merge t1 l2
                else if h1 &gt; h2 then h2 :: merge l1 t2
                else merge t1 l2
      type 'a tag = 'a list
      class ['a] c =
        object (_ : 'b)
          val repr = ([] : 'a list)
          method is_empty = (repr = [])
          method mem x = List.exists (( = ) x) repr
          method add x = {&lt; repr = merge [x] repr &gt;}
          method union (s : 'b) = {&lt; repr = merge repr s#tag &gt;}
          method iter (f : 'a -&gt; unit) = List.iter f repr
          method tag = repr
        end
    end;;
</span></span></pre>
<!--TOC section id="sec57" The subject/observer pattern-->
<h2 class="section" id="sec57">5.3&#XA0;&#XA0;The subject/observer pattern</h2><!--SEC END --><p>

<a id="ss:subject-observer"></a></p><p>The following example, known as the subject/observer pattern, is often
presented in the literature as a difficult inheritance problem with
inter-connected classes.
The general pattern amounts to the definition a pair of two
classes that recursively interact with one another.</p><p>The class <span class="c007">observer</span> has a distinguished method <span class="c007">notify</span> that requires
two arguments, a subject and an event to execute an action.
</p><pre><span class="c004">#<span class="c003"> class virtual ['subject, 'event] observer =
    object
      method virtual notify : 'subject -&gt;  'event -&gt; unit
    end;;
<span class="c006">class virtual ['subject, 'event] observer :
  object method virtual notify : 'subject -&gt; 'event -&gt; unit end
</span></span></span></pre><p>
The class <span class="c007">subject</span> remembers a list of observers in an instance variable,
and has a distinguished method <span class="c007">notify_observers</span> to broadcast the message
<span class="c007">notify</span> to all observers with a particular event <span class="c007">e</span>.
</p><pre><span class="c004">#<span class="c003"> class ['observer, 'event] subject =
    object (self)
      val mutable observers = ([]:'observer list)
      method add_observer obs = observers &lt;- (obs :: observers)
      method notify_observers (e : 'event) =
          List.iter (fun x -&gt; x#notify self e) observers
    end;;
<span class="c006">class ['a, 'event] subject :
  object ('b)
    constraint 'a = &lt; notify : 'b -&gt; 'event -&gt; unit; .. &gt;
    val mutable observers : 'a list
    method add_observer : 'a -&gt; unit
    method notify_observers : 'event -&gt; unit
  end
</span></span></span></pre><p>
The difficulty usually lies in defining instances of the pattern above
by inheritance. This can be done in a natural and obvious manner in
OCaml, as shown on the following example manipulating windows.
</p><pre><span class="c004">#</span><span class="c003"> type event = Raise | Resize | Move;;
<span class="c006">type event = Raise | Resize | Move

</span><span class="c004">#</span> let string_of_event = function
      Raise -&gt; "Raise" | Resize -&gt; "Resize" | Move -&gt; "Move";;
<span class="c006">val string_of_event : event -&gt; string = &lt;fun&gt;

</span><span class="c004">#</span> let count = ref 0;;
<span class="c006">val count : int ref = {contents = 0}

</span><span class="c004">#</span> class ['observer] window_subject =
    let id = count := succ !count; !count in
    object (self)
      inherit ['observer, event] subject
      val mutable position = 0
      method identity = id
      method move x = position &lt;- position + x; self#notify_observers Move
      method draw = Printf.printf "{Position = %d}\n"  position;
    end;;
<span class="c006">class ['a] window_subject :
  object ('b)
    constraint 'a = &lt; notify : 'b -&gt; event -&gt; unit; .. &gt;
    val mutable observers : 'a list
    val mutable position : int
    method add_observer : 'a -&gt; unit
    method draw : unit
    method identity : int
    method move : int -&gt; unit
    method notify_observers : event -&gt; unit
  end

</span><span class="c004">#</span> class ['subject] window_observer =
    object
      inherit ['subject, event] observer
      method notify s e = s#draw
    end;;
</span><span class="c006">class ['a] window_observer :
  object
    constraint 'a = &lt; draw : unit; .. &gt;
    method notify : 'a -&gt; event -&gt; unit
  end
</span></pre><p>
As can be expected, the type of <span class="c007">window</span> is recursive.
</p><pre><span class="c004">#<span class="c003"> let window = new window_subject;;
<span class="c006">val window : &lt; notify : 'a -&gt; event -&gt; unit; _.. &gt; window_subject as 'a =
  &lt;obj&gt;
</span></span></span></pre><p>
However, the two classes of <span class="c007">window_subject</span> and <span class="c007">window_observer</span> are not
mutually recursive.
</p><pre><span class="c004">#</span><span class="c003"> let window_observer = new window_observer;;
<span class="c006">val window_observer : &lt; draw : unit; _.. &gt; window_observer = &lt;obj&gt;

</span><span class="c004">#</span> window#add_observer window_observer;;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> window#move 1;;
</span><span class="c006">{Position = 1}
- : unit = ()
</span></pre><p>Classes <span class="c007">window_observer</span> and <span class="c007">window_subject</span> can still be extended by
inheritance. For instance, one may enrich the <span class="c007">subject</span> with new
behaviors and refine the behavior of the observer.
</p><pre><span class="c004">#</span><span class="c003"> class ['observer] richer_window_subject =
    object (self)
      inherit ['observer] window_subject
      val mutable size = 1
      method resize x = size &lt;- size + x; self#notify_observers Resize
      val mutable top = false
      method raise = top &lt;- true; self#notify_observers Raise
      method draw = Printf.printf "{Position = %d; Size = %d}\n"  position size;
    end;;
<span class="c006">class ['a] richer_window_subject :
  object ('b)
    constraint 'a = &lt; notify : 'b -&gt; event -&gt; unit; .. &gt;
    val mutable observers : 'a list
    val mutable position : int
    val mutable size : int
    val mutable top : bool
    method add_observer : 'a -&gt; unit
    method draw : unit
    method identity : int
    method move : int -&gt; unit
    method notify_observers : event -&gt; unit
    method raise : unit
    method resize : int -&gt; unit
  end

</span><span class="c004">#</span> class ['subject] richer_window_observer =
    object
      inherit ['subject] window_observer as super
      method notify s e = if e &lt;&gt; Raise then s#raise; super#notify s e
    end;;
</span><span class="c006">class ['a] richer_window_observer :
  object
    constraint 'a = &lt; draw : unit; raise : unit; .. &gt;
    method notify : 'a -&gt; event -&gt; unit
  end
</span></pre><p>
We can also create a different kind of observer:
</p><pre><span class="c004">#<span class="c003"> class ['subject] trace_observer =
    object
      inherit ['subject, event] observer
      method notify s e =
        Printf.printf
          "&lt;Window %d &lt;== %s&gt;\n" s#identity (string_of_event e)
    end;;
<span class="c006">class ['a] trace_observer :
  object
    constraint 'a = &lt; identity : int; .. &gt;
    method notify : 'a -&gt; event -&gt; unit
  end
</span></span></span></pre><p>
and attach several observers to the same object:
</p><pre><span class="c004">#</span><span class="c003"> let window = new richer_window_subject;;
<span class="c006">val window :
  &lt; notify : 'a -&gt; event -&gt; unit; _.. &gt; richer_window_subject as 'a = &lt;obj&gt;

</span><span class="c004">#</span> window#add_observer (new richer_window_observer);;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> window#add_observer (new trace_observer);;
<span class="c006">- : unit = ()

</span><span class="c004">#</span> window#move 1; window#resize 2;;
</span><span class="c006">&lt;Window 1 &lt;== Move&gt;
&lt;Window 1 &lt;== Raise&gt;
{Position = 1; Size = 1}
{Position = 1; Size = 1}
&lt;Window 1 &lt;== Resize&gt;
&lt;Window 1 &lt;== Raise&gt;
{Position = 1; Size = 3}
{Position = 1; Size = 3}
- : unit = ()
</span></pre>
<!--TOC part id="sec58" The OCaml language-->
<table class="center"><tr><td><h1 class="part" id="sec58">Part&#XA0;II<br>
The OCaml language</h1></td></tr>
</table><!--SEC END --><p>
<a id="p:refman"></a>
</p>
<!--TOC chapter id="sec59" The OCaml language-->
<h1 class="chapter" id="sec59">Chapter&#XA0;6&#XA0;&#XA0;The OCaml language</h1><!--SEC END --><p> <a id="c:refman"></a>

</p><!--NAME language.html-->
<!--TOC subsection id="sec60" Foreword-->
<h3 class="subsection" id="sec60">Foreword</h3><!--SEC END --><p>This document is intended as a reference manual for the OCaml
language. It lists the language constructs, and gives their precise
syntax and informal semantics. It is by no means a tutorial
introduction to the language: there is not a single example. A good
working knowledge of OCaml is assumed.</p><p>No attempt has been made at mathematical rigor: words are employed
with their intuitive meaning, without further definition. As a
consequence, the typing rules have been left out, by lack of the
mathematical framework required to express them, while they are
definitely part of a full formal definition of the language.</p><!--TOC subsection id="sec61" Notations-->
<h3 class="subsection" id="sec61">Notations</h3><!--SEC END --><p>The syntax of the language is given in BNF-like notation. Terminal
symbols are set in typewriter font (<span class="c005"><span class="c007">like</span> <span class="c007">this</span></span>).
Non-terminal symbols are set in italic font (<span class="c014">like</span> &#XA0;<span class="c014">that</span>).
Square brackets [&#X2026;] denote optional components. Curly brackets
{&#X2026;} denotes zero, one or several repetitions of the enclosed
components. Curly brackets with a trailing plus sign {&#X2026;}<sup>+</sup>
denote one or several repetitions of the enclosed components.
Parentheses (&#X2026;) denote grouping.</p><!--CUT DEF section  -->
<!--TOC section id="sec62" Lexical conventions-->
<h2 class="section" id="sec62">6.1&#XA0;&#XA0;Lexical conventions</h2><!--SEC END --><!--NAME lex.html-->
<!--TOC subsubsection id="sec63" Blanks-->
<h4 class="subsubsection" id="sec63">Blanks</h4><!--SEC END --><p>The following characters are considered as blanks: space,
horizontal tabulation, carriage return, line feed and form feed. Blanks are
ignored, but they separate adjacent identifiers, literals and
keywords that would otherwise be confused as one single identifier,
literal or keyword.</p><!--TOC subsubsection id="sec64" Comments-->
<h4 class="subsubsection" id="sec64">Comments</h4><!--SEC END --><p>Comments are introduced by the two characters <span class="c008">(*</span>, with no
intervening blanks, and terminated by the characters <span class="c008">*)</span>, with
no intervening blanks. Comments are treated as blank characters.
Comments do not occur inside string or character literals. Nested
comments are handled correctly.</p><!--TOC subsubsection id="sec65" Identifiers-->
<h4 class="subsubsection" id="sec65">Identifiers</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="ident"><span class="c014">ident</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;(&#XA0;<a class="syntax" href="#letter"><span class="c014">letter</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">_</span>&#XA0;)&#XA0;{&#XA0;<a class="syntax" href="#letter"><span class="c014">letter</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">0</span>&#XA0;&#X2026;&#XA0;<span class="c008">9</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">_</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">'</span>&#XA0;}&#XA0;&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="capitalized-ident"><span class="c014">capitalized-ident</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;(<span class="c008">A</span>&#XA0;&#X2026;&#XA0;<span class="c008">Z</span>)&#XA0;{&#XA0;<a class="syntax" href="#letter"><span class="c014">letter</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">0</span>&#XA0;&#X2026;&#XA0;<span class="c008">9</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">_</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">'</span>&#XA0;}&#XA0;&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="lowercase-ident"><span class="c014">lowercase-ident</span></a></td><td class="c022">::=</td><td class="c024">
(<span class="c008">a</span>&#XA0;&#X2026;&#XA0;<span class="c008">z</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">_</span>)&#XA0;{&#XA0;<a class="syntax" href="#letter"><span class="c014">letter</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">0</span>&#XA0;&#X2026;&#XA0;<span class="c008">9</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">_</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">'</span>&#XA0;}&#XA0;&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="letter"><span class="c014">letter</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<span class="c008">A</span>&#XA0;&#X2026;&#XA0;<span class="c008">Z</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">a</span>&#XA0;&#X2026;&#XA0;<span class="c008">z</span>
</td></tr>
</table></td></tr>
</table><p>Identifiers are sequences of letters, digits, <span class="c007">_</span> (the underscore
character), and <span class="c007">'</span> (the single quote), starting with a
letter or an underscore.
Letters contain at least the 52 lowercase and uppercase
letters from the ASCII set. The current implementation
also recognizes as letters some characters from the ISO
8859-1 set (characters 192&#X2013;214 and 216&#X2013;222 as uppercase letters;
characters 223&#X2013;246 and 248&#X2013;255 as lowercase letters). This
feature is deprecated and should be avoided for future compatibility.</p><p>All characters in an identifier are
meaningful. The current implementation accepts identifiers up to
16000000 characters in length.</p><p>In many places, OCaml makes a distinction between capitalized
identifiers and identifiers that begin with a lowercase letter. The
underscore character is considered a lowercase letter for this
purpose.</p><!--TOC subsubsection id="sec66" Integer literals-->
<h4 class="subsubsection" id="sec66">Integer literals</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="integer-literal"><span class="c014">integer-literal</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">-</span>]&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>)&#XA0;{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">_</span>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;[<span class="c008">-</span>]&#XA0;(<span class="c008">0x</span>&#X2223;&#XA0;<span class="c008">0X</span>)&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">A</span>&#X2026;<span class="c008">F</span>&#X2223;&#XA0;<span class="c008">a</span>&#X2026;<span class="c008">f</span>)
{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">A</span>&#X2026;<span class="c008">F</span>&#X2223;&#XA0;<span class="c008">a</span>&#X2026;<span class="c008">f</span>&#X2223;&#XA0;<span class="c008">_</span>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;[<span class="c008">-</span>]&#XA0;(<span class="c008">0o</span>&#X2223;&#XA0;<span class="c008">0O</span>)&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">7</span>)&#XA0;{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">7</span>&#X2223;&#XA0;<span class="c008">_</span>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;[<span class="c008">-</span>]&#XA0;(<span class="c008">0b</span>&#X2223;&#XA0;<span class="c008">0B</span>)&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">1</span>)&#XA0;{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">1</span>&#X2223;&#XA0;<span class="c008">_</span>&#XA0;}
</td></tr>
</table></td></tr>
</table><p>An integer literal is a sequence of one or more digits, optionally
preceded by a minus sign. By default, integer literals are in decimal
(radix 10). The following prefixes select a different radix:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Prefix</span></td><td class="c021"><span class="c019">Radix</span> </td></tr>
<tr><td class="c023">
<span class="c007">0x</span>, <span class="c007">0X</span></td><td class="c023">hexadecimal (radix 16) </td></tr>
<tr><td class="c023"><span class="c007">0o</span>, <span class="c007">0O</span></td><td class="c023">octal (radix 8) </td></tr>
<tr><td class="c023"><span class="c007">0b</span>, <span class="c007">0B</span></td><td class="c023">binary (radix 2) </td></tr>
</table></div><p>
(The initial <span class="c008">0</span> is the digit zero; the <span class="c008">O</span> for octal is the letter O.)
The interpretation of integer literals that fall outside the range of
representable integer values is undefined.</p><p>For convenience and readability, underscore characters (<span class="c008">_</span>) are accepted
(and ignored) within integer literals.</p><!--TOC subsubsection id="sec67" Floating-point literals-->
<h4 class="subsubsection" id="sec67">Floating-point literals</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="float-literal"><span class="c014">float-literal</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">-</span>]&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>)&#XA0;{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">_</span>&#XA0;}&#XA0;[<span class="c008">.</span>&#XA0;{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">_</span>&#XA0;}]
[(<span class="c008">e</span>&#X2223;&#XA0;<span class="c008">E</span>)&#XA0;[<span class="c008">+</span>&#X2223;&#XA0;<span class="c008">-</span>]&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>)&#XA0;{&#XA0;<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">_</span>&#XA0;}]
</td></tr>
</table></td></tr>
</table><p>Floating-point decimals consist in an integer part, a decimal part and
an exponent part. The integer part is a sequence of one or more
digits, optionally preceded by a minus sign. The decimal part is a
decimal point followed by zero, one or more digits.
The exponent part is the character <span class="c008">e</span> or <span class="c008">E</span> followed by an
optional <span class="c008">+</span> or <span class="c008">-</span> sign, followed by one or more digits.
The decimal part or the exponent part can be omitted but not both, to
avoid ambiguity with integer literals.
The interpretation of floating-point literals that fall outside the
range of representable floating-point values is undefined.</p><p>For convenience and readability, underscore characters (<span class="c008">_</span>) are accepted
(and ignored) within floating-point literals.</p><!--TOC subsubsection id="s:characterliteral" Character literals-->
<h4 class="subsubsection" id="s:characterliteral">Character literals</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="char-literal"><span class="c014">char-literal</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">'</span>&#XA0;<span class="c014">regular-char</span>&#XA0;<span class="c008">'</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">'</span>&#XA0;<a class="syntax" href="#escape-sequence"><span class="c014">escape-sequence</span></a>&#XA0;<span class="c008">'</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="escape-sequence"><span class="c014">escape-sequence</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">\</span>&#XA0;(&#XA0;<span class="c008">\</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">"</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">'</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">n</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">t</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">b</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">r</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c014">space</span>&#XA0;)
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">\</span>&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>)&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>)&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>)
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">\x</span>&#XA0;(<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">A</span>&#X2026;<span class="c008">F</span>&#X2223;&#XA0;<span class="c008">a</span>&#X2026;<span class="c008">f</span>)
(<span class="c008">0</span>&#X2026;<span class="c008">9</span>&#X2223;&#XA0;<span class="c008">A</span>&#X2026;<span class="c008">F</span>&#X2223;&#XA0;<span class="c008">a</span>&#X2026;<span class="c008">f</span>)
</td></tr>
</table></td></tr>
</table><p>Character literals are delimited by <span class="c008">'</span> (single quote) characters.
The two single quotes enclose either one character different from
<span class="c008">'</span> and <span class="c008">\</span>, or one of the escape sequences below:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Sequence</span></td><td class="c021"><span class="c019">Character denoted</span> </td></tr>
<tr><td class="c023">
<span class="c007">\\</span></td><td class="c023">backslash (<span class="c007">\</span>) </td></tr>
<tr><td class="c023"><span class="c007">\"</span></td><td class="c023">double quote (<span class="c007">"</span>) </td></tr>
<tr><td class="c023"><span class="c007">\'</span></td><td class="c023">single quote (<span class="c007">'</span>) </td></tr>
<tr><td class="c023"><span class="c007">\n</span></td><td class="c023">linefeed (LF) </td></tr>
<tr><td class="c023"><span class="c007">\r</span></td><td class="c023">carriage return (CR) </td></tr>
<tr><td class="c023"><span class="c007">\t</span></td><td class="c023">horizontal tabulation (TAB) </td></tr>
<tr><td class="c023"><span class="c007">\b</span></td><td class="c023">backspace (BS) </td></tr>
<tr><td class="c023"><span class="c007">\</span><span class="c013">space</span></td><td class="c023">space (SPC) </td></tr>
<tr><td class="c023"><span class="c007">\</span><span class="c013">ddd</span></td><td class="c023">the character with ASCII code <span class="c013">ddd</span> in decimal </td></tr>
<tr><td class="c023"><span class="c007">\x</span><span class="c013">hh</span></td><td class="c023">the character with ASCII code <span class="c013">hh</span> in hexadecimal </td></tr>
</table></div><!--TOC subsubsection id="s:stringliteral" String literals-->
<h4 class="subsubsection" id="s:stringliteral">String literals</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="string-literal"><span class="c014">string-literal</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">"</span>&#XA0;{&#XA0;<a class="syntax" href="#string-character"><span class="c014">string-character</span></a>&#XA0;}&#XA0;<span class="c008">"</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="string-character"><span class="c014">string-character</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c014">regular-string-char</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#escape-sequence"><span class="c014">escape-sequence</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">\</span>&#XA0;<span class="c014">newline</span>&#XA0;&#XA0;{&#XA0;<span class="c014">space</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c014">tab</span>&#XA0;}
</td></tr>
</table></td></tr>
</table><p>String literals are delimited by <span class="c008">"</span> (double quote) characters.
The two double quotes enclose a sequence of either characters
different from <span class="c008">"</span> and <span class="c008">\</span>, or escape sequences from the
table given above for character literals.</p><p>To allow splitting long string literals across lines, the sequence
<span class="c007">\</span><span class="c013">newline</span>&#XA0;<span class="c013">spaces-or-tabs</span> (a backslash at the end of a line
followed by any number of spaces and horizontal tabulations at the
beginning of the next line) is ignored inside string literals.</p><p>The current implementation places practically no restrictions on the
length of string literals.</p><!--TOC subsubsection id="s:labelname" Naming labels-->
<h4 class="subsubsection" id="s:labelname">Naming labels</h4><!--SEC END --><p>To avoid ambiguities, naming labels in expressions cannot just be defined
syntactically as the sequence of the three tokens <span class="c007">~</span>, <a class="syntax" href="#ident"><span class="c014">ident</span></a> and
<span class="c007">:</span>, and have to be defined at the lexical level.</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="label-name"><span class="c014">label-name</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="label"><span class="c014">label</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<span class="c008">~</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="optlabel"><span class="c014">optlabel</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>
</td></tr>
</table></td></tr>
</table><p>Naming labels come in two flavours: <a class="syntax" href="#label"><span class="c014">label</span></a> for normal arguments and
<a class="syntax" href="#optlabel"><span class="c014">optlabel</span></a> for optional ones. They are simply distinguished by their
first character, either <span class="c007">~</span> or <span class="c007">?</span>.</p><p>Despite <a class="syntax" href="#label"><span class="c014">label</span></a> and <a class="syntax" href="#optlabel"><span class="c014">optlabel</span></a> being lexical entities in expressions,
their expansions <span class="c008">~</span> <a class="syntax" href="#label-name"><span class="c014">label-name</span></a> <span class="c008">:</span> and <span class="c008">?</span> <a class="syntax" href="#label-name"><span class="c014">label-name</span></a> <span class="c008">:</span> will be
used in grammars, for the sake of readability. Note also that inside
type expressions, this expansion can be taken literally, <em>i.e.</em>
there are really 3 tokens, with optional blanks between them.</p><!--TOC subsubsection id="sec71" Prefix and infix symbols-->
<h4 class="subsubsection" id="sec71">Prefix and infix symbols</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="infix-symbol"><span class="c014">infix-symbol</span></a></td><td class="c022">::=</td><td class="c024">
(<span class="c008">=</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&lt;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&gt;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">@</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">^</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">|</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&amp;</span>&#XA0;&#X2223;&#XA0;
<span class="c008">+</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">-</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">*</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">/</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">$</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">%</span>)&#XA0;{&#XA0;<a class="syntax" href="#operator-char"><span class="c014">operator-char</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="prefix-symbol"><span class="c014">prefix-symbol</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">!</span>&#XA0;{&#XA0;<a class="syntax" href="#operator-char"><span class="c014">operator-char</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;(<span class="c008">?</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">~</span>)&#XA0;{&#XA0;<a class="syntax" href="#operator-char"><span class="c014">operator-char</span></a>&#XA0;}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="operator-char"><span class="c014">operator-char</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">!</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">$</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">%</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&amp;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">*</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">+</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">-</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">.</span>&#XA0;&#X2223;&#XA0;
<span class="c008">/</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">:</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&lt;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">=</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&gt;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">?</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">@</span>&#XA0;&#X2223;&#XA0;
<span class="c008">^</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">|</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">~</span>
</td></tr>
</table></td></tr>
</table><p>Sequences of &#X201C;operator characters&#X201D;, such as <span class="c007">&lt;=&gt;</span> or <span class="c007">!!</span>,
are read as a single token from the <a class="syntax" href="#infix-symbol"><span class="c014">infix-symbol</span></a> or <a class="syntax" href="#prefix-symbol"><span class="c014">prefix-symbol</span></a>
class. These symbols are parsed as prefix and infix operators inside
expressions, but otherwise behave like normal identifiers.
</p><!--TOC subsubsection id="sec72" Keywords-->
<h4 class="subsubsection" id="sec72">Keywords</h4><!--SEC END --><p>The identifiers below are reserved as keywords, and cannot be employed
otherwise:
</p><pre>      and         as          assert      asr         begin       class
      constraint  do          done        downto      else        end
      exception   external    false       for         fun         function
      functor     if          in          include     inherit     initializer
      land        lazy        let         lor         lsl         lsr
      lxor        match       method      mod         module      mutable
      new         object      of          open        or          private
      rec         sig         struct      then        to          true
      try         type        val         virtual     when        while
      with
</pre><p> <br>
The following character sequences are also keywords:
</p><pre>
<span class="c007">    !=    #     &amp;     &amp;&amp;    '     (     )     *     +     ,     -</span>
<span class="c007">    -.    -&gt;    .     ..    :     ::    :=    :&gt;    ;     ;;    &lt;</span>
<span class="c007">    &lt;-    =     &gt;     &gt;]    &gt;}    ?     [     [&lt;    [&gt;    [|    ]</span>
<span class="c007">    _     `     {     {&lt;    |     |]    ||    }     ~</span>
</pre><p>
Note that the following identifiers are keywords of the Camlp4
extensions and should be avoided for compatibility reasons.
</p><pre>    parser    value    $     $$    $:    &lt;:    &lt;&lt;    &gt;&gt;    ??
</pre><!--TOC subsubsection id="sec73" Ambiguities-->
<h4 class="subsubsection" id="sec73">Ambiguities</h4><!--SEC END --><p>Lexical ambiguities are resolved according to the &#X201C;longest match&#X201D;
rule: when a character sequence can be decomposed into two tokens in
several different ways, the decomposition retained is the one with the
longest first token.</p><!--TOC subsubsection id="sec74" Line number directives-->
<h4 class="subsubsection" id="sec74">Line number directives</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="linenum-directive"><span class="c014">linenum-directive</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">#</span>&#XA0;{<span class="c008">0</span>&#XA0;&#X2026;&#XA0;<span class="c008">9</span>}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">#</span>&#XA0;{<span class="c008">0</span>&#XA0;&#X2026;&#XA0;<span class="c008">9</span>}<sup>+</sup>&#XA0;<span class="c008">"</span>&#XA0;{&#XA0;<a class="syntax" href="#string-character"><span class="c014">string-character</span></a>&#XA0;}&#XA0;<span class="c008">"</span>
</td></tr>
</table></td></tr>
</table><p>Preprocessors that generate OCaml source code can insert line number
directives in their output so that error messages produced by the
compiler contain line numbers and file names referring to the source
file before preprocessing, instead of after preprocessing.
A line number directive is composed of a <span class="c008">#</span> (sharp sign), followed by
a positive integer (the source line number), optionally followed by a
character string (the source file name).
Line number directives are treated as blanks during lexical
analysis.</p>
<!--TOC section id="sec75" Values-->
<h2 class="section" id="sec75">6.2&#XA0;&#XA0;Values</h2><!--SEC END --><!--NAME values.html-->
<p>This section describes the kinds of values that are manipulated by
OCaml programs.</p>
<!--TOC subsection id="sec76" Base values-->
<h3 class="subsection" id="sec76">6.2.1&#XA0;&#XA0;Base values</h3><!--SEC END --><!--TOC subsubsection id="sec77" Integer numbers-->
<h4 class="subsubsection" id="sec77">Integer numbers</h4><!--SEC END --><p>Integer values are integer numbers from &#X2212;2<sup>30</sup> to 2<sup>30</sup>&#X2212;1, that
is &#X2212;1073741824 to 1073741823. The implementation may support a
wider range of integer values: on 64-bit platforms, the current
implementation supports integers ranging from &#X2212;2<sup>62</sup> to 2<sup>62</sup>&#X2212;1.</p><!--TOC subsubsection id="sec78" Floating-point numbers-->
<h4 class="subsubsection" id="sec78">Floating-point numbers</h4><!--SEC END --><p>Floating-point values are numbers in floating-point representation.
The current implementation uses double-precision floating-point
numbers conforming to the IEEE 754 standard, with 53 bits of mantissa
and an exponent ranging from &#X2212;1022 to 1023.</p><!--TOC subsubsection id="sec79" Characters-->
<h4 class="subsubsection" id="sec79">Characters</h4><!--SEC END --><p>Character values are represented as 8-bit integers between 0 and 255.
Character codes between 0 and 127 are interpreted following the ASCII
standard. The current implementation interprets character codes
between 128 and 255 following the ISO 8859-1 standard.</p><!--TOC subsubsection id="s:string-val" Character strings-->
<h4 class="subsubsection" id="s:string-val">Character strings</h4><!--SEC END --><p>String values are finite sequences of characters. The current
implementation supports strings containing up to 2<sup>24</sup> &#X2212; 5
characters (16777211 characters); on 64-bit platforms, the limit is
2<sup>57</sup> &#X2212; 9.</p>
<!--TOC subsection id="sec81" Tuples-->
<h3 class="subsection" id="sec81">6.2.2&#XA0;&#XA0;Tuples</h3><!--SEC END --><p>Tuples of values are written <span class="c008">(</span><span class="c014">v</span><sub>1</sub><span class="c008">,</span> &#X2026;<span class="c008">,</span> <span class="c014">v</span><sub><span class="c013">n</span></sub><span class="c008">)</span>, standing for the
<span class="c013">n</span>-tuple of values <span class="c014">v</span><sub>1</sub> to <span class="c014">v</span><sub><span class="c013">n</span></sub>. The current implementation
supports tuple of up to 2<sup>22</sup> &#X2212; 1 elements (4194303 elements).</p>
<!--TOC subsection id="sec82" Records-->
<h3 class="subsection" id="sec82">6.2.3&#XA0;&#XA0;Records</h3><!--SEC END --><p>Record values are labeled tuples of values. The record value written
<span class="c008">{</span> <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> <span class="c008">=</span> <span class="c014">v</span><sub>1</sub><span class="c008">;</span> &#X2026;<span class="c008">;</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span> <span class="c014">v</span><sub><span class="c013">n</span></sub> <span class="c008">}</span> associates the value
<span class="c014">v</span><sub><span class="c013">i</span></sub> to the record field <a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">i</span></sub>, for <span class="c013">i</span> = 1 &#X2026; <span class="c013">n</span>. The current
implementation supports records with up to 2<sup>22</sup> &#X2212; 1 fields
(4194303 fields).</p>
<!--TOC subsection id="sec83" Arrays-->
<h3 class="subsection" id="sec83">6.2.4&#XA0;&#XA0;Arrays</h3><!--SEC END --><p>Arrays are finite, variable-sized sequences of values of the same
type. The current implementation supports arrays containing up to
2<sup>22</sup> &#X2212; 1 elements (4194303 elements) unless the elements are
floating-point numbers (2097151 elements in this case); on 64-bit
platforms, the limit is 2<sup>54</sup> &#X2212; 1 for all arrays.</p>
<!--TOC subsection id="sec84" Variant values-->
<h3 class="subsection" id="sec84">6.2.5&#XA0;&#XA0;Variant values</h3><!--SEC END --><p>Variant values are either a constant constructor, or a non-constant
constructor applied to a number of values. The former case is written
<a class="syntax" href="#constr"><span class="c014">constr</span></a>; the latter case is written <a class="syntax" href="#constr"><span class="c014">constr</span></a> <span class="c008">(</span><span class="c014">v</span><sub>1</sub><span class="c008">,</span> ... <span class="c008">,</span> <span class="c014">v</span><sub><span class="c013">n</span></sub>
<span class="c008">)</span>, where the <span class="c014">v</span><sub><span class="c013">i</span></sub> are said to be the arguments of the non-constant
constructor <a class="syntax" href="#constr"><span class="c014">constr</span></a>. The parentheses may be omitted if there is only
one argument.</p><p>The following constants are treated like built-in constant
constructors:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Constant</span></td><td class="c021"><span class="c019">Constructor</span> </td></tr>
<tr><td class="c023">
<span class="c007">false</span></td><td class="c023">the boolean false </td></tr>
<tr><td class="c023"><span class="c007">true</span></td><td class="c023">the boolean true </td></tr>
<tr><td class="c023"><span class="c007">()</span></td><td class="c023">the &#X201C;unit&#X201D; value </td></tr>
<tr><td class="c023"><span class="c007">[]</span></td><td class="c023">the empty list </td></tr>
</table></div><p>The current implementation limits each variant type to have at most
246 non-constant constructors and 2<sup>30</sup>&#X2212;1 constant constructors.</p>
<!--TOC subsection id="sec85" Polymorphic variants-->
<h3 class="subsection" id="sec85">6.2.6&#XA0;&#XA0;Polymorphic variants</h3><!--SEC END --><p>Polymorphic variants are an alternate form of variant values, not
belonging explicitly to a predefined variant type, and following
specific typing rules. They can be either constant, written
<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>, or non-constant, written <span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a><span class="c005"><span class="c007">(</span><span class="c014">v</span><span class="c007">)</span></span>.</p>
<!--TOC subsection id="sec86" Functions-->
<h3 class="subsection" id="sec86">6.2.7&#XA0;&#XA0;Functions</h3><!--SEC END --><p>Functional values are mappings from values to values.</p>
<!--TOC subsection id="sec87" Objects-->
<h3 class="subsection" id="sec87">6.2.8&#XA0;&#XA0;Objects</h3><!--SEC END --><p>Objects are composed of a hidden internal state which is a
record of instance variables, and a set of methods for accessing and
modifying these variables. The structure of an object is described by
the toplevel class that created it.

</p>
<!--TOC section id="sec88" Names-->
<h2 class="section" id="sec88">6.3&#XA0;&#XA0;Names</h2><!--SEC END --><p> <a id="s:names"></a>

</p><!--NAME names.html-->
<p>Identifiers are used to give names to several classes of language
objects and refer to these objects by name later:
</p><ul class="itemize"><li class="li-itemize">
value names (syntactic class <a class="syntax" href="#value-name"><span class="c014">value-name</span></a>),
</li><li class="li-itemize">value constructors and exception constructors (class <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>),
</li><li class="li-itemize">labels (<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>, defined in section&#XA0;<a href="#s%3Alabelname">6.1</a>),
</li><li class="li-itemize">polymorphic variant tags (<a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>),
</li><li class="li-itemize">type constructors (<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>),
</li><li class="li-itemize">record fields (<a class="syntax" href="#field-name"><span class="c014">field-name</span></a>),
</li><li class="li-itemize">class names (<a class="syntax" href="#class-name"><span class="c014">class-name</span></a>),
</li><li class="li-itemize">method names (<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>),
</li><li class="li-itemize">instance variable names (<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>),
</li><li class="li-itemize">module names (<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>),
</li><li class="li-itemize">module type names (<a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a>).
</li></ul><p>
These eleven name spaces are distinguished both by the context and by the
capitalization of the identifier: whether the first letter of the
identifier is in lowercase (written <a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a> below) or in
uppercase (written <a class="syntax" href="#capitalized-ident"><span class="c014">capitalized-ident</span></a>). Underscore is considered a
lowercase letter for this purpose.</p><p><a id="hevea_manual.kwd0"></a>
<a id="hevea_manual.kwd1"></a></p><!--TOC subsubsection id="sec89" Naming objects-->
<h4 class="subsubsection" id="sec89">Naming objects</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="value-name"><span class="c014">value-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#operator-name"><span class="c014">operator-name</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="operator-name"><span class="c014">operator-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#prefix-symbol"><span class="c014">prefix-symbol</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<a class="syntax" href="#infix-op"><span class="c014">infix-op</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="infix-op"><span class="c014">infix-op</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#infix-symbol"><span class="c014">infix-symbol</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">*</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">+</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">-</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">-.</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">=</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">!=</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&lt;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&gt;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">or</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">||</span>
&#X2223;&#XA0;&#XA0;<span class="c008">&amp;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">&amp;&amp;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">:=</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">mod</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">land</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">lor</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">lxor</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">lsl</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">lsr</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">asr</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="constr-name"><span class="c014">constr-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#capitalized-ident"><span class="c014">capitalized-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="tag-name"><span class="c014">tag-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#capitalized-ident"><span class="c014">capitalized-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="typeconstr-name"><span class="c014">typeconstr-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="field-name"><span class="c014">field-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="module-name"><span class="c014">module-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#capitalized-ident"><span class="c014">capitalized-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="modtype-name"><span class="c014">modtype-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#ident"><span class="c014">ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="class-name"><span class="c014">class-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="inst-var-name"><span class="c014">inst-var-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="method-name"><span class="c014">method-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
</td></tr>
</table></td></tr>
</table><p>
As shown above, prefix and infix symbols as well as some keywords can
be used as value names, provided they are written between parentheses.
The capitalization rules are summarized in the table below.</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Name space</span></td><td class="c021"><span class="c019">Case of first letter</span> </td></tr>
<tr><td class="c023">
Values</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Constructors</td><td class="c023">uppercase </td></tr>
<tr><td class="c023">Labels</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Polymorphic variant tags</td><td class="c023">uppercase </td></tr>
<tr><td class="c023">Exceptions</td><td class="c023">uppercase </td></tr>
<tr><td class="c023">Type constructors</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Record fields</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Classes</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Instance variables</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Methods</td><td class="c023">lowercase </td></tr>
<tr><td class="c023">Modules</td><td class="c023">uppercase </td></tr>
<tr><td class="c023">Module types</td><td class="c023">any </td></tr>
</table></div><p><span class="c013">Note on polymorphic variant tags:</span> the current implementation accepts
lowercase variant tags in addition to capitalized variant tags, but we
suggest you avoid lowercase variant tags for portability and
compatibility with future OCaml versions.</p><!--TOC subsubsection id="sec90" Referring to named objects-->
<h4 class="subsubsection" id="sec90">Referring to named objects</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="value-path"><span class="c014">value-path</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="constr"><span class="c014">constr</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="typeconstr"><span class="c014">typeconstr</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="field"><span class="c014">field</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#field-name"><span class="c014">field-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="modtype-path"><span class="c014">modtype-path</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="class-path"><span class="c014">class-path</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#class-name"><span class="c014">class-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="classtype-path"><span class="c014">classtype-path</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>&#XA0;<span class="c008">.</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#class-name"><span class="c014">class-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="module-path"><span class="c014">module-path</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">.</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="extended-module-path"><span class="c014">extended-module-path</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#extended-module-name"><span class="c014">extended-module-name</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">.</span>&#XA0;<a class="syntax" href="#extended-module-name"><span class="c014">extended-module-name</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="extended-module-name"><span class="c014">extended-module-name</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>&#XA0;<span class="c008">)</span>&#XA0;}
</td></tr>
</table></td></tr>
</table><p>A named object can be referred to either by its name (following the
usual static scoping rules for names) or by an access path <span class="c014">prefix</span> <span class="c008">.</span> &#XA0;<span class="c014">name</span>,
where <span class="c014">prefix</span> designates a module and <span class="c014">name</span> is the name of an object
defined in that module. The first component of the path, <span class="c014">prefix</span>, is
either a simple module name or an access path <span class="c014">name</span><sub>1</sub> <span class="c008">.</span> &#XA0;<span class="c014">name</span><sub>2</sub> &#X2026;,
in case the defining module is itself nested inside other modules.
For referring to type constructors, module types, or class types,
the <span class="c014">prefix</span> can
also contain simple functor applications (as in the syntactic class
<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a> above) in case the defining module is the
result of a functor application.</p><p>Label names, tag names, method names and instance variable names need
not be qualified: the former three are global labels, while the latter
are local to a class.

</p>
<!--TOC section id="sec91" Type expressions-->
<h2 class="section" id="sec91">6.4&#XA0;&#XA0;Type expressions</h2><!--SEC END --><!--NAME types.html-->
<p>
<a id="hevea_manual.kwd2"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="typexpr"><span class="c014">typexpr</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">'</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">_</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;[[<span class="c008">?</span>]<a class="syntax" href="#label-name"><span class="c014">label-name</span></a><span class="c008">:</span>]&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">*</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}&#XA0;<span class="c008">)</span>&#XA0;&#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">as</span>&#XA0;<span class="c008">'</span>&#XA0;&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#polymorphic-variant-type"><span class="c014">polymorphic-variant-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">&lt;</span>&#XA0;[<span class="c008">..</span>]&#XA0;<span class="c008">&gt;</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">&lt;</span>&#XA0;<a class="syntax" href="#method-type"><span class="c014">method-type</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#method-type"><span class="c014">method-type</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">;</span>&#XA0;<span class="c008">..</span>]&#XA0;<span class="c008">&gt;</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">#</span>&#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">#</span>&#XA0;&#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}&#XA0;<span class="c008">)</span>&#XA0;<span class="c008">#</span>&#XA0;&#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="poly-typexpr"><span class="c014">poly-typexpr</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;{&#XA0;<span class="c008">'</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>&#XA0;}<sup>+</sup>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="method-type"><span class="c014">method-type</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
</td></tr>
</table></td></tr>
</table><p>The table below shows the relative precedences and associativity of
operators and non-closed type constructions. The constructions with
higher precedences come first.
<a id="hevea_manual.kwd3"></a>
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Operator</span></td><td class="c021"><span class="c019">Associativity</span> </td></tr>
<tr><td class="c023">
Type constructor application</td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">#</span></td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">*</span></td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">-&gt;</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">as</span></td><td class="c023">&#X2013; </td></tr>
</table></div><p>Type expressions denote types in definitions of data types as well as
in type constraints over patterns and expressions.</p><!--TOC subsubsection id="sec92" Type variables-->
<h4 class="subsubsection" id="sec92">Type variables</h4><!--SEC END --><p>The type expression <span class="c008">'</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> stands for the type variable named
<a class="syntax" href="#ident"><span class="c014">ident</span></a>. The type expression <span class="c008">_</span> stands for an anonymous type variable.
In data type definitions, type variables are names for the
data type parameters. In type constraints, they represent unspecified
types that can be instantiated by any type to satisfy the type
constraint. In general the scope of a named type variable is the
whole top-level phrase where it appears, and it can only be
generalized when leaving
this scope. Anonymous variables have no such restriction.
In the following cases, the scope of named type variables is
restricted to the type expression where they appear: 1) for universal
(explicitly polymorphic) type variables; 2) for type variables that
only appear in public method specifications (as those variables will
be made universal, as described in section&#XA0;<a href="#sec-methspec">6.9.1</a>);
3) for variables used as aliases, when the type they are aliased to
would be invalid in the scope of the enclosing definition (<span class="c013">i.e.</span>
when it contains free universal type variables, or locally
defined types.)</p><!--TOC subsubsection id="sec93" Parenthesized types-->
<h4 class="subsubsection" id="sec93">Parenthesized types</h4><!--SEC END --><p>The type expression <span class="c008">(</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">)</span> denotes the same type as
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.</p><!--TOC subsubsection id="sec94" Function types-->
<h4 class="subsubsection" id="sec94">Function types</h4><!--SEC END --><p>The type expression <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub> denotes the type of
functions mapping arguments of type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> to results of type
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub>.</p><p><a class="syntax" href="#label-name"><span class="c014">label-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub> denotes the same function type, but
the argument is labeled <a class="syntax" href="#label"><span class="c014">label</span></a>.</p><p><span class="c008">?</span> <a class="syntax" href="#label-name"><span class="c014">label-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub> denotes the type of functions
mapping an optional labeled argument of type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> to results of
type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub>. That is, the physical type of the function will be
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c005"><span class="c007">option</span> <span class="c007">-&gt;</span></span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub>.</p><!--TOC subsubsection id="sec95" Tuple types-->
<h4 class="subsubsection" id="sec95">Tuple types</h4><!--SEC END --><p>The type expression <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">*</span> &#X2026; <span class="c008">*</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>
denotes the type of tuples whose elements belong to types <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub>,
&#X2026; &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub> respectively.</p><!--TOC subsubsection id="sec96" Constructed types-->
<h4 class="subsubsection" id="sec96">Constructed types</h4><!--SEC END --><p>Type constructors with no parameter, as in <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>, are type
expressions.</p><p>The type expression <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> &#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>, where <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> is a type
constructor with one parameter, denotes the application of the unary type
constructor <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> to the type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.</p><p>The type expression (<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub>,&#X2026;,&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>) &#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>, where
<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> is a type constructor with <span class="c013">n</span> parameters, denotes the
application of the <span class="c013">n</span>-ary type constructor <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> to the types
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> through <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>.</p><!--TOC subsubsection id="sec97" Aliased and recursive types-->
<h4 class="subsubsection" id="sec97">Aliased and recursive types</h4><!--SEC END --><p><a id="hevea_manual.kwd4"></a></p><p>The type expression <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c005"><span class="c007">as</span> <span class="c007">'</span></span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> denotes the same type as
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>, and also binds the type variable <a class="syntax" href="#ident"><span class="c014">ident</span></a> to type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> both
in <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> and in other types. In general the scope of an alias is
the same as for a named type variable, and covers the whole enclosing
definition. If the type variable
<a class="syntax" href="#ident"><span class="c014">ident</span></a> actually occurs in <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>, a recursive type is created. Recursive
types for which there exists a recursive path that does not contain
an object or polymorphic variant type constructor are rejected, except
when the <span class="c007">-rectypes</span> mode is selected.</p><p>If <span class="c008">'</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> denotes an explicit polymorphic variable, and <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
denotes either an object or polymorphic variant type, the row variable
of <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> is captured by <span class="c008">'</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a>, and quantified upon.</p><!--TOC subsubsection id="sec98" Polymorphic variant types-->
<h4 class="subsubsection" id="sec98">Polymorphic variant types</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="polymorphic-variant-type"><span class="c014">polymorphic-variant-type</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">[</span>&#XA0;<a class="syntax" href="#tag-spec-first"><span class="c014">tag-spec-first</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">|</span>&#XA0;<a class="syntax" href="#tag-spec"><span class="c014">tag-spec</span></a>&#XA0;}&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[&gt;</span>&#XA0;[&#XA0;<a class="syntax" href="#tag-spec"><span class="c014">tag-spec</span></a>&#XA0;]&#XA0;&#XA0;{&#XA0;<span class="c008">|</span>&#XA0;<a class="syntax" href="#tag-spec"><span class="c014">tag-spec</span></a>&#XA0;}&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[&lt;</span>&#XA0;[<span class="c008">|</span>]&#XA0;<a class="syntax" href="#tag-spec-full"><span class="c014">tag-spec-full</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">|</span>&#XA0;<a class="syntax" href="#tag-spec-full"><span class="c014">tag-spec-full</span></a>&#XA0;}
&#XA0;[&#XA0;<span class="c008">&gt;</span>&#XA0;{&#XA0;<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>&#XA0;}<sup>+</sup>&#XA0;]&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="tag-spec-first"><span class="c014">tag-spec-first</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>&#XA0;&#XA0;[&#XA0;<span class="c008">of</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;[&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;]&#XA0;<span class="c008">|</span>&#XA0;&#XA0;<a class="syntax" href="#tag-spec"><span class="c014">tag-spec</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="tag-spec"><span class="c014">tag-spec</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>&#XA0;&#XA0;[&#XA0;<span class="c008">of</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="tag-spec-full"><span class="c014">tag-spec-full</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>&#XA0;&#XA0;[&#XA0;<span class="c008">of</span>&#XA0;[<span class="c008">&amp;</span>]&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">&amp;</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}&#XA0;]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
</td></tr>
</table></td></tr>
</table><p>Polymorphic variant types describe the values a polymorphic variant
may take.</p><p>The first case is an exact variant type: all possible tags are
known, with their associated types, and they can all be present.
Its structure is fully known.</p><p>The second case is an open variant type, describing a polymorphic
variant value: it gives the list of all tags the value could take,
with their associated types. This type is still compatible with a
variant type containing more tags. A special case is the unknown
type, which does not define any tag, and is compatible with any
variant type.</p><p>The third case is a closed variant type. It gives information about
all the possible tags and their associated types, and which tags are
known to potentially appear in values. The exact variant type (first
case) is
just an abbreviation for a closed variant type where all possible tags
are also potentially present.</p><p>In all three cases, tags may be either specified directly in the
<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a> &#XA0;[<span class="c008">of</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>] form, or indirectly through a type
expression, which must expand to an
exact variant type, whose tag specifications are inserted in its
place.</p><p>Full specifications of variant tags are only used for non-exact closed
types. They can be understood as a conjunctive type for the argument:
it is intended to have all the types enumerated in the
specification.</p><p>Such conjunctive constraints may be unsatisfiable. In such a case the
corresponding tag may not be used in a value of this type. This
does not mean that the whole type is not valid: one can still use
other available tags.
Conjunctive constraints are mainly intended as output from the type
checker. When they are used in source programs, unsolvable constraints
may cause early failures.</p><!--TOC subsubsection id="sec99" Object types-->
<h4 class="subsubsection" id="sec99">Object types</h4><!--SEC END --><p>An object type
<span class="c008">&lt;</span> [<a class="syntax" href="#method-type"><span class="c014">method-type</span></a> &#XA0;{ <span class="c008">;</span> <a class="syntax" href="#method-type"><span class="c014">method-type</span></a> }] <span class="c008">&gt;</span>
is a record of method types.</p><p>Each method may have an explicit polymorphic type: { <span class="c008">'</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> }<sup>+</sup>
<span class="c008">.</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>. Explicit polymorphic variables have a local scope, and
an explicit polymorphic type can only be unified to an
equivalent one, where only the order and names of polymorphic
variables may change.</p><p>The type <span class="c008">&lt;</span> {<a class="syntax" href="#method-type"><span class="c014">method-type</span></a> <span class="c008">;</span>} <span class="c005"><span class="c007">..</span> <span class="c007">&gt;</span></span> is the
type of an object whose method names and types are described by
<a class="syntax" href="#method-type"><span class="c014">method-type</span></a><sub>1</sub>, &#X2026;, &#XA0;<a class="syntax" href="#method-type"><span class="c014">method-type</span></a><sub><span class="c013">n</span></sub>, and possibly some other
methods represented by the ellipsis. This ellipsis actually is
a special kind of type variable (called <em>row variable</em> in the
literature) that stands for any number of extra method types.</p><!--TOC subsubsection id="s:sharp-types" #-types-->
<h4 class="subsubsection" id="s:sharp-types">#-types</h4><!--SEC END --><p>The type <span class="c008">#</span> <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> is a special kind of abbreviation. This
abbreviation unifies with the type of any object belonging to a subclass
of class <a class="syntax" href="#class-path"><span class="c014">class-path</span></a>.
It is handled in a special way as it usually hides a type variable (an
ellipsis, representing the methods that may be added in a subclass).
In particular, it vanishes when the ellipsis gets instantiated.
Each type expression <span class="c008">#</span> <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> defines a new type variable, so
type <span class="c008">#</span> <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> <span class="c005"><span class="c007">-&gt;</span> <span class="c007">#</span></span> &#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a> is usually not the same as
type (<span class="c008">#</span> <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> <span class="c005"><span class="c007">as</span> <span class="c007">'</span></span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>) <span class="c005"><span class="c007">-&gt;</span> <span class="c007">'</span></span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>.
</p><p>Use of #-types to abbreviate polymorphic variant types is deprecated.
If <span class="c014">t</span> is an exact variant type then <span class="c008">#</span><span class="c014">t</span> translates to <span class="c005"><span class="c007">[&lt;</span> <span class="c014">t</span><span class="c007">]</span></span>,
and <span class="c005"><span class="c007">#</span><span class="c014">t</span><span class="c007">[&gt;</span> <span class="c007">`</span></span><a class="syntax" href="#tag-name"><span class="c014">tag</span></a><sub>1</sub> &#X2026;<span class="c008">`</span>&#XA0;<a class="syntax" href="#tag-name"><span class="c014">tag</span></a><sub><span class="c013">k</span></sub><span class="c008">]</span> translates to
<span class="c005"><span class="c007">[&lt;</span> <span class="c014">t</span> <span class="c007">&gt;</span> <span class="c007">`</span></span><a class="syntax" href="#tag-name"><span class="c014">tag</span></a><sub>1</sub> &#X2026;<span class="c008">`</span>&#XA0;<a class="syntax" href="#tag-name"><span class="c014">tag</span></a><sub><span class="c013">k</span></sub><span class="c008">]</span></p><!--TOC subsubsection id="sec101" Variant and record types-->
<h4 class="subsubsection" id="sec101">Variant and record types</h4><!--SEC END --><p>There are no type expressions describing (defined) variant types nor
record types, since those are always named, i.e. defined before use
and referred to by name. Type definitions are described in
section&#XA0;<a href="#s%3Atype-defs">6.8.1</a>.

</p>
<!--TOC section id="sec102" Constants-->
<h2 class="section" id="sec102">6.5&#XA0;&#XA0;Constants</h2><!--SEC END --><!--NAME const.html-->
<table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="constant"><span class="c014">constant</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#integer-literal"><span class="c014">integer-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#float-literal"><span class="c014">float-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#char-literal"><span class="c014">char-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#string-literal"><span class="c014">string-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">false</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">true</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">()</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">begin</span>&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[||]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>
</td></tr>
</table></td></tr>
</table><p>The syntactic class of constants comprises literals from the four
base types (integers, floating-point numbers, characters, character
strings), and constant constructors from both normal and polymorphic
variants, as well as the special constants <span class="c008">false</span>, <span class="c008">true</span>, <span class="c008">()</span>,
<span class="c008">[]</span>, and <span class="c008">[||]</span>, which behave like constant constructors, and
<span class="c005"><span class="c007">begin</span> <span class="c007">end</span></span>, which is equivalent to <span class="c008">()</span>.

</p>
<!--TOC section id="sec103" Patterns-->
<h2 class="section" id="sec103">6.6&#XA0;&#XA0;Patterns</h2><!--SEC END --><p>

<a id="hevea_manual.kwd5"></a>
</p><!--NAME patterns.html-->
<table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="pattern"><span class="c014">pattern</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">_</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#constant"><span class="c014">constant</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;<span class="c008">as</span>&#XA0;&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;<span class="c008">|</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">#</span><a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;}&#XA0;&#XA0;[&#XA0;<span class="c008">;</span>&#XA0;]&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;}&#XA0;&#XA0;[&#XA0;<span class="c008">;</span>&#XA0;]&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;<span class="c008">::</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[|</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;}&#XA0;&#XA0;[&#XA0;<span class="c008">;</span>&#XA0;]&#XA0;<span class="c008">|]</span>
</td></tr>
</table></td></tr>
</table><p>The table below shows the relative precedences and associativity of
operators and non-closed pattern constructions. The constructions with
higher precedences come first.
<a id="hevea_manual.kwd6"></a>
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Operator</span></td><td class="c021"><span class="c019">Associativity</span> </td></tr>
<tr><td class="c023">
<span class="c007">..</span> (see section&#XA0;<a href="#s%3Arange-patterns">7.4</a>)</td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">lazy</span> (see section&#XA0;<a href="#s%3Alazy">7.6</a>)</td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023">Constructor application, Tag application</td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">::</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">,</span></td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">|</span></td><td class="c023">left </td></tr>
<tr><td class="c023"><span class="c007">as</span></td><td class="c023">&#X2013; </td></tr>
</table></div><p>Patterns are templates that allow selecting data structures of a
given shape, and binding identifiers to components of the data
structure. This selection operation is called pattern matching; its
outcome is either &#X201C;this value does not match this pattern&#X201D;, or
&#X201C;this value matches this pattern, resulting in the following bindings
of names to values&#X201D;.</p><!--TOC subsubsection id="sec104" Variable patterns-->
<h4 class="subsubsection" id="sec104">Variable patterns</h4><!--SEC END --><p>A pattern that consists in a value name matches any value,
binding the name to the value. The pattern <span class="c008">_</span> also matches
any value, but does not bind any name.</p><p>Patterns are <em>linear</em>: a variable cannot be bound several times by
a given pattern. In particular, there is no way to test for equality
between two parts of a data structure using only a pattern (but
<span class="c008">when</span> guards can be used for this purpose).</p><!--TOC subsubsection id="sec105" Constant patterns-->
<h4 class="subsubsection" id="sec105">Constant patterns</h4><!--SEC END --><p>A pattern consisting in a constant matches the values that
are equal to this constant.</p><!--TOC subsubsection id="sec106" Alias patterns-->
<h4 class="subsubsection" id="sec106">Alias patterns</h4><!--SEC END --><p>
<a id="hevea_manual.kwd7"></a></p><p>The pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">as</span> &#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a> matches the same values as
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>. If the matching against <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> is successful,
the name <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> is bound to the matched value, in addition to the
bindings performed by the matching against <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>.</p><!--TOC subsubsection id="sec107" Parenthesized patterns-->
<h4 class="subsubsection" id="sec107">Parenthesized patterns</h4><!--SEC END --><p>The pattern <span class="c008">(</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">)</span> matches the same values as
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>. A type constraint can appear in a
parenthesized pattern, as in <span class="c008">(</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">)</span>. This
constraint forces the type of <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> to be compatible with
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.</p><!--TOC subsubsection id="sec108" &#X201C;Or&#X201D; patterns-->
<h4 class="subsubsection" id="sec108">&#X201C;Or&#X201D; patterns</h4><!--SEC END --><p>The pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">|</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub> represents the logical &#X201C;or&#X201D; of
the two patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> and <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub>. A value matches
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">|</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub> if it matches <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> or
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub>. The two sub-patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> and <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub>
must bind exactly the same identifiers to values having the same types.
Matching is performed from left to right.
More precisely,
in case some value&#XA0;<span class="c013">v</span> matches <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">|</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub>, the bindings
performed are those of <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> when <span class="c013">v</span> matches <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>.
Otherwise, value&#XA0;<span class="c013">v</span> matches <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub> whose bindings are performed.</p><!--TOC subsubsection id="sec109" Variant patterns-->
<h4 class="subsubsection" id="sec109">Variant patterns</h4><!--SEC END --><p>The pattern <a class="syntax" href="#constr"><span class="c014">constr</span></a> <span class="c008">(</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">,</span> &#X2026; <span class="c008">,</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">)</span> matches
all variants whose
constructor is equal to <a class="syntax" href="#constr"><span class="c014">constr</span></a>, and whose arguments match
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>. It is a type error if <span class="c013">n</span> is not the
number of arguments expected by the constructor.</p><p>The pattern <a class="syntax" href="#constr"><span class="c014">constr</span></a> <span class="c008">_</span> matches all variants whose constructor is
<a class="syntax" href="#constr"><span class="c014">constr</span></a>.</p><p>The pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">::</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub> matches non-empty lists whose
heads match <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>, and whose tails match <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>2</sub>.</p><p>The pattern <span class="c008">[</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">]</span> matches lists
of length <span class="c013">n</span> whose elements match <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> &#X2026;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>,
respectively. This pattern behaves like
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">::</span> &#X2026; <span class="c008">::</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">::</span> <span class="c007">[]</span></span>.</p><!--TOC subsubsection id="sec110" Polymorphic variant patterns-->
<h4 class="subsubsection" id="sec110">Polymorphic variant patterns</h4><!--SEC END --><p>The pattern <span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> matches all polymorphic variants
whose tag is equal to <a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>, and whose argument matches
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>.</p><!--TOC subsubsection id="sec111" Polymorphic variant abbreviation patterns-->
<h4 class="subsubsection" id="sec111">Polymorphic variant abbreviation patterns</h4><!--SEC END --><p>If the type [<span class="c008">('a,'b,</span>&#X2026;<span class="c008">)</span>] <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> = <span class="c005"><span class="c007">[</span> <span class="c007">`</span></span>&#XA0;<a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">|</span>
&#X2026; <span class="c005"><span class="c007">|</span> <span class="c007">`</span></span>&#XA0;<a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a><sub><span class="c013">n</span></sub> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub><span class="c008">]</span> is defined, then the pattern <span class="c008">#</span><a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>
is a shorthand for the following or-pattern:
<span class="c005"><span class="c007">(</span> <span class="c007">`</span></span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a><sub>1</sub><span class="c005"><span class="c007">(_</span> <span class="c007">:</span></span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub><span class="c005"><span class="c007">)</span> <span class="c007">|</span></span> &#X2026; <span class="c005"><span class="c007">|</span> <span class="c007">`</span></span>&#XA0;<a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a><sub><span class="c013">n</span></sub><span class="c005"><span class="c007">(_</span>
<span class="c007">:</span></span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub><span class="c008">))</span>. It matches all values of type <span class="c008">[&lt;</span> <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> <span class="c008">]</span>.</p><!--TOC subsubsection id="sec112" Tuple patterns-->
<h4 class="subsubsection" id="sec112">Tuple patterns</h4><!--SEC END --><p>The pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">,</span> &#X2026; <span class="c008">,</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> matches <span class="c013">n</span>-tuples
whose components match the patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> through <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>. That
is, the pattern matches the tuple values (<span class="c013">v</span><sub>1</sub>, &#X2026;, <span class="c013">v</span><sub><span class="c013">n</span></sub>) such that
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub> matches <span class="c013">v</span><sub><span class="c013">i</span></sub> for <span class="c013">i</span> = 1,&#X2026; , <span class="c013">n</span>.</p><!--TOC subsubsection id="sec113" Record patterns-->
<h4 class="subsubsection" id="sec113">Record patterns</h4><!--SEC END --><p>The pattern <span class="c008">{</span> <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span>
&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">}</span> matches records that define at least the fields
<a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> through <a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub>, and such that the value associated to
<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">i</span></sub> matches the pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub>, for <span class="c013">i</span> = 1,&#X2026; , <span class="c013">n</span>.
The record value can define more fields than <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> &#X2026;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub>; the values associated to these extra fields are not taken
into account for matching.</p><!--TOC subsubsection id="sec114" Array patterns-->
<h4 class="subsubsection" id="sec114">Array patterns</h4><!--SEC END --><p>The pattern <span class="c008">[|</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">|]</span>
matches arrays of length <span class="c013">n</span> such that the <span class="c013">i</span>-th array element
matches the pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub>, for <span class="c013">i</span> = 1,&#X2026; , <span class="c013">n</span>.</p>
<!--TOC section id="s:value-expr" Expressions-->
<h2 class="section" id="s:value-expr">6.7&#XA0;&#XA0;Expressions</h2><!--SEC END --><!--NAME expr.html-->
<p>
<a id="hevea_manual.kwd8"></a>
<a id="hevea_manual.kwd9"></a>
<a id="hevea_manual.kwd10"></a>
<a id="hevea_manual.kwd11"></a>
<a id="hevea_manual.kwd12"></a>
<a id="hevea_manual.kwd13"></a>
<a id="hevea_manual.kwd14"></a>
<a id="hevea_manual.kwd15"></a>
<a id="hevea_manual.kwd16"></a>
<a id="hevea_manual.kwd17"></a>
<a id="hevea_manual.kwd18"></a>
<a id="hevea_manual.kwd19"></a>
<a id="hevea_manual.kwd20"></a>
<a id="hevea_manual.kwd21"></a>
<a id="hevea_manual.kwd22"></a>
<a id="hevea_manual.kwd23"></a>
<a id="hevea_manual.kwd24"></a>
<a id="hevea_manual.kwd25"></a>
<a id="hevea_manual.kwd26"></a>
<a id="hevea_manual.kwd27"></a>
<a id="hevea_manual.kwd28"></a>
<a id="hevea_manual.kwd29"></a>
<a id="hevea_manual.kwd30"></a>
<a id="hevea_manual.kwd31"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#value-path"><span class="c014">value-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#constant"><span class="c014">constant</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">begin</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{<span class="c008">,</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">::</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">[|</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">|]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">with</span>&#XA0;&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<a class="syntax" href="#argument"><span class="c014">argument</span></a>&#XA0;}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#prefix-symbol"><span class="c014">prefix-symbol</span></a>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">-</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">-.</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;<a class="syntax" href="#infix-op"><span class="c014">infix-op</span></a>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;<span class="c008">&lt;-</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.(</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.(</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">)</span>&#XA0;<span class="c008">&lt;-</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.[</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.[</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">]</span>&#XA0;<span class="c008">&lt;-</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">if</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">then</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;[&#XA0;<span class="c008">else</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">while</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">do</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">done</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">for</span>&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;(&#XA0;<span class="c008">to</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">downto</span>&#XA0;)&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">do</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">done</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">;</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">match</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">with</span>&#XA0;&#XA0;<a class="syntax" href="#pattern-matching"><span class="c014">pattern-matching</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">function</span>&#XA0;<a class="syntax" href="#pattern-matching"><span class="c014">pattern-matching</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">fun</span>&#XA0;<a class="syntax" href="#multiple-matching"><span class="c014">multiple-matching</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">try</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">with</span>&#XA0;&#XA0;<a class="syntax" href="#pattern-matching"><span class="c014">pattern-matching</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">let</span>&#XA0;[<span class="c008">rec</span>]&#XA0;<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a>&#XA0;}&#XA0;<span class="c008">in</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">new</span>&#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">object</span>&#XA0;<a class="syntax" href="#class-body"><span class="c014">class-body</span></a>&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">#</span>&#XA0;&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">&lt;-</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">:&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">:&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{&lt;</span>&#XA0;[&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;]&#XA0;<span class="c008">&gt;}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
</table></td></tr>
</table><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="argument"><span class="c014">argument</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">~</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">~</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="pattern-matching"><span class="c014">pattern-matching</span></a></td><td class="c022">::=</td><td class="c024">
[&#XA0;<span class="c008">|</span>&#XA0;]&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;[<span class="c008">when</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;{&#XA0;<span class="c008">|</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;[<span class="c008">when</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="multiple-matching"><span class="c014">multiple-matching</span></a></td><td class="c022">::=</td><td class="c024">
{&#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a>&#XA0;}<sup>+</sup>&#XA0;&#XA0;[<span class="c008">when</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="let-binding"><span class="c014">let-binding</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;&#XA0;{&#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;&#XA0;[<span class="c008">:&gt;</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="parameter"><span class="c014">parameter</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">~</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">~</span>&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">~</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">?</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">label-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;<span class="c008">(</span>&#XA0;&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;<span class="c008">)</span>
</td></tr>
</table></td></tr>
</table><p>The table below shows the relative precedences and associativity of
operators and non-closed constructions. The constructions with higher
precedence come first. For infix and prefix symbols, we write
&#X201C;<span class="c007">*</span>&#X2026;&#X201D; to mean &#X201C;any symbol starting with <span class="c007">*</span>&#X201D;.
<a id="hevea_manual.kwd32"></a><a id="hevea_manual.kwd33"></a><a id="hevea_manual.kwd34"></a><a id="hevea_manual.kwd35"></a><a id="hevea_manual.kwd36"></a><a id="hevea_manual.kwd37"></a><a id="hevea_manual.kwd38"></a></p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Construction or operator</span></td><td class="c021"><span class="c019">Associativity</span> </td></tr>
<tr><td class="c023">
prefix-symbol</td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">.   .(   .[   .{</span> (see section&#XA0;<a href="#s%3Abigarray-access">7.20</a>)</td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">#</span></td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023">function application, constructor application, tag
application, <span class="c007">assert</span> (see&#XA0;<a href="#s%3Aassert">7.5</a>),
<span class="c007">lazy</span> (see&#XA0;<a href="#s%3Alazy">7.6</a>)</td><td class="c023">left </td></tr>
<tr><td class="c023"><span class="c007">-   -.</span> (prefix)</td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">**</span>&#X2026;<span class="c007">   lsl   lsr   asr</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">*</span>&#X2026;<span class="c007">   /</span>&#X2026;<span class="c007">   %</span>&#X2026;<span class="c007">   mod   land   lor   lxor</span></td><td class="c023">left </td></tr>
<tr><td class="c023"> <span class="c007">+</span>&#X2026;<span class="c007">   -</span>&#X2026;</td><td class="c023">left </td></tr>
<tr><td class="c023"><span class="c007">::</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">@</span>&#X2026;<span class="c007">   ^</span>&#X2026;</td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">=</span>&#X2026;<span class="c007">   &lt;</span>&#X2026;<span class="c007">   &gt;</span>&#X2026;<span class="c007">   |</span>&#X2026;<span class="c007">   &amp;</span>&#X2026;<span class="c007">   $</span>&#X2026;<span class="c007">   !=</span></td><td class="c023">left </td></tr>
<tr><td class="c023"><span class="c007">&amp;   &amp;&amp;</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">or  ||</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">,</span></td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">&lt;-   :=</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">if</span></td><td class="c023">&#X2013; </td></tr>
<tr><td class="c023"><span class="c007">;</span></td><td class="c023">right </td></tr>
<tr><td class="c023"><span class="c007">let  match  fun  function  try</span></td><td class="c023">&#X2013; </td></tr>
</table></div>
<!--TOC subsection id="sec116" Basic expressions-->
<h3 class="subsection" id="sec116">6.7.1&#XA0;&#XA0;Basic expressions</h3><!--SEC END --><!--TOC subsubsection id="sec117" Constants-->
<h4 class="subsubsection" id="sec117">Constants</h4><!--SEC END --><p>An expression consisting in a constant evaluates to this constant.</p><!--TOC subsubsection id="expr:var" Value paths-->
<h4 class="subsubsection" id="expr:var">Value paths</h4><!--SEC END --><p>An expression consisting in an access path evaluates to the value bound to
this path in the current evaluation environment. The path can
be either a value name or an access path to a value component of a module.</p><!--TOC subsubsection id="sec119" Parenthesized expressions-->
<h4 class="subsubsection" id="sec119">Parenthesized expressions</h4><!--SEC END --><p>
<a id="hevea_manual.kwd39"></a>
<a id="hevea_manual.kwd40"></a></p><p>The expressions <span class="c008">(</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">)</span> and <span class="c008">begin</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">end</span> have the same
value as <a class="syntax" href="#expr"><span class="c014">expr</span></a>. The two constructs are semantically equivalent, but it
is good style to use <span class="c008">begin</span> &#X2026; <span class="c008">end</span> inside control structures:
</p><pre>
        if &#X2026; then begin &#X2026; ; &#X2026; end else begin &#X2026; ; &#X2026; end
</pre><p>
and <span class="c008">(</span> &#X2026; <span class="c008">)</span> for the other grouping situations.</p><p>Parenthesized expressions can contain a type constraint, as in <span class="c008">(</span>
<a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">)</span>. This constraint forces the type of <a class="syntax" href="#expr"><span class="c014">expr</span></a> to be
compatible with <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.</p><p>Parenthesized expressions can also contain coercions
<span class="c008">(</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> &#XA0;[<span class="c008">:</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>] <span class="c008">:&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><span class="c008">)</span> (see
subsection&#XA0;<a href="#s%3Acoercions">6.7.6</a> below).</p><!--TOC subsubsection id="sec120" Function application-->
<h4 class="subsubsection" id="sec120">Function application</h4><!--SEC END --><p>Function application is denoted by juxtaposition of (possibly labeled)
expressions. The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> &#XA0;<a class="syntax" href="#argument"><span class="c014">argument</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#argument"><span class="c014">argument</span></a><sub><span class="c013">n</span></sub>
evaluates the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> and those appearing in <a class="syntax" href="#argument"><span class="c014">argument</span></a><sub>1</sub>
to <a class="syntax" href="#argument"><span class="c014">argument</span></a><sub><span class="c013">n</span></sub>. The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> must evaluate to a
functional value <span class="c013">f</span>, which is then applied to the values of
<a class="syntax" href="#argument"><span class="c014">argument</span></a><sub>1</sub>, &#X2026;, &#XA0;<a class="syntax" href="#argument"><span class="c014">argument</span></a><sub><span class="c013">n</span></sub>.</p><p>The order in which the expressions <a class="syntax" href="#expr"><span class="c014">expr</span></a>, &#XA0;<a class="syntax" href="#argument"><span class="c014">argument</span></a><sub>1</sub>, &#X2026;,
&#XA0;<a class="syntax" href="#argument"><span class="c014">argument</span></a><sub><span class="c013">n</span></sub> are evaluated is not specified.</p><p>Arguments and parameters are matched according to their respective
labels. Argument order is irrelevant, except among arguments with the
same label, or no label.</p><p>If a parameter is specified as optional (label prefixed by <span class="c008">?</span>) in the
type of <a class="syntax" href="#expr"><span class="c014">expr</span></a>, the corresponding argument will be automatically
wrapped with the constructor <span class="c007">Some</span>, except if the argument itself is
also prefixed by <span class="c008">?</span>, in which case it is passed as is.
If a non-labeled argument is passed, and its corresponding parameter
is preceded by one or several optional parameters, then these
parameters are <em>defaulted</em>, <em>i.e.</em> the value <span class="c007">None</span> will be
passed for them.
All other missing parameters (without corresponding argument), both
optional and non-optional, will be kept, and the result of the
function will still be a function of these missing parameters to the
body of <span class="c013">f</span>.</p><p>As a special case, if the function has a known arity, all the
arguments are unlabeled, and their number matches the number of
non-optional parameters, then labels are ignored and non-optional
parameters are matched in their definition order. Optional arguments
are defaulted.</p><p>In all cases but exact match of order and labels, without optional
parameters, the function type should be known at the application
point. This can be ensured by adding a type constraint. Principality
of the derivation can be checked in the <span class="c007">-principal</span> mode.</p><!--TOC subsubsection id="sec121" Function definition-->
<h4 class="subsubsection" id="sec121">Function definition</h4><!--SEC END --><p>Two syntactic forms are provided to define functions. The first form
is introduced by the keyword <span class="c007">function</span>:
<a id="hevea_manual.kwd41"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025"><span class="c008">function</span></td><td class="c024"><span class="c018">pattern</span><sub>1</sub></td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c018">expr</span><sub>1</sub>&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024">&#X2026;&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024"><span class="c018">pattern</span><sub><span class="c013">n</span></sub></td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c018">expr</span><sub><span class="c013">n</span></sub>
</td></tr>
</table></td></tr>
</table><p>
This expression evaluates to a functional value with one argument.
When this function is applied to a value <span class="c013">v</span>, this value is
matched against each pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> to <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>.
If one of these matchings succeeds, that is, if the value <span class="c013">v</span>
matches the pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub> for some <span class="c013">i</span>,
then the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> associated to the selected pattern
is evaluated, and its value becomes the value of the function
application. The evaluation of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> takes place in an
environment enriched by the bindings performed during the matching.</p><p>If several patterns match the argument <span class="c013">v</span>, the one that occurs
first in the function definition is selected. If none of the patterns
matches the argument, the exception <span class="c007">Match_failure</span> is raised.
<a id="hevea_manual0"></a></p><p><br>
</p><p>The other form of function definition is introduced by the keyword <span class="c007">fun</span>:
<a id="hevea_manual.kwd42"></a>
</p><div class="center">
<span class="c008">fun</span> <a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub><span class="c013">n</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
This expression is equivalent to:
</p><div class="center">
<span class="c008">fun</span> <a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#X2026; <span class="c008">fun</span> &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub><span class="c013">n</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>The parameter patterns <span class="c008">~</span><a class="syntax" href="#label-name"><span class="c014">lab</span></a> and <span class="c008">~(</span><a class="syntax" href="#label-name"><span class="c014">lab</span></a> &#XA0;[<span class="c008">:</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>]<span class="c008">)</span>
are shorthands for respectively <span class="c008">~</span><a class="syntax" href="#label-name"><span class="c014">lab</span></a><span class="c008">:</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">lab</span></a> and
<span class="c008">~</span><a class="syntax" href="#label-name"><span class="c014">lab</span></a><span class="c008">:(</span>&#XA0;<a class="syntax" href="#label-name"><span class="c014">lab</span></a> &#XA0;[<span class="c008">:</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>]<span class="c008">)</span>, and similarly for their optional
counterparts.</p><p>A function of the form <span class="c005"><span class="c007">fun</span> <span class="c007">?</span></span> <a class="syntax" href="#label-name"><span class="c014">lab</span></a> <span class="c008">:(</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> is equivalent to
</p><div class="center">
<span class="c005"><span class="c007">fun</span> <span class="c007">?</span></span> <a class="syntax" href="#label-name"><span class="c014">lab</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c005"><span class="c007">-&gt;</span>
<span class="c007">let</span></span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a> <span class="c005"><span class="c007">=</span>
<span class="c007">match</span></span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c005"><span class="c007">with</span> <span class="c007">Some</span></span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c005"><span class="c007">|</span> <span class="c007">None</span> <span class="c007">-&gt;</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub>
<span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
where <a class="syntax" href="#ident"><span class="c014">ident</span></a>
is a fresh variable, except that it is unspecified when <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> is evaluated.</p><p>After these two transformations, expressions are of the form
</p><div class="center">
<span class="c008">fun</span> [<a class="syntax" href="#label"><span class="c014">label</span></a><sub>1</sub>] &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#X2026; <span class="c008">fun</span> &#XA0;[<a class="syntax" href="#label"><span class="c014">label</span></a><sub><span class="c013">n</span></sub>] &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
If we ignore labels, which will only be meaningful at function
application, this is equivalent to
</p><div class="center">
<span class="c008">function</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#X2026; <span class="c008">function</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
That is, the <span class="c008">fun</span> expression above evaluates to a curried function
with <span class="c013">n</span> arguments: after applying this function <span class="c013">n</span> times to the
values <span class="c014">v</span><sub>1</sub> &#X2026; <span class="c014">v</span><sub><span class="c013">n</span></sub>, the values will be matched
in parallel against the patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>.
If the matching succeeds, the function returns the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a> in
an environment enriched by the bindings performed during the matchings.
If the matching fails, the exception <span class="c007">Match_failure</span> is raised.</p><!--TOC subsubsection id="sec122" Guards in pattern-matchings-->
<h4 class="subsubsection" id="sec122">Guards in pattern-matchings</h4><!--SEC END --><p><a id="hevea_manual.kwd43"></a>
The cases of a pattern matching (in the <span class="c008">function</span>, <span class="c008">fun</span>, <span class="c008">match</span> and
<span class="c008">try</span> constructs) can include guard expressions, which are
arbitrary boolean expressions that must evaluate to <span class="c007">true</span> for the
match case to be selected. Guards occur just before the <span class="c008">-&gt;</span> token and
are introduced by the <span class="c008">when</span> keyword:</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025"><span class="c008">function</span></td><td class="c024"><span class="c014">pattern</span><sub>1</sub>&#XA0;&#XA0;&#XA0;[<span class="c008">when</span>&#XA0;&#XA0;&#XA0;<span class="c014">cond</span><sub>1</sub>]</td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c014">expr</span><sub>1</sub>&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024">&#X2026;&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024"><span class="c014">pattern</span><sub><span class="c013">n</span></sub>&#XA0;&#XA0;&#XA0;&#XA0;[<span class="c008">when</span>&#XA0;&#XA0;&#XA0;<span class="c014">cond</span><sub><span class="c013">n</span></sub>]</td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c014">expr</span><sub><span class="c013">n</span></sub>
</td></tr>
</table></td></tr>
</table><p>Matching proceeds as described before, except that if the value
matches some pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub> which has a guard <span class="c014">cond</span><sub><span class="c013">i</span></sub>, then the
expression <span class="c014">cond</span><sub><span class="c013">i</span></sub> is evaluated (in an environment enriched by the
bindings performed during matching). If <span class="c014">cond</span><sub><span class="c013">i</span></sub> evaluates to <span class="c007">true</span>,
then <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> is evaluated and its value returned as the result of the
matching, as usual. But if <span class="c014">cond</span><sub><span class="c013">i</span></sub> evaluates to <span class="c007">false</span>, the matching
is resumed against the patterns following <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub>.</p><!--TOC subsubsection id="s:localdef" Local definitions-->
<h4 class="subsubsection" id="s:localdef">Local definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd44"></a></p><p>The <span class="c008">let</span> and <span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> constructs bind value names locally.
The construct
</p><div class="center">
<span class="c008">let</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">and</span> &#X2026; <span class="c008">and</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
evaluates <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> in some unspecified order and matches
their values against the patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>. If the
matchings succeed, <a class="syntax" href="#expr"><span class="c014">expr</span></a> is evaluated in the environment enriched by
the bindings performed during matching, and the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a> is
returned as the value of the whole <span class="c008">let</span> expression. If one of the
matchings fails, the exception <span class="c007">Match_failure</span> is raised.
<a id="hevea_manual1"></a></p><p>An alternate syntax is provided to bind variables to functional
values: instead of writing
</p><div class="center">
<span class="c008">let</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c005"><span class="c007">=</span> <span class="c007">fun</span></span> &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub><span class="c013">m</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
in a <span class="c008">let</span> expression, one may instead write
</p><div class="center">
<span class="c008">let</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub><span class="c013">m</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p><br>
Recursive definitions of names are introduced by <span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span>:
</p><div class="center">
<span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">and</span> &#X2026; <span class="c008">and</span> &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>
<span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
The only difference with the <span class="c008">let</span> construct described above is
that the bindings of names to values performed by the
pattern-matching are considered already performed when the expressions
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> are evaluated. That is, the expressions <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>
to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> can reference identifiers that are bound by one of the
patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>, &#X2026;, &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>, and expect them to have the
same value as in <a class="syntax" href="#expr"><span class="c014">expr</span></a>, the body of the <span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> construct.</p><p>The recursive definition is guaranteed to behave as described above if
the expressions <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> are function definitions
(<span class="c008">fun</span> &#X2026; or <span class="c008">function</span> &#X2026;), and the patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub>
&#X2026; &#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub> are just value names, as in:
</p><div class="center">
<span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> <span class="c014">name</span><sub>1</sub> <span class="c005"><span class="c007">=</span> <span class="c007">fun</span></span> &#X2026;
<span class="c008">and</span> &#X2026;
<span class="c008">and</span> &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">=</span> <span class="c007">fun</span></span> &#X2026;
<span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
This defines <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> as mutually recursive functions
local to <a class="syntax" href="#expr"><span class="c014">expr</span></a>.</p><p>The behavior of other forms of <span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> definitions is
implementation-dependent. The current implementation also supports
a certain class of recursive definitions of non-functional values,
as explained in section&#XA0;<a href="#s%3Aletrecvalues">7.3</a>.</p>
<!--TOC subsection id="sec124" Control structures-->
<h3 class="subsection" id="sec124">6.7.2&#XA0;&#XA0;Control structures</h3><!--SEC END --><!--TOC subsubsection id="sec125" Sequence-->
<h4 class="subsubsection" id="sec125">Sequence</h4><!--SEC END --><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluates <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> first, then
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>, and returns the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>.</p><!--TOC subsubsection id="sec126" Conditional-->
<h4 class="subsubsection" id="sec126">Conditional</h4><!--SEC END --><p>
<a id="hevea_manual.kwd45"></a></p><p>The expression <span class="c008">if</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">then</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">else</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> evaluates to
the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> if <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> evaluates to the boolean <span class="c008">true</span>,
and to the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> if <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> evaluates to the boolean
<span class="c008">false</span>.</p><p>The <span class="c008">else</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> part can be omitted, in which case it defaults to
<span class="c005"><span class="c007">else</span> <span class="c007">()</span></span>.</p><!--TOC subsubsection id="sec127" Case expression-->
<h4 class="subsubsection" id="sec127">Case expression</h4><!--SEC END --><p><a id="hevea_manual.kwd46"></a></p><p>The expression
</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025"><span class="c008">match</span></td><td class="c024"><span class="c018">expr</span>&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">with</span></td><td class="c024"><span class="c018">pattern</span><sub>1</sub></td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c018">expr</span><sub>1</sub>&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024">&#X2026;&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024"><span class="c018">pattern</span><sub><span class="c013">n</span></sub></td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c018">expr</span><sub><span class="c013">n</span></sub>
</td></tr>
</table></td></tr>
</table><p>
matches the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a> against the patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> to
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>. If the matching against <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub> succeeds, the
associated expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> is evaluated, and its value becomes the
value of the whole <span class="c008">match</span> expression. The evaluation of
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> takes place in an environment enriched by the bindings
performed during matching. If several patterns match the value of
<a class="syntax" href="#expr"><span class="c014">expr</span></a>, the one that occurs first in the <span class="c008">match</span> expression is
selected. If none of the patterns match the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a>, the
exception <span class="c007">Match_failure</span> is raised.
<a id="hevea_manual2"></a></p><!--TOC subsubsection id="sec128" Boolean operators-->
<h4 class="subsubsection" id="sec128">Boolean operators</h4><!--SEC END --><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">&amp;&amp;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluates to <span class="c008">true</span> if both
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> and <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluate to <span class="c008">true</span>; otherwise, it evaluates to
<span class="c008">false</span>. The first component, <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>, is evaluated first. The
second component, <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>, is not evaluated if the first component
evaluates to <span class="c008">false</span>. Hence, the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">&amp;&amp;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> behaves
exactly as
</p><div class="center">
<span class="c008">if</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">then</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c005"><span class="c007">else</span> <span class="c007">false</span></span>.
</div><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">||</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluates to <span class="c008">true</span> if one of
the expressions
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> and <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluates to <span class="c008">true</span>; otherwise, it evaluates to
<span class="c008">false</span>. The first component, <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>, is evaluated first. The
second component, <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>, is not evaluated if the first component
evaluates to <span class="c008">true</span>. Hence, the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">||</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> behaves
exactly as
</p><div class="center">
<span class="c008">if</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c005"><span class="c007">then</span> <span class="c007">true</span> <span class="c007">else</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>.
</div><p><a id="hevea_manual.kwd47"></a>
The boolean operators <span class="c008">&amp;</span> and <span class="c008">or</span> are deprecated synonyms for
(respectively) <span class="c008">&amp;&amp;</span> and <span class="c008">||</span>.</p><!--TOC subsubsection id="sec129" Loops-->
<h4 class="subsubsection" id="sec129">Loops</h4><!--SEC END --><p><a id="hevea_manual.kwd48"></a>
The expression <span class="c008">while</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">do</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">done</span> repeatedly
evaluates <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> while <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> evaluates to <span class="c008">true</span>. The loop
condition <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> is evaluated and tested at the beginning of each
iteration. The whole <span class="c008">while</span> &#X2026; <span class="c008">done</span> expression evaluates to
the unit value <span class="c008">()</span>.</p><p><a id="hevea_manual.kwd49"></a>
The expression <span class="c005"><span class="c007">for</span> <span class="c014">name</span> <span class="c007">=</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">to</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">do</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> <span class="c008">done</span>
first evaluates the expressions <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> and <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> (the boundaries)
into integer values <span class="c013">n</span> and <span class="c013">p</span>. Then, the loop body <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> is
repeatedly evaluated in an environment where <span class="c014">name</span> is successively
bound to the values
<span class="c013">n</span>, <span class="c013">n</span>+1, &#X2026;, <span class="c013">p</span>&#X2212;1, <span class="c013">p</span>.
The loop body is never evaluated if <span class="c013">n</span> &gt; <span class="c013">p</span>.</p><p>The expression <span class="c005"><span class="c007">for</span> <span class="c014">name</span> <span class="c007">=</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">downto</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">do</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> <span class="c008">done</span>
evaluates similarly, except that <span class="c014">name</span> is successively bound to the values
<span class="c013">n</span>, <span class="c013">n</span>&#X2212;1, &#X2026;, <span class="c013">p</span>+1, <span class="c013">p</span>.
The loop body is never evaluated if <span class="c013">n</span> &lt; <span class="c013">p</span>.</p><p>In both cases, the whole <span class="c008">for</span> expression evaluates to the unit
value <span class="c008">()</span>.</p><!--TOC subsubsection id="sec130" Exception handling-->
<h4 class="subsubsection" id="sec130">Exception handling</h4><!--SEC END --><p>
<a id="hevea_manual.kwd50"></a></p><p>The expression
</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025"><span class="c008">try&#XA0;</span></td><td class="c024"><span class="c018">expr</span>&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">with</span></td><td class="c024"><span class="c018">pattern</span><sub>1</sub></td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c018">expr</span><sub>1</sub>&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024">&#X2026;&#XA0;</td></tr>
<tr><td class="c025"><span class="c008">|</span></td><td class="c024"><span class="c018">pattern</span><sub><span class="c013">n</span></sub></td><td class="c024"><span class="c008">-&gt;</span></td><td class="c024"><span class="c018">expr</span><sub><span class="c013">n</span></sub>
</td></tr>
</table></td></tr>
</table><p>
evaluates the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> and returns its value if the
evaluation of <a class="syntax" href="#expr"><span class="c014">expr</span></a> does not raise any exception. If the evaluation
of <a class="syntax" href="#expr"><span class="c014">expr</span></a> raises an exception, the exception value is matched against
the patterns <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub>1</sub> to <a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">n</span></sub>. If the matching against
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a><sub><span class="c013">i</span></sub> succeeds, the associated expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> is evaluated,
and its value becomes the value of the whole <span class="c008">try</span> expression. The
evaluation of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> takes place in an environment enriched by the
bindings performed during matching. If several patterns match the value of
<a class="syntax" href="#expr"><span class="c014">expr</span></a>, the one that occurs first in the <span class="c008">try</span> expression is
selected. If none of the patterns matches the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a>, the
exception value is raised again, thereby transparently &#X201C;passing
through&#X201D; the <span class="c008">try</span> construct.</p>
<!--TOC subsection id="sec131" Operations on data structures-->
<h3 class="subsection" id="sec131">6.7.3&#XA0;&#XA0;Operations on data structures</h3><!--SEC END --><!--TOC subsubsection id="sec132" Products-->
<h4 class="subsubsection" id="sec132">Products</h4><!--SEC END --><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">,</span> &#X2026; <span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> evaluates to the
<span class="c013">n</span>-tuple of the values of expressions <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>. The
evaluation order of the subexpressions is not specified.</p><!--TOC subsubsection id="sec133" Variants-->
<h4 class="subsubsection" id="sec133">Variants</h4><!--SEC END --><p>The expression <a class="syntax" href="#constr"><span class="c014">constr</span></a> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> evaluates to the unary variant value
whose constructor is <a class="syntax" href="#constr"><span class="c014">constr</span></a>, and whose argument is the value of
<a class="syntax" href="#expr"><span class="c014">expr</span></a>. Similarly, the expression <a class="syntax" href="#constr"><span class="c014">constr</span></a> <span class="c008">(</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">,</span> &#X2026; <span class="c008">,</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">)</span> evaluates to the n-ary variant value whose constructor is
<a class="syntax" href="#constr"><span class="c014">constr</span></a> and whose arguments are the values of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>, &#X2026;,
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>.</p><p>The expression <a class="syntax" href="#constr"><span class="c014">constr</span></a> <span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>, &#X2026;, &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub><span class="c008">)</span> evaluates to the
variant value whose constructor is <a class="syntax" href="#constr"><span class="c014">constr</span></a>, and whose arguments are
the values of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>.</p><p>For lists, some syntactic sugar is provided. The expression
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">::</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> stands for the constructor <span class="c005"><span class="c007">(</span> <span class="c007">::</span> <span class="c007">)</span></span> 
applied to the arguments <span class="c008">(</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">)</span>, and therefore
evaluates to the list whose head is the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> and whose tail
is the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>. The expression <span class="c008">[</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">]</span> is equivalent to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">::</span> &#X2026; <span class="c008">::</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">::</span>
<span class="c007">[]</span></span>, and therefore evaluates to the list whose elements are the
values of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>.</p><!--TOC subsubsection id="sec134" Polymorphic variants-->
<h4 class="subsubsection" id="sec134">Polymorphic variants</h4><!--SEC END --><p>The expression <span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> evaluates to the polymorphic variant
value whose tag is <a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a>, and whose argument is the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a>.</p><!--TOC subsubsection id="sec135" Records-->
<h4 class="subsubsection" id="sec135">Records</h4><!--SEC END --><p>The expression <span class="c008">{</span> <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">}</span> evaluates to the record value
{ <span class="c013">field</span><sub>1</sub> = <span class="c013">v</span><sub>1</sub>; &#X2026;; <span class="c013">field</span><sub><span class="c013">n</span></sub> = <span class="c013">v</span><sub><span class="c013">n</span></sub> }
where <span class="c013">v</span><sub><span class="c013">i</span></sub> is the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub> for <span class="c013">i</span> = 1,&#X2026; , <span class="c013">n</span>.
The fields <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> to <a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub> must all belong to the same record
type; each field of this record type must appear exactly
once in the record expression, though they can appear in any
order. The order in which <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> are evaluated is not
specified.</p><p>The expression
<span class="c008">{</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">with</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">}</span>
builds a fresh record with fields <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub> equal to
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>, and all other fields having the same value as
in the record <a class="syntax" href="#expr"><span class="c014">expr</span></a>. In other terms, it returns a shallow copy of
the record <a class="syntax" href="#expr"><span class="c014">expr</span></a>, except for the fields <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">n</span></sub>,
which are initialized to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>.</p><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a> evaluates <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to a record
value, and returns the value associated to <a class="syntax" href="#field"><span class="c014">field</span></a> in this record
value.</p><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a> <span class="c008">&lt;-</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluates <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to a record
value, which is then modified in-place by replacing the value
associated to <a class="syntax" href="#field"><span class="c014">field</span></a> in this record by the value of
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>. This operation is permitted only if <a class="syntax" href="#field"><span class="c014">field</span></a> has been
declared <span class="c008">mutable</span> in the definition of the record type. The whole
expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a> <span class="c008">&lt;-</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> evaluates to the unit value
<span class="c008">()</span>.</p><!--TOC subsubsection id="sec136" Arrays-->
<h4 class="subsubsection" id="sec136">Arrays</h4><!--SEC END --><p>The expression <span class="c008">[|</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">|]</span> evaluates to
a <span class="c013">n</span>-element array, whose elements are initialized with the values of
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> to <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> respectively. The order in which these
expressions are evaluated is unspecified.</p><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.(</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">)</span> returns the value of element
number <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> in the array denoted by <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>. The first element
has number 0; the last element has number <span class="c013">n</span>&#X2212;1, where <span class="c013">n</span> is the
size of the array. The exception <span class="c007">Invalid_argument</span> is raised if the
access is out of bounds.</p><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.(</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c005"><span class="c007">)</span> <span class="c007">&lt;-</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> modifies in-place
the array denoted by <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>, replacing element number <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> by
the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub>. The exception <span class="c007">Invalid_argument</span> is raised if
the access is out of bounds. The value of the whole expression is <span class="c008">()</span>.</p><!--TOC subsubsection id="sec137" Strings-->
<h4 class="subsubsection" id="sec137">Strings</h4><!--SEC END --><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.[</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c008">]</span> returns the value of character
number <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> in the string denoted by <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>. The first character
has number 0; the last character has number <span class="c013">n</span>&#X2212;1, where <span class="c013">n</span> is the
length of the string. The exception <span class="c007">Invalid_argument</span> is raised if the
access is out of bounds.</p><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">.[</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> <span class="c005"><span class="c007">]</span> <span class="c007">&lt;-</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> modifies in-place
the string denoted by <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>, replacing character number <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> by
the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub>. The exception <span class="c007">Invalid_argument</span> is raised if
the access is out of bounds. The value of the whole expression is <span class="c008">()</span>.</p>
<!--TOC subsection id="sec138" Operators-->
<h3 class="subsection" id="sec138">6.7.4&#XA0;&#XA0;Operators</h3><!--SEC END --><p>Symbols from the class <a class="syntax" href="#infix-symbol"><span class="c014">infix-symbol</span></a>, as well as the keywords
<span class="c008">*</span>, <span class="c008">+</span>, <span class="c008">-</span>, <span class="c008">-.</span>, <span class="c008">=</span>, <span class="c008">!=</span>, <span class="c008">&lt;</span>, <span class="c008">&gt;</span>, <span class="c008">or</span>, <span class="c008">||</span>,
<span class="c008">&amp;</span>, <span class="c008">&amp;&amp;</span>, <span class="c008">:=</span>, <span class="c008">mod</span>, <span class="c008">land</span>, <span class="c008">lor</span>, <span class="c008">lxor</span>, <span class="c008">lsl</span>, <span class="c008">lsr</span>,
and <span class="c008">asr</span> can appear in infix position (between two
expressions). Symbols from the class <a class="syntax" href="#prefix-symbol"><span class="c014">prefix-symbol</span></a>, as well as
the keywords <span class="c008">-</span> and <span class="c008">-.</span>
can appear in prefix position (in front of an expression).</p><p>Infix and prefix symbols do not have a fixed meaning: they are simply
interpreted as applications of functions bound to the names
corresponding to the symbols. The expression <a class="syntax" href="#prefix-symbol"><span class="c014">prefix-symbol</span></a> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> is
interpreted as the application <span class="c008">(</span> <a class="syntax" href="#prefix-symbol"><span class="c014">prefix-symbol</span></a> <span class="c008">)</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>. Similarly, the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#infix-symbol"><span class="c014">infix-symbol</span></a> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> is
interpreted as the application <span class="c008">(</span> <a class="syntax" href="#infix-symbol"><span class="c014">infix-symbol</span></a> <span class="c008">)</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>.</p><p>The table below lists the symbols defined in the initial environment
and their initial meaning. (See the description of the core
library module <span class="c007">Pervasives</span> in chapter&#XA0;<a href="#c%3Acorelib">20</a> for more
details). Their meaning may be changed at any time using
<span class="c005"><span class="c007">let</span> <span class="c007">(</span></span> <a class="syntax" href="#infix-op"><span class="c014">infix-op</span></a> <span class="c008">)</span> &#XA0;<span class="c014">name</span><sub>1</sub> &#XA0;<span class="c014">name</span><sub>2</sub> <span class="c008">=</span> &#X2026;</p><p>Note: the operators <span class="c008">&amp;&amp;</span>, <span class="c008">||</span>, and <span class="c008">~-</span> are handled specially
and it is not advisable to change their meaning.</p><p>The keywords <span class="c008">-</span> and <span class="c008">-.</span> can appear both as infix and
prefix operators. When they appear as prefix operators, they are
interpreted respectively as the functions <span class="c008">(~-)</span> and <span class="c008">(~-.)</span>.</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Operator</span></td><td class="c021"><span class="c019">Initial meaning</span> </td></tr>
<tr><td class="c029">
<span class="c007">+</span></td><td class="c028">Integer addition. </td></tr>
<tr><td class="c029"><span class="c007">-</span> (infix)</td><td class="c028">Integer subtraction. </td></tr>
<tr><td class="c029"><span class="c007">~-   -</span> (prefix)</td><td class="c028">Integer negation. </td></tr>
<tr><td class="c029"><span class="c007">*</span></td><td class="c028">Integer multiplication. </td></tr>
<tr><td class="c029"><span class="c007">/</span></td><td class="c028">Integer division.
Raise <span class="c007">Division_by_zero</span> if second argument is zero. </td></tr>
<tr><td class="c029"><span class="c007">mod</span></td><td class="c028">Integer modulus. Raise
<span class="c007">Division_by_zero</span> if second argument is zero. </td></tr>
<tr><td class="c029"><span class="c007">land</span></td><td class="c028">Bitwise logical &#X201C;and&#X201D; on integers. </td></tr>
<tr><td class="c029"><span class="c007">lor</span></td><td class="c028">Bitwise logical &#X201C;or&#X201D; on integers. </td></tr>
<tr><td class="c029"><span class="c007">lxor</span></td><td class="c028">Bitwise logical &#X201C;exclusive or&#X201D; on integers. </td></tr>
<tr><td class="c029"><span class="c007">lsl</span></td><td class="c028">Bitwise logical shift left on integers. </td></tr>
<tr><td class="c029"><span class="c007">lsr</span></td><td class="c028">Bitwise logical shift right on integers. </td></tr>
<tr><td class="c029"><span class="c007">asr</span></td><td class="c028">Bitwise arithmetic shift right on integers. </td></tr>
<tr><td class="c029"><span class="c007">+.</span></td><td class="c028">Floating-point addition. </td></tr>
<tr><td class="c029"><span class="c007">-.</span> (infix)</td><td class="c028">Floating-point subtraction. </td></tr>
<tr><td class="c029"><span class="c007">~-.   -.</span> (prefix)</td><td class="c028">Floating-point negation. </td></tr>
<tr><td class="c029"><span class="c007">*.</span></td><td class="c028">Floating-point multiplication. </td></tr>
<tr><td class="c029"><span class="c007">/.</span></td><td class="c028">Floating-point division. </td></tr>
<tr><td class="c029"><span class="c007">**</span></td><td class="c028">Floating-point exponentiation. </td></tr>
<tr><td class="c029"><span class="c007">@</span> </td><td class="c028">List concatenation. </td></tr>
<tr><td class="c029"><span class="c007">^</span> </td><td class="c028">String concatenation. </td></tr>
<tr><td class="c029"><span class="c007">!</span> </td><td class="c028">Dereferencing (return the current
contents of a reference). </td></tr>
<tr><td class="c029"><span class="c007">:=</span></td><td class="c028">Reference assignment (update the
reference given as first argument with the value of the second
argument). </td></tr>
<tr><td class="c029"><span class="c007">=</span> </td><td class="c028">Structural equality test. </td></tr>
<tr><td class="c029"><span class="c007">&lt;&gt;</span> </td><td class="c028">Structural inequality test. </td></tr>
<tr><td class="c029"><span class="c007">==</span> </td><td class="c028">Physical equality test. </td></tr>
<tr><td class="c029"><span class="c007">!=</span> </td><td class="c028">Physical inequality test. </td></tr>
<tr><td class="c029"><span class="c007">&lt;</span> </td><td class="c028">Test &#X201C;less than&#X201D;. </td></tr>
<tr><td class="c029"><span class="c007">&lt;=</span> </td><td class="c028">Test &#X201C;less than or equal&#X201D;. </td></tr>
<tr><td class="c029"><span class="c007">&gt;</span> </td><td class="c028">Test &#X201C;greater than&#X201D;. </td></tr>
<tr><td class="c029"><span class="c007">&gt;=</span> </td><td class="c028">Test &#X201C;greater than or equal&#X201D;. </td></tr>
<tr><td class="c029"><span class="c007">&amp;&amp;   &amp;</span></td><td class="c028">Boolean conjunction. </td></tr>
<tr><td class="c029"><span class="c007">||   or</span></td><td class="c028">Boolean disjunction. </td></tr>
</table></div>
<!--TOC subsection id="sec139" Objects-->
<h3 class="subsection" id="sec139">6.7.5&#XA0;&#XA0;Objects</h3><!--SEC END --><p> <a id="s:objects"></a></p><!--TOC subsubsection id="sec140" Object creation-->
<h4 class="subsubsection" id="sec140">Object creation</h4><!--SEC END --><p><a id="hevea_manual.kwd51"></a></p><p>When <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> evaluates to a class body, <span class="c008">new</span> <a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
evaluates to a new object containing the instance variables and
methods of this class.</p><p>When <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> evaluates to a class function, <span class="c008">new</span> <a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
evaluates to a function expecting the same number of arguments and
returning a new object of this class.</p><!--TOC subsubsection id="sec141" Immediate object creation-->
<h4 class="subsubsection" id="sec141">Immediate object creation</h4><!--SEC END --><p><a id="hevea_manual.kwd52"></a></p><p>Creating directly an object through the <span class="c008">object</span> <a class="syntax" href="#class-body"><span class="c014">class-body</span></a> <span class="c008">end</span>
construct is operationally equivalent to defining locally a <span class="c008">class</span>
<a class="syntax" href="#class-name"><span class="c014">class-name</span></a> <span class="c005"><span class="c007">=</span> <span class="c007">object</span></span> &#XA0;<a class="syntax" href="#class-body"><span class="c014">class-body</span></a> <span class="c008">end</span> &#X2014;see sections
<a href="#ss%3Aclass-body">6.9.2</a> and following for the syntax of <a class="syntax" href="#class-body"><span class="c014">class-body</span></a>&#X2014;
and immediately creating a single object from it by <span class="c008">new</span> <a class="syntax" href="#class-name"><span class="c014">class-name</span></a>.</p><p>The typing of immediate objects is slightly different from explicitly
defining a class in two respects. First, the inferred object type may
contain free type variables. Second, since the class body of an
immediate object will never be extended, its self type can be unified
with a closed object type.</p><!--TOC subsubsection id="sec142" Method invocation-->
<h4 class="subsubsection" id="sec142">Method invocation</h4><!--SEC END --><p>The expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">#</span> &#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a> invokes the method
<a class="syntax" href="#method-name"><span class="c014">method-name</span></a> of the object denoted by <a class="syntax" href="#expr"><span class="c014">expr</span></a>.</p><p>If <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> is a polymorphic method, its type should be known at
the invocation site. This is true for instance if <a class="syntax" href="#expr"><span class="c014">expr</span></a> is the name
of a fresh object (<span class="c008">let</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> = <span class="c008">new</span> &#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a> &#X2026; ) or if
there is a type constraint. Principality of the derivation can be
checked in the <span class="c007">-principal</span> mode.</p><!--TOC subsubsection id="sec143" Accessing and modifying instance variables-->
<h4 class="subsubsection" id="sec143">Accessing and modifying instance variables</h4><!--SEC END --><p>The instance variables of a class are visible only in the body of the
methods defined in the same class or a class that inherits from the
class defining the instance variables. The expression <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>
evaluates to the value of the given instance variable. The expression
<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">&lt;-</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> assigns the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a> to the instance
variable <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>, which must be mutable. The whole expression
<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">&lt;-</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> evaluates to <span class="c008">()</span>.</p><!--TOC subsubsection id="sec144" Object duplication-->
<h4 class="subsubsection" id="sec144">Object duplication</h4><!--SEC END --><p>An object can be duplicated using the library function <span class="c007">Oo.copy</span>
(see
<a href="libref/Oo.html">Module <span class="c007">Oo</span></a>). Inside a method, the expression
 <span class="c008">{&lt;</span> <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> &#XA0;{ <span class="c008">;</span> <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> } <span class="c008">&gt;}</span>
returns a copy of self with the given instance variables replaced by
the values of the associated expressions; other instance variables
have the same value in the returned object as in self.</p>
<!--TOC subsection id="sec145" Coercions-->
<h3 class="subsection" id="sec145">6.7.6&#XA0;&#XA0;Coercions</h3><!--SEC END --><p> <a id="s:coercions"></a></p><p>Expressions whose type contains object or polymorphic variant types
can be explicitly coerced (weakened) to a supertype.
The expression <span class="c008">(</span><a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><span class="c008">)</span> coerces the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a>
to type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.
The expression <span class="c008">(</span><a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">:&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub><span class="c008">)</span> coerces the
expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> from type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> to type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub>.</p><p>The former operator will sometimes fail to coerce an expression <a class="syntax" href="#expr"><span class="c014">expr</span></a>
from a type <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> to a type <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>
even if type <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> is a subtype of type
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>: in the current implementation it only expands two levels of
type abbreviations containing objects and/or polymorphic variants,
keeping only recursion when it is explicit in the class type (for objects).
As an exception to the above algorithm, if both the inferred type of <a class="syntax" href="#expr"><span class="c014">expr</span></a>
and <a class="syntax" href="#typexpr"><span class="c014">typ</span></a> are ground (<em>i.e.</em> do not contain type variables), the
former operator behaves as the latter one, taking the inferred type of
<a class="syntax" href="#expr"><span class="c014">expr</span></a> as <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub>. In case of failure with the former operator,
the latter one should be used.</p><p>It is only possible to coerce an expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> from type
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> to type <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>, if the type of <a class="syntax" href="#expr"><span class="c014">expr</span></a> is an instance of
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> (like for a type annotation), and <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> is a subtype
of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>. The type of the coerced expression is an
instance of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>. If the types contain variables,
they may be instantiated by the subtyping algorithm, but this is only
done after determining whether <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> is a potential subtype of
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>. This means that typing may fail during this latter
unification step, even if some instance of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> is a subtype of
some instance of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub>.
In the following paragraphs we describe the subtyping relation used.</p><!--TOC subsubsection id="sec146" Object types-->
<h4 class="subsubsection" id="sec146">Object types</h4><!--SEC END --><p>A fixed object type admits as subtype any object type that includes all
its methods. The types of the methods shall be subtypes of those in
the supertype. Namely,
</p><div class="center">
 <span class="c008">&lt;</span> <a class="syntax" href="#method-name"><span class="c014">met</span></a><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#method-name"><span class="c014">met</span></a><sub><span class="c013">n</span></sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub><span class="c013">n</span></sub> <span class="c008">&gt;</span> 
</div><p>
is a supertype of
</p><div class="center">
 <span class="c008">&lt;</span> <a class="syntax" href="#method-name"><span class="c014">met</span></a><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> <a class="syntax" href="#method-name"><span class="c014">met</span></a><sub><span class="c013">n</span></sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">n</span></sub> <span class="c008">;</span>
<a class="syntax" href="#method-name"><span class="c014">met</span></a><sub><span class="c013">n</span>+1</sub> <span class="c008">:</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">n</span>+1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> <a class="syntax" href="#method-name"><span class="c014">met</span></a><sub><span class="c013">n</span>+<span class="c013">m</span></sub> <span class="c008">:</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">n</span>+<span class="c013">m</span></sub>
&#XA0;[<span class="c005"><span class="c007">;</span> <span class="c007">..</span></span>] <span class="c008">&gt;</span> 
</div><p>
which may contain an ellipsis <span class="c007">..</span> if every <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub><span class="c013">i</span></sub> is a supertype of
the corresponding <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">i</span></sub>.</p><p>A monomorphic method type can be a supertype of a polymorphic method
type. Namely, if <a class="syntax" href="#typexpr"><span class="c014">typ</span></a> is an instance of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;, then  <span class="c008">'</span><span class="c014">a</span><sub>1</sub>
&#X2026; <span class="c008">'</span><span class="c014">a</span><sub><span class="c013">n</span></sub> <span class="c008">.</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032; is a subtype of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>.</p><p>Inside a class definition, newly defined types are not available for
subtyping, as the type abbreviations are not yet completely
defined. There is an exception for coercing <span class="c014">self</span> to the (exact)
type of its class: this is allowed if the type of <span class="c014">self</span> does not
appear in a contravariant position in the class type, <em>i.e.</em> if
there are no binary methods.</p><!--TOC subsubsection id="sec147" Polymorphic variant types-->
<h4 class="subsubsection" id="sec147">Polymorphic variant types</h4><!--SEC END --><p>A polymorphic variant type <a class="syntax" href="#typexpr"><span class="c014">typ</span></a> is a subtype of another polymorphic
variant type <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032; if the upper bound of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a> (<em>i.e.</em> the
maximum set of constructors that may appear in an instance of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>)
is included in the lower bound of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;, and the types of arguments
for the constructors of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a> are subtypes of those in
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;. Namely,
</p><div class="center">
 <span class="c008">[</span>[<span class="c008">&lt;</span>] <span class="c008">`</span><a class="syntax" href="#constr-name"><span class="c014">C</span></a><sub>1</sub> <span class="c008">of</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> <span class="c008">|</span> &#X2026; <span class="c005"><span class="c007">|</span> <span class="c007">`</span></span>&#XA0;<a class="syntax" href="#constr-name"><span class="c014">C</span></a><sub><span class="c013">n</span></sub> <span class="c008">of</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub><span class="c013">n</span></sub> <span class="c008">]</span> 
</div><p>
which may be a shrinkable type, is a subtype of
</p><div class="center">
 <span class="c008">[</span>[<span class="c008">&gt;</span>] <span class="c008">`</span><a class="syntax" href="#constr-name"><span class="c014">C</span></a><sub>1</sub> <span class="c008">of</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>1</sub> <span class="c008">|</span> &#X2026; <span class="c005"><span class="c007">|</span> <span class="c007">`</span></span><a class="syntax" href="#constr-name"><span class="c014">C</span></a><sub><span class="c013">n</span></sub> <span class="c008">of</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">n</span></sub>
<span class="c005"><span class="c007">|</span> <span class="c007">`</span></span><a class="syntax" href="#constr-name"><span class="c014">C</span></a><sub><span class="c013">n</span>+1</sub> <span class="c008">of</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">n</span>+1</sub> <span class="c008">|</span> &#X2026; <span class="c005"><span class="c007">|</span> <span class="c007">`</span></span><a class="syntax" href="#constr-name"><span class="c014">C</span></a><sub><span class="c013">n</span>+<span class="c013">m</span></sub> <span class="c008">of</span>
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">n</span>+<span class="c013">m</span></sub> <span class="c008">]</span> 
</div><p>
which may be an extensible type, if every <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub><span class="c013">i</span></sub> is a subtype of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub><span class="c013">i</span></sub>.</p><!--TOC subsubsection id="sec148" Variance-->
<h4 class="subsubsection" id="sec148">Variance</h4><!--SEC END --><p>Other types do not introduce new subtyping, but they may propagate the
subtyping of their arguments. For instance, <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> <span class="c008">*</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub> is a
subtype of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>1</sub> <span class="c008">*</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>2</sub> when <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> and <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub> are
respectively subtypes of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>1</sub> and <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>2</sub>.
For function types, the relation is more subtle:
<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub> is a subtype of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>1</sub>&#XA0;<span class="c008">-&gt;</span> <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>2</sub>
if <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>1</sub> is a supertype of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>1</sub> and <a class="syntax" href="#typexpr"><span class="c014">typ</span></a><sub>2</sub> is a
subtype of <a class="syntax" href="#typexpr"><span class="c014">typ</span></a>&#X2032;<sub>2</sub>. For this reason, function types are covariant in
their second argument (like tuples), but contravariant in their first
argument. Mutable types, like <span class="c007">array</span> or <span class="c007">ref</span> are neither covariant
nor contravariant, they are nonvariant, that is they do not propagate
subtyping.</p><p>For user-defined types, the variance is automatically inferred: a
parameter is covariant if it has only covariant occurences,
contravariant if it has only contravariant occurences,
variance-free if it has no occurences, and nonvariant otherwise.
A variance-free parameter may change freely through subtyping, it does
not have to be a subtype or a supertype.
For abstract and private types, the variance must be given explicitly
(see section&#XA0;<a href="#s%3Atype-defs">6.8.1</a>),
otherwise the default is nonvariant. This is also the case for
constrained arguments in type definitions.</p>
<!--TOC section id="sec149" Type and exception definitions-->
<h2 class="section" id="sec149">6.8&#XA0;&#XA0;Type and exception definitions</h2><!--SEC END --><!--NAME typedecl.html-->

<!--TOC subsection id="sec150" Type definitions-->
<h3 class="subsection" id="sec150">6.8.1&#XA0;&#XA0;Type definitions</h3><!--SEC END --><p>
<a id="s:type-defs"></a></p><p>Type definitions bind type constructors to data types: either
variant types, record types, type abbreviations, or abstract data
types. They also bind the value constructors and record fields
associated with the definition.</p><p><a id="hevea_manual.kwd53"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="type-definition"><span class="c014">type-definition</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">type</span>&#XA0;<a class="syntax" href="#typedef"><span class="c014">typedef</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#typedef"><span class="c014">typedef</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="typedef"><span class="c014">typedef</span></a></td><td class="c022">::=</td><td class="c024">
[<a class="syntax" href="#type-params"><span class="c014">type-params</span></a>]&#XA0;&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>&#XA0;&#XA0;<a class="syntax" href="#type-information"><span class="c014">type-information</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-information"><span class="c014">type-information</span></a></td><td class="c022">::=</td><td class="c024">
[<a class="syntax" href="#type-equation"><span class="c014">type-equation</span></a>]&#XA0;&#XA0;[<a class="syntax" href="#type-representation"><span class="c014">type-representation</span></a>]&#XA0;&#XA0;{&#XA0;<a class="syntax" href="#type-constraint"><span class="c014">type-constraint</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-equation"><span class="c014">type-equation</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">=</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-representation"><span class="c014">type-representation</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">=</span>&#XA0;[<span class="c008">|</span>]&#XA0;<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">|</span>&#XA0;<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">=</span>&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-params"><span class="c014">type-params</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#type-param"><span class="c014">type-param</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#type-param"><span class="c014">type-param</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<a class="syntax" href="#type-param"><span class="c014">type-param</span></a>&#XA0;}&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-param"><span class="c014">type-param</span></a></td><td class="c022">::=</td><td class="c024">
[<a class="syntax" href="#variance"><span class="c014">variance</span></a>]&#XA0;<span class="c008">'</span>&#XA0;&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="variance"><span class="c014">variance</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">+</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">-</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="constr-decl"><span class="c014">constr-decl</span></a></td><td class="c022">::=</td><td class="c024">
(<a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">()</span>)&#XA0;[&#XA0;<span class="c008">of</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">*</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}&#XA0;]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="field-decl"><span class="c014">field-decl</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">mutable</span>]&#XA0;<a class="syntax" href="#field-name"><span class="c014">field-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-constraint"><span class="c014">type-constraint</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">constraint</span>&#XA0;<span class="c008">'</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
</td></tr>
</table></td></tr>
</table><p>
<a id="hevea_manual.kwd54"></a>
<a id="hevea_manual.kwd55"></a></p><p>Type definitions are introduced by the <span class="c007">type</span> keyword, and
consist in one or several simple definitions, possibly mutually
recursive, separated by the <span class="c007">and</span> keyword. Each simple definition
defines one type constructor.</p><p>A simple definition consists in a lowercase identifier, possibly
preceded by one or several type parameters, and followed by an
optional type equation, then an optional type representation, and then
a constraint clause. The identifier is the name of the type
constructor being defined.</p><p>The optional type parameters are either one type variable <span class="c008">'</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a>,
for type constructors with one parameter, or a list of type variables
<span class="c008">('</span><a class="syntax" href="#ident"><span class="c014">ident</span></a><sub>1</sub>,&#X2026;,<span class="c008">'</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a><sub><span class="c013">n</span></sub><span class="c008">)</span>, for type constructors with several
parameters. Each type parameter may be prefixed by a variance
constraint <span class="c008">+</span> (resp. <span class="c008">-</span>) indicating that the parameter is
covariant (resp. contravariant). These type parameters can appear in
the type expressions of the right-hand side of the definition,
optionally restricted by a variance constraint ; <em>i.e.</em> a
covariant parameter may only appear on the right side of a functional
arrow (more precisely, follow the left branch of an even number of
arrows), and a contravariant parameter only the left side (left branch of
an odd number of arrows). If the type has a representation or
an equation, and the parameter is free (<em>i.e.</em> not bound via a
type constraint to a constructed type), its variance constraint is
checked but subtyping <em>etc.</em> will use the inferred variance of the
parameter, which may be less restrictive; otherwise (<em>i.e.</em> for abstract
types or non-free parameters), the variance must be given explicitly,
and the parameter is invariant if no variance is given.</p><p>The optional type equation <span class="c008">=</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> makes the defined type
equivalent to the type expression <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>:
one can be substituted for the other during typing.
If no type equation is given, a new type is generated: the defined type
is incompatible with any other type.</p><p>The optional type representation describes the data structure
representing the defined type, by giving the list of associated
constructors (if it is a variant type) or associated fields (if it is
a record type). If no type representation is given, nothing is
assumed on the structure of the type besides what is stated in the
optional type equation.</p><p>The type representation <span class="c008">=</span> [<span class="c008">|</span>] <a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a> &#XA0;{ <span class="c008">|</span> <a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a> }
describes a variant type. The constructor declarations
<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a><sub>1</sub>, &#X2026;, &#XA0;<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a><sub><span class="c013">n</span></sub> describe the constructors
associated to this variant type. The constructor
declaration <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a> <span class="c008">of</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">*</span> &#X2026; <span class="c008">*</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>
declares the name <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a> as a non-constant constructor, whose
arguments have types <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> &#X2026;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>.
The constructor declaration <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>
declares the name <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a> as a constant
constructor. Constructor names must be capitalized.</p><p>The type representation <span class="c005"><span class="c007">=</span> <span class="c007">{</span></span> <a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a> &#XA0;{ <span class="c008">;</span> <a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a> } &#XA0;[<span class="c008">;</span>] <span class="c008">}</span>
describes a record type. The field declarations <a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a><sub>1</sub>, &#X2026;,
&#XA0;<a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a><sub><span class="c013">n</span></sub> describe the fields associated to this record type.
The field declaration <a class="syntax" href="#field-name"><span class="c014">field-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a> declares
<a class="syntax" href="#field-name"><span class="c014">field-name</span></a> as a field whose argument has type <a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>.
The field declaration <span class="c008">mutable</span> <a class="syntax" href="#field-name"><span class="c014">field-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
<a id="hevea_manual.kwd56"></a>
behaves similarly; in addition, it allows physical modification of
this field.
Immutable fields are covariant, mutable fields are non-variant.
Both mutable and immutable fields may have a explicitly polymorphic
types. The polymorphism of the contents is statically checked whenever
a record value is created or modified. Extracted values may have their
types instantiated.</p><p>The two components of a type definition, the optional equation and the
optional representation, can be combined independently, giving
rise to four typical situations:</p><dl class="description"><dt class="dt-description">
<span class="c019">Abstract type: no equation, no representation.</span></dt><dd class="dd-description"> &#XA0;<br>
When appearing in a module signature, this definition specifies
nothing on the type constructor, besides its number of parameters:
its representation is hidden and it is assumed incompatible with any
other type.</dd><dt class="dt-description"><span class="c019">Type abbreviation: an equation, no representation.</span></dt><dd class="dd-description"> &#XA0;<br>
This defines the type constructor as an abbreviation for the type
expression on the right of the <span class="c008">=</span> sign.</dd><dt class="dt-description"><span class="c019">New variant type or record type: no equation, a representation.</span></dt><dd class="dd-description"> &#XA0;<br>
This generates a new type constructor and defines associated
constructors or fields, through which values of that type can be
directly built or inspected.</dd><dt class="dt-description"><span class="c019">Re-exported variant type or record type: an equation,
a representation.</span></dt><dd class="dd-description"> &#XA0;<br>
In this case, the type constructor is defined as an abbreviation for
the type expression given in the equation, but in addition the
constructors or fields given in the representation remain attached to
the defined type constructor. The type expression in the equation part
must agree with the representation: it must be of the same kind
(record or variant) and have exactly the same constructors or fields,
in the same order, with the same arguments.
</dd></dl><p>The type variables appearing as type parameters can optionally be
prefixed by <span class="c007">+</span> or <span class="c007">-</span> to indicate that the type constructor is
covariant or contravariant with respect to this parameter. This
variance information is used to decide subtyping relations when
checking the validity of <span class="c008">:&gt;</span> coercions (see section <a href="#s%3Acoercions">6.7.6</a>).</p><p>For instance, <span class="c007">type +'a t</span> declares <span class="c007">t</span> as an abstract type that is
covariant in its parameter; this means that if the type &#X3C4; is a
subtype of the type &#X3C3;, then &#X3C4; <span class="c009"> t</span> is a subtype of &#X3C3;
<span class="c009"> t</span>. Similarly, <span class="c007">type -'a t</span> declares that the abstract type <span class="c007">t</span> is
contravariant in its parameter: if &#X3C4; is a subtype of &#X3C3;, then
&#X3C3; <span class="c009"> t</span> is a subtype of &#X3C4; <span class="c009"> t</span>. If no <span class="c007">+</span> or <span class="c007">-</span> variance
annotation is given, the type constructor is assumed non-variant in the
corresponding parameter. For instance, the abstract type declaration
<span class="c007">type 'a t</span> means that &#X3C4; <span class="c009"> t</span> is neither a subtype nor a
supertype of &#X3C3; <span class="c009"> t</span> if &#X3C4; is subtype of &#X3C3;.</p><p>The variance indicated by the <span class="c007">+</span> and <span class="c007">-</span> annotations on parameters
are required only for abstract types. For abbreviations, variant
types or record types, the variance properties of the type constructor
are inferred from its definition, and the variance annotations are
only checked for conformance with the definition.</p><p><a id="hevea_manual.kwd57"></a>
The construct  <span class="c005"><span class="c007">constraint</span> <span class="c007">'</span></span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>  allows the
specification of
type parameters. Any actual type argument corresponding to the type
parameter <a class="syntax" href="#ident"><span class="c014">ident</span></a> has to be an instance of <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> (more precisely,
<a class="syntax" href="#ident"><span class="c014">ident</span></a> and <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> are unified). Type variables of <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> can
appear in the type equation and the type declaration.</p>
<!--TOC subsection id="sec151" Exception definitions-->
<h3 class="subsection" id="sec151">6.8.2&#XA0;&#XA0;Exception definitions</h3><!--SEC END --><p> <a id="s:excdef"></a>
<a id="hevea_manual.kwd58"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="exception-definition"><span class="c014">exception-definition</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">exception</span>&#XA0;<a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>&#XA0;&#XA0;[&#XA0;<span class="c008">of</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">*</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}&#XA0;]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">exception</span>&#XA0;<a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>
</td></tr>
</table></td></tr>
</table><p>Exception definitions add new constructors to the built-in variant
type <code>exn</code> of exception values. The constructors are declared as
for a definition of a variant type.</p><p>The form <span class="c008">exception</span> <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a> &#XA0;[<span class="c008">of</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> &#XA0;{<span class="c008">*</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>}]
generates a new exception, distinct from all other exceptions in the system.
The form <span class="c008">exception</span> <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>
gives an alternate name to an existing exception.

</p>
<!--TOC section id="sec152" Classes-->
<h2 class="section" id="sec152">6.9&#XA0;&#XA0;Classes</h2><!--SEC END --><!--NAME classes.html-->
<p>
Classes are defined using a small language, similar to the module
language.</p>
<!--TOC subsection id="sec153" Class types-->
<h3 class="subsection" id="sec153">6.9.1&#XA0;&#XA0;Class types</h3><!--SEC END --><p>Class types are the class-level equivalent of type expressions: they
specify the general shape and type properties of classes.</p><p><a id="hevea_manual.kwd59"></a>
<a id="hevea_manual.kwd60"></a>
<a id="hevea_manual.kwd61"></a>
<a id="hevea_manual.kwd62"></a>
<a id="hevea_manual.kwd63"></a>
<a id="hevea_manual.kwd64"></a>
<a id="hevea_manual.kwd65"></a>
<a id="hevea_manual.kwd66"></a>
<a id="hevea_manual.kwd67"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="class-type"><span class="c014">class-type</span></a></td><td class="c022">::=</td><td class="c024">
{[[<span class="c008">?</span>]<a class="syntax" href="#label-name"><span class="c014">label-name</span></a><span class="c008">:</span>]&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">-&gt;</span>}&#XA0;&#XA0;<a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="class-body-type"><span class="c014">class-body-type</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">object</span>&#XA0;[<span class="c008">(</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">)</span>]&#XA0;&#XA0;{<a class="syntax" href="#class-field-spec"><span class="c014">class-field-spec</span></a>}&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;[<span class="c008">[</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{<span class="c008">,</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>}&#XA0;<span class="c008">]</span>]&#XA0;&#XA0;<a class="syntax" href="#classtype-path"><span class="c014">classtype-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="class-field-spec"><span class="c014">class-field-spec</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">inherit</span>&#XA0;<a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">val</span>&#XA0;[<span class="c008">mutable</span>]&#XA0;[<span class="c008">virtual</span>]&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">val</span>&#XA0;<span class="c008">virtual</span>&#XA0;<span class="c008">mutable</span>&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method</span>&#XA0;[<span class="c008">private</span>]&#XA0;[<span class="c008">virtual</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method</span>&#XA0;<span class="c008">virtual</span>&#XA0;<span class="c008">private</span>&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">constraint</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
</td></tr>
</table></td></tr>
</table><!--TOC subsubsection id="sec154" Simple class expressions-->
<h4 class="subsubsection" id="sec154">Simple class expressions</h4><!--SEC END --><p>The expression <a class="syntax" href="#classtype-path"><span class="c014">classtype-path</span></a> is equivalent to the class type bound to
the name <a class="syntax" href="#classtype-path"><span class="c014">classtype-path</span></a>. Similarly, the expression
<span class="c008">[</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">,</span> &#X2026; &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub> <span class="c008">]</span> &#XA0;<a class="syntax" href="#classtype-path"><span class="c014">classtype-path</span></a> is equivalent to
the parametric class type bound to the name <a class="syntax" href="#classtype-path"><span class="c014">classtype-path</span></a>, in which
type parameters have been instantiated to respectively <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub>,
&#X2026;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>.</p><!--TOC subsubsection id="sec155" Class function type-->
<h4 class="subsubsection" id="sec155">Class function type</h4><!--SEC END --><p>The class type expression <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#class-type"><span class="c014">class-type</span></a> is the type of
class functions (functions from values to classes) that take as
argument a value of type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> and return as result a class of
type <a class="syntax" href="#class-type"><span class="c014">class-type</span></a>.</p><!--TOC subsubsection id="sec156" Class body type-->
<h4 class="subsubsection" id="sec156">Class body type</h4><!--SEC END --><p>The class type expression
<span class="c008">object</span> [<span class="c008">(</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">)</span>] &#XA0;{<a class="syntax" href="#class-field-spec"><span class="c014">class-field-spec</span></a>} <span class="c008">end</span>
is the type of a class body. It specifies its instance variables and
methods. In this type, <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> is matched against the self type, therefore
providing a name for the self type.</p><p>A class body will match a class body type if it provides definitions
for all the components specified in the class body type, and these
definitions meet the type requirements given in the class body type.
Furthermore, all methods either virtual or public present in the class
body must also be present in the class body type (on the other hand, some
instance variables and concrete private methods may be omitted). A
virtual method will match a concrete method, which makes it possible
to forget its implementation. An immutable instance variable will match a
mutable instance variable.</p><!--TOC subsubsection id="sec157" Inheritance-->
<h4 class="subsubsection" id="sec157">Inheritance</h4><!--SEC END --><p><a id="hevea_manual.kwd68"></a></p><p>The inheritance construct <span class="c008">inherit</span> <a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a> provides for inclusion of
methods and instance variables from other class types.
The instance variable and method types from <a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a> are added
into the current class type.</p><!--TOC subsubsection id="sec158" Instance variable specification-->
<h4 class="subsubsection" id="sec158">Instance variable specification</h4><!--SEC END --><p><a id="hevea_manual.kwd69"></a>
<a id="hevea_manual.kwd70"></a>
<a id="hevea_manual.kwd71"></a></p><p>A specification of an instance variable is written
<span class="c008">val</span> [<span class="c008">mutable</span>] [<span class="c008">virtual</span>] <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>, where
<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>
is the name of the instance variable and <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> its expected type.
The flag <span class="c008">mutable</span> indicates whether this instance variable can be
physically modified.
The flag <span class="c008">virtual</span> indicates that this instance variable is not
initialized. It can be initialized later through inheritance.</p><p>An instance variable specification will hide any previous
specification of an instance variable of the same name.</p><!--TOC subsubsection id="sec-methspec" Method specification-->
<h4 class="subsubsection" id="sec-methspec">Method specification</h4><!--SEC END --><p><a id="hevea_manual.kwd72"></a>
<a id="hevea_manual.kwd73"></a></p><p>The specification of a method is written
<span class="c008">method</span> [<span class="c008">private</span>] <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>, where
<a class="syntax" href="#method-name"><span class="c014">method-name</span></a> is the name of the method and <a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a> its
expected type, possibly polymorphic. The flag <span class="c008">private</span> indicates
that the method cannot be accessed from outside the object.</p><p>The polymorphism may be left implicit in public method specifications:
any type variable which is not bound to a class parameter and does not
appear elsewhere inside the class specification will be assumed to be
universal, and made polymorphic in the resulting method type.
Writing an explicit polymorphic type will disable this behaviour.</p><p>If several specifications are present for the same method, they
must have compatible types.
Any non-private specification of a method forces it to be public.</p><!--TOC subsubsection id="sec160" Virtual method specification-->
<h4 class="subsubsection" id="sec160">Virtual method specification</h4><!--SEC END --><p><a id="hevea_manual.kwd74"></a>
<a id="hevea_manual.kwd75"></a>
<a id="hevea_manual.kwd76"></a></p><p>A virtual method specification is written <span class="c008">method</span> [<span class="c008">private</span>]
<span class="c008">virtual</span> <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>, where <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> is the
name of the method and <a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a> its expected type.</p><!--TOC subsubsection id="sec161" Constraints on type parameters-->
<h4 class="subsubsection" id="sec161">Constraints on type parameters</h4><!--SEC END --><p><a id="hevea_manual.kwd77"></a></p><p>The construct <span class="c008">constraint</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub> forces the two
type expressions to be equal. This is typically used to specify type
parameters: in this way, they can be bound to specific type
expressions.</p>
<!--TOC subsection id="sec162" Class expressions-->
<h3 class="subsection" id="sec162">6.9.2&#XA0;&#XA0;Class expressions</h3><!--SEC END --><p>Class expressions are the class-level equivalent of value expressions:
they evaluate to classes, thus providing implementations for the
specifications expressed in class types.</p><p><a id="hevea_manual.kwd78"></a>
<a id="hevea_manual.kwd79"></a>
<a id="hevea_manual.kwd80"></a>
<a id="hevea_manual.kwd81"></a>
<a id="hevea_manual.kwd82"></a>
<a id="hevea_manual.kwd83"></a>
<a id="hevea_manual.kwd84"></a>
<a id="hevea_manual.kwd85"></a>
<a id="hevea_manual.kwd86"></a>
<a id="hevea_manual.kwd87"></a>
<a id="hevea_manual.kwd88"></a>
<a id="hevea_manual.kwd89"></a>
<a id="hevea_manual.kwd90"></a>
<a id="hevea_manual.kwd91"></a>
<a id="hevea_manual.kwd92"></a>
<a id="hevea_manual.kwd93"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="class-expr"><span class="c014">class-expr</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">[</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{<span class="c008">,</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>}&#XA0;<span class="c008">]</span>&#XA0;&#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#class-type"><span class="c014">class-type</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>&#XA0;&#XA0;{<a class="syntax" href="#argument"><span class="c014">argument</span></a>}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">fun</span>&#XA0;{<a class="syntax" href="#parameter"><span class="c014">parameter</span></a>}<sup>+</sup>&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">let</span>&#XA0;[<span class="c008">rec</span>]&#XA0;<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a>&#XA0;&#XA0;{<span class="c008">and</span>&#XA0;<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a>}&#XA0;<span class="c008">in</span>&#XA0;&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">object</span>&#XA0;<a class="syntax" href="#class-body"><span class="c014">class-body</span></a>&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
</table></td></tr>
</table><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="class-field"><span class="c014">class-field</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">inherit</span>&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>&#XA0;&#XA0;[<span class="c008">as</span>&#XA0;<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">val</span>&#XA0;[<span class="c008">mutable</span>]&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">val</span>&#XA0;[<span class="c008">mutable</span>]&#XA0;<span class="c008">virtual</span>&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">val</span>&#XA0;<span class="c008">virtual</span>&#XA0;<span class="c008">mutable</span>&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method</span>&#XA0;[<span class="c008">private</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;&#XA0;{<a class="syntax" href="#parameter"><span class="c014">parameter</span></a>}&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method</span>&#XA0;[<span class="c008">private</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method</span>&#XA0;[<span class="c008">private</span>]&#XA0;<span class="c008">virtual</span>&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method</span>&#XA0;<span class="c008">virtual</span>&#XA0;<span class="c008">private</span>&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">constraint</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">initializer</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><!--TOC subsubsection id="sec163" Simple class expressions-->
<h4 class="subsubsection" id="sec163">Simple class expressions</h4><!--SEC END --><p>The expression <a class="syntax" href="#class-path"><span class="c014">class-path</span></a> evaluates to the class bound to the name
<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>. Similarly, the expression
<span class="c008">[</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">,</span> &#X2026; &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub> <span class="c008">]</span> &#XA0;<a class="syntax" href="#class-path"><span class="c014">class-path</span></a>
evaluates to the parametric class bound to the name <a class="syntax" href="#class-path"><span class="c014">class-path</span></a>,
in which type parameters have been instantiated respectively to
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub>, &#X2026;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub><span class="c013">n</span></sub>.</p><p>The expression <span class="c008">(</span> <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> <span class="c008">)</span> evaluates to the same module as
<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>.</p><p>The expression <span class="c008">(</span> <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#class-type"><span class="c014">class-type</span></a> <span class="c008">)</span> checks that
<a class="syntax" href="#class-type"><span class="c014">class-type</span></a> matches the type of <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> (that is, that the
implementation <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> meets the type specification
<a class="syntax" href="#class-type"><span class="c014">class-type</span></a>). The whole expression evaluates to the same class as
<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>, except that all components not specified in
<a class="syntax" href="#class-type"><span class="c014">class-type</span></a> are hidden and can no longer be accessed.</p><!--TOC subsubsection id="sec164" Class application-->
<h4 class="subsubsection" id="sec164">Class application</h4><!--SEC END --><p>Class application is denoted by juxtaposition of (possibly labeled)
expressions. It denotes the class whose constructor is the first
expression applied to the given arguments. The arguments are
evaluated as for expression application, but the constructor itself will
only be evaluated when objects are created. In particular, side-effects
caused by the application of the constructor will only occur at object
creation time.</p><!--TOC subsubsection id="sec165" Class function-->
<h4 class="subsubsection" id="sec165">Class function</h4><!--SEC END --><p>The expression <span class="c008">fun</span> [[<span class="c008">?</span>]<a class="syntax" href="#label-name"><span class="c014">label-name</span></a><span class="c008">:</span>]&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> evaluates
to a function from values to classes.
When this function is applied to a value <span class="c013">v</span>, this value is
matched against the pattern <a class="syntax" href="#pattern"><span class="c014">pattern</span></a> and the result is the result of
the evaluation of <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> in the extended environment.</p><p>Conversion from functions with default values to functions with
patterns only works identically for class functions as for normal
functions.</p><p>The expression
</p><div class="center">
<span class="c008">fun</span> <a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub><span class="c013">n</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>
</div><p>
is a short form for
</p><div class="center">
<span class="c008">fun</span> <a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#X2026; <span class="c008">fun</span> &#XA0;<a class="syntax" href="#parameter"><span class="c014">parameter</span></a><sub><span class="c013">n</span></sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><!--TOC subsubsection id="sec166" Local definitions-->
<h4 class="subsubsection" id="sec166">Local definitions</h4><!--SEC END --><p>The <span class="c007">let</span> and <span class="c007">let rec</span> constructs bind value names locally,
as for the core language expressions.</p><p>If a local definition occurs at the very beginning of a class
definition, it will be evaluated when the class is created (just as if
the definition was outside of the class).
Otherwise, it will be evaluated when the object constructor is called.</p><!--TOC subsubsection id="ss:class-body" Class body-->
<h4 class="subsubsection" id="ss:class-body">Class body</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="class-body"><span class="c014">class-body</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;&#XA0;[<span class="c008">(</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">)</span>]&#XA0;&#XA0;{&#XA0;<a class="syntax" href="#class-field"><span class="c014">class-field</span></a>&#XA0;}
</td></tr>
</table></td></tr>
</table><p>
The expression
<span class="c008">object</span> <a class="syntax" href="#class-body"><span class="c014">class-body</span></a> <span class="c008">end</span> denotes
a class body. This is the prototype for an object : it lists the
instance variables and methods of an objet of this class.</p><p>A class body is a class value: it is not evaluated at once. Rather,
its components are evaluated each time an object is created.</p><p>In a class body, the pattern <span class="c008">(</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a> &#XA0;[<span class="c008">:</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>] <span class="c008">)</span> is
matched against self, therefore providing a binding for self and self
type. Self can only be used in method and initializers.</p><p>Self type cannot be a closed object type, so that the class remains
extensible.</p><p>Since OCaml 4.01, it is an error if the same method or instance
variable name is defined several times in the same class body.</p><!--TOC subsubsection id="sec168" Inheritance-->
<h4 class="subsubsection" id="sec168">Inheritance</h4><!--SEC END --><p><a id="hevea_manual.kwd94"></a></p><p>The inheritance construct <span class="c008">inherit</span> <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> allows reusing
methods and instance variables from other classes. The class
expression <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> must evaluate to a class body. The instance
variables, methods and initializers from this class body are added
into the current class. The addition of a method will override any
previously defined method of the same name.</p><p><a id="hevea_manual.kwd95"></a>
An ancestor can be bound by appending <span class="c008">as</span> <a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
to the inheritance construct. <a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a> is not a true
variable and can only be used to select a method, i.e. in an expression
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a> <span class="c008">#</span> &#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>. This gives access to the
method <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> as it was defined in the parent class even if it is
redefined in the current class.
The scope of this ancestor binding is limited to the current class.
The ancestor method may be called from a subclass but only indirectly.</p><!--TOC subsubsection id="sec169" Instance variable definition-->
<h4 class="subsubsection" id="sec169">Instance variable definition</h4><!--SEC END --><p><a id="hevea_manual.kwd96"></a>
<a id="hevea_manual.kwd97"></a></p><p>The definition <span class="c008">val</span> [<span class="c008">mutable</span>] <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> adds an
instance variable <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> whose initial value is the value of
expression <a class="syntax" href="#expr"><span class="c014">expr</span></a>.
The flag <span class="c008">mutable</span> allows physical modification of this variable by
methods.</p><p>An instance variable can only be used in the methods and
initializers that follow its definition.</p><p>Since version 3.10, redefinitions of a visible instance variable with
the same name do not create a new variable, but are merged, using the
last value for initialization. They must have identical types and
mutability.
However, if an instance variable is hidden by
omitting it from an interface, it will be kept distinct from
other instance variables with the same name.</p><!--TOC subsubsection id="sec170" Virtual instance variable definition-->
<h4 class="subsubsection" id="sec170">Virtual instance variable definition</h4><!--SEC END --><p><a id="hevea_manual.kwd98"></a>
<a id="hevea_manual.kwd99"></a>
<a id="hevea_manual.kwd100"></a></p><p>A variable specification is written <span class="c008">val</span> [<span class="c008">mutable</span>] <span class="c008">virtual</span>
<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>. It specifies whether the variable is
modifiable, and gives its type.</p><p>Virtual instance variables were added in version 3.10.</p><!--TOC subsubsection id="sec171" Method definition-->
<h4 class="subsubsection" id="sec171">Method definition</h4><!--SEC END --><p><a id="hevea_manual.kwd101"></a>
<a id="hevea_manual.kwd102"></a></p><p>A method definition is written <span class="c008">method</span> <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>. The
definition of a method overrides any previous definition of this
method. The method will be public (that is, not private) if any of
the definition states so.</p><p>A private method, <span class="c005"><span class="c007">method</span> <span class="c007">private</span></span> <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>, is a
method that can only be invoked on self (from other methods of the
same object, defined in this class or one of its subclasses). This
invocation is performed using the expression
<a class="syntax" href="#value-name"><span class="c014">value-name</span></a> <span class="c008">#</span> &#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>, where <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> is directly bound to
self at the beginning of the class definition. Private methods do
not appear in object types. A method may have both public and private
definitions, but as soon as there is a public one, all subsequent
definitions will be made public.</p><p>Methods may have an explicitly polymorphic type, allowing them to be
used polymorphically in programs (even for the same object). The
explicit declaration may be done in one of three ways: (1) by giving an
explicit polymorphic type in the method definition, immediately after
the method name, <em>i.e.</em>
<span class="c008">method</span> [<span class="c008">private</span>] <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> <span class="c008">:</span> &#XA0;{<span class="c008">'</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a>}<sup>+</sup> <span class="c008">.</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">=</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>; (2) by a forward declaration of the explicit polymorphic type
through a virtual method definition; (3) by importing such a
declaration through inheritance and/or constraining the type of <em>self</em>.</p><p>Some special expressions are available in method bodies for
manipulating instance variables and duplicating self:
</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
&#X2026;
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">&lt;-</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{&lt;</span>&#XA0;[&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;]&#XA0;<span class="c008">&gt;}</span>
</td></tr>
</table></td></tr>
</table><p>The expression <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> <span class="c008">&lt;-</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> modifies in-place the current
object by replacing the value associated to <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> by the
value of <a class="syntax" href="#expr"><span class="c014">expr</span></a>. Of course, this instance variable must have been
declared mutable.</p><p>The expression
<span class="c008">{&lt;</span> <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a><sub><span class="c013">n</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">&gt;}</span>
evaluates to a copy of the current object in which the values of
instance variables <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a><sub>1</sub>, &#X2026;, &#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a><sub><span class="c013">n</span></sub> have
been replaced by the values of the corresponding expressions <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>,
&#X2026;, &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub>.</p><!--TOC subsubsection id="sec172" Virtual method definition-->
<h4 class="subsubsection" id="sec172">Virtual method definition</h4><!--SEC END --><p><a id="hevea_manual.kwd103"></a>
<a id="hevea_manual.kwd104"></a>
<a id="hevea_manual.kwd105"></a></p><p>A method specification is written <span class="c008">method</span> [<span class="c008">private</span>] <span class="c008">virtual</span>
<a class="syntax" href="#method-name"><span class="c014">method-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>. It specifies whether the method is
public or private, and gives its type. If the method is intended to be
polymorphic, the type must be explicitly polymorphic.</p><!--TOC subsubsection id="sec173" Constraints on type parameters-->
<h4 class="subsubsection" id="sec173">Constraints on type parameters</h4><!--SEC END --><p><a id="hevea_manual.kwd106"></a></p><p>The construct <span class="c008">constraint</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub> forces the two
type expressions to be equals. This is typically used to specify type
parameters: in that way they can be bound to specific type
expressions.</p><!--TOC subsubsection id="sec174" Initializers-->
<h4 class="subsubsection" id="sec174">Initializers</h4><!--SEC END --><p><a id="hevea_manual.kwd107"></a></p><p>A class initializer <span class="c008">initializer</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> specifies an expression that
will be evaluated whenever an object is created from the class, once
all its instance variables have been initialized.</p>
<!--TOC subsection id="sec175" Class definitions-->
<h3 class="subsection" id="sec175">6.9.3&#XA0;&#XA0;Class definitions</h3><!--SEC END --><p>
<a id="s:classdef"></a></p><p><a id="hevea_manual.kwd108"></a>
<a id="hevea_manual.kwd109"></a>
<a id="hevea_manual.kwd110"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="class-definition"><span class="c014">class-definition</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">class</span>&#XA0;<a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="class-binding"><span class="c014">class-binding</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">virtual</span>]&#XA0;[<span class="c008">[</span>&#XA0;<a class="syntax" href="#type-parameters"><span class="c014">type-parameters</span></a>&#XA0;<span class="c008">]</span>]&#XA0;&#XA0;<a class="syntax" href="#class-name"><span class="c014">class-name</span></a>
&#XA0;{<a class="syntax" href="#parameter"><span class="c014">parameter</span></a>}&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#class-type"><span class="c014">class-type</span></a>]&#XA0;&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="type-parameters"><span class="c014">type-parameters</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">'</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<span class="c008">'</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>&#XA0;}
</td></tr>
</table></td></tr>
</table><p>A class definition <span class="c008">class</span> <a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a> } is
recursive. Each <a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a> defines a <a class="syntax" href="#class-name"><span class="c014">class-name</span></a> that can be
used in the whole expression except for inheritance. It can also be
used for inheritance, but only in the definitions that follow its own.</p><p>A class binding binds the class name <a class="syntax" href="#class-name"><span class="c014">class-name</span></a> to the value of
expression <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>. It also binds the class type <a class="syntax" href="#class-name"><span class="c014">class-name</span></a> to
the type of the class, and defines two type abbreviations :
<a class="syntax" href="#class-name"><span class="c014">class-name</span></a> and <span class="c008">#</span> <a class="syntax" href="#class-name"><span class="c014">class-name</span></a>. The first one is the type of
objects of this class, while the second is more general as it unifies
with the type of any object belonging to a subclass (see
section&#XA0;<a href="#s%3Asharp-types">6.4</a>).</p><!--TOC subsubsection id="sec176" Virtual class-->
<h4 class="subsubsection" id="sec176">Virtual class</h4><!--SEC END --><p><a id="hevea_manual.kwd111"></a>
A class must be flagged virtual if one of its methods is virtual (that
is, appears in the class type, but is not actually defined).
Objects cannot be created from a virtual class.</p><!--TOC subsubsection id="sec177" Type parameters-->
<h4 class="subsubsection" id="sec177">Type parameters</h4><!--SEC END --><p>The class type parameters correspond to the ones of the class type and
of the two type abbreviations defined by the class binding. They must
be bound to actual types in the class definition using type
constraints. So that the abbreviations are well-formed, type
variables of the inferred type of the class must either be type
parameters or be bound in the constraint clause.</p>
<!--TOC subsection id="sec178" Class specifications-->
<h3 class="subsection" id="sec178">6.9.4&#XA0;&#XA0;Class specifications</h3><!--SEC END --><p>
<a id="s:class-spec"></a></p><p><a id="hevea_manual.kwd112"></a>
<a id="hevea_manual.kwd113"></a>
<a id="hevea_manual.kwd114"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="class-specification"><span class="c014">class-specification</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">class</span>&#XA0;<a class="syntax" href="#class-spec"><span class="c014">class-spec</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#class-spec"><span class="c014">class-spec</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="class-spec"><span class="c014">class-spec</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">virtual</span>]&#XA0;[<span class="c008">[</span>&#XA0;<a class="syntax" href="#type-parameters"><span class="c014">type-parameters</span></a>&#XA0;<span class="c008">]</span>]&#XA0;&#XA0;<a class="syntax" href="#class-name"><span class="c014">class-name</span></a>&#XA0;<span class="c008">:</span>
&#XA0;<a class="syntax" href="#class-type"><span class="c014">class-type</span></a>
</td></tr>
</table></td></tr>
</table><p>This is the counterpart in signatures of class definitions.
A class specification matches a class definition if they have the same
type parameters and their types match.</p>
<!--TOC subsection id="sec179" Class type definitions-->
<h3 class="subsection" id="sec179">6.9.5&#XA0;&#XA0;Class type definitions</h3><!--SEC END --><p>
<a id="s:classtype"></a></p><p><a id="hevea_manual.kwd115"></a>
<a id="hevea_manual.kwd116"></a>
<a id="hevea_manual.kwd117"></a>
<a id="hevea_manual.kwd118"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="classtype-definition"><span class="c014">classtype-definition</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">class</span>&#XA0;<span class="c008">type</span>&#XA0;<a class="syntax" href="#classtype-def"><span class="c014">classtype-def</span></a>
&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#classtype-def"><span class="c014">classtype-def</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="classtype-def"><span class="c014">classtype-def</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">virtual</span>]&#XA0;[<span class="c008">[</span>&#XA0;<a class="syntax" href="#type-parameters"><span class="c014">type-parameters</span></a>&#XA0;<span class="c008">]</span>]&#XA0;&#XA0;<a class="syntax" href="#class-name"><span class="c014">class-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a>
</td></tr>
</table></td></tr>
</table><p>A class type definition <span class="c008">class</span> <a class="syntax" href="#class-name"><span class="c014">class-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a>
defines an abbreviation <a class="syntax" href="#class-name"><span class="c014">class-name</span></a> for the class body type
<a class="syntax" href="#class-body-type"><span class="c014">class-body-type</span></a>. As for class definitions, two type abbreviations
<a class="syntax" href="#class-name"><span class="c014">class-name</span></a> and <span class="c008">#</span> <a class="syntax" href="#class-name"><span class="c014">class-name</span></a> are also defined. The definition can
be parameterized by some type parameters. If any method in the class
type body is virtual, the definition must be flagged <span class="c008">virtual</span>.</p><p>Two class type definitions match if they have the same type parameters
and they expand to matching types.

</p>
<!--TOC section id="sec180" Module types (module specifications)-->
<h2 class="section" id="sec180">6.10&#XA0;&#XA0;Module types (module specifications)</h2><!--SEC END --><!--NAME modtypes.html-->
<p>Module types are the module-level equivalent of type expressions: they
specify the general shape and type properties of modules.</p><p><a id="hevea_manual.kwd119"></a>
<a id="hevea_manual.kwd120"></a>
<a id="hevea_manual.kwd121"></a>
<a id="hevea_manual.kwd122"></a>
<a id="hevea_manual.kwd123"></a>
<a id="hevea_manual.kwd124"></a>
<a id="hevea_manual.kwd125"></a>
<a id="hevea_manual.kwd126"></a>
<a id="hevea_manual.kwd127"></a>
<a id="hevea_manual.kwd128"></a>
<a id="hevea_manual.kwd129"></a>
<a id="hevea_manual.kwd130"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="module-type"><span class="c014">module-type</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#modtype-path"><span class="c014">modtype-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">sig</span>&#XA0;{&#XA0;<a class="syntax" href="#specification"><span class="c014">specification</span></a>&#XA0;&#XA0;[<span class="c008">;;</span>]&#XA0;}&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">functor</span>&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">with</span>&#XA0;&#XA0;<a class="syntax" href="#mod-constraint"><span class="c014">mod-constraint</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#mod-constraint"><span class="c014">mod-constraint</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="mod-constraint"><span class="c014">mod-constraint</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">type</span>&#XA0;[<a class="syntax" href="#type-params"><span class="c014">type-params</span></a>]&#XA0;&#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>&#XA0;&#XA0;<a class="syntax" href="#type-equation"><span class="c014">type-equation</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
</table></td></tr>
</table><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="specification"><span class="c014">specification</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">val</span>&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">external</span>&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#type-definition"><span class="c014">type-definition</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">exception</span>&#XA0;<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#class-specification"><span class="c014">class-specification</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#classtype-definition"><span class="c014">classtype-definition</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>&#XA0;}
<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<span class="c008">type</span>&#XA0;<a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<span class="c008">type</span>&#XA0;<a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">open</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">include</span>&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
</td></tr>
</table></td></tr>
</table>
<!--TOC subsection id="sec181" Simple module types-->
<h3 class="subsection" id="sec181">6.10.1&#XA0;&#XA0;Simple module types</h3><!--SEC END --><p>The expression <a class="syntax" href="#modtype-path"><span class="c014">modtype-path</span></a> is equivalent to the module type bound
to the name <a class="syntax" href="#modtype-path"><span class="c014">modtype-path</span></a>.
The expression <span class="c008">(</span> <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> <span class="c008">)</span> denotes the same type as
<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>.</p>
<!--TOC subsection id="sec182" Signatures-->
<h3 class="subsection" id="sec182">6.10.2&#XA0;&#XA0;Signatures</h3><!--SEC END --><p><a id="hevea_manual.kwd131"></a>
<a id="hevea_manual.kwd132"></a></p><p>Signatures are type specifications for structures. Signatures
<span class="c008">sig</span> &#X2026; <span class="c008">end</span> are collections of type specifications for value
names, type names, exceptions, module names and module type names. A
structure will match a signature if the structure provides definitions
(implementations) for all the names specified in the signature (and
possibly more), and these definitions meet the type requirements given
in the signature.</p><p>An optional <span class="c008">;;</span> is allowed after each specification in a
signature. It serves as a syntactic separator with no semantic
meaning.</p><!--TOC subsubsection id="sec183" Value specifications-->
<h4 class="subsubsection" id="sec183">Value specifications</h4><!--SEC END --><p><a id="hevea_manual.kwd133"></a></p><p>A specification of a value component in a signature is written
<span class="c008">val</span> <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>, where <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> is the name of the
value and <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> its expected type.</p><p><a id="hevea_manual.kwd134"></a></p><p>The form <span class="c008">external</span> <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a>
is similar, except that it requires in addition the name to be
implemented as the external function specified in <a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a>
(see chapter&#XA0;<a href="#c%3Aintf-c">19</a>).</p><!--TOC subsubsection id="sec184" Type specifications-->
<h4 class="subsubsection" id="sec184">Type specifications</h4><!--SEC END --><p><a id="hevea_manual.kwd135"></a></p><p>A specification of one or several type components in a signature is
written <span class="c008">type</span> <a class="syntax" href="#typedef"><span class="c014">typedef</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#typedef"><span class="c014">typedef</span></a> } and consists of a sequence
of mutually recursive definitions of type names.</p><p>Each type definition in the signature specifies an optional type
equation <span class="c008">=</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> and an optional type representation
<span class="c008">=</span> <a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a> &#X2026; or <span class="c005"><span class="c007">=</span> <span class="c007">{</span></span> <a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a> &#X2026; <span class="c008">}</span>.
The implementation of the type name in a matching structure must
be compatible with the type expression specified in the equation (if
given), and have the specified representation (if given). Conversely,
users of that signature will be able to rely on the type equation
or type representation, if given. More precisely, we have the
following four situations:</p><dl class="description"><dt class="dt-description">
<span class="c019">Abstract type: no equation, no representation.</span></dt><dd class="dd-description"> &#XA0; <br>
Names that are defined as abstract types in a signature can be
implemented in a matching structure by any kind of type definition
(provided it has the same number of type parameters). The exact
implementation of the type will be hidden to the users of the
structure. In particular, if the type is implemented as a variant type
or record type, the associated constructors and fields will not be
accessible to the users; if the type is implemented as an
abbreviation, the type equality between the type name and the
right-hand side of the abbreviation will be hidden from the users of the
structure. Users of the structure consider that type as incompatible
with any other type: a fresh type has been generated.</dd><dt class="dt-description"><span class="c019">Type abbreviation: an equation </span><span class="c008">=</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><span class="c019">, no representation.</span></dt><dd class="dd-description"> &#XA0; <br>
The type name must be implemented by a type compatible with <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.
All users of the structure know that the type name is
compatible with <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.</dd><dt class="dt-description"><span class="c019">New variant type or record type: no equation, a representation.</span></dt><dd class="dd-description"> &#XA0; <br>
The type name must be implemented by a variant type or record type
with exactly the constructors or fields specified. All users of the
structure have access to the constructors or fields, and can use them
to create or inspect values of that type. However, users of the
structure consider that type as incompatible with any other type: a
fresh type has been generated.</dd><dt class="dt-description"><span class="c019">Re-exported variant type or record type: an equation,
a representation.</span></dt><dd class="dd-description"> &#XA0; <br>
This case combines the previous two: the representation of the type is
made visible to all users, and no fresh type is generated.
</dd></dl><!--TOC subsubsection id="sec185" Exception specification-->
<h4 class="subsubsection" id="sec185">Exception specification</h4><!--SEC END --><p><a id="hevea_manual.kwd136"></a></p><p>The specification <span class="c008">exception</span> <a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a> in a signature requires the
matching structure to provide an exception with the name and arguments
specified in the definition, and makes the exception available to all
users of the structure.</p><!--TOC subsubsection id="sec186" Class specifications-->
<h4 class="subsubsection" id="sec186">Class specifications</h4><!--SEC END --><p><a id="hevea_manual.kwd137"></a></p><p>A specification of one or several classes in a signature is written
<span class="c008">class</span> <a class="syntax" href="#class-spec"><span class="c014">class-spec</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#class-spec"><span class="c014">class-spec</span></a> } and consists of a sequence
of mutually recursive definitions of class names.</p><p>Class specifications are described more precisely in
section&#XA0;<a href="#s%3Aclass-spec">6.9.4</a>.</p><!--TOC subsubsection id="sec187" Class type specifications-->
<h4 class="subsubsection" id="sec187">Class type specifications</h4><!--SEC END --><p><a id="hevea_manual.kwd138"></a>
<a id="hevea_manual.kwd139"></a></p><p>A specification of one or several classe types in a signature is
written <span class="c005"><span class="c007">class</span> <span class="c007">type</span></span> <a class="syntax" href="#classtype-def"><span class="c014">classtype-def</span></a> { <span class="c008">and</span> <a class="syntax" href="#classtype-def"><span class="c014">classtype-def</span></a> } and
consists of a sequence of mutually recursive definitions of class type
names. Class type specifications are described more precisely in
section&#XA0;<a href="#s%3Aclasstype">6.9.5</a>.</p><!--TOC subsubsection id="sec188" Module specifications-->
<h4 class="subsubsection" id="sec188">Module specifications</h4><!--SEC END --><p><a id="hevea_manual.kwd140"></a></p><p>A specification of a module component in a signature is written
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>, where <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> is the
name of the module component and <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> its expected type.
Modules can be nested arbitrarily; in particular, functors can appear
as components of structures and functor types as components of
signatures.</p><p>For specifying a module component that is a functor, one may write
</p><div class="center">
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">(</span> &#XA0;<span class="c014">name</span><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub> <span class="c008">)</span>
&#X2026; <span class="c008">(</span> &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">)</span>
<span class="c007">:</span></span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
</div><p>
instead of
</p><div class="center">
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c005"><span class="c007">:</span>
<span class="c007">functor</span> <span class="c007">(</span></span> &#XA0;<span class="c014">name</span><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span> &#X2026;
<span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
</div><!--TOC subsubsection id="sec189" Module type specifications-->
<h4 class="subsubsection" id="sec189">Module type specifications</h4><!--SEC END --><p><a id="hevea_manual.kwd141"></a>
<a id="hevea_manual.kwd142"></a></p><p>A module type component of a signature can be specified either as a
manifest module type or as an abstract module type.</p><p>An abstract module type specification
<span class="c005"><span class="c007">module</span> <span class="c007">type</span></span> <a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> allows the name <a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> to be
implemented by any module type in a matching signature, but hides the
implementation of the module type to all users of the signature.</p><p>A manifest module type specification
<span class="c005"><span class="c007">module</span> <span class="c007">type</span></span> <a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
requires the name <a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> to be implemented by the module type
<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> in a matching signature, but makes the equality between
<a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> and <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> apparent to all users of the signature.</p>
<!--TOC subsubsection id="sec190" Opening a module path-->
<h4 class="subsubsection" id="sec190">Opening a module path</h4><!--SEC END --><p><a id="hevea_manual.kwd143"></a></p><p>The expression <span class="c008">open</span> <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> in a signature does not specify
any components. It simply affects the parsing of the following items
of the signature, allowing components of the module denoted by
<a class="syntax" href="#module-path"><span class="c014">module-path</span></a> to be referred to by their simple names <span class="c014">name</span> instead of
path accesses <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> <span class="c008">.</span> &#XA0;<span class="c014">name</span>. The scope of the <span class="c008">open</span>
stops at the end of the signature expression.</p>
<!--TOC subsubsection id="sec191" Including a signature-->
<h4 class="subsubsection" id="sec191">Including a signature</h4><!--SEC END --><p><a id="hevea_manual.kwd144"></a></p><p>The expression <span class="c008">include</span> <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> in a signature performs textual
inclusion of the components of the signature denoted by <a class="syntax" href="#module-type"><span class="c014">module-type</span></a>.
It behaves as if the components of the included signature were copied
at the location of the <span class="c008">include</span>. The <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> argument must
refer to a module type that is a signature, not a functor type.</p>
<!--TOC subsection id="sec192" Functor types-->
<h3 class="subsection" id="sec192">6.10.3&#XA0;&#XA0;Functor types</h3><!--SEC END --><p><a id="hevea_manual.kwd145"></a></p><p>The module type expression
<span class="c005"><span class="c007">functor</span> <span class="c007">(</span></span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>2</sub>
is the type of functors (functions from modules to modules) that take
as argument a module of type <a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub> and return as result a
module of type <a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>2</sub>. The module type <a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>2</sub> can
use the name <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> to refer to type components of the actual
argument of the functor. No restrictions are placed on the type of the
functor argument; in particular, a functor may take another functor as
argument (&#X201C;higher-order&#X201D; functor).</p>
<!--TOC subsection id="sec193" The <span class="c007">with</span> operator-->
<h3 class="subsection" id="sec193">6.10.4&#XA0;&#XA0;The <span class="c007">with</span> operator</h3><!--SEC END --><p><a id="hevea_manual.kwd146"></a></p><p>Assuming <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> denotes a signature, the expression
<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> <span class="c008">with</span> &#XA0;<a class="syntax" href="#mod-constraint"><span class="c014">mod-constraint</span></a> { <span class="c008">and</span> <a class="syntax" href="#mod-constraint"><span class="c014">mod-constraint</span></a> } denotes
the same signature where type equations have been added to some of the
type specifications, as described by the constraints following the
<span class="c007">with</span> keyword. The constraint <span class="c008">type</span> [<a class="syntax" href="#type-parameters"><span class="c014">type-parameters</span></a>] &#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>
<span class="c008">=</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> adds the type equation <span class="c008">=</span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> to the specification
of the type component named <a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a> of the constrained signature.
The constraint <span class="c008">module</span> <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a> adds
type equations to all type components of the sub-structure denoted by
<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>, making them equivalent to the corresponding type
components of the structure denoted by <a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>.</p><p>For instance, if the module type name <span class="c007">S</span> is bound to the signature
</p><pre>        sig type t module M: (sig type u end) end
</pre><p>then <span class="c007">S with type t=int</span> denotes the signature
</p><pre>        sig type t=int module M: (sig type u end) end
</pre><p>and <span class="c007">S with module M = N</span> denotes the signature
</p><pre>        sig type t module M: (sig type u=N.u end) end
</pre><p>A functor taking two arguments of type <span class="c007">S</span> that share their <span class="c007">t</span> component
is written
</p><pre>        functor (A: S) (B: S with type t = A.t) ...
</pre><p>
Constraints are added left to right. After each constraint has been
applied, the resulting signature must be a subtype of the signature
before the constraint was applied. Thus, the <span class="c008">with</span> operator can
only add information on the type components of a signature, but never
remove information.

</p>
<!--TOC section id="s:module-expr" Module expressions (module implementations)-->
<h2 class="section" id="s:module-expr">6.11&#XA0;&#XA0;Module expressions (module implementations)</h2><!--SEC END --><!--NAME modules.html-->
<p>Module expressions are the module-level equivalent of value
expressions: they evaluate to modules, thus providing implementations
for the specifications expressed in module types.</p><p><a id="hevea_manual.kwd147"></a>
<a id="hevea_manual.kwd148"></a>
<a id="hevea_manual.kwd149"></a>
<a id="hevea_manual.kwd150"></a>
<a id="hevea_manual.kwd151"></a>
<a id="hevea_manual.kwd152"></a>
<a id="hevea_manual.kwd153"></a>
<a id="hevea_manual.kwd154"></a>
<a id="hevea_manual.kwd155"></a>
<a id="hevea_manual.kwd156"></a>
<a id="hevea_manual.kwd157"></a></p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="module-expr"><span class="c014">module-expr</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">struct</span>&#XA0;[&#XA0;<a class="syntax" href="#module-items"><span class="c014">module-items</span></a>&#XA0;]&#XA0;<span class="c008">end</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">functor</span>&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>&#XA0;<span class="c008">-&gt;</span>&#XA0;&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;<span class="c008">(</span>&#XA0;&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="module-items"><span class="c014">module-items</span></a></td><td class="c022">::=</td><td class="c024">
[<span class="c008">;;</span>]&#XA0;(&#XA0;<a class="syntax" href="#definition"><span class="c014">definition</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;)&#XA0;&#XA0;{&#XA0;[<span class="c008">;;</span>]&#XA0;<a class="syntax" href="#definition"><span class="c014">definition</span></a>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">;;</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;&#XA0;[<span class="c008">;;</span>]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="definition"><span class="c014">definition</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">let</span>&#XA0;[<span class="c008">rec</span>]&#XA0;<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">external</span>&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#type-definition"><span class="c014">type-definition</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#exception-definition"><span class="c014">exception-definition</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#class-definition"><span class="c014">class-definition</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#classtype-definition"><span class="c014">classtype-definition</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>&#XA0;}
&#XA0;[&#XA0;<span class="c008">:</span>&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;]&#XA0;&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<span class="c008">type</span>&#XA0;<a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">open</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">include</span>&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
</td></tr>
</table></td></tr>
</table>
<!--TOC subsection id="sec195" Simple module expressions-->
<h3 class="subsection" id="sec195">6.11.1&#XA0;&#XA0;Simple module expressions</h3><!--SEC END --><p>The expression <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> evaluates to the module bound to the name
<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>.</p><p>The expression <span class="c008">(</span> <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> <span class="c008">)</span> evaluates to the same module as
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>.</p><p>The expression <span class="c008">(</span> <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> <span class="c008">)</span> checks that the
type of <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> is a subtype of <a class="syntax" href="#module-type"><span class="c014">module-type</span></a>, that is, that all
components specified in <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> are implemented in
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>, and their implementation meets the requirements given
in <a class="syntax" href="#module-type"><span class="c014">module-type</span></a>. In other terms, it checks that the implementation
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> meets the type specification <a class="syntax" href="#module-type"><span class="c014">module-type</span></a>. The whole
expression evaluates to the same module as <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>, except that
all components not specified in <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> are hidden and can no
longer be accessed.</p>
<!--TOC subsection id="sec196" Structures-->
<h3 class="subsection" id="sec196">6.11.2&#XA0;&#XA0;Structures</h3><!--SEC END --><p><a id="hevea_manual.kwd158"></a>
<a id="hevea_manual.kwd159"></a></p><p>Structures <span class="c008">struct</span> &#X2026; <span class="c008">end</span> are collections of definitions for
value names, type names, exceptions, module names and module type
names. The definitions are evaluated in the order in which they appear
in the structure. The scopes of the bindings performed by the
definitions extend to the end of the structure. As a consequence, a
definition may refer to names bound by earlier definitions in the same
structure.</p><p>For compatibility with toplevel phrases (chapter&#XA0;<a href="#c%3Acamllight">9</a>),
an optional <span class="c008">;;</span> is allowed after each
definition in a structure. The <span class="c008">;;</span> has no semantic meaning. Also for
compatibility, <a class="syntax" href="#expr"><span class="c014">expr</span></a> is allowed as a component of a structure,
meaning <span class="c005"><span class="c007">let</span> <span class="c007">_</span> <span class="c007">=</span></span> <a class="syntax" href="#expr"><span class="c014">expr</span></a>, i.e. evaluate <a class="syntax" href="#expr"><span class="c014">expr</span></a> for its side-effects.
In this case, the <span class="c008">;;</span> of the previous component (if any) is not
optional.</p><!--TOC subsubsection id="sec197" Value definitions-->
<h4 class="subsubsection" id="sec197">Value definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd160"></a></p><p>A value definition <span class="c008">let</span> [<span class="c008">rec</span>] <a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a> }
bind value names in the same way as a <span class="c008">let</span> &#X2026; <span class="c008">in</span> &#X2026; expression
(see section&#XA0;<a href="#s%3Alocaldef">6.7.1</a>). The value names appearing in the
left-hand sides of the bindings are bound to the corresponding values
in the right-hand sides.</p><p><a id="hevea_manual.kwd161"></a></p><p>A value definition <span class="c008">external</span> <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a>
implements <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> as the external function specified in
<a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a> (see chapter&#XA0;<a href="#c%3Aintf-c">19</a>).</p><!--TOC subsubsection id="sec198" Type definitions-->
<h4 class="subsubsection" id="sec198">Type definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd162"></a></p><p>A definition of one or several type components is written
<span class="c008">type</span> <a class="syntax" href="#typedef"><span class="c014">typedef</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#typedef"><span class="c014">typedef</span></a> } and consists of a sequence
of mutually recursive definitions of type names.</p><!--TOC subsubsection id="sec199" Exception definitions-->
<h4 class="subsubsection" id="sec199">Exception definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd163"></a></p><p>Exceptions are defined with the syntax <span class="c008">exception</span> <a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a>
or <span class="c008">exception</span> <a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>.</p><!--TOC subsubsection id="sec200" Class definitions-->
<h4 class="subsubsection" id="sec200">Class definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd164"></a></p><p>A definition of one or several classes is written <span class="c008">class</span>
<a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#class-binding"><span class="c014">class-binding</span></a> } and consists of a sequence of
mutually recursive definitions of class names. Class definitions are
described more precisely in section&#XA0;<a href="#s%3Aclassdef">6.9.3</a>.</p><!--TOC subsubsection id="sec201" Class type definitions-->
<h4 class="subsubsection" id="sec201">Class type definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd165"></a>
<a id="hevea_manual.kwd166"></a></p><p>A definition of one or several classes is written
<span class="c005"><span class="c007">class</span> <span class="c007">type</span></span> <a class="syntax" href="#classtype-def"><span class="c014">classtype-def</span></a> &#XA0;{ <span class="c008">and</span> <a class="syntax" href="#classtype-def"><span class="c014">classtype-def</span></a> } and consists of
a sequence of mutually recursive definitions of class type names.
Class type definitions are described more precisely in
section&#XA0;<a href="#s%3Aclasstype">6.9.5</a>.</p><!--TOC subsubsection id="sec202" Module definitions-->
<h4 class="subsubsection" id="sec202">Module definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd167"></a></p><p>The basic form for defining a module component is
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>, which evaluates <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> and binds
the result to the name <a class="syntax" href="#module-name"><span class="c014">module-name</span></a>.</p><p>One can write
</p><div class="center">
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
</div><p>
instead of
</p><div class="center">
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c005"><span class="c007">=</span> <span class="c007">(</span></span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> <span class="c008">)</span>.
</div><p>
Another derived form is
</p><div class="center">
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">(</span> &#XA0;<span class="c014">name</span><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub> <span class="c008">)</span> &#X2026;
<span class="c008">(</span> &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">)</span> <span class="c007">=</span></span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
</div><p>
which is equivalent to
</p><div class="center">
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c005"><span class="c007">=</span>
<span class="c007">functor</span> <span class="c007">(</span></span> &#XA0;<span class="c014">name</span><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span> &#X2026;
<span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
</div><!--TOC subsubsection id="sec203" Module type definitions-->
<h4 class="subsubsection" id="sec203">Module type definitions</h4><!--SEC END --><p><a id="hevea_manual.kwd168"></a>
<a id="hevea_manual.kwd169"></a></p><p>A definition for a module type is written
<span class="c005"><span class="c007">module</span> <span class="c007">type</span></span> <a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>.
It binds the name <a class="syntax" href="#modtype-name"><span class="c014">modtype-name</span></a> to the module type denoted by the
expression <a class="syntax" href="#module-type"><span class="c014">module-type</span></a>.</p><!--TOC subsubsection id="sec204" Opening a module path-->
<h4 class="subsubsection" id="sec204">Opening a module path</h4><!--SEC END --><p><a id="hevea_manual.kwd170"></a></p><p>The expression <span class="c008">open</span> <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> in a structure does not define any
components nor perform any bindings. It simply affects the parsing of
the following items of the structure, allowing components of the
module denoted by <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> to be referred to by their simple names
<span class="c014">name</span> instead of path accesses <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> <span class="c008">.</span> &#XA0;<span class="c014">name</span>. The scope of
the <span class="c008">open</span> stops at the end of the structure expression.</p><!--TOC subsubsection id="sec205" Including the components of another structure-->
<h4 class="subsubsection" id="sec205">Including the components of another structure</h4><!--SEC END --><p><a id="hevea_manual.kwd171"></a></p><p>The expression <span class="c008">include</span> <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> in a structure re-exports in
the current structure all definitions of the structure denoted by
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>. For instance, if the identifier <span class="c007">S</span> is bound to the
module
</p><pre>        struct type t = int  let x = 2 end
</pre><p>the module expression
</p><pre>        struct include S  let y = (x + 1 : t) end
</pre><p>is equivalent to the module expression
</p><pre>        struct type t = S.t  let x = S.x  let y = (x + 1 : t) end
</pre><p>The difference between <span class="c008">open</span> and <span class="c008">include</span> is that <span class="c008">open</span>
simply provides short names for the components of the opened
structure, without defining any components of the current structure,
while <span class="c008">include</span> also adds definitions for the components of the
included structure.</p>
<!--TOC subsection id="sec206" Functors-->
<h3 class="subsection" id="sec206">6.11.3&#XA0;&#XA0;Functors</h3><!--SEC END --><!--TOC subsubsection id="sec207" Functor definition-->
<h4 class="subsubsection" id="sec207">Functor definition</h4><!--SEC END --><p><a id="hevea_manual.kwd172"></a></p><p>The expression <span class="c005"><span class="c007">functor</span> <span class="c007">(</span></span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span>
&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> evaluates to a functor that takes as argument modules of
the type <a class="syntax" href="#module-type"><span class="c014">module-type</span></a><sub>1</sub>, binds <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> to these modules,
evaluates <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> in the extended environment, and returns the
resulting modules as results. No restrictions are placed on the type of the
functor argument; in particular, a functor may take another functor as
argument (&#X201C;higher-order&#X201D; functor).</p><!--TOC subsubsection id="sec208" Functor application-->
<h4 class="subsubsection" id="sec208">Functor application</h4><!--SEC END --><p>The expression <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a><sub>1</sub> <span class="c008">(</span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a><sub>2</sub> <span class="c008">)</span> evaluates
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a><sub>1</sub> to a functor and <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a><sub>2</sub> to a module, and
applies the former to the latter. The type of <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a><sub>2</sub> must
match the type expected for the arguments of the functor <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a><sub>1</sub>.</p>
<!--TOC section id="sec209" Compilation units-->
<h2 class="section" id="sec209">6.12&#XA0;&#XA0;Compilation units</h2><!--SEC END --><!--NAME compunit.html-->
<table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="unit-interface"><span class="c014">unit-interface</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;{&#XA0;<a class="syntax" href="#specification"><span class="c014">specification</span></a>&#XA0;&#XA0;[<span class="c008">;;</span>]&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="unit-implementation"><span class="c014">unit-implementation</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;[&#XA0;<a class="syntax" href="#module-items"><span class="c014">module-items</span></a>&#XA0;]
</td></tr>
</table></td></tr>
</table><p>Compilation units bridge the module system and the separate
compilation system. A compilation unit is composed of two parts: an
interface and an implementation. The interface contains a sequence of
specifications, just as the inside of a <span class="c008">sig</span> &#X2026; <span class="c008">end</span>
signature expression. The implementation contains a sequence of
definitions and expressions, just as the inside of a
<span class="c008">struct</span> &#X2026; <span class="c008">end</span> module
expression. A compilation unit also has a name <span class="c014">unit-name</span>, derived
from the names of the files containing the interface and the
implementation (see chapter&#XA0;<a href="#c%3Acamlc">8</a> for more details). A
compilation unit behaves roughly as the module definition
</p><div class="center">
<span class="c005"><span class="c007">module</span> <span class="c014">unit-name</span> <span class="c007">:</span> <span class="c007">sig</span></span> &#XA0;<a class="syntax" href="#unit-interface"><span class="c014">unit-interface</span></a> <span class="c005"><span class="c007">end</span> <span class="c007">=</span>
<span class="c007">struct</span></span> &#XA0;<a class="syntax" href="#unit-implementation"><span class="c014">unit-implementation</span></a> <span class="c008">end</span>
</div><p>A compilation unit can refer to other compilation units by their
names, as if they were regular modules. For instance, if <span class="c007">U</span> is a
compilation unit that defines a type <span class="c007">t</span>, other compilation units can
refer to that type under the name <span class="c007">U.t</span>; they can also refer to <span class="c007">U</span> as
a whole structure. Except for names of other compilation units, a unit
interface or unit implementation must not have any other free variables.
In other terms, the type-checking and compilation of an interface or
implementation proceeds in the initial environment
</p><div class="center">
<span class="c014">name</span><sub>1</sub> <span class="c005"><span class="c007">:</span> <span class="c007">sig</span></span> &#XA0;<a class="syntax" href="#specification"><span class="c014">specification</span></a><sub>1</sub> <span class="c008">end</span> &#X2026;
&#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">:</span> <span class="c007">sig</span></span> &#XA0;<a class="syntax" href="#specification"><span class="c014">specification</span></a><sub><span class="c013">n</span></sub> <span class="c008">end</span>
</div><p>
where <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> are the names of the other
compilation units available in the search path (see
chapter&#XA0;<a href="#c%3Acamlc">8</a> for more details) and <a class="syntax" href="#specification"><span class="c014">specification</span></a><sub>1</sub> &#X2026;
&#XA0;<a class="syntax" href="#specification"><span class="c014">specification</span></a><sub><span class="c013">n</span></sub> are their respective interfaces.

</p><!--CUT END -->

<!--TOC chapter id="sec210" Language extensions-->
<h1 class="chapter" id="sec210">Chapter&#XA0;7&#XA0;&#XA0;Language extensions</h1><!--SEC END --><p> <a id="c:extensions"></a>

</p><!--NAME extn.html-->
<p>This chapter describes language extensions and convenience features
that are implemented in OCaml, but not described in the
OCaml reference manual.</p>
<!--TOC section id="sec211" Integer literals for types <span class="c007">int32</span>, <span class="c007">int64</span>
and <span class="c007">nativeint</span>-->
<h2 class="section" id="sec211">7.1&#XA0;&#XA0;Integer literals for types <span class="c007">int32</span>, <span class="c007">int64</span>
and <span class="c007">nativeint</span></h2><!--SEC END --><p>(Introduced in Objective Caml 3.07)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#constant"><span class="c014">constant</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#int32-literal"><span class="c014">int32-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#int64-literal"><span class="c014">int64-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#nativeint-literal"><span class="c014">nativeint-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="int32-literal"><span class="c014">int32-literal</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<a class="syntax" href="#integer-literal"><span class="c014">integer-literal</span></a>&#XA0;<span class="c008">l</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="int64-literal"><span class="c014">int64-literal</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<a class="syntax" href="#integer-literal"><span class="c014">integer-literal</span></a>&#XA0;<span class="c008">L</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="nativeint-literal"><span class="c014">nativeint-literal</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<a class="syntax" href="#integer-literal"><span class="c014">integer-literal</span></a>&#XA0;<span class="c008">n</span>
</td></tr>
</table></td></tr>
</table><p>An integer literal can be followed by one of the letters <span class="c007">l</span>, <span class="c007">L</span> or <span class="c007">n</span>
to indicate that this integer has type <span class="c007">int32</span>, <span class="c007">int64</span> or <span class="c007">nativeint</span>
respectively, instead of the default type <span class="c007">int</span> for integer literals.
<a id="hevea_manual3"></a>
<a id="hevea_manual4"></a>
<a id="hevea_manual5"></a>
The library modules <span class="c007">Int32</span>[<a href="libref/Int32.html"><span class="c007">Int32</span></a>],
<span class="c007">Int64</span>[<a href="libref/Int64.html"><span class="c007">Int64</span></a>] and <span class="c007">Nativeint</span>[<a href="libref/Nativeint.html"><span class="c007">Nativeint</span></a>]
provide operations on these integer types.</p>
<!--TOC section id="sec212" Streams and stream parsers-->
<h2 class="section" id="sec212">7.2&#XA0;&#XA0;Streams and stream parsers</h2><!--SEC END --><p> <a id="s:streams"></a></p><p>(Removed in Objective Caml 3.03)</p><p>The syntax for streams and stream parsers is no longer part of the
OCaml language, but available through a Camlp4 syntax
extension. See the Camlp4 reference manual for more information.
Support for basic operations on streams is still available through the
<span class="c007">Stream</span>[<a href="libref/Stream.html"><span class="c007">Stream</span></a>] module of the standard library.
OCaml programs
that use the stream parser syntax should be compiled with the
<span class="c007">-pp camlp4o</span> option to <span class="c007">ocamlc</span> and <span class="c007">ocamlopt</span>. For interactive use,
run <span class="c007">ocaml</span> and issue the <code>#load "dynlink.cma";;</code> command,
followed by the <code>#load "camlp4o.cma";;</code> command.</p>
<!--TOC section id="sec213" Recursive definitions of values-->
<h2 class="section" id="sec213">7.3&#XA0;&#XA0;Recursive definitions of values</h2><!--SEC END --><p> <a id="s:letrecvalues"></a></p><p>(Introduced in Objective Caml 1.00)</p><p>As mentioned in section&#XA0;<a href="#s%3Alocaldef">6.7.1</a>, the <span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> binding
construct, in addition to the definition of recursive functions,
also supports a certain class of recursive definitions of
non-functional values, such as
</p><div class="center">
<span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> <span class="c014">name</span><sub>1</sub> <span class="c005"><span class="c007">=</span> <span class="c007">1</span> <span class="c007">::</span></span> &#XA0;<span class="c014">name</span><sub>2</sub>
<span class="c008">and</span> &#XA0;<span class="c014">name</span><sub>2</sub> <span class="c005"><span class="c007">=</span> <span class="c007">2</span> <span class="c007">::</span></span> &#XA0;<span class="c014">name</span><sub>1</sub>
<span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
which binds <span class="c014">name</span><sub>1</sub> to the cyclic list <span class="c007">1::2::1::2::</span>&#X2026;, and
<span class="c014">name</span><sub>2</sub> to the cyclic list <span class="c007">2::1::2::1::</span>&#X2026;Informally, the class of accepted definitions consists of those
definitions where the defined names occur only inside function
bodies or as argument to a data constructor.</p><p>More precisely, consider the expression:
</p><div class="center">
<span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span> <span class="c014">name</span><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">and</span> &#X2026; <span class="c008">and</span> &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</div><p>
It will be accepted if each one of <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> is
statically constructive with respect to <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub>,
is not immediately linked to any of <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub>,
and is not an array constructor whose arguments have abstract type.</p><p>An expression <span class="c014">e</span> is said to be <em>statically constructive
with respect to</em> the variables <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub> if at least
one of the following conditions is true:
</p><ul class="itemize"><li class="li-itemize">
<span class="c014">e</span> has no free occurrence of any of <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub>
</li><li class="li-itemize"><span class="c014">e</span> is a variable
</li><li class="li-itemize"><span class="c014">e</span> has the form <span class="c008">fun</span> &#X2026; <span class="c008">-&gt;</span> &#X2026;
</li><li class="li-itemize"><span class="c014">e</span> has the form <span class="c008">function</span> &#X2026; <span class="c008">-&gt;</span> &#X2026;
</li><li class="li-itemize"><span class="c014">e</span> has the form <span class="c005"><span class="c007">lazy</span> <span class="c007">(</span></span> &#X2026; <span class="c008">)</span>
</li><li class="li-itemize"><span class="c014">e</span> has one of the following forms, where each one of
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#X2026; &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> is statically constructive with respect to
<span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub>, and <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> is statically constructive with
respect to <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub>, &#XA0;<span class="c014">xname</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">xname</span><sub><span class="c013">m</span></sub>:
<ul class="itemize"><li class="li-itemize">
<span class="c008">let</span> [<span class="c008">rec</span>] <span class="c014">xname</span><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">and</span> &#X2026;
<span class="c008">and</span> &#XA0;<span class="c014">xname</span><sub><span class="c013">m</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> <span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub>
</li><li class="li-itemize"><span class="c005"><span class="c007">let</span> <span class="c007">module</span></span> &#X2026; <span class="c008">in</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub>
</li><li class="li-itemize"><a class="syntax" href="#constr"><span class="c014">constr</span></a> <span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026; <span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub><span class="c008">)</span>
</li><li class="li-itemize"><span class="c008">`</span><a class="syntax" href="#tag-name"><span class="c014">tag-name</span></a> <span class="c008">(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026; <span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub><span class="c008">)</span>
</li><li class="li-itemize"><span class="c008">[|</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> <span class="c008">|]</span>
</li><li class="li-itemize"><span class="c008">{</span> <a class="syntax" href="#field"><span class="c014">field</span></a><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">m</span></sub> = &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> <span class="c008">}</span>
</li><li class="li-itemize"><span class="c008">{</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">with</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub>2</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub><span class="c008">;</span> &#X2026; <span class="c008">;</span>
&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a><sub><span class="c013">m</span></sub> = &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> <span class="c008">}</span> where <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> is not immediately
linked to <span class="c014">name</span><sub>1</sub> &#X2026; &#XA0;<span class="c014">name</span><sub><span class="c013">n</span></sub>
</li><li class="li-itemize"><span class="c008">(</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026; <span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> <span class="c008">)</span>
</li><li class="li-itemize"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub>
</li></ul>
</li></ul><p>An expression <span class="c014">e</span> is said to be <em>immediately linked to</em> the variable
<span class="c014">name</span> in the following cases:
</p><ul class="itemize"><li class="li-itemize">
<span class="c014">e</span> is <span class="c014">name</span>
</li><li class="li-itemize"><span class="c014">e</span> has the form <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">;</span> &#X2026; <span class="c008">;</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> where <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub>
is immediately linked to <span class="c014">name</span>
</li><li class="li-itemize"><span class="c014">e</span> has the form <span class="c008">let</span> [<span class="c008">rec</span>] <span class="c014">xname</span><sub>1</sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">and</span> &#X2026;
<span class="c008">and</span> &#XA0;<span class="c014">xname</span><sub><span class="c013">m</span></sub> <span class="c008">=</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">m</span></sub> <span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> where <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> is immediately
linked to <span class="c014">name</span> or to one of the <span class="c014">xname</span><sub><span class="c013">i</span></sub> such that <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">i</span></sub>
is immediately linked to <span class="c014">name</span>.
</li></ul>
<!--TOC section id="sec214" Range patterns-->
<h2 class="section" id="sec214">7.4&#XA0;&#XA0;Range patterns</h2><!--SEC END --><p> <a id="s:range-patterns"></a></p><p>(Introduced in Objective Caml 1.00)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#char-literal"><span class="c014">char-literal</span></a>&#XA0;<span class="c008">..</span>&#XA0;&#XA0;<a class="syntax" href="#char-literal"><span class="c014">char-literal</span></a>
</td></tr>
</table></td></tr>
</table><p>In patterns, OCaml recognizes the form
<span class="c005"><span class="c007">'</span> <span class="c014">c</span> <span class="c007">'</span> <span class="c007">..</span> <span class="c007">'</span> <span class="c014">d</span> <span class="c007">'</span></span> as shorthand for the pattern
</p><div class="center">
<span class="c008">'</span> <span class="c006"><span class="c013">c</span> <span class="c005"><span class="c007">'</span> <span class="c007">|</span> <span class="c007">'</span></span> <span class="c013">c</span></span><sub>1</sub> <span class="c005"><span class="c007">'</span> <span class="c007">|</span> <span class="c007">'</span></span> <span class="c014">c</span><sub>2</sub> <span class="c005"><span class="c007">'</span> <span class="c007">|</span></span> &#X2026;
<span class="c005"><span class="c007">|</span> <span class="c007">'</span></span> <span class="c014">c</span><sub><span class="c013">n</span></sub> <span class="c005"><span class="c007">'</span> <span class="c007">|</span> <span class="c007">'</span> <span class="c014">d</span> <span class="c007">'</span></span>
</div><p>
where <span class="c013">c</span><sub>1</sub>, <span class="c013">c</span><sub>2</sub>, &#X2026;, <span class="c013">c</span><sub><span class="c013">n</span></sub> are the characters
that occur between <span class="c013">c</span> and <span class="c013">d</span> in the ASCII character set. For
instance, the pattern <span class="c007">'0'<span class="c005">..</span>'9'</span> matches all characters that are digits.</p>
<!--TOC section id="sec215" Assertion checking-->
<h2 class="section" id="sec215">7.5&#XA0;&#XA0;Assertion checking</h2><!--SEC END --><p><a id="s:assert"></a>
<a id="hevea_manual.kwd173"></a></p><p>(Introduced in Objective Caml 1.06)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">assert</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>OCaml supports the <span class="c008">assert</span> construct to check debugging assertions.
The expression <span class="c008">assert</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> evaluates the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> and
returns <span class="c008">()</span> if <a class="syntax" href="#expr"><span class="c014">expr</span></a> evaluates to <span class="c008">true</span>. If it evaluates to
<span class="c008">false</span> the exception
<span class="c007">Assert_failure</span> is raised with the source file name and the
location of <a class="syntax" href="#expr"><span class="c014">expr</span></a> as arguments. Assertion
checking can be turned off with the <span class="c007">-noassert</span> compiler option. In
this case, <a class="syntax" href="#expr"><span class="c014">expr</span></a> is not evaluated at all.</p><p>As a special case, <span class="c008">assert false</span> is reduced to
<span class="c008">raise</span> <span class="c007"><span class="c005">(</span>Assert_failure ...<span class="c005">)</span></span>, which gives it a polymorphic
type. This means that it can be used in place of any expression (for
example as a branch of any pattern-matching). It also means that
the <span class="c008">assert false</span> &#X201C;assertions&#X201D; cannot be turned off by the
<span class="c007">-noassert</span> option.
<a id="hevea_manual6"></a></p>
<!--TOC section id="sec216" Lazy evaluation-->
<h2 class="section" id="sec216">7.6&#XA0;&#XA0;Lazy evaluation</h2><!--SEC END --><p> <a id="s:lazy"></a>
<a id="hevea_manual.kwd174"></a></p>
<!--TOC subsection id="sec217" Lazy expressions-->
<h3 class="subsection" id="sec217">7.6.1&#XA0;&#XA0;Lazy expressions</h3><!--SEC END --><p>
(Introduced in Objective Caml 1.06)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">lazy</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>The expression <span class="c008">lazy</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> returns a value <span class="c013">v</span> of type <span class="c007">Lazy.t</span> that
encapsulates the computation of <a class="syntax" href="#expr"><span class="c014">expr</span></a>. The argument <a class="syntax" href="#expr"><span class="c014">expr</span></a> is not
evaluated at this point in the program. Instead, its evaluation will
be performed the first time the function <span class="c007">Lazy.force</span> is applied to the value
<span class="c013">v</span>, returning the actual value of <a class="syntax" href="#expr"><span class="c014">expr</span></a>. Subsequent applications
of <span class="c007">Lazy.force</span> to <span class="c013">v</span> do not evaluate <a class="syntax" href="#expr"><span class="c014">expr</span></a> again. Applications
of <span class="c007">Lazy.force</span> may be implicit through pattern matching (see below).</p>
<!--TOC subsection id="sec218" Lazy patterns-->
<h3 class="subsection" id="sec218">7.6.2&#XA0;&#XA0;Lazy patterns</h3><!--SEC END --><p>
(Introduced in Objective Caml 3.11)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">lazy</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>
</td></tr>
</table></td></tr>
</table><p>The pattern <span class="c008">lazy</span> <a class="syntax" href="#pattern"><span class="c014">pattern</span></a> matches a value <span class="c013">v</span> of type <span class="c007">Lazy.t</span>,
provided <a class="syntax" href="#pattern"><span class="c014">pattern</span></a> matches the result of forcing <span class="c013">v</span> with
<span class="c007">Lazy.force</span>. A successful match of a pattern containing <span class="c008">lazy</span>
sub-patterns forces the corresponding parts of the value being matched, even
those that imply no test such as <span class="c008">lazy</span> <a class="syntax" href="#value-name"><span class="c014">value-name</span></a> or <span class="c005"><span class="c007">lazy</span> <span class="c007">_</span></span>.
Matching a value with a <a class="syntax" href="#pattern-matching"><span class="c014">pattern-matching</span></a> where some patterns
contain <span class="c008">lazy</span> sub-patterns may imply forcing parts of the value,
even when the pattern selected in the end has no <span class="c008">lazy</span> sub-pattern.</p><p>For more information, see the description of module <span class="c007">Lazy</span> in the
standard library (
<a href="libref/Lazy.html">Module <span class="c007">Lazy</span></a>).
<a id="hevea_manual7"></a><a id="hevea_manual8"></a></p>
<!--TOC section id="sec219" Local modules-->
<h2 class="section" id="sec219">7.7&#XA0;&#XA0;Local modules</h2><!--SEC END --><p>
<a id="hevea_manual.kwd175"></a>
<a id="hevea_manual.kwd176"></a></p><p>(Introduced in Objective Caml 2.00)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">let</span>&#XA0;<span class="c008">module</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">)</span>&#XA0;}
&#XA0;[&#XA0;<span class="c008">:</span>&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;]&#XA0;&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;<span class="c008">in</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>The expression
<span class="c005"><span class="c007">let</span> <span class="c007">module</span></span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> <span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
locally binds the module expression <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> to the identifier
<a class="syntax" href="#module-name"><span class="c014">module-name</span></a> during the evaluation of the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a>.
It then returns the value of <a class="syntax" href="#expr"><span class="c014">expr</span></a>. For example:
</p><pre>        let remove_duplicates comparison_fun string_list =
          let module StringSet =
            Set.Make(struct type t = string
                            let compare = comparison_fun end) in
          StringSet.elements
            (List.fold_right StringSet.add string_list StringSet.empty)
</pre>
<!--TOC section id="sec220" Recursive modules-->
<h2 class="section" id="sec220">7.8&#XA0;&#XA0;Recursive modules</h2><!--SEC END --><p> <a id="s-recursive-modules"></a>
<a id="hevea_manual.kwd177"></a>
<a id="hevea_manual.kwd178"></a></p><p>(Introduced in Objective Caml 3.07)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#definition"><span class="c014">definition</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<span class="c008">rec</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;
&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#specification"><span class="c014">specification</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<span class="c008">rec</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>
&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a><span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a>&#XA0;}
</td></tr>
</table></td></tr>
</table><p>Recursive module definitions, introduced by the <span class="c008">module rec</span> &#X2026;<span class="c008">and</span> &#X2026; construction, generalize regular module definitions
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> and module specifications
<span class="c008">module</span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#module-type"><span class="c014">module-type</span></a> by allowing the defining
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> and the <a class="syntax" href="#module-type"><span class="c014">module-type</span></a> to refer recursively to the module
identifiers being defined. A typical example of a recursive module
definition is:
</p><pre>    module rec A : sig
                     type t = Leaf of string | Node of ASet.t
                     val compare: t -&gt; t -&gt; int
                   end
                 = struct
                     type t = Leaf of string | Node of ASet.t
                     let compare t1 t2 =
                       match (t1, t2) with
                         (Leaf s1, Leaf s2) -&gt; Pervasives.compare s1 s2
                       | (Leaf _, Node _) -&gt; 1
                       | (Node _, Leaf _) -&gt; -1
                       | (Node n1, Node n2) -&gt; ASet.compare n1 n2
                   end
        and ASet : Set.S with type elt = A.t
                 = Set.Make(A)
</pre><p>It can be given the following specification:
</p><pre>    module rec A : sig
                     type t = Leaf of string | Node of ASet.t
                     val compare: t -&gt; t -&gt; int
                   end
        and ASet : Set.S with type elt = A.t
</pre><p>
This is an experimental extension of OCaml: the class of
recursive definitions accepted, as well as its dynamic semantics are
not final and subject to change in future releases.</p><p>Currently, the compiler requires that all dependency cycles between
the recursively-defined module identifiers go through at least one
&#X201C;safe&#X201D; module. A module is &#X201C;safe&#X201D; if all value definitions that
it contains have function types <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">-&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub>. Evaluation of a
recursive module definition proceeds by building initial values for
the safe modules involved, binding all (functional) values to
<span class="c005"><span class="c007">fun</span> <span class="c007">_</span> <span class="c007">-&gt;</span> <span class="c007">raise</span></span> <span class="c007">Undefined_recursive_module</span>. The defining
module expressions are then evaluated, and the initial values
for the safe modules are replaced by the values thus computed. If a
function component of a safe module is applied during this computation
(which corresponds to an ill-founded recursive definition), the
<span class="c007">Undefined_recursive_module</span> exception is raised.</p><p>Note that, in the <a class="syntax" href="#specification"><span class="c014">specification</span></a> case, the <a class="syntax" href="#module-type"><span class="c014">module-type</span></a>s must be
parenthesized if they use the <span class="c008">with</span> <a class="syntax" href="#mod-constraint"><span class="c014">mod-constraint</span></a> construct.</p>
<!--TOC section id="sec221" Private types-->
<h2 class="section" id="sec221">7.9&#XA0;&#XA0;Private types</h2><!--SEC END --><p>
<a id="hevea_manual.kwd179"></a></p><p>Private type declarations in module signatures, of the form
<span class="c007">type t = private ...</span>, enable libraries to
reveal some, but not all aspects of the implementation of a type to
clients of the library. In this respect, they strike a middle ground
between abstract type declarations, where no information is revealed
on the type implementation, and data type definitions and type
abbreviations, where all aspects of the type implementation are
publicized. Private type declarations come in three flavors: for
variant and record types (section&#XA0;<a href="#s-private-types-variant">7.9.1</a>),
for type abbreviations (section&#XA0;<a href="#s-private-types-abbrev">7.9.2</a>),
and for row types (section&#XA0;<a href="#s-private-rows">7.9.3</a>).</p>
<!--TOC subsection id="sec222" Private variant and record types-->
<h3 class="subsection" id="sec222">7.9.1&#XA0;&#XA0;Private variant and record types</h3><!--SEC END --><p> <a id="s-private-types-variant"></a></p><p>(Introduced in Objective Caml 3.07)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#type-representation"><span class="c014">type-representation</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">=</span>&#XA0;<span class="c008">private</span>&#XA0;[&#XA0;<span class="c008">|</span>&#XA0;]&#XA0;<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">|</span>&#XA0;<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">=</span>&#XA0;<span class="c008">private</span>&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field-decl"><span class="c014">field-decl</span></a>&#XA0;}&#XA0;&#XA0;[&#XA0;<span class="c008">;</span>&#XA0;]&#XA0;<span class="c008">}</span>
</td></tr>
</table></td></tr>
</table><p>Values of a variant or record type declared <span class="c008">private</span>
can be de-structured normally in pattern-matching or via
the <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">.</span> &#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a> notation for record accesses. However, values of
these types cannot be constructed directly by constructor application
or record construction. Moreover, assignment on a mutable field of a
private record type is not allowed.</p><p>The typical use of private types is in the export signature of a
module, to ensure that construction of values of the private type always
go through the functions provided by the module, while still allowing
pattern-matching outside the defining module. For example:
</p><pre>        module M : sig
                     type t = private A | B of int
                     val a : t
                     val b : int -&gt; t
                   end
                 = struct
                     type t = A | B of int
                     let a = A
                     let b n = assert (n &gt; 0); B n
                   end
</pre><p>Here, the <span class="c008">private</span> declaration ensures that in any value of type
<span class="c007">M.t</span>, the argument to the <span class="c007">B</span> constructor is always a positive integer.</p><p>With respect to the variance of their parameters, private types are
handled like abstract types. That is, if a private type has
parameters, their variance is the one explicitly given by prefixing
the parameter by a &#X2018;<span class="c007">+</span>&#X2019; or a &#X2018;<span class="c007">-</span>&#X2019;, it is invariant otherwise.</p>
<!--TOC subsection id="sec223" Private type abbreviations-->
<h3 class="subsection" id="sec223">7.9.2&#XA0;&#XA0;Private type abbreviations</h3><!--SEC END --><p> <a id="s-private-types-abbrev"></a></p><p>(Introduced in Objective Caml 3.11)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#type-equation"><span class="c014">type-equation</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">=</span>&#XA0;<span class="c008">private</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
</td></tr>
</table></td></tr>
</table><p>Unlike a regular type abbreviation, a private type abbreviation
declares a type that is distinct from its implementation type <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>.
However, coercions from the type to <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> are permitted.
Moreover, the compiler &#X201C;knows&#X201D; the implementation type and can take
advantage of this knowledge to perform type-directed optimizations.
For ambiguity reasons, <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> cannot be an object or polymorphic
variant type, but a similar behaviour can be obtained through private
row types.</p><p>The following example uses a private type abbreviation to define a
module of nonnegative integers:
</p><pre>        module N : sig
                     type t = private int
                     val of_int: int -&gt; t
                     val to_int: t -&gt; int
                   end
                 = struct
                     type t = int
                     let of_int n = assert (n &gt;= 0); n
                     let to_int n = n
                   end
</pre><p>The type <span class="c007">N.t</span> is incompatible with <span class="c007">int</span>, ensuring that nonnegative
integers and regular integers are not confused. However, if <span class="c007">x</span> has
type <span class="c007">N.t</span>, the coercion <span class="c007">(x :&gt; int)</span> is legal and returns the
underlying integer, just like <span class="c007">N.to_int x</span>. Deep coercions are also
supported: if <span class="c007">l</span> has type <span class="c007">N.t list</span>, the coercion <span class="c007">(l :&gt; int list)</span>
returns the list of underlying integers, like <span class="c007">List.map N.to_int l</span>
but without copying the list <span class="c007">l</span>.</p><p>Note that the coercion <span class="c008">(</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">)</span> is actually an abbreviated
form,
and will only work in presence of private abbreviations if neither the
type of <a class="syntax" href="#expr"><span class="c014">expr</span></a> nor <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> contain any type variables. If they do,
you must use the full form <span class="c008">(</span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> <span class="c008">:&gt;</span> &#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>2</sub> <span class="c008">)</span> where
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a><sub>1</sub> is the expected type of <a class="syntax" href="#expr"><span class="c014">expr</span></a>. Concretely, this would be <span class="c007">(x : N.t :&gt; int)</span> and <span class="c007">(l : N.t list :&gt; int list)</span> for the above examples.</p>
<!--TOC subsection id="sec224" Private row types-->
<h3 class="subsection" id="sec224">7.9.3&#XA0;&#XA0;Private row types</h3><!--SEC END --><p> <a id="s-private-rows"></a>
<a id="hevea_manual.kwd180"></a></p><p>(Introduced in Objective Caml 3.09)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#type-equation"><span class="c014">type-equation</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">=</span>&#XA0;<span class="c008">private</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
</td></tr>
</table></td></tr>
</table><p>Private row types are type abbreviations where part of the
structure of the type is left abstract. Concretely <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> in the
above should denote either an object type or a polymorphic variant
type, with some possibility of refinement left. If the private
declaration is used in an interface, the corresponding implementation
may either provide a ground instance, or a refined private type.
</p><pre>   module M : sig type c = private &lt; x : int; .. &gt; val o : c end =
     struct
       class c = object method x = 3 method y = 2 end
       let o = new c
     end
</pre><p>This declaration does more than hiding the <span class="c007">y</span> method, it also makes
the type <span class="c007">c</span> incompatible with any other closed object type, meaning
that only <span class="c007">o</span> will be of type <span class="c007">c</span>. In that respect it behaves
similarly to private record types. But private row types are
more flexible with respect to incremental refinement. This feature can
be used in combination with functors.
</p><pre>   module F(X : sig type c = private &lt; x : int; .. &gt; end) =
     struct
       let get_x (o : X.c) = o#x
     end
   module G(X : sig type c = private &lt; x : int; y : int; .. &gt; end) =
     struct
       include F(X)
       let get_y (o : X.c) = o#y
     end
</pre><p>
Polymorphic variant types can be refined in two ways, either to allow
the addition of new constructors, or to allow the disparition of
declared constructors. The second case corresponds to private variant
types (one cannot create a value of the private type), while the first
case requires default cases in pattern-matching to handle addition.
</p><pre>   type t = [ `A of int | `B of bool ]
   type u = private [&lt; t &gt; `A ]
   type v = private [&gt; t ]
</pre><p>With type <span class="c007">u</span>, it is possible to create values of the form <span class="c007">(`A n)</span>,
but not <span class="c007">(`B b)</span>. With type <span class="c007">v</span>, construction is not restricted but
pattern-matching must have a default case.</p><p>Similarly to abstract types, the variance of type parameters
is not inferred, and must be given explicitly.</p>
<!--TOC section id="sec225" Local opens-->
<h2 class="section" id="sec225">7.10&#XA0;&#XA0;Local opens</h2><!--SEC END --><p>
<a id="hevea_manual.kwd181"></a>
<a id="hevea_manual.kwd182"></a></p><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">let</span>&#XA0;<span class="c008">open</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">in</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">.(</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">)</span>
</td></tr>
</table></td></tr>
</table><p>The expressions
<span class="c005"><span class="c007">let</span> <span class="c007">open</span></span> <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> <span class="c008">in</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
and
<a class="syntax" href="#module-path"><span class="c014">module-path</span></a><span class="c008">.(</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><span class="c008">)</span> are strictly equivalent. They
locally open the module referred to by the module path <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> in
the scope of the expression <a class="syntax" href="#expr"><span class="c014">expr</span></a>.</p><p>Restricting opening to the scope of a single expression instead of a
whole structure allows one to benefit from shorter syntax to refer to
components of the opened module, without polluting the global
scope. Also, this can make the code easier to read (the open statement is
closer to where it is used) and to refactor (because the code
fragment is more self-contained).</p>
<!--TOC section id="sec226" Record notations-->
<h2 class="section" id="sec226">7.11&#XA0;&#XA0;Record notations</h2><!--SEC END --><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>]&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#pattern"><span class="c014">pattern</span></a>]&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>&#XA0;<span class="c008">_</span>&#XA0;]&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">with</span>&#XA0;&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;&#XA0;{&#XA0;<span class="c008">;</span>&#XA0;<a class="syntax" href="#field"><span class="c014">field</span></a>&#XA0;&#XA0;[<span class="c008">=</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>]&#XA0;}&#XA0;&#XA0;[<span class="c008">;</span>]&#XA0;<span class="c008">}</span>
</td></tr>
</table></td></tr>
</table><p>In a record pattern or a record construction expression, a single
identifier <span class="c014">id</span> stands for <span class="c014">id</span> <span class="c008">=</span> &#XA0;<span class="c014">id</span>, and a qualified identifier
<a class="syntax" href="#module-path"><span class="c014">module-path</span></a> <span class="c008">.</span> &#XA0;<span class="c014">id</span> stands for <a class="syntax" href="#module-path"><span class="c014">module-path</span></a> <span class="c008">.</span> &#XA0;<span class="c014">id</span> <span class="c008">=</span> &#XA0;<span class="c014">id</span>.
For example, assuming
the record type
</p><pre>          type point = { x: float; y: float }
</pre><p>has been declared, the following expressions are equivalent:
</p><pre>          let x = 1 and y = 2 in { x = x; y = y }
          let x = 1 and y = 2 in { x; y }
          let x = 1 and y = 2 in { x = x; y }
</pre><p>Likewise, the following functions are equivalent:
</p><pre>          fun {x = x; y = y} -&gt; x + y
          fun {x; y} -&gt; x + y
</pre><p>
Optionally, a record pattern can be terminated by <span class="c005"><span class="c007">;</span> <span class="c007">_</span></span> to convey the
fact that not all fields of the record type are listed in the record
pattern and that it is intentional. By default, the compiler ignores
the <span class="c005"><span class="c007">;</span> <span class="c007">_</span></span> annotation. If warning 9 is turned on,
the compiler will warn when a record pattern fails to list all fields of
the corresponding record type and is not terminated by <span class="c005"><span class="c007">;</span> <span class="c007">_</span></span>.
Continuing the <span class="c007">point</span> example above,
</p><pre>          fun {x} -&gt; x + 1
</pre><p>will warn if warning 9 is on, while
</p><pre>          fun {x; _} -&gt; x + 1
</pre><p>will not warn. This warning can help spot program points where
record patterns may need to be modified after new fields are added to a
record type.</p>
<!--TOC section id="sec227" Explicit polymorphic type annotations-->
<h2 class="section" id="sec227">7.12&#XA0;&#XA0;Explicit polymorphic type annotations</h2><!--SEC END --><p>
<a id="hevea_manual.kwd183"></a></p><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>Polymorphic type annotations in <span class="c008">let</span>-definitions behave in a way
similar to polymorphic methods: they explicitly require the defined
value to be polymorphic, and allow one to use this polymorphism in
recursive occurences (when using <span class="c005"><span class="c007">let</span> <span class="c007">rec</span></span>). Note however that this
is a normal polymorphic type, unifiable with any instance of
itself.</p><p>There are two possible applications of this feature. One is polymorphic
recursion:
</p><pre>        type 'a t = Leaf of 'a | Node of ('a * 'a) t
        let rec depth : 'a. 'a t -&gt; 'b = function
            Leaf _ -&gt; 1
          | Node x -&gt; 1 + depth x
</pre><p>Note that <span class="c007">'b</span> is not explicitly polymorphic here, and it will
actually be unified with <span class="c007">int</span>.</p><p>The other application is to ensure that some definition is sufficiently
polymorphic.
</p><pre><span class="c004">#</span><span class="c003"> let id : 'a. 'a -&gt; 'a = <U>fun x -&gt; x+1</U> ;;
</span><span class="c006">Error: This definition has type int -&gt; int which is less general than
         'a. 'a -&gt; 'a
</span></pre>
<!--TOC section id="sec228" Locally abstract types-->
<h2 class="section" id="sec228">7.13&#XA0;&#XA0;Locally abstract types</h2><!--SEC END --><p>
<a id="hevea_manual.kwd184"></a>
<a id="hevea_manual.kwd185"></a></p><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#parameter"><span class="c014">parameter</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<span class="c008">type</span>&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>&#XA0;<span class="c008">)</span>
</td></tr>
</table></td></tr>
</table><p>The expression <span class="c005"><span class="c007">fun</span> <span class="c007">(</span> <span class="c007">type</span></span> <a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> introduces a
type constructor named <a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a> which is considered abstract
in the scope of the sub-expression, but then replaced by a fresh type
variable. Note that contrary to what the syntax could suggest, the
expression <span class="c005"><span class="c007">fun</span> <span class="c007">(</span> <span class="c007">type</span></span> <a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a> <span class="c005"><span class="c007">)</span> <span class="c007">-&gt;</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> itself does not
suspend the evaluation of <a class="syntax" href="#expr"><span class="c014">expr</span></a> as a regular abstraction would. The
syntax has been chosen to fit nicely in the context of function
declarations, where it is generally used. It is possible to freely mix
regular function parameters with pseudo type parameters, as in:
</p><pre>        let f = fun (type t) (foo : t list) -&gt; ...
</pre><p>and even use the alternative syntax for declaring functions:
</p><pre>        let f (type t) (foo : t list) = ...
</pre><p>
This construction is useful because the type constructor it introduces
can be used in places where a type variable is not allowed. For
instance, one can use it to define an exception in a local module
within a polymorphic function.
</p><pre>        let f (type t) () =
          let module M = struct exception E of t end in
          (fun x -&gt; M.E x), (function M.E x -&gt; Some x | _ -&gt; None)
</pre><p>
Here is another example:
</p><pre>        let sort_uniq (type s) (cmp : s -&gt; s -&gt; int) =
          let module S = Set.Make(struct type t = s let compare = cmp end) in
          fun l -&gt;
            S.elements (List.fold_right S.add l S.empty)
</pre><p>
It is also extremely useful for first-class modules and GADTs.</p>
<!--TOC paragraph id="sec229" Polymorphic syntax-->
<h5 class="paragraph" id="sec229">Polymorphic syntax</h5><!--SEC END --><p> (Introduced in OCaml 4.00)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#let-binding"><span class="c014">let-binding</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;<span class="c008">type</span>&#XA0;&#XA0;{&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>&#XA0;}<sup>+</sup>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#class-field"><span class="c014">class-field</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">method</span>&#XA0;[<span class="c008">private</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;<span class="c008">type</span>
&#XA0;{&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>&#XA0;}<sup>+</sup>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">method!</span>&#XA0;[<span class="c008">private</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;<span class="c008">type</span>
&#XA0;{&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>&#XA0;}<sup>+</sup>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>The <span class="c008">(type</span> <a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a><span class="c008">)</span> syntax construction by itself does not make
polymorphic the type variable it introduces, but it can be combined
with explicit polymorphic annotations where needed.
The above rule is provided as syntactic sugar to make this easier:
</p><pre>        let rec f : type t1 t2. t1 * t2 list -&gt; t1 = ...
</pre><p>is automatically expanded into
</p><pre>        let rec f : 't1 't2. 't1 * 't2 list -&gt; 't1 =
          fun (type t1) (type t2) -&gt; (... : t1 * t2 list -&gt; t1)
</pre><p>
The same feature is provided for method definitions.
The <span class="c008">method!</span> form combines this extension with the
&#X201C;explicit overriding&#X201D; extension described in
section&#XA0;<a href="#s%3Aexplicit-overriding">7.17</a>.</p>
<!--TOC section id="sec230" First-class modules-->
<h2 class="section" id="sec230">7.14&#XA0;&#XA0;First-class modules</h2><!--SEC END --><p><a id="s-first-class-modules"></a>
<a id="hevea_manual.kwd186"></a>
<a id="hevea_manual.kwd187"></a>
<a id="hevea_manual.kwd188"></a></p><p>(Introduced in OCaml 3.12; pattern syntax and package type inference
introduced in 4.00)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(module</span>&#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a><span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(val</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a>]<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(module</span>&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a>]<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#pattern"><span class="c014">pattern</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(module</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a>]<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="package-type"><span class="c014">package-type</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#modtype-path"><span class="c014">modtype-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#modtype-path"><span class="c014">modtype-path</span></a>&#XA0;<span class="c008">with</span>&#XA0;&#XA0;<a class="syntax" href="#package-constraint"><span class="c014">package-constraint</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">and</span>&#XA0;<a class="syntax" href="#package-constraint"><span class="c014">package-constraint</span></a>&#XA0;}
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="package-constraint"><span class="c014">package-constraint</span></a></td><td class="c022">::=</td><td class="c024">
<span class="c008">type</span>&#XA0;<a class="syntax" href="#typeconstr"><span class="c014">typeconstr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
</td></tr>
</table></td></tr>
</table><p>Modules are typically thought of as static components. This extension
makes it possible to pack a module as a first-class value, which can
later be dynamically unpacked into a module.</p><p>The expression <span class="c005"><span class="c007">(</span> <span class="c007">module</span></span> <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c008">)</span> converts the
module (structure or functor) denoted by module expression <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
to a value of the core language that encapsulates this module. The
type of this core language value is <span class="c005"><span class="c007">(</span> <span class="c007">module</span></span> <a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c008">)</span>.
The <a class="syntax" href="#package-type"><span class="c014">package-type</span></a> annotation can be omitted if it can be inferred
from the context.</p><p>Conversely, the module expression <span class="c005"><span class="c007">(</span> <span class="c007">val</span></span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c008">)</span>
evaluates the core language expression <a class="syntax" href="#expr"><span class="c014">expr</span></a> to a value, which must
have type <span class="c008">module</span> <a class="syntax" href="#package-type"><span class="c014">package-type</span></a>, and extracts the module that was
encapsulated in this value. Again <a class="syntax" href="#package-type"><span class="c014">package-type</span></a> can be omitted if the
type of <a class="syntax" href="#expr"><span class="c014">expr</span></a> is known.</p><p>The pattern <span class="c005"><span class="c007">(</span> <span class="c007">module</span></span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c008">)</span> matches a
package with type <a class="syntax" href="#package-type"><span class="c014">package-type</span></a> and binds it to <a class="syntax" href="#module-name"><span class="c014">module-name</span></a>.
It is not allowed in toplevel let bindings.
Again <a class="syntax" href="#package-type"><span class="c014">package-type</span></a> can be omitted if it can be inferred from the
enclosing pattern.</p><p>The <a class="syntax" href="#package-type"><span class="c014">package-type</span></a> syntactic class appearing in the <span class="c005"><span class="c007">(</span> <span class="c007">module</span></span>
<a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c008">)</span> type expression and in the annotated forms represents a
subset of module types.
This subset consists of named module types with optional constraints
of a limited form: only non-parametrized types can be specified. For
type-checking purposes, package types are compared by path equality on
the module type name component, and normal type equality for
constraints.</p><p>The module expression <span class="c005"><span class="c007">(</span> <span class="c007">val</span></span> <a class="syntax" href="#expr"><span class="c014">expr</span></a> <span class="c008">:</span> &#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c008">)</span> cannot be used
in the
body of a functor, because this can cause unsoundness in conjunction
with applicative functors. On the other hand, it can be used anywhere
in the context of a local module binding
<span class="c005"><span class="c007">let</span> <span class="c007">module</span></span> <a class="syntax" href="#module-name"><span class="c014">module-name</span></a> <span class="c005"><span class="c007">=</span> <span class="c007">(</span> <span class="c007">val</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> <span class="c008">:</span> &#XA0;<a class="syntax" href="#package-type"><span class="c014">package-type</span></a> <span class="c005"><span class="c007">)</span>
<span class="c007">in</span></span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub>.</p>
<!--TOC paragraph id="sec231" Basic example-->
<h5 class="paragraph" id="sec231">Basic example</h5><!--SEC END --><p> A typical use of first-class modules is to
select at run-time among several implementations of a signature.
Each implementation is a structure that we can encapsulate as a
first-class module, then store in a data structure such as a hash
table:
</p><pre>        module type DEVICE = sig ... end
        let devices : (string, (module DEVICE)) Hashtbl.t = Hashtbl.create 17

        module SVG = struct ... end
        let _ = Hashtbl.add devices "SVG" (module SVG : DEVICE)

        module PDF = struct ... end
        let _ = Hashtbl.add devices "PDF" (module PDF: DEVICE)
</pre><p>We can then select one implementation based on command-line
arguments, for instance:
</p><pre>        module Device =
          (val (try Hashtbl.find devices (parse_cmdline())
                with Not_found -&gt; eprintf "Unknown device %s\n"; exit 2)
           : DEVICE)
</pre><p>Alternatively, the selection can be performed within a function:
</p><pre>        let draw_using_device device_name picture =
          let module Device =
            (val (Hashtbl.find_devices device_name) : DEVICE)
          in
            Device.draw picture
</pre>
<!--TOC paragraph id="sec232" Advanced examples-->
<h5 class="paragraph" id="sec232">Advanced examples</h5><!--SEC END --><p>
With first-class modules, it is possible to parametrize some code over the
implementation of a module without using a functor.</p><pre>        let sort (type s) (module Set : Set.S with type elt = s) l =
          Set.elements (List.fold_right Set.add l Set.empty)
        val sort : (module Set.S with type elt = 'a) -&gt; 'a list -&gt; 'a list
</pre><p>
To use this function, one can wrap the <span class="c007">Set.Make</span> functor:</p><pre>        let make_set (type s) cmp =
          let module S = Set.Make(struct
            type t = s
            let compare = cmp
          end) in
          (module S : Set.S with type elt = s)
        val make_set : ('a -&gt; 'a -&gt; int) -&gt; (module Set.S with type elt = 'a)
</pre>
<!--TOC section id="sec233" Recovering the type of a module-->
<h2 class="section" id="sec233">7.15&#XA0;&#XA0;Recovering the type of a module</h2><!--SEC END --><p><a id="hevea_manual.kwd189"></a>
<a id="hevea_manual.kwd190"></a>
<a id="hevea_manual.kwd191"></a></p><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#module-type"><span class="c014">module-type</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<span class="c008">type</span>&#XA0;<span class="c008">of</span>&#XA0;<a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>
</td></tr>
</table></td></tr>
</table><p>The construction <span class="c005"><span class="c007">module</span> <span class="c007">type</span> <span class="c007">of</span></span> <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a> expands to the module type
(signature or functor type) inferred for the module expression <a class="syntax" href="#module-expr"><span class="c014">module-expr</span></a>.</p><p>A typical use, in conjunction with the signature-level <span class="c008">include</span>
construct, is to extend the signature of an existing structure, as in
the following example.
</p><pre>        module type MYHASH = sig
          include module type of Hashtbl
          val replace: ('a, 'b) t -&gt; 'a -&gt; 'b -&gt; unit
        end
</pre><p>The signature <span class="c007">MYHASH</span> then contains all the fields of the signature
of the module <span class="c007">Hashtbl</span>, plus the new field <span class="c007">replace</span>. An implementation
of this signature can be obtained easily by using the <span class="c008">include</span>
construct again, but this time at the structure level:
</p><pre>        module MyHash : MYHASH = struct
          include Hashtbl
          let replace t k v = remove t k; add t k v
        end
</pre>
<!--TOC section id="sec234" Substituting inside a signature-->
<h2 class="section" id="sec234">7.16&#XA0;&#XA0;Substituting inside a signature</h2><!--SEC END --><p>
<a id="hevea_manual.kwd192"></a>
<a id="hevea_manual.kwd193"></a>
<a id="hevea_manual.kwd194"></a></p><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#mod-constraint"><span class="c014">mod-constraint</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">type</span>&#XA0;[<a class="syntax" href="#type-params"><span class="c014">type-params</span></a>]&#XA0;&#XA0;<a class="syntax" href="#typeconstr-name"><span class="c014">typeconstr-name</span></a>&#XA0;<span class="c008">:=</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">module</span>&#XA0;<a class="syntax" href="#module-name"><span class="c014">module-name</span></a>&#XA0;<span class="c008">:=</span>&#XA0;&#XA0;<a class="syntax" href="#extended-module-path"><span class="c014">extended-module-path</span></a>
</td></tr>
</table></td></tr>
</table><p>&#X201C;Destructive&#X201D; substitution (<span class="c008">with</span> ... <span class="c008">:=</span> ...) behaves essentially like
normal signature constraints (<span class="c008">with</span> ... <span class="c008">=</span> ...), but it additionally removes
the redefined type or module from the signature. There are a number of
restrictions: one can only remove types and modules at the outermost
level (not inside submodules), and in the case of <span class="c008">with type</span> the
definition must be another type constructor with the same type
parameters.</p><p>A natural application of destructive substitution is merging two
signatures sharing a type name.
</p><pre>        module type Printable = sig
          type t
          val print : Format.formatter -&gt; t -&gt; unit
        end
        module type Comparable = sig
          type t
          val compare : t -&gt; t -&gt; int
        end
        module type PrintableComparable = sig
          include Printable
          include Comparable with type t := t
        end
</pre><p>
One can also use this to completely remove a field:
</p><pre><span class="c004">#<span class="c003"> module type S = Comparable with type t := int;;
<span class="c006">module type S = sig val compare : int -&gt; int -&gt; int end
</span></span></span></pre><p>
or to rename one:
</p><pre><span class="c004">#<span class="c003"> module type S = sig
    type u
    include Comparable with type t := u
  end;;
<span class="c006">module type S = sig type u val compare : u -&gt; u -&gt; int end
</span></span></span></pre><p>Note that you can also remove manifest types, by substituting with the
same type.
</p><pre><span class="c004">#</span><span class="c003"> module type ComparableInt = Comparable with type t = int ;;
<span class="c006">module type ComparableInt = sig type t = int val compare : t -&gt; t -&gt; int end
</span><span class="c004">#</span> module type CompareInt = ComparableInt with type t := int ;;
</span><span class="c006">module type CompareInt = sig val compare : int -&gt; int -&gt; int end
</span></pre>
<!--TOC section id="sec235" Explicit overriding in class definitions-->
<h2 class="section" id="sec235">7.17&#XA0;&#XA0;Explicit overriding in class definitions</h2><!--SEC END --><p><a id="s:explicit-overriding"></a>
<a id="hevea_manual.kwd195"></a>
<a id="hevea_manual.kwd196"></a>
<a id="hevea_manual.kwd197"></a></p><p>(Introduced in OCaml 3.12)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#class-field"><span class="c014">class-field</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">inherit!</span>&#XA0;<a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a>&#XA0;&#XA0;[<span class="c008">as</span>&#XA0;<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>]
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">val!</span>&#XA0;[<span class="c008">mutable</span>]&#XA0;<a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a>&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method!</span>&#XA0;[<span class="c008">private</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;&#XA0;{<a class="syntax" href="#parameter"><span class="c014">parameter</span></a>}&#XA0;&#XA0;[<span class="c008">:</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>]&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">method!</span>&#XA0;[<span class="c008">private</span>]&#XA0;<a class="syntax" href="#method-name"><span class="c014">method-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#poly-typexpr"><span class="c014">poly-typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>The keywords <span class="c008">inherit!</span>, <span class="c008">val!</span> and <span class="c008">method!</span> have the same semantics
as <span class="c008">inherit</span>, <span class="c008">val</span> and <span class="c008">method</span>, but they additionally require the
definition they introduce to be an overriding. Namely, <span class="c008">method!</span>
requires <a class="syntax" href="#method-name"><span class="c014">method-name</span></a> to be already defined in this class, <span class="c008">val!</span>
requires <a class="syntax" href="#inst-var-name"><span class="c014">inst-var-name</span></a> to be already defined in this class, and
<span class="c008">inherit!</span> requires <a class="syntax" href="#class-expr"><span class="c014">class-expr</span></a> to override some definitions.
If no such overriding occurs, an error is signaled.</p><p>As a side-effect, these 3 keywords avoid the warnings&#XA0;7
(method override) and&#XA0;13 (instance variable override).
Note that warning&#XA0;7 is disabled by default.</p>
<!--TOC section id="sec236" Overriding in open statements-->
<h2 class="section" id="sec236">7.18&#XA0;&#XA0;Overriding in open statements</h2><!--SEC END --><p><a id="s:explicit-overriding-open"></a>
<a id="hevea_manual.kwd198"></a></p><p>(Introduced in OCaml 4.01)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#definition"><span class="c014">definition</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">open!</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#specification"><span class="c014">specification</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;&#XA0;<span class="c008">open!</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">let</span>&#XA0;<span class="c008">open!</span>&#XA0;<a class="syntax" href="#module-path"><span class="c014">module-path</span></a>&#XA0;<span class="c008">in</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>Since OCaml 4.01, <span class="c008">open</span> statements shadowing an existing identifier
(which is later used) trigger the warning 44. Adding a <span class="c008">!</span>
character after the <span class="c008">open</span> keyword indicates that such a shadowing is
intentional and should not trigger the warning.</p>
<!--TOC section id="sec237" Generalized algebraic datatypes-->
<h2 class="section" id="sec237">7.19&#XA0;&#XA0;Generalized algebraic datatypes</h2><!--SEC END --><p> <a id="hevea_manual.kwd199"></a>
<a id="hevea_manual.kwd200"></a></p><p>(Introduced in OCaml 4.00)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#constr-decl"><span class="c014">constr-decl</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#constr-name"><span class="c014">constr-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;[&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">*</span>&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;}&#XA0;<span class="c008">-&gt;</span>&#XA0;]&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" href="#type-param"><span class="c014">type-param</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;[<a class="syntax" href="#variance"><span class="c014">variance</span></a>]&#XA0;<span class="c008">_</span>
</td></tr>
</table></td></tr>
</table><p>Generalized algebraic datatypes, or GADTs, extend usual sum types in
two ways: constraints on type parameters may change depending on the
value constructor, and some type variables may be existentially
quantified.
Adding constraints is done by giving an explicit return type
(the rightmost <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> in the above syntax), where type parameters
are instantiated.
This return type must use the same type constructor as the type being
defined, and have the same number of parameters.
Variables are made existential when they appear inside a constructor&#X2019;s
argument, but not in its return type.</p><p>Since the use of a return type often eliminates the need to name type
parameters in the left-hand side of a type definition, one can replace
them with anonymous types <span class="c008">_</span> in that case.</p><p>The constraints associated to each constructor can be recovered
through pattern-matching.
Namely, if the type of the scrutinee of a pattern-matching contains
a locally abstract type, this type can be refined according to the
constructor used.
These extra constraints are only valid inside the corresponding branch
of the pattern-matching.
If a constructor has some existential variables, fresh locally
abstract types are generated, and they must not escape the
scope of this branch.</p><p>Here is a concrete example:
</p><pre>        type _ term =
          | Int : int -&gt; int term
          | Add : (int -&gt; int -&gt; int) term
          | App : ('b -&gt; 'a) term * 'b term -&gt; 'a term

        let rec eval : type a. a term -&gt; a = function
          | Int n    -&gt; n                 (* a = int *)
          | Add      -&gt; (fun x y -&gt; x+y)  (* a = int -&gt; int -&gt; int *)
          | App(f,x) -&gt; (eval f) (eval x)
                  (* eval called at types (b-&gt;a) and b for fresh b *)

        let two = eval (App (App (Add, Int 1), Int 1))
        val two : int = 2
</pre><p>
Type inference for GADTs is notoriously hard.
This is due to the fact some types may become ambiguous when escaping
from a branch.
For instance, in the <span class="c007">Int</span> case above, <span class="c007">n</span> could have either type <span class="c007">int</span>
or <span class="c007">a</span>, and they are not equivalent outside of that branch.
As a first approximation, type inference will always work if a
pattern-matching is annotated with types containing no free type
variables (both on the scrutinee and the return type).
This is the case in the above example, thanks to the type annotation
containing only locally abstract types.</p><p>In practice, type inference is a bit more clever than that: type
annotations do not need to be immediately on the pattern-matching, and
the types do not have to be always closed.
As a result, it is usually enough to only annotate functions, as in
the example above. Type annotations are
propagated in two ways: for the scrutinee, they follow the flow of
type inference, in a way similar to polymorphic methods; for the
return type, they follow the structure of the program, they are split
on functions, propagated to all branches of a pattern matching,
and go through tuples, records, and sum types.
Moreover, the notion of ambiguity used is stronger: a type is only
seen as ambiguous if it was mixed with incompatible types (equated by
constraints), without type annotations between them.
For instance, the following program types correctly.
</p><pre>        let rec sum : type a. a term -&gt; _ = fun x -&gt;
          let y =
            match x with
            | Int n -&gt; n
            | Add   -&gt; 0
            | App(f,x) -&gt; sum f + sum x
          in y + 1
        val sum : 'a term -&gt; int = &lt;fun&gt;
</pre><p>Here the return type <span class="c007">int</span> is never mixed with <span class="c007">a</span>, so it is seen as
non-ambiguous, and can be inferred.
When using such partial type annotations we strongly suggest
specifying the <span class="c007">-principal</span> mode, to check that inference is
principal.</p><p>The exhaustiveness check is aware of GADT constraints, and can
automatically infer that some cases cannot happen.
For instance, the following pattern matching is correctly seen as
exhaustive (the <span class="c007">Add</span> case cannot happen).
</p><pre>        let get_int : int term -&gt; int = function
          | Int n    -&gt; n
          | App(_,_) -&gt; 0
</pre>
<!--TOC paragraph id="sec238" Advanced examples-->
<h5 class="paragraph" id="sec238">Advanced examples</h5><!--SEC END --><p>
The <span class="c007">term</span> type we have defined above is an <em>indexed</em> type, where
a type parameter reflects a property of the value contents.
Another use of GADTs is <em>singleton</em> types, where a GADT value
represents exactly one type. This value can be used as runtime
representation for this type, and a function receiving it can have a
polytypic behavior.</p><p>Here is an example of a polymorphic function that takes the
runtime representation of some type <span class="c007">t</span> and a value of the same type,
then pretty-prints the value as a string:
</p><pre>        type _ typ =
          | Int : int typ
          | String : string typ
          | Pair : 'a typ * 'b typ -&gt; ('a * 'b) typ

        let rec to_string: type t. t typ -&gt; t -&gt; string =
          fun t x -&gt;
          match t with
          | Int -&gt; string_of_int x
          | String -&gt; Printf.sprintf "%S" x
          | Pair(t1,t2) -&gt;
              let (x1, x2) = x in
              Printf.sprintf "(%s,%s)" (to_string t1 x1) (to_string t2 x2)
</pre><p>
Another frequent application of GADTs is equality witnesses.
</p><pre>        type (_,_) eq = Eq : ('a,'a) eq

        let cast : type a b. (a,b) eq -&gt; a -&gt; b = fun Eq x -&gt; x
</pre><p>Here type <span class="c007">eq</span> has only one constructor, and by matching on it one
adds a local constraint allowing the conversion between <span class="c007">a</span> and <span class="c007">b</span>.
By building such equality witnesses, one can make equal types which
are syntactically different.</p><p>Here is an example using both singleton types and equality witnesses
to implement dynamic types.
</p><pre>        let rec eq_type : type a b. a typ -&gt; b typ -&gt; (a,b) eq option =
          fun a b -&gt;
          match a, b with
          | Int, Int -&gt; Some Eq
          | String, String -&gt; Some Eq
          | Pair(a1,a2), Pair(b1,b2) -&gt;
              begin match eq_type a1 b1, eq_type a2 b2 with
              | Some Eq, Some Eq -&gt; Some Eq
              | _ -&gt; None
              end
          | _ -&gt; None

        type dyn = Dyn : 'a typ * 'a -&gt; dyn

        let get_dyn : type a. a typ -&gt; dyn -&gt; a option =
          fun a (Dyn(b,x)) -&gt;
          match eq_type a b with
          | None -&gt; None
          | Some Eq -&gt; Some x
</pre>
<!--TOC section id="sec239" Syntax for Bigarray access-->
<h2 class="section" id="sec239">7.20&#XA0;&#XA0;Syntax for Bigarray access</h2><!--SEC END --><p><a id="s:bigarray-access"></a></p><p>(Introduced in Objective Caml 3.00)</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c022">::=</td><td class="c024">
...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.{</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;<span class="c008">}</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">.{</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;&#XA0;{&#XA0;<span class="c008">,</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;}&#XA0;<span class="c008">}</span>&#XA0;<span class="c008">&lt;-</span>&#XA0;&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>
</td></tr>
</table></td></tr>
</table><p>This extension provides syntactic sugar for getting and setting
elements in the arrays provided by the
<span class="c007">Bigarray</span>[<a href="libref/Bigarray.html"><span class="c007">Bigarray</span></a>] library.</p><p>The short expressions are translated into calls to functions of the
<span class="c007">Bigarray</span> module as described in the following table.</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">expression</span></td><td class="c021"><span class="c019">translation</span> </td></tr>
<tr><td class="c023">
<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">}</span></td><td class="c023"><span class="c007">Bigarray.Array1.get </span><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c005"><span class="c007">}</span> <span class="c007">&lt;-</span></span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c023"><span class="c007">Bigarray.Array1.set </span><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub><span class="c008">}</span></td><td class="c023"><span class="c007">Bigarray.Array2.get </span><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub><span class="c005"><span class="c007">}</span> <span class="c007">&lt;-</span></span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c023"><span class="c007">Bigarray.Array2.set </span><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub><span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub><span class="c008">}</span></td><td class="c023"><span class="c007">Bigarray.Array3.get </span><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub><span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub><span class="c005"><span class="c007">}</span> <span class="c007">&lt;-</span></span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c023"><span class="c007">Bigarray.Array3.set </span><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>2</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>3</sub> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026;<span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub><span class="c008">}</span></td><td class="c023"><span class="c007">Bigarray.Genarray.get </span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> <span class="c008">[|</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026; <span class="c008">,</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">|]</span> </td></tr>
<tr><td class="c023"><a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub><span class="c008">.{</span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026;<span class="c008">,</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub><span class="c005"><span class="c007">}</span> <span class="c007">&lt;-</span></span>&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a></td><td class="c023"><span class="c007">Bigarray.Genarray.set </span> <a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>0</sub> <span class="c008">[|</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub>1</sub><span class="c008">,</span> &#X2026; <span class="c008">,</span>
&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a><sub><span class="c013">n</span></sub> <span class="c008">|]</span> &#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a> </td></tr>
</table></div><p>The last two entries are valid for any <span class="c013">n</span> &gt; 3.
</p>
<!--TOC part id="sec240" The OCaml tools-->
<table class="center"><tr><td><h1 class="part" id="sec240">Part&#XA0;III<br>
The OCaml tools</h1></td></tr>
</table><!--SEC END --><p>
<a id="p:commands"></a></p>
<!--TOC chapter id="sec241" Batch compilation (ocamlc)-->
<h1 class="chapter" id="sec241">Chapter&#XA0;8&#XA0;&#XA0;Batch compilation (ocamlc)</h1><!--SEC END --><p> <a id="c:camlc"></a>

</p><!--NAME comp.html-->
<p>This chapter describes the OCaml batch compiler <span class="c007">ocamlc</span>,
which compiles OCaml source files to bytecode object files and links
these object files to produce standalone bytecode executable files.
These executable files are then run by the bytecode interpreter
<span class="c007">ocamlrun</span>.</p>
<!--TOC section id="sec242" Overview of the compiler-->
<h2 class="section" id="sec242">8.1&#XA0;&#XA0;Overview of the compiler</h2><!--SEC END --><p>The <span class="c007">ocamlc</span> command has a command-line interface similar to the one of
most C compilers. It accepts several types of arguments and processes them
sequentially:</p><ul class="itemize"><li class="li-itemize">
Arguments ending in <span class="c007">.mli</span> are taken to be source files for
compilation unit interfaces. Interfaces specify the names exported by
compilation units: they declare value names with their types, define
public data types, declare abstract data types, and so on. From the
file <span class="c013">x</span><span class="c007">.mli</span>, the <span class="c007">ocamlc</span> compiler produces a compiled interface
in the file <span class="c013">x</span><span class="c007">.cmi</span>.</li><li class="li-itemize">Arguments ending in <span class="c007">.ml</span> are taken to be source files for compilation
unit implementations. Implementations provide definitions for the
names exported by the unit, and also contain expressions to be
evaluated for their side-effects. From the file <span class="c013">x</span><span class="c007">.ml</span>, the <span class="c007">ocamlc</span>
compiler produces compiled object bytecode in the file <span class="c013">x</span><span class="c007">.cmo</span>.<p>If the interface file <span class="c013">x</span><span class="c007">.mli</span> exists, the implementation
<span class="c013">x</span><span class="c007">.ml</span> is checked against the corresponding compiled interface
<span class="c013">x</span><span class="c007">.cmi</span>, which is assumed to exist. If no interface
<span class="c013">x</span><span class="c007">.mli</span> is provided, the compilation of <span class="c013">x</span><span class="c007">.ml</span> produces a
compiled interface file <span class="c013">x</span><span class="c007">.cmi</span> in addition to the compiled
object code file <span class="c013">x</span><span class="c007">.cmo</span>. The file <span class="c013">x</span><span class="c007">.cmi</span> produced
corresponds to an interface that exports everything that is defined in
the implementation <span class="c013">x</span><span class="c007">.ml</span>.</p></li><li class="li-itemize">Arguments ending in <span class="c007">.cmo</span> are taken to be compiled object bytecode. These
files are linked together, along with the object files obtained
by compiling <span class="c007">.ml</span> arguments (if any), and the OCaml standard
library, to produce a standalone executable program. The order in
which <span class="c007">.cmo</span> and <span class="c007">.ml</span> arguments are presented on the command line is
relevant: compilation units are initialized in that order at
run-time, and it is a link-time error to use a component of a unit
before having initialized it. Hence, a given <span class="c013">x</span><span class="c007">.cmo</span> file must come
before all <span class="c007">.cmo</span> files that refer to the unit <span class="c013">x</span>.</li><li class="li-itemize">Arguments ending in <span class="c007">.cma</span> are taken to be libraries of object bytecode.
A library of object bytecode packs in a single file a set of object
bytecode files (<span class="c007">.cmo</span> files). Libraries are built with <span class="c007">ocamlc -a</span>
(see the description of the <span class="c007">-a</span> option below). The object files
contained in the library are linked as regular <span class="c007">.cmo</span> files (see
above), in the order specified when the <span class="c007">.cma</span> file was built. The
only difference is that if an object file contained in a library is
not referenced anywhere in the program, then it is not linked in.</li><li class="li-itemize">Arguments ending in <span class="c007">.c</span> are passed to the C compiler, which generates
a <span class="c007">.o</span> object file (<span class="c007">.obj</span> under Windows). This object file is linked
with the program if the <span class="c007">-custom</span> flag is set (see the description of
<span class="c007">-custom</span> below).</li><li class="li-itemize">Arguments ending in <span class="c007">.o</span> or <span class="c007">.a</span> (<span class="c007">.obj</span> or <span class="c007">.lib</span> under Windows)
are assumed to be C object files and libraries. They are passed to the
C linker when linking in <span class="c007">-custom</span> mode (see the description of
<span class="c007">-custom</span> below).</li><li class="li-itemize">Arguments ending in <span class="c007">.so</span> (<span class="c007">.dll</span> under Windows)
are assumed to be C shared libraries (DLLs). During linking, they are
searched for external C functions referenced from the OCaml code,
and their names are written in the generated bytecode executable.
The run-time system <span class="c007">ocamlrun</span> then loads them dynamically at program
start-up time.</li></ul><p>The output of the linking phase is a file containing compiled bytecode
that can be executed by the OCaml bytecode interpreter:
the command named <span class="c007">ocamlrun</span>. If <span class="c007">a.out</span> is the name of the file
produced by the linking phase, the command
</p><pre>
        ocamlrun a.out <span class="c013">arg</span><sub>1</sub> <span class="c013">arg</span><sub>2</sub> &#X2026; <span class="c013">arg</span><sub><span class="c013">n</span></sub>
</pre><p>
executes the compiled code contained in <span class="c007">a.out</span>, passing it as
arguments the character strings <span class="c013">arg</span><sub>1</sub> to <span class="c013">arg</span><sub><span class="c013">n</span></sub>.
(See chapter&#XA0;<a href="#c%3Aruntime">10</a> for more details.)</p><p>On most systems, the file produced by the linking
phase can be run directly, as in:
</p><pre>
        ./a.out <span class="c013">arg</span><sub>1</sub> <span class="c013">arg</span><sub>2</sub> &#X2026; <span class="c013">arg</span><sub><span class="c013">n</span></sub>
</pre><p>
The produced file has the executable bit set, and it manages to launch
the bytecode interpreter by itself.</p>
<!--TOC section id="sec243" Options-->
<h2 class="section" id="sec243">8.2&#XA0;&#XA0;Options</h2><!--SEC END --><p><a id="s:comp-options"></a></p><p>The following command-line options are recognized by <span class="c007">ocamlc</span>.
The options <span class="c007">-pack</span>, <span class="c007">-a</span>, <span class="c007">-c</span> and <span class="c007">-output-obj</span> are mutually exclusive.</p><dl class="description"><dt class="dt-description"><span class="c010">-a</span></dt><dd class="dd-description">
Build a library (<span class="c007">.cma</span> file) with the object files (<span class="c007">.cmo</span> files)
given on the command line, instead of linking them into an executable
file. The name of the library must be set with the <span class="c007">-o</span> option.<p>If <span class="c007">-custom</span>, <span class="c007">-cclib</span> or <span class="c007">-ccopt</span> options are passed on the command
line, these options are stored in the resulting <span class="c007">.cma</span> library. Then,
linking with this library automatically adds back the <span class="c007">-custom</span>,
<span class="c007">-cclib</span> and <span class="c007">-ccopt</span> options as if they had been provided on the
command line, unless the <span class="c007">-noautolink</span> option is given.</p></dd><dt class="dt-description"><span class="c010">-absname</span></dt><dd class="dd-description">
Force error messages to show absolute paths for file names.</dd><dt class="dt-description"><span class="c010">-annot</span></dt><dd class="dd-description">
Dump detailed information about the compilation (types, bindings,
tail-calls, etc). The information for file <span class="c013">src</span><span class="c007">.ml</span>
is put into file <span class="c013">src</span><span class="c007">.annot</span>. In case of a type error, dump
all the information inferred by the type-checker before the error.
The <span class="c013">src</span><span class="c007">.annot</span> file can be used with the emacs commands given in
<span class="c007">emacs/caml-types.el</span> to display types and other annotations
interactively.</dd><dt class="dt-description"><span class="c010">-bin-annot</span></dt><dd class="dd-description">
Dump detailed information about the compilation (types, bindings,
tail-calls, etc) in binary format. The information for file <span class="c013">src</span><span class="c007">.ml</span>
is put into file <span class="c013">src</span><span class="c007">.cmt</span>. In case of a type error, dump
all the information inferred by the type-checker before the error.
The <span class="c007">*.cmt</span> files produced by <span class="c007">-bin-annot</span> contain more information
and are much more compact than the files produced by <span class="c007">-annot</span>.</dd><dt class="dt-description"><span class="c010">-c</span></dt><dd class="dd-description">
Compile only. Suppress the linking phase of the
compilation. Source code files are turned into compiled files, but no
executable file is produced. This option is useful to
compile modules separately.</dd><dt class="dt-description"><span class="c019"><span class="c007">-cc</span> <span class="c013">ccomp</span></span></dt><dd class="dd-description">
Use <span class="c013">ccomp</span> as the C linker when linking in &#X201C;custom runtime&#X201D;
mode (see the <span class="c007">-custom</span> option)
and as the C compiler for compiling <span class="c007">.c</span> source files.</dd><dt class="dt-description"><span class="c019"><span class="c007">-cclib</span> <span class="c007">-l</span><span class="c013">libname</span></span></dt><dd class="dd-description">
Pass the <span class="c007">-l</span><span class="c013">libname</span> option to the C linker when linking in
&#X201C;custom runtime&#X201D; mode (see the <span class="c007">-custom</span> option). This causes the
given C library to be linked with the program.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ccopt</span> <span class="c013">option</span></span></dt><dd class="dd-description">
Pass the given option to the C compiler and linker. When linking in
&#X201C;custom runtime&#X201D; mode, for instance,
<span class="c007">-ccopt -L</span><span class="c013">dir</span> causes the C linker to search for C libraries in
directory <span class="c013">dir</span>. (See the <span class="c007">-custom</span> option.)</dd><dt class="dt-description"><span class="c010">-compat-32</span></dt><dd class="dd-description">
Check that the generated bytecode executable can run on 32-bit
platforms and signal an error if it cannot. This is useful when
compiling bytecode on a 64-bit machine.</dd><dt class="dt-description"><span class="c010">-config</span></dt><dd class="dd-description">
Print the version number of <span class="c007">ocamlc</span> and a detailed summary of its
configuration, then exit.</dd><dt class="dt-description"><span class="c010">-custom</span></dt><dd class="dd-description">
Link in &#X201C;custom runtime&#X201D; mode. In the default linking mode, the
linker produces bytecode that is intended to be executed with the
shared runtime system, <span class="c007">ocamlrun</span>. In the custom runtime mode, the
linker produces an output file that contains both the runtime system
and the bytecode for the program. The resulting file is larger, but it
can be executed directly, even if the <span class="c007">ocamlrun</span> command is not
installed. Moreover, the &#X201C;custom runtime&#X201D; mode enables static
linking of OCaml code with user-defined C functions, as described in
chapter&#XA0;<a href="#c%3Aintf-c">19</a>.
<blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0;
Never use the <span class="c007">strip</span> command on executables produced by <span class="c007">ocamlc -custom</span>,
this would remove the bytecode part of the executable.
</blockquote></dd><dt class="dt-description"><span class="c019"><span class="c007">-dllib</span> <span class="c007">-l</span><span class="c013">libname</span></span></dt><dd class="dd-description">
Arrange for the C shared library <span class="c007">dll</span><span class="c013">libname</span><span class="c007">.so</span>
(<span class="c007">dll</span><span class="c013">libname</span><span class="c007">.dll</span> under Windows) to be loaded dynamically
by the run-time system <span class="c007">ocamlrun</span> at program start-up time.</dd><dt class="dt-description"><span class="c019"><span class="c007">-dllpath</span> <span class="c013">dir</span></span></dt><dd class="dd-description">
Adds the directory <span class="c013">dir</span> to the run-time search path for shared
C libraries. At link-time, shared libraries are searched in the
standard search path (the one corresponding to the <span class="c007">-I</span> option).
The <span class="c007">-dllpath</span> option simply stores <span class="c013">dir</span> in the produced
executable file, where <span class="c007">ocamlrun</span> can find it and use it as
described in section&#XA0;<a href="#s-ocamlrun-dllpath">10.3</a>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-for-pack</span> <span class="c013">ident</span></span></dt><dd class="dd-description">
This option is accepted for compatibility with <span class="c007">ocamlopt</span>; it does
nothing.</dd><dt class="dt-description"><span class="c010">-g</span></dt><dd class="dd-description">
Add debugging information while compiling and linking. This option is
required in order to be able to debug the program with <span class="c007">ocamldebug</span>
(see chapter&#XA0;<a href="#c%3Adebugger">16</a>), and to produce stack backtraces when
the program terminates on an uncaught exception (see
section&#XA0;<a href="#ocamlrun-options">10.2</a>).</dd><dt class="dt-description"><span class="c010">-i</span></dt><dd class="dd-description">
Cause the compiler to print all defined names (with their inferred
types or their definitions) when compiling an implementation (<span class="c007">.ml</span>
file). No compiled files (<span class="c007">.cmo</span> and <span class="c007">.cmi</span> files) are produced.
This can be useful to check the types inferred by the
compiler. Also, since the output follows the syntax of interfaces, it
can help in writing an explicit interface (<span class="c007">.mli</span> file) for a file:
just redirect the standard output of the compiler to a <span class="c007">.mli</span> file,
and edit that file to remove all declarations of unexported names.</dd><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
compiled interface files (<span class="c007">.cmi</span>), compiled object code files
(<span class="c007">.cmo</span>), libraries (<span class="c007">.cma</span>), and C libraries specified with
<span class="c007">-cclib -lxxx</span>. By default, the current directory is
searched first, then the standard library directory. Directories added
with <span class="c007">-I</span> are searched after the current directory, in the order in
which they were given on the command line, but before the standard
library directory.<p>If the given directory starts with <span class="c007">+</span>, it is taken relative to the
standard library directory. For instance, <span class="c007">-I +labltk</span> adds the
subdirectory <span class="c007">labltk</span> of the standard library to the search path.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-impl</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Compile the file <span class="c013">filename</span> as an implementation file, even if its
extension is not <span class="c007">.ml</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intf</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Compile the file <span class="c013">filename</span> as an interface file, even if its
extension is not <span class="c007">.mli</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intf-suffix</span> <span class="c013">string</span></span></dt><dd class="dd-description">
Recognize file names ending with <span class="c013">string</span> as interface files
(instead of the default <span class="c007">.mli</span>).</dd><dt class="dt-description"><span class="c010">-labels</span></dt><dd class="dd-description">
Labels are not ignored in types, labels may be used in applications,
and labelled parameters can be given in any order. This is the default.</dd><dt class="dt-description"><span class="c010">-linkall</span></dt><dd class="dd-description">
Force all modules contained in libraries to be linked in. If this
flag is not given, unreferenced modules are not linked in. When
building a library (option <span class="c007">-a</span>), setting the <span class="c007">-linkall</span> option forces all
subsequent links of programs involving that library to link all the
modules contained in the library.</dd><dt class="dt-description"><span class="c010">-make-runtime</span></dt><dd class="dd-description">
Build a custom runtime system (in the file specified by option <span class="c007">-o</span>)
incorporating the C object files and libraries given on the command
line. This custom runtime system can be used later to execute
bytecode executables produced with the
<span class="c007">ocamlc -use-runtime</span> <span class="c013">runtime-name</span> option.
See section&#XA0;<a href="#s%3Acustom-runtime">19.1.6</a> for more information.</dd><dt class="dt-description"><span class="c010">-no-app-funct</span></dt><dd class="dd-description">
Deactivates the applicative behaviour of functors. With this option,
each functor application generates new types in its result and
applying the same functor twice to the same argument yields two
incompatible structures.</dd><dt class="dt-description"><span class="c010">-noassert</span></dt><dd class="dd-description">
Do not compile assertion checks. Note that the special form
<span class="c007">assert false</span> is always compiled because it is typed specially.
This flag has no effect when linking already-compiled files.</dd><dt class="dt-description"><span class="c010">-noautolink</span></dt><dd class="dd-description">
When linking <span class="c007">.cma</span> libraries, ignore <span class="c007">-custom</span>, <span class="c007">-cclib</span> and <span class="c007">-ccopt</span>
options potentially contained in the libraries (if these options were
given when building the libraries). This can be useful if a library
contains incorrect specifications of C libraries or C options; in this
case, during linking, set <span class="c007">-noautolink</span> and pass the correct C
libraries and options on the command line.</dd><dt class="dt-description"><span class="c010">-nolabels</span></dt><dd class="dd-description">
Ignore non-optional labels in types. Labels cannot be used in
applications, and parameter order becomes strict.</dd><dt class="dt-description"><span class="c010">-nostdlib</span></dt><dd class="dd-description">
Do not include the standard library directory in the list of
directories searched for compiled interfaces (see option <span class="c007">-I</span>).</dd><dt class="dt-description"><span class="c019"><span class="c007">-o</span> <span class="c013">exec-file</span></span></dt><dd class="dd-description">
Specify the name of the output file produced by the compiler. The
default output name is <span class="c007">a.out</span> under Unix and <span class="c007">camlprog.exe</span> under
Windows. If the <span class="c007">-a</span> option is given, specify the name of the library
produced. If the <span class="c007">-pack</span> option is given, specify the name of the
packed object file produced. If the <span class="c007">-output-obj</span> option is given,
specify the name of the output file produced. If the <span class="c007">-c</span> option is
given, specify the name of the object file produced for the <em>next</em>
source file that appears on the command line.</dd><dt class="dt-description"><span class="c010">-output-obj</span></dt><dd class="dd-description">
Cause the linker to produce a C object file instead of a bytecode
executable file. This is useful to wrap OCaml code as a C library,
callable from any C program. See chapter&#XA0;<a href="#c%3Aintf-c">19</a>,
section&#XA0;<a href="#s%3Aembedded-code">19.7.5</a>. The name of the output object file
must be set with the <span class="c007">-o</span> option. This
option can also be used to produce a C source file (<span class="c007">.c</span> extension) or
a compiled shared/dynamic library (<span class="c007">.so</span> extension, <span class="c007">.dll</span> under Windows).</dd><dt class="dt-description"><span class="c010">-pack</span></dt><dd class="dd-description">
Build a bytecode object file (<span class="c007">.cmo</span> file) and its associated compiled
interface (<span class="c007">.cmi</span>) that combines the object
files given on the command line, making them appear as sub-modules of
the output <span class="c007">.cmo</span> file. The name of the output <span class="c007">.cmo</span> file must be
given with the <span class="c007">-o</span> option. For instance,
<pre>        ocamlc -pack -o p.cmo a.cmo b.cmo c.cmo
</pre>generates compiled files <span class="c007">p.cmo</span> and <span class="c007">p.cmi</span> describing a compilation
unit having three sub-modules <span class="c007">A</span>, <span class="c007">B</span> and <span class="c007">C</span>, corresponding to the
contents of the object files <span class="c007">a.cmo</span>, <span class="c007">b.cmo</span> and <span class="c007">c.cmo</span>. These
contents can be referenced as <span class="c007">P.A</span>, <span class="c007">P.B</span> and <span class="c007">P.C</span> in the remainder
of the program.</dd><dt class="dt-description"><span class="c019"><span class="c007">-pp</span> <span class="c013">command</span></span></dt><dd class="dd-description">
Cause the compiler to call the given <span class="c013">command</span> as a preprocessor
for each source file. The output of <span class="c013">command</span> is redirected to
an intermediate file, which is compiled. If there are no compilation
errors, the intermediate file is deleted afterwards.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ppx</span> <span class="c013">command</span></span></dt><dd class="dd-description">
After parsing, pipe the abstract syntax tree through the preprocessor
<span class="c013">command</span>. The format of the input and ouput of the preprocessor
are not yet documented.</dd><dt class="dt-description"><span class="c010">-principal</span></dt><dd class="dd-description">
Check information path during type-checking, to make sure that all
types are derived in a principal way. When using labelled arguments
and/or polymorphic methods, this flag is required to ensure future
versions of the compiler will be able to infer types correctly, even
if internal algorithms change.
All programs accepted in <span class="c007">-principal</span> mode are also accepted in the
default mode with equivalent types, but different binary signatures,
and this may slow down type checking; yet it is a good idea to
use it once before publishing source code.</dd><dt class="dt-description"><span class="c010">-rectypes</span></dt><dd class="dd-description">
Allow arbitrary recursive types during type-checking. By default,
only recursive types where the recursion goes through an object type
are supported. Note that once you have created an interface using this
flag, you must use it again for all dependencies.</dd><dt class="dt-description"><span class="c019"><span class="c007">-runtime-variant</span> <span class="c013">suffix</span></span></dt><dd class="dd-description">
Add the <span class="c013">suffix</span> string to the name of the runtime library used by
the program. Currently, only one such suffix is supported: <span class="c007">d</span>, and
only if the OCaml compiler was configured with option
<span class="c007">-with-debug-runtime</span>. This suffix gives the debug version of the
runtime, which is useful for debugging pointer problems in low-level
code such as C stubs.</dd><dt class="dt-description"><span class="c010">-short-paths</span></dt><dd class="dd-description">
When a type is visible under several module-paths, use the shortest
one when printing the type&#X2019;s name in inferred interfaces and error and
warning messages.</dd><dt class="dt-description"><span class="c010">-strict-sequence</span></dt><dd class="dd-description">
Force the left-hand part of each sequence to have type unit.</dd><dt class="dt-description"><span class="c010">-thread</span></dt><dd class="dd-description">
Compile or link multithreaded programs, in combination with the
system <span class="c007">threads</span> library described in chapter&#XA0;<a href="#c%3Athreads">25</a>.</dd><dt class="dt-description"><span class="c010">-unsafe</span></dt><dd class="dd-description">
Turn bound checking off for array and string accesses (the <span class="c007">v.(i)</span> and
<span class="c007">s.[i]</span> constructs). Programs compiled with <span class="c007">-unsafe</span> are therefore
slightly faster, but unsafe: anything can happen if the program
accesses an array or string outside of its bounds.</dd><dt class="dt-description"><span class="c019"><span class="c007">-use-runtime</span> <span class="c013">runtime-name</span></span></dt><dd class="dd-description">
Generate a bytecode executable file that can be executed on the custom
runtime system <span class="c013">runtime-name</span>, built earlier with
<span class="c007">ocamlc -make-runtime</span> <span class="c013">runtime-name</span>.
See section&#XA0;<a href="#s%3Acustom-runtime">19.1.6</a> for more information.</dd><dt class="dt-description"><span class="c010">-v</span></dt><dd class="dd-description">
Print the version number of the compiler and the location of the
standard library directory, then exit.</dd><dt class="dt-description"><span class="c010">-verbose</span></dt><dd class="dd-description">
Print all external commands before they are executed, in particular
invocations of the C compiler and linker in <span class="c007">-custom</span> mode. Useful to
debug C library problems.</dd><dt class="dt-description"><span class="c010">-vmthread</span></dt><dd class="dd-description">
Compile or link multithreaded programs, in combination with the
VM-level <span class="c007">threads</span> library described in chapter&#XA0;<a href="#c%3Athreads">25</a>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-vnum</span> or <span class="c007">-version</span></span></dt><dd class="dd-description">
Print the version number of the compiler in short form (e.g. <span class="c007">3.11.0</span>),
then exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-w</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Enable, disable, or mark as fatal the warnings specified by the argument
<span class="c013">warning-list</span>.
Each warning can be <em>enabled</em> or <em>disabled</em>, and each warning
can be <em>fatal</em> or <em>non-fatal</em>.
If a warning is disabled, it isn&#X2019;t displayed and doesn&#X2019;t affect
compilation in any way (even if it is fatal). If a warning is
enabled, it is displayed normally by the compiler whenever the source
code triggers it. If it is enabled and fatal, the compiler will also
stop with an error after displaying it.<p>The <span class="c013">warning-list</span> argument is a sequence of warning specifiers,
with no separators between them. A warning specifier is one of the
following:</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">+</span><span class="c013">num</span></span></dt><dd class="dd-description"> Enable warning number <span class="c013">num</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span><span class="c013">num</span></span></dt><dd class="dd-description"> Disable warning number <span class="c013">num</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">@</span><span class="c013">num</span></span></dt><dd class="dd-description"> Enable and mark as fatal warning number <span class="c013">num</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">+</span><span class="c013">num1</span>..<span class="c013">num2</span></span></dt><dd class="dd-description"> Enable warnings in the given range.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span><span class="c013">num1</span>..<span class="c013">num2</span></span></dt><dd class="dd-description"> Disable warnings in the given range.
</dd><dt class="dt-description"><span class="c019"><span class="c007">@</span><span class="c013">num1</span>..<span class="c013">num2</span></span></dt><dd class="dd-description"> Enable and mark as fatal warnings in
the given range.
</dd><dt class="dt-description"><span class="c019"><span class="c007">+</span><span class="c013">letter</span></span></dt><dd class="dd-description"> Enable the set of warnings corresponding to
<span class="c013">letter</span>. The letter may be uppercase or lowercase.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span><span class="c013">letter</span></span></dt><dd class="dd-description"> Disable the set of warnings corresponding to
<span class="c013">letter</span>. The letter may be uppercase or lowercase.
</dd><dt class="dt-description"><span class="c019"><span class="c007">@</span><span class="c013">letter</span></span></dt><dd class="dd-description"> Enable and mark as fatal the set of warnings
corresponding to <span class="c013">letter</span>. The letter may be uppercase or
lowercase.
</dd><dt class="dt-description"><span class="c017">uppercase-letter</span></dt><dd class="dd-description"> Enable the set of warnings corresponding
to <span class="c013">uppercase-letter</span>.
</dd><dt class="dt-description"><span class="c017">lowercase-letter</span></dt><dd class="dd-description"> Disable the set of warnings corresponding
to <span class="c013">lowercase-letter</span>.
</dd></dl><p>Warning numbers and letters which are out of the range of warnings
that are currently defined are ignored. The warning are as follows.
</p><dl class="description"><dt class="dt-description">
<span class="c019">1</span></dt><dd class="dd-description"> Suspicious-looking start-of-comment mark.
</dd><dt class="dt-description"><span class="c019">2</span></dt><dd class="dd-description"> Suspicious-looking end-of-comment mark.
</dd><dt class="dt-description"><span class="c019">3</span></dt><dd class="dd-description"> Deprecated feature.
</dd><dt class="dt-description"><span class="c019">4</span></dt><dd class="dd-description"> Fragile pattern matching: matching that will remain complete even
if additional constructors are added to one of the variant types
matched.
</dd><dt class="dt-description"><span class="c019">5</span></dt><dd class="dd-description"> Partially applied function: expression whose result has function
type and is ignored.
</dd><dt class="dt-description"><span class="c019">6</span></dt><dd class="dd-description"> Label omitted in function application.
</dd><dt class="dt-description"><span class="c019">7</span></dt><dd class="dd-description"> Method overridden.
</dd><dt class="dt-description"><span class="c019">8</span></dt><dd class="dd-description"> Partial match: missing cases in pattern-matching.
</dd><dt class="dt-description"><span class="c019">9</span></dt><dd class="dd-description"> Missing fields in a record pattern.
</dd><dt class="dt-description"><span class="c019">10</span></dt><dd class="dd-description"> Expression on the left-hand side of a sequence that doesn&#X2019;t have type
<span class="c007">unit</span> (and that is not a function, see warning number 5).
</dd><dt class="dt-description"><span class="c019">11</span></dt><dd class="dd-description"> Redundant case in a pattern matching (unused match case).
</dd><dt class="dt-description"><span class="c019">12</span></dt><dd class="dd-description"> Redundant sub-pattern in a pattern-matching.
</dd><dt class="dt-description"><span class="c019">13</span></dt><dd class="dd-description"> Instance variable overridden.
</dd><dt class="dt-description"><span class="c019">14</span></dt><dd class="dd-description"> Illegal backslash escape in a string constant.
</dd><dt class="dt-description"><span class="c019">15</span></dt><dd class="dd-description"> Private method made public implicitly.
</dd><dt class="dt-description"><span class="c019">16</span></dt><dd class="dd-description"> Unerasable optional argument.
</dd><dt class="dt-description"><span class="c019">17</span></dt><dd class="dd-description"> Undeclared virtual method.
</dd><dt class="dt-description"><span class="c019">18</span></dt><dd class="dd-description"> Non-principal type.
</dd><dt class="dt-description"><span class="c019">19</span></dt><dd class="dd-description"> Type without principality.
</dd><dt class="dt-description"><span class="c019">20</span></dt><dd class="dd-description"> Unused function argument.
</dd><dt class="dt-description"><span class="c019">21</span></dt><dd class="dd-description"> Non-returning statement.
</dd><dt class="dt-description"><span class="c019">22</span></dt><dd class="dd-description"> Camlp4 warning.
</dd><dt class="dt-description"><span class="c019">23</span></dt><dd class="dd-description"> Useless record <span class="c007">with</span> clause.
</dd><dt class="dt-description"><span class="c019">24</span></dt><dd class="dd-description"> Bad module name: the source file name is not a valid OCaml module name.
</dd><dt class="dt-description"><span class="c019">25</span></dt><dd class="dd-description"> Pattern-matching with all clauses guarded. Exhaustiveness cannot be
checked.
</dd><dt class="dt-description"><span class="c019">26</span></dt><dd class="dd-description"> Suspicious unused variable: unused variable that is bound
with <span class="c007">let</span> or <span class="c007">as</span>, and doesn&#X2019;t start with an underscore (<span class="c007">_</span>)
character.
</dd><dt class="dt-description"><span class="c019">27</span></dt><dd class="dd-description"> Innocuous unused variable: unused variable that is not bound with
<span class="c007">let</span> nor <span class="c007">as</span>, and doesn&#X2019;t start with an underscore (<span class="c007">_</span>)
character.
</dd><dt class="dt-description"><span class="c019">28</span></dt><dd class="dd-description"> Wildcard pattern given as argument to a constant constructor.
</dd><dt class="dt-description"><span class="c019">29</span></dt><dd class="dd-description"> Unescaped end-of-line in a string constant (non-portable code).
</dd><dt class="dt-description"><span class="c019">30</span></dt><dd class="dd-description"> Two labels or constructors of the same name are defined in two
mutually recursive types.
</dd><dt class="dt-description"><span class="c019">31</span></dt><dd class="dd-description"> A module is linked twice in the same executable.
</dd><dt class="dt-description"><span class="c019">32</span></dt><dd class="dd-description"> Unused value declaration.
</dd><dt class="dt-description"><span class="c019">33</span></dt><dd class="dd-description"> Unused open statement.
</dd><dt class="dt-description"><span class="c019">34</span></dt><dd class="dd-description"> Unused type declaration.
</dd><dt class="dt-description"><span class="c019">35</span></dt><dd class="dd-description"> Unused for-loop index.
</dd><dt class="dt-description"><span class="c019">36</span></dt><dd class="dd-description"> Unused ancestor variable.
</dd><dt class="dt-description"><span class="c019">37</span></dt><dd class="dd-description"> Unused constructor.
</dd><dt class="dt-description"><span class="c019">38</span></dt><dd class="dd-description"> Unused exception constructor.
</dd><dt class="dt-description"><span class="c019">39</span></dt><dd class="dd-description"> Unused rec flag.
</dd><dt class="dt-description"><span class="c019">40</span></dt><dd class="dd-description"> Constructor or label name used out of scope.
</dd><dt class="dt-description"><span class="c019">41</span></dt><dd class="dd-description"> Ambiguous constructor or label name.
</dd><dt class="dt-description"><span class="c019">42</span></dt><dd class="dd-description"> Disambiguated constructor or label name.
</dd><dt class="dt-description"><span class="c019">43</span></dt><dd class="dd-description"> Nonoptional label applied as optional.
</dd><dt class="dt-description"><span class="c019">44</span></dt><dd class="dd-description"> Open statement shadows an already defined identifier.
</dd><dt class="dt-description"><span class="c019">45</span></dt><dd class="dd-description"> Open statement shadows an already defined label or constructor.
</dd><dt class="dt-description"><span class="c019">A</span></dt><dd class="dd-description"> All warnings.
</dd><dt class="dt-description"><span class="c019">C</span></dt><dd class="dd-description"> Set of warnings 1, 2.
</dd><dt class="dt-description"><span class="c019">D</span></dt><dd class="dd-description"> Synonym for warning 3.
</dd><dt class="dt-description"><span class="c019">E</span></dt><dd class="dd-description"> Synonym for warning 4.
</dd><dt class="dt-description"><span class="c019">F</span></dt><dd class="dd-description"> Synonym for warning 5.
</dd><dt class="dt-description"><span class="c019">K</span></dt><dd class="dd-description"> Set of warnings 32, 33, 34, 35, 36, 37, 38, 39.
</dd><dt class="dt-description"><span class="c019">L</span></dt><dd class="dd-description"> Synonym for warning 6.
</dd><dt class="dt-description"><span class="c019">M</span></dt><dd class="dd-description"> Synonym for warning 7.
</dd><dt class="dt-description"><span class="c019">P</span></dt><dd class="dd-description"> Synonym for warning 8.
</dd><dt class="dt-description"><span class="c019">R</span></dt><dd class="dd-description"> Synonym for warning 9.
</dd><dt class="dt-description"><span class="c019">S</span></dt><dd class="dd-description"> Synonym for warning 10.
</dd><dt class="dt-description"><span class="c019">U</span></dt><dd class="dd-description"> Set of warnings 11, 12.
</dd><dt class="dt-description"><span class="c019">V</span></dt><dd class="dd-description"> Synonym for warning 13.
</dd><dt class="dt-description"><span class="c019">X</span></dt><dd class="dd-description"> Set of warnings 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 30.
</dd><dt class="dt-description"><span class="c019">Y</span></dt><dd class="dd-description"> Synonym for warning 26.
</dd><dt class="dt-description"><span class="c019">Z</span></dt><dd class="dd-description"> Synonym for warning 27.

</dd></dl><p>The default setting is <span class="c007">-w +a-4-6-7-9-27-29-32..39-41..42-44-45</span>.
It is displayed by <span class="c007">ocamlc -help</span>.
Note that warnings 5 and 10 are not always triggered, depending on
the internals of the type checker.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-warn-error</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Mark as fatal the warnings specified in the argument <span class="c013">warning-list</span>.
The compiler will stop with an error when one of these warnings is
emitted. The <span class="c013">warning-list</span> has the same meaning as for
the <span class="c007">-w</span> option: a <span class="c007">+</span> sign (or an uppercase letter) marks the
corresponding warnings as fatal, a <span class="c007">-</span>
sign (or a lowercase letter) turns them back into non-fatal warnings, and a
<span class="c007">@</span> sign both enables and marks as fatal the corresponding warnings.<p>Note: it is not recommended to use warning sets (i.e. letters) as
arguments to <span class="c007">-warn-error</span>
in production code, because this can break your build when future versions
of OCaml add some new warnings.</p><p>The default setting is <span class="c007">-warn-error -a</span> (all warnings are non-fatal).</p></dd><dt class="dt-description"><span class="c010">-warn-help</span></dt><dd class="dd-description">
Show the description of all available warning numbers.</dd><dt class="dt-description"><span class="c010">-where</span></dt><dd class="dd-description">
Print the location of the standard library, then exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Process <span class="c013">file</span> as a file name, even if it starts with a dash (<span class="c007">-</span>)
character.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl>
<!--TOC section id="sec244" Modules and the file system-->
<h2 class="section" id="sec244">8.3&#XA0;&#XA0;Modules and the file system</h2><!--SEC END --><p>This short section is intended to clarify the relationship between the
names of the modules corresponding to compilation units and the names
of the files that contain their compiled interface and compiled
implementation.</p><p>The compiler always derives the module name by taking the capitalized
base name of the source file (<span class="c007">.ml</span> or <span class="c007">.mli</span> file). That is, it
strips the leading directory name, if any, as well as the <span class="c007">.ml</span> or
<span class="c007">.mli</span> suffix; then, it set the first letter to uppercase, in order to
comply with the requirement that module names must be capitalized.
For instance, compiling the file <span class="c007">mylib/misc.ml</span> provides an
implementation for the module named <span class="c007">Misc</span>. Other compilation units
may refer to components defined in <span class="c007">mylib/misc.ml</span> under the names
<span class="c007">Misc.</span><span class="c013">name</span>; they can also do <span class="c007">open Misc</span>, then use unqualified
names <span class="c013">name</span>.</p><p>The <span class="c007">.cmi</span> and <span class="c007">.cmo</span> files produced by the compiler have the same
base name as the source file. Hence, the compiled files always have
their base name equal (modulo capitalization of the first letter) to
the name of the module they describe (for <span class="c007">.cmi</span> files) or implement
(for <span class="c007">.cmo</span> files).</p><p>When the compiler encounters a reference to a free module identifier
<span class="c007">Mod</span>, it looks in the search path for a file named <span class="c007">Mod.cmi</span> or <span class="c007">mod.cmi</span>
and loads the compiled interface
contained in that file. As a consequence, renaming <span class="c007">.cmi</span> files is not
advised: the name of a <span class="c007">.cmi</span> file must always correspond to the name
of the compilation unit it implements. It is admissible to move them
to another directory, if their base name is preserved, and the correct
<span class="c007">-I</span> options are given to the compiler. The compiler will flag an
error if it loads a <span class="c007">.cmi</span> file that has been renamed.</p><p>Compiled bytecode files (<span class="c007">.cmo</span> files), on the other hand, can be
freely renamed once created. That&#X2019;s because the linker never attempts
to find by itself the <span class="c007">.cmo</span> file that implements a module with a
given name: it relies instead on the user providing the list of <span class="c007">.cmo</span>
files by hand.</p>
<!--TOC section id="sec245" Common errors-->
<h2 class="section" id="sec245">8.4&#XA0;&#XA0;Common errors</h2><!--SEC END --><p> <a id="s:comp-errors"></a></p><p>This section describes and explains the most frequently encountered
error messages.</p><dl class="description"><dt class="dt-description"><span class="c019">Cannot find file <span class="c013">filename</span></span></dt><dd class="dd-description">
The named file could not be found in the current directory, nor in the
directories of the search path. The <span class="c013">filename</span> is either a
compiled interface file (<span class="c007">.cmi</span> file), or a compiled bytecode file
(<span class="c007">.cmo</span> file). If <span class="c013">filename</span> has the format <span class="c013">mod</span><span class="c007">.cmi</span>, this
means you are trying to compile a file that references identifiers
from module <span class="c013">mod</span>, but you have not yet compiled an interface for
module <span class="c013">mod</span>. Fix: compile <span class="c013">mod</span><span class="c007">.mli</span> or <span class="c013">mod</span><span class="c007">.ml</span>
first, to create the compiled interface <span class="c013">mod</span><span class="c007">.cmi</span>.<p>If <span class="c013">filename</span> has the format <span class="c013">mod</span><span class="c007">.cmo</span>, this
means you are trying to link a bytecode object file that does not
exist yet. Fix: compile <span class="c013">mod</span><span class="c007">.ml</span> first.</p><p>If your program spans several directories, this error can also appear
because you haven&#X2019;t specified the directories to look into. Fix: add
the correct <span class="c007">-I</span> options to the command line.</p></dd><dt class="dt-description"><span class="c019">Corrupted compiled interface <span class="c013">filename</span></span></dt><dd class="dd-description">
The compiler produces this error when it tries to read a compiled
interface file (<span class="c007">.cmi</span> file) that has the wrong structure. This means
something went wrong when this <span class="c007">.cmi</span> file was written: the disk was
full, the compiler was interrupted in the middle of the file creation,
and so on. This error can also appear if a <span class="c007">.cmi</span> file is modified after
its creation by the compiler. Fix: remove the corrupted <span class="c007">.cmi</span> file,
and rebuild it.</dd><dt class="dt-description"><span class="c019">This expression has type </span><span class="c013">t</span><sub>1</sub><span class="c019">, but is used with type </span><span class="c013">t</span><sub>2</sub></dt><dd class="dd-description">
This is by far the most common type error in programs. Type <span class="c013">t</span><sub>1</sub> is
the type inferred for the expression (the part of the program that is
displayed in the error message), by looking at the expression itself.
Type <span class="c013">t</span><sub>2</sub> is the type expected by the context of the expression; it
is deduced by looking at how the value of this expression is used in
the rest of the program. If the two types <span class="c013">t</span><sub>1</sub> and <span class="c013">t</span><sub>2</sub> are not
compatible, then the error above is produced.<p>In some cases, it is hard to understand why the two types <span class="c013">t</span><sub>1</sub> and
<span class="c013">t</span><sub>2</sub> are incompatible. For instance, the compiler can report that
&#X201C;expression of type <span class="c007">foo</span> cannot be used with type <span class="c007">foo</span>&#X201D;, and it
really seems that the two types <span class="c007">foo</span> are compatible. This is not
always true. Two type constructors can have the same name, but
actually represent different types. This can happen if a type
constructor is redefined. Example:
</p><pre>        type foo = A | B
        let f = function A -&gt; 0 | B -&gt; 1
        type foo = C | D
        f C
</pre><p>This result in the error message &#X201C;expression <span class="c007">C</span> of type <span class="c007">foo</span> cannot
be used with type <span class="c007">foo</span>&#X201D;.</p></dd><dt class="dt-description"><span class="c019">The type of this expression, <span class="c013">t</span>, contains type variables
that cannot be generalized</span></dt><dd class="dd-description">
Type variables (<span class="c007">'a</span>, <span class="c007">'b</span>, &#X2026;) in a type <span class="c013">t</span> can be in either
of two states: generalized (which means that the type <span class="c013">t</span> is valid
for all possible instantiations of the variables) and not generalized
(which means that the type <span class="c013">t</span> is valid only for one instantiation
of the variables). In a <span class="c007">let</span> binding <span class="c007">let </span><span class="c013">name</span><span class="c007"> = </span><span class="c013">expr</span>,
the type-checker normally generalizes as many type variables as
possible in the type of <span class="c013">expr</span>. However, this leads to unsoundness
(a well-typed program can crash) in conjunction with polymorphic
mutable data structures. To avoid this, generalization is performed at
<span class="c007">let</span> bindings only if the bound expression <span class="c013">expr</span> belongs to the
class of &#X201C;syntactic values&#X201D;, which includes constants, identifiers,
functions, tuples of syntactic values, etc. In all other cases (for
instance, <span class="c013">expr</span> is a function application), a polymorphic mutable
could have been created and generalization is therefore turned off for
all variables occuring in contravariant or non-variant branches of the
type. For instance, if the type of a non-value is <span class="c007">'a list</span> the
variable is generalizable (<span class="c007">list</span> is a covariant type constructor),
but not in <span class="c007">'a list -&gt; 'a list</span> (the left branch of <span class="c007">-&gt;</span> is
contravariant) or <span class="c007">'a ref</span> (<span class="c007">ref</span> is non-variant).<p>Non-generalized type variables in a type cause no difficulties inside
a given structure or compilation unit (the contents of a <span class="c007">.ml</span> file,
or an interactive session), but they cannot be allowed inside
signatures nor in compiled interfaces (<span class="c007">.cmi</span> file), because they
could be used inconsistently later. Therefore, the compiler
flags an error when a structure or compilation unit defines a value
<span class="c013">name</span> whose type contains non-generalized type variables. There
are two ways to fix this error:
</p><ul class="itemize"><li class="li-itemize">
Add a type constraint or a <span class="c007">.mli</span> file to give a monomorphic
type (without type variables) to <span class="c013">name</span>. For instance, instead of
writing
<pre>    let sort_int_list = Sort.list (&lt;)
    (* inferred type 'a list -&gt; 'a list, with 'a not generalized *)
</pre>write
<pre>    let sort_int_list = (Sort.list (&lt;) : int list -&gt; int list);;
</pre></li><li class="li-itemize">If you really need <span class="c013">name</span> to have a polymorphic type, turn
its defining expression into a function by adding an extra parameter.
For instance, instead of writing
<pre>    let map_length = List.map Array.length
    (* inferred type 'a array list -&gt; int list, with 'a not generalized *)
</pre>write
<pre>    let map_length lv = List.map Array.length lv
</pre></li></ul></dd><dt class="dt-description"><span class="c019">Reference to undefined global <span class="c013">mod</span></span></dt><dd class="dd-description">
This error appears when trying to link an incomplete or incorrectly
ordered set of files. Either you have forgotten to provide an
implementation for the compilation unit named <span class="c013">mod</span> on the command line
(typically, the file named <span class="c013">mod</span><span class="c007">.cmo</span>, or a library containing
that file). Fix: add the missing <span class="c007">.ml</span> or <span class="c007">.cmo</span> file to the command
line. Or, you have provided an implementation for the module named
<span class="c013">mod</span>, but it comes too late on the command line: the
implementation of <span class="c013">mod</span> must come before all bytecode object files
that reference <span class="c013">mod</span>. Fix: change the order of <span class="c007">.ml</span> and <span class="c007">.cmo</span>
files on the command line.<p>Of course, you will always encounter this error if you have mutually
recursive functions across modules. That is, function <span class="c007">Mod1.f</span> calls
function <span class="c007">Mod2.g</span>, and function <span class="c007">Mod2.g</span> calls function <span class="c007">Mod1.f</span>.
In this case, no matter what permutations you perform on the command
line, the program will be rejected at link-time. Fixes:
</p><ul class="itemize"><li class="li-itemize">
Put <span class="c007">f</span> and <span class="c007">g</span> in the same module.
</li><li class="li-itemize">Parameterize one function by the other.
That is, instead of having
<pre>mod1.ml:    let f x = ... Mod2.g ...
mod2.ml:    let g y = ... Mod1.f ...
</pre>define
<pre>mod1.ml:    let f g x = ... g ...
mod2.ml:    let rec g y = ... Mod1.f g ...
</pre>and link <span class="c007">mod1.cmo</span> before <span class="c007">mod2.cmo</span>.
</li><li class="li-itemize">Use a reference to hold one of the two functions, as in :
<pre>mod1.ml:    let forward_g =
                ref((fun x -&gt; failwith "forward_g") : &lt;type&gt;)
            let f x = ... !forward_g ...
mod2.ml:    let g y = ... Mod1.f ...
            let _ = Mod1.forward_g := g
</pre></li></ul></dd><dt class="dt-description"><span class="c019">The external function <span class="c013">f</span> is not available</span></dt><dd class="dd-description">
This error appears when trying to link code that calls external
functions written in C. As explained in
chapter&#XA0;<a href="#c%3Aintf-c">19</a>, such code must be linked with C libraries that
implement the required <span class="c013">f</span> C function. If the C libraries in
question are not shared libraries (DLLs), the code must be linked in
&#X201C;custom runtime&#X201D; mode. Fix: add the required C libraries to the
command line, and possibly the <span class="c007">-custom</span> option.</dd></dl>
<!--TOC chapter id="sec246" The toplevel system (ocaml)-->
<h1 class="chapter" id="sec246">Chapter&#XA0;9&#XA0;&#XA0;The toplevel system (ocaml)</h1><!--SEC END --><p> <a id="c:camllight"></a>

</p><!--NAME toplevel.html-->
<p>This chapter describes the toplevel system for OCaml, that permits
interactive use of the OCaml system
through a read-eval-print loop. In this mode, the system repeatedly
reads OCaml phrases from the input, then typechecks, compile and
evaluate them, then prints the inferred type and result value, if
any. The system prints a <span class="c007">#</span> (sharp) prompt before reading each
phrase.</p><p>Input to the toplevel can span several lines. It is terminated by <span class="c008">;;</span> (a
double-semicolon). The toplevel input consists in one or several
toplevel phrases, with the following syntax:</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="toplevel-input"><span class="c014">toplevel-input</span></a></td><td class="c022">::=</td><td class="c024">
{&#XA0;<a class="syntax" href="#definition"><span class="c014">definition</span></a>&#XA0;}<sup>+</sup>&#XA0;<span class="c008">;;</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#expr"><span class="c014">expr</span></a>&#XA0;<span class="c008">;;</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">#</span>&#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>&#XA0;&#XA0;[&#XA0;<a class="syntax" href="#directive-argument"><span class="c014">directive-argument</span></a>&#XA0;]&#XA0;<span class="c008">;;</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="directive-argument"><span class="c014">directive-argument</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#string-literal"><span class="c014">string-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#integer-literal"><span class="c014">integer-literal</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#value-path"><span class="c014">value-path</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">true</span>&#XA0;&#X2223;&#XA0;&#XA0;<span class="c008">false</span>
</td></tr>
</table></td></tr>
</table><p>A phrase can consist of a definition, like those found in
implementations of compilation units or in <span class="c008">struct</span> &#X2026; <span class="c008">end</span>
module expressions. The definition can bind value names, type names,
an exception, a module name, or a module type name. The toplevel
system performs the bindings, then prints the types and values (if
any) for the names thus defined.</p><p>A phrase may also consist in a value expression
(section&#XA0;<a href="#s%3Avalue-expr">6.7</a>). It is simply evaluated
without performing any bindings, and its value is
printed.</p><p>Finally, a phrase can also consist in a toplevel directive,
starting with <span class="c008">#</span> (the sharp sign). These directives control the
behavior of the toplevel; they are listed below in
section&#XA0;<a href="#s%3Atoplevel-directives">9.2</a>.</p><blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0;
The toplevel system is started by the command <span class="c007">ocaml</span>, as follows:
<pre>
        ocaml <span class="c013">options objects</span>                # interactive mode
        ocaml <span class="c013">options objects scriptfile</span>        # script mode
</pre>
<span class="c013">options</span> are described below.
<span class="c013">objects</span> are filenames ending in <span class="c007">.cmo</span> or <span class="c007">.cma</span>; they are
loaded into the interpreter immediately after <span class="c013">options</span> are set.
<span class="c013">scriptfile</span> is any file name not ending in <span class="c007">.cmo</span> or <span class="c007">.cma</span>.<p>If no <span class="c013">scriptfile</span> is given on the command line, the toplevel system
enters interactive mode: phrases are read on standard input, results
are printed on standard output, errors on standard error. End-of-file
on standard input terminates <span class="c007">ocaml</span> (see also the <span class="c007">#quit</span> directive
in section&#XA0;<a href="#s%3Atoplevel-directives">9.2</a>).</p><p>On start-up (before the first phrase is read), if the file
<span class="c007">.ocamlinit</span> exists in the current directory,
its contents are read as a sequence of OCaml phrases
and executed as per the <span class="c007">#use</span> directive
described in section&#XA0;<a href="#s%3Atoplevel-directives">9.2</a>.
The evaluation outcode for each phrase are not displayed.
If the current directory does not contain an <span class="c007">.ocamlinit</span> file, but
the user&#X2019;s home directory (environment variable <span class="c007">HOME</span>) does, the
latter is read and executed as described below.</p><p>The toplevel system does not perform line editing, but it can
easily be used in conjunction with an external line editor such as
<span class="c007">ledit</span>, <span class="c007">ocaml2</span> or <span class="c007">rlwrap</span>


(see the
<a href="http://caml.inria.fr/humps/index_framed_caml.html">Caml Hump</a>).

Another option is to use <span class="c007">ocaml</span> under Gnu Emacs, which gives the
full editing power of Emacs (command <span class="c007">run-caml</span> from library <span class="c007">inf-caml</span>).</p><p>At any point, the parsing, compilation or evaluation of the current
phrase can be interrupted by pressing <span class="c007">ctrl-C</span> (or, more precisely,
by sending the <span class="c007">INTR</span> signal to the <span class="c007">ocaml</span> process). The toplevel
then immediately returns to the <span class="c007">#</span> prompt.</p><p>If <span class="c013">scriptfile</span> is given on the command-line to <span class="c007">ocaml</span>, the toplevel
system enters script mode: the contents of the file are read as a
sequence of OCaml phrases and executed, as per the <span class="c007">#use</span>
directive (section&#XA0;<a href="#s%3Atoplevel-directives">9.2</a>). The outcome of the
evaluation is not printed. On reaching the end of file, the <span class="c007">ocaml</span>
command exits immediately. No commands are read from standard input.
<span class="c007">Sys.argv</span> is transformed, ignoring all OCaml parameters, and
starting with the script file name in <span class="c007">Sys.argv.(0)</span>.</p><p>In script mode, the first line of the script is ignored if it starts
with <span class="c007">#!</span>. Thus, it should be possible to make the script
itself executable and put as first line <span class="c007">#!/usr/local/bin/ocaml</span>,
thus calling the toplevel system automatically when the script is
run. However, <span class="c007">ocaml</span> itself is a <span class="c007">#!</span> script on most installations
of OCaml, and Unix kernels usually do not handle nested <span class="c007">#!</span>
scripts. A better solution is to put the following as the first line
of the script:
</p><pre>        #!/usr/local/bin/ocamlrun /usr/local/bin/ocaml
</pre></blockquote><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
In addition to the text-only command <span class="c007">ocaml.exe</span>, which works exactly
as under Unix (see above), a graphical user interface for the
toplevel is available under the name <span class="c007">ocamlwin.exe</span>. It should be
launched from the Windows file manager or program manager.
This interface provides a text window in which commands can be entered
and edited, and the toplevel responses are printed.
</blockquote>
<!--TOC section id="sec247" Options-->
<h2 class="section" id="sec247">9.1&#XA0;&#XA0;Options</h2><!--SEC END --><p> <a id="s:toplevel-options"></a></p><p>The following command-line options are recognized by the <span class="c007">ocaml</span> command.</p><dl class="description"><dt class="dt-description"><span class="c010">-absname</span></dt><dd class="dd-description">
Force error messages to show absolute paths for file names.</dd><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
source and compiled files. By default, the current directory is
searched first, then the standard library directory. Directories added
with <span class="c007">-I</span> are searched after the current directory, in the order in
which they were given on the command line, but before the standard
library directory.<p>If the given directory starts with <span class="c007">+</span>, it is taken relative to the
standard library directory. For instance, <span class="c007">-I +labltk</span> adds the
subdirectory <span class="c007">labltk</span> of the standard library to the search path.</p><p>Directories can also be added to the list once
the toplevel is running with the <span class="c007">#directory</span> directive
(section&#XA0;<a href="#s%3Atoplevel-directives">9.2</a>).</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-init</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Load the given file instead of the default initialization file.
The default file is <span class="c007">.ocamlinit</span> in the current directory if it
exists, otherwise <span class="c007">.ocamlinit</span> in the user&#X2019;s home directory.</dd><dt class="dt-description"><span class="c010">-labels</span></dt><dd class="dd-description">
Labels are not ignored in types, labels may be used in applications,
and labelled parameters can be given in any order. This is the default.</dd><dt class="dt-description"><span class="c010">-no-app-funct</span></dt><dd class="dd-description">
Deactivates the applicative behaviour of functors. With this option,
each functor application generates new types in its result and
applying the same functor twice to the same argument yields two
incompatible structures.</dd><dt class="dt-description"><span class="c010">-noassert</span></dt><dd class="dd-description">
Do not compile assertion checks. Note that the special form
<span class="c007">assert false</span> is always compiled because it is typed specially.</dd><dt class="dt-description"><span class="c010">-nolabels</span></dt><dd class="dd-description">
Ignore non-optional labels in types. Labels cannot be used in
applications, and parameter order becomes strict.</dd><dt class="dt-description"><span class="c010">-noprompt</span></dt><dd class="dd-description">
Do not display any prompt when waiting for input.</dd><dt class="dt-description"><span class="c010">-nopromptcont</span></dt><dd class="dd-description">
Do not display the secondary prompt when waiting for continuation
lines in multi-line inputs. This should be used e.g. when running
<span class="c007">ocaml</span> in an <span class="c007">emacs</span> window.</dd><dt class="dt-description"><span class="c010">-nostdlib</span></dt><dd class="dd-description">
Do not include the standard library directory in the list of
directories searched for source and compiled files.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ppx</span> <span class="c013">command</span></span></dt><dd class="dd-description">
After parsing, pipe the abstract syntax tree through the preprocessor
<span class="c013">command</span>. The format of the input and ouput of the preprocessor
are not yet documented.</dd><dt class="dt-description"><span class="c010">-principal</span></dt><dd class="dd-description">
Check information paths during type-checking, to make sure that all
types are derived in a principal way. When using labelled arguments
and/or polymorphic methods, this flag is required to ensure future
versions of the compiler will be able to infer types correctly, even
if internal algorithms change.
All programs accepted in <span class="c007">-principal</span> mode are also accepted in the
default mode with equivalent types, but different binary signatures,
and this may slow down type checking; yet it is a good idea to
use it once before publishing source code.</dd><dt class="dt-description"><span class="c010">-rectypes</span></dt><dd class="dd-description">
Allow arbitrary recursive types during type-checking. By default,
only recursive types where the recursion goes through an object type
are supported.</dd><dt class="dt-description"><span class="c010">-short-paths</span></dt><dd class="dd-description">
When a type is visible under several module-paths, use the shortest
one when printing the type&#X2019;s name in inferred interfaces and error and
warning messages.</dd><dt class="dt-description"><span class="c010">-stdin</span></dt><dd class="dd-description">
Read the standard input as a script file rather than starting an
interactive session.</dd><dt class="dt-description"><span class="c010">-strict-sequence</span></dt><dd class="dd-description">
Force the left-hand part of each sequence to have type unit.</dd><dt class="dt-description"><span class="c010">-unsafe</span></dt><dd class="dd-description">
See the corresponding option for <span class="c007">ocamlc</span>, chapter&#XA0;<a href="#c%3Acamlc">8</a>.
Turn bound checking off on array and string accesses (the <span class="c007">v.(i)</span> and
<span class="c007">s.[i]</span> constructs). Programs compiled with <span class="c007">-unsafe</span> are therefore
slightly faster, but unsafe: anything can happen if the program
accesses an array or string outside of its bounds.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-w</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Enable or disable warnings according to the argument <span class="c013">warning-list</span>.
See section&#XA0;<a href="#s%3Acomp-options">8.2</a> for the syntax of the argument.</dd><dt class="dt-description"><span class="c019"><span class="c007">-warn-error</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Mark as fatal the warnings enabled by the argument <span class="c013">warning-list</span>.
See section&#XA0;<a href="#s%3Acomp-options">8.2</a> for the syntax of the argument.</dd><dt class="dt-description"><span class="c010">-warn-help</span></dt><dd class="dd-description">
Show the description of all available warning numbers.</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Use <span class="c013">file</span> as a script file name, even when it starts with a
hyphen (-).</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl><blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0;
The following environment variables are also consulted:
<dl class="description"><dt class="dt-description">
<span class="c010">LC_CTYPE</span></dt><dd class="dd-description"> If set to <span class="c007">iso_8859_1</span>, accented characters (from the
ISO Latin-1 character set) in string and character literals are
printed as is; otherwise, they are printed as decimal escape sequences
(<span class="c007">\</span><span class="c013">ddd</span>).</dd><dt class="dt-description"><span class="c010">TERM</span></dt><dd class="dd-description"> When printing error messages, the toplevel system
attempts to underline visually the location of the error. It
consults the <span class="c007">TERM</span> variable to determines the type of output terminal
and look up its capabilities in the terminal database.</dd><dt class="dt-description"><span class="c010">HOME</span></dt><dd class="dd-description"> Directory where the <span class="c007">.ocamlinit</span> file is searched.
</dd></dl>
</blockquote>
<!--TOC section id="sec248" Toplevel directives-->
<h2 class="section" id="sec248">9.2&#XA0;&#XA0;Toplevel directives</h2><!--SEC END --><p>
<a id="s:toplevel-directives"></a></p><p>The following directives control the toplevel behavior, load files in
memory, and trace program execution.</p><p><span class="c019">Note:</span> all directives start with a <span class="c007">#</span> (sharp) symbol. This <span class="c007">#</span>
must be typed before the directive, and must not be confused with the
<span class="c007">#</span> prompt displayed by the interactive loop. For instance,
typing <span class="c007">#quit;;</span> will exit the toplevel loop, but typing <span class="c007">quit;;</span>
will result in an &#X201C;unbound value <span class="c007">quit</span>&#X201D; error.</p><dl class="description"><dt class="dt-description"><span class="c010">#quit;;</span></dt><dd class="dd-description">
Exit the toplevel loop and terminate the <span class="c007">ocaml</span> command.</dd><dt class="dt-description"><span class="c019"><span class="c007">#labels </span><span class="c013">bool</span><span class="c007">;;</span></span></dt><dd class="dd-description">
Ignore labels in function types if argument is <span class="c007">false</span>, or switch back
to default behaviour (commuting style) if argument is <span class="c007">true</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">#principal </span><span class="c013">bool</span><span class="c007">;;</span></span></dt><dd class="dd-description">
If the argument is <span class="c007">true</span>, check information paths during
type-checking, to make sure that all types are derived in a principal
way. If the argument is <span class="c007">false</span>, do not check information paths.</dd><dt class="dt-description"><span class="c010">#rectypes;;</span></dt><dd class="dd-description">
Allow arbitrary recursive types during type-checking. Note: once
enabled, this option cannot be disabled because that would lead to
unsoundness of the type system.</dd><dt class="dt-description"><span class="c019"><span class="c007">#warnings "</span><span class="c013">warning-list</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Enable or disable warnings according to the argument.</dd><dt class="dt-description"><span class="c019"><span class="c007">#warn_error "</span><span class="c013">warning-list</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Treat as errors the warnings enabled by the argument and as normal
warnings the warnings disabled by the argument.</dd><dt class="dt-description"><span class="c019"><span class="c007">#directory "</span><span class="c013">dir-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
source and compiled files.</dd><dt class="dt-description"><span class="c019"><span class="c007">#remove_directory "</span><span class="c013">dir-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Remove the given directory from the list of directories searched for
source and compiled files. Do nothing if the list does not contain
the given directory.</dd><dt class="dt-description"><span class="c019"><span class="c007">#cd "</span><span class="c013">dir-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Change the current working directory.</dd><dt class="dt-description"><span class="c019"><span class="c007">#load "</span><span class="c013">file-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Load in memory a bytecode object file (<span class="c007">.cmo</span> file) or library file
(<span class="c007">.cma</span> file) produced by the batch compiler <span class="c007">ocamlc</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">#load_rec "</span><span class="c013">file-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Load in memory a bytecode object file (<span class="c007">.cmo</span> file) or library file
(<span class="c007">.cma</span> file) produced by the batch compiler <span class="c007">ocamlc</span>.
When loading an object file that depends on other modules
which have not been loaded yet, the .cmo files for these modules
are searched and loaded as well, recursively. The loading order
is not specified.</dd><dt class="dt-description"><span class="c019"><span class="c007">#use "</span><span class="c013">file-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Read, compile and execute source phrases from the given file.
This is textual inclusion: phrases are processed just as if
they were typed on standard input. The reading of the file stops at
the first error encountered.</dd><dt class="dt-description"><span class="c019"><span class="c007">#mod_use "</span><span class="c013">file-name</span><span class="c007">";;</span></span></dt><dd class="dd-description">
Similar to <span class="c007">#use</span> but also wrap the code into a top-level module of the
same name as capitalised file name without extensions, following
semantics of the compiler.</dd><dt class="dt-description"><span class="c019"><span class="c007">#install_printer </span><span class="c013">printer-name</span><span class="c007">;;</span></span></dt><dd class="dd-description">
This directive registers the function named <span class="c013">printer-name</span> (a
value path) as a printer for values whose types match the argument
type of the function. That is, the toplevel loop will call
<span class="c013">printer-name</span> when it has such a value to print.<p>The printing function <span class="c013">printer-name</span> should have type
<span class="c005"><span class="c007">Format.formatter</span> <span class="c007">-&gt;</span> <span class="c014">t</span> <span class="c007">-&gt;</span> <span class="c007">unit</span></span>, where <span class="c014">t</span> is the
type for the values to be printed, and should output its textual
representation for the value of type <span class="c014">t</span> on the given formatter,
using the functions provided by the <span class="c007">Format</span> library. For backward
compatibility, <span class="c013">printer-name</span> can also have type
<span class="c014">t</span> <span class="c005"><span class="c007">-&gt;</span> <span class="c007">unit</span></span> and should then output on the standard
formatter, but this usage is deprecated.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">#remove_printer </span><span class="c013">printer-name</span><span class="c007">;;</span></span></dt><dd class="dd-description">
Remove the named function from the table of toplevel printers.</dd><dt class="dt-description"><span class="c019"><span class="c007">#trace </span><span class="c013">function-name</span><span class="c007">;;</span></span></dt><dd class="dd-description">
After executing this directive, all calls to the function named
<span class="c013">function-name</span> will be &#X201C;traced&#X201D;. That is, the argument and the
result are displayed for each call, as well as the exceptions escaping
out of the function, raised either by the function itself or by
another function it calls. If the function is curried, each argument
is printed as it is passed to the function.</dd><dt class="dt-description"><span class="c019"><span class="c007">#untrace </span><span class="c013">function-name</span><span class="c007">;;</span></span></dt><dd class="dd-description">
Stop tracing the given function.</dd><dt class="dt-description"><span class="c010">#untrace_all;;</span></dt><dd class="dd-description">
Stop tracing all functions traced so far.</dd><dt class="dt-description"><span class="c019"><span class="c007">#print_depth </span><span class="c013">n</span><span class="c007">;;</span></span></dt><dd class="dd-description">
Limit the printing of values to a maximal depth of <span class="c013">n</span>.
The parts of values whose depth exceeds <span class="c013">n</span> are printed as <span class="c007">...</span>
(ellipsis).</dd><dt class="dt-description"><span class="c019"><span class="c007">#print_length </span><span class="c013">n</span><span class="c007">;;</span></span></dt><dd class="dd-description">
Limit the number of value nodes printed to at most <span class="c013">n</span>.
Remaining parts of values are printed as <span class="c007">...</span> (ellipsis).</dd></dl>
<!--TOC section id="sec249" The toplevel and the module system-->
<h2 class="section" id="sec249">9.3&#XA0;&#XA0;The toplevel and the module system</h2><!--SEC END --><p> <a id="s:toplevel-modules"></a></p><p>Toplevel phrases can refer to identifiers defined in compilation units
with the same mechanisms as for separately compiled units: either by
using qualified names (<span class="c007">Modulename.localname</span>), or by using
the <span class="c007">open</span> construct and unqualified names (see section&#XA0;<a href="#s%3Anames">6.3</a>).</p><p>However, before referencing another compilation unit, an
implementation of that unit must be present in memory.
At start-up, the toplevel system contains implementations for all the
modules in the the standard library. Implementations for user modules
can be entered with the <span class="c007">#load</span> directive described above. Referencing
a unit for which no implementation has been provided
results in the error <span class="c007">Reference to undefined global `...'</span>.</p><p>Note that entering <span class="c007">open </span><span class="c013">Mod</span> merely accesses the compiled
interface (<span class="c007">.cmi</span> file) for <span class="c013">Mod</span>, but does not load the
implementation of <span class="c013">Mod</span>, and does not cause any error if no
implementation of <span class="c013">Mod</span> has been loaded. The error
&#X201C;reference to undefined global <span class="c013">Mod</span>&#X201D; will occur only when
executing a value or module definition that refers to <span class="c013">Mod</span>.</p>
<!--TOC section id="sec250" Common errors-->
<h2 class="section" id="sec250">9.4&#XA0;&#XA0;Common errors</h2><!--SEC END --><p>This section describes and explains the most frequently encountered
error messages.</p><dl class="description"><dt class="dt-description"><span class="c019">Cannot find file <span class="c013">filename</span></span></dt><dd class="dd-description">
The named file could not be found in the current directory, nor in the
directories of the search path.<p>If <span class="c013">filename</span> has the format <span class="c013">mod</span><span class="c007">.cmi</span>, this
means you have referenced the compilation unit <span class="c013">mod</span>, but its
compiled interface could not be found. Fix: compile <span class="c013">mod</span><span class="c007">.mli</span> or
<span class="c013">mod</span><span class="c007">.ml</span> first, to create the compiled interface <span class="c013">mod</span><span class="c007">.cmi</span>.</p><p>If <span class="c013">filename</span> has the format <span class="c013">mod</span><span class="c007">.cmo</span>, this
means you are trying to load with <span class="c007">#load</span> a bytecode object file that
does not exist yet. Fix: compile <span class="c013">mod</span><span class="c007">.ml</span> first.</p><p>If your program spans several directories, this error can also appear
because you haven&#X2019;t specified the directories to look into. Fix: use
the <span class="c007">#directory</span> directive to add the correct directories to the
search path.</p></dd><dt class="dt-description"><span class="c019">This expression has type </span><span class="c013">t</span><sub>1</sub><span class="c019">, but is used with type </span><span class="c013">t</span><sub>2</sub></dt><dd class="dd-description">
See section&#XA0;<a href="#s%3Acomp-errors">8.4</a>.</dd><dt class="dt-description"><span class="c019">Reference to undefined global <span class="c013">mod</span></span></dt><dd class="dd-description">
You have neglected to load in memory an implementation for a module
with <span class="c007">#load</span>. See section&#XA0;<a href="#s%3Atoplevel-modules">9.3</a> above.</dd></dl>
<!--TOC section id="sec251" Building custom toplevel systems: <span class="c007">ocamlmktop</span>-->
<h2 class="section" id="sec251">9.5&#XA0;&#XA0;Building custom toplevel systems: <span class="c007">ocamlmktop</span></h2><!--SEC END --><p>The <span class="c007">ocamlmktop</span> command builds OCaml toplevels that
contain user code preloaded at start-up.</p><p>The <span class="c007">ocamlmktop</span> command takes as argument a set of <span class="c007">.cmo</span> and <span class="c007">.cma</span>
files, and links them with the object files that implement the OCaml toplevel.
The typical use is:
</p><pre>        ocamlmktop -o mytoplevel foo.cmo bar.cmo gee.cmo
</pre><p>This creates the bytecode file <span class="c007">mytoplevel</span>, containing the OCaml toplevel
system, plus the code from the three <span class="c007">.cmo</span>
files. This toplevel is directly executable and is started by:
</p><pre>        ./mytoplevel
</pre><p>This enters a regular toplevel loop, except that the code from
<span class="c007">foo.cmo</span>, <span class="c007">bar.cmo</span> and <span class="c007">gee.cmo</span> is already loaded in memory, just as
if you had typed:
</p><pre>        #load "foo.cmo";;
        #load "bar.cmo";;
        #load "gee.cmo";;
</pre><p>on entrance to the toplevel. The modules <span class="c007">Foo</span>, <span class="c007">Bar</span> and <span class="c007">Gee</span> are
not opened, though; you still have to do
</p><pre>        open Foo;;
</pre><p>yourself, if this is what you wish.</p>
<!--TOC section id="sec252" Options-->
<h2 class="section" id="sec252">9.6&#XA0;&#XA0;Options</h2><!--SEC END --><p>The following command-line options are recognized by <span class="c007">ocamlmktop</span>.</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-cclib</span> <span class="c013">libname</span></span></dt><dd class="dd-description">
Pass the <span class="c007">-l</span><span class="c013">libname</span> option to the C linker when linking in
&#X201C;custom runtime&#X201D; mode. See the corresponding option for
<span class="c007">ocamlc</span>, in chapter&#XA0;<a href="#c%3Acamlc">8</a>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ccopt</span> <span class="c013">option</span></span></dt><dd class="dd-description">
Pass the given option to the C compiler and linker, when linking in
&#X201C;custom runtime&#X201D; mode. See the corresponding option for
<span class="c007">ocamlc</span>, in chapter&#XA0;<a href="#c%3Acamlc">8</a>.</dd><dt class="dt-description"><span class="c010">-custom</span></dt><dd class="dd-description">
Link in &#X201C;custom runtime&#X201D; mode. See the corresponding option for
<span class="c007">ocamlc</span>, in chapter&#XA0;<a href="#c%3Acamlc">8</a>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
compiled object code files (<span class="c007">.cmo</span> and <span class="c007">.cma</span>).</dd><dt class="dt-description"><span class="c019"><span class="c007">-o</span> <span class="c013">exec-file</span></span></dt><dd class="dd-description">
Specify the name of the toplevel file produced by the linker.
The default is <span class="c007">a.out</span>.</dd></dl>
<!--TOC chapter id="sec253" The runtime system (ocamlrun)-->
<h1 class="chapter" id="sec253">Chapter&#XA0;10&#XA0;&#XA0;The runtime system (ocamlrun)</h1><!--SEC END --><p> <a id="c:runtime"></a>

</p><!--NAME runtime.html-->
<p>The <span class="c007">ocamlrun</span> command executes bytecode files produced by the
linking phase of the <span class="c007">ocamlc</span> command.</p>
<!--TOC section id="sec254" Overview-->
<h2 class="section" id="sec254">10.1&#XA0;&#XA0;Overview</h2><!--SEC END --><p>The <span class="c007">ocamlrun</span> command comprises three main parts: the bytecode
interpreter, that actually executes bytecode files; the memory
allocator and garbage collector; and a set of C functions that
implement primitive operations such as input/output.</p><p>The usage for <span class="c007">ocamlrun</span> is:
</p><pre>
        ocamlrun <span class="c013">options bytecode-executable arg</span><sub>1</sub> ... <span class="c013">arg</span><sub><span class="c013">n</span></sub>
</pre><p>
The first non-option argument is taken to be the name of the file
containing the executable bytecode. (That file is searched in the
executable path as well as in the current directory.) The remaining
arguments are passed to the OCaml program, in the string array
<span class="c007">Sys.argv</span>. Element 0 of this array is the name of the
bytecode executable file; elements 1 to <span class="c013">n</span> are the remaining
arguments <span class="c013">arg</span><sub>1</sub> to <span class="c013">arg</span><sub><span class="c013">n</span></sub>.</p><p>As mentioned in chapter&#XA0;<a href="#c%3Acamlc">8</a>, the bytecode executable files
produced by the <span class="c007">ocamlc</span> command are self-executable, and manage to
launch the <span class="c007">ocamlrun</span> command on themselves automatically. That is,
assuming <span class="c007">a.out</span> is a bytecode executable file,
</p><pre>
        a.out <span class="c013">arg</span><sub>1</sub> ... <span class="c013">arg</span><sub><span class="c013">n</span></sub>
</pre><p>
works exactly as
</p><pre>
        ocamlrun a.out <span class="c013">arg</span><sub>1</sub> ... <span class="c013">arg</span><sub><span class="c013">n</span></sub>
</pre><p>
Notice that it is not possible to pass options to <span class="c007">ocamlrun</span> when
invoking <span class="c007">a.out</span> directly.</p><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
Under several versions of Windows, bytecode executable files are
self-executable only if their name ends in <span class="c007">.exe</span>. It is recommended
to always give <span class="c007">.exe</span> names to bytecode executables, e.g. compile
with <span class="c007">ocamlc -o myprog.exe ...</span> rather than <span class="c007">ocamlc -o myprog ...</span>.
</blockquote>
<!--TOC section id="sec255" Options-->
<h2 class="section" id="sec255">10.2&#XA0;&#XA0;Options</h2><!--SEC END --><p> <a id="ocamlrun-options"></a></p><p>The following command-line options are recognized by <span class="c007">ocamlrun</span>.</p><dl class="description"><dt class="dt-description"><span class="c010">-b</span></dt><dd class="dd-description">
When the program aborts due to an uncaught exception, print a detailed
&#X201C;back trace&#X201D; of the execution, showing where the exception was
raised and which function calls were outstanding at this point. The
back trace is printed only if the bytecode executable contains
debugging information, i.e. was compiled and linked with the <span class="c007">-g</span>
option to <span class="c007">ocamlc</span> set. This is equivalent to setting the <span class="c007">b</span> flag
in the <span class="c007">OCAMLRUNPARAM</span> environment variable (see below).
</dd><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">dir</span></span></dt><dd class="dd-description">
Search the directory <span class="c013">dir</span> for dynamically-loaded libraries,
in addition to the standard search path (see
section&#XA0;<a href="#s-ocamlrun-dllpath">10.3</a>).
</dd><dt class="dt-description"><span class="c010">-p</span></dt><dd class="dd-description">
Print the names of the primitives known to this version of
<span class="c007">ocamlrun</span> and exit.
</dd><dt class="dt-description"><span class="c010">-v</span></dt><dd class="dd-description">
Direct the memory manager to print some progress messages on
standard error. This is equivalent to setting <span class="c007">v=63</span> in the
<span class="c007">OCAMLRUNPARAM</span> environment variable (see below).
</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.
</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd></dl><p>The following environment variables are also consulted:</p><dl class="description"><dt class="dt-description">
<span class="c010">CAML_LD_LIBRARY_PATH</span></dt><dd class="dd-description"> Additional directories to search for
dynamically-loaded libraries (see section&#XA0;<a href="#s-ocamlrun-dllpath">10.3</a>).</dd><dt class="dt-description"><span class="c010">OCAMLLIB</span></dt><dd class="dd-description"> The directory containing the OCaml standard
library. (If <span class="c007">OCAMLLIB</span> is not set, <span class="c007">CAMLLIB</span> will be used instead.)
Used to locate the <span class="c007">ld.conf</span> configuration file for
dynamic loading (see section&#XA0;<a href="#s-ocamlrun-dllpath">10.3</a>). If not set,
default to the library directory specified when compiling OCaml.</dd><dt class="dt-description"><span class="c010">OCAMLRUNPARAM</span></dt><dd class="dd-description"> Set the runtime system options
and garbage collection parameters.
(If <span class="c007">OCAMLRUNPARAM</span> is not set, <span class="c007">CAMLRUNPARAM</span> will be used instead.)
This variable must be a sequence of parameter specifications.
A parameter specification is an option letter followed by an <span class="c007">=</span>
sign, a decimal number (or an hexadecimal number prefixed by <span class="c007">0x</span>),
and an optional multiplier. The options are documented below;
the last six correspond to the fields of the
<span class="c007">control</span> record documented in
<a href="libref/Gc.html">Module <span class="c007">Gc</span></a>.
<dl class="description"><dt class="dt-description">
<span class="c019">b</span></dt><dd class="dd-description"> (backtrace) Trigger the printing of a stack backtrace
when an uncaught exception aborts the program.
This option takes no argument.
</dd><dt class="dt-description"><span class="c019">p</span></dt><dd class="dd-description"> (parser trace) Turn on debugging support for
<span class="c007">ocamlyacc</span>-generated parsers. When this option is on,
the pushdown automaton that executes the parsers prints a
trace of its actions. This option takes no argument.
</dd><dt class="dt-description"><span class="c019">R</span></dt><dd class="dd-description"> (randomize) Turn on randomization of all hash tables by default
(see
<a href="libref/Hashtbl.html">Module <span class="c007">Hashtbl</span></a>).
This option takes no argument.
</dd><dt class="dt-description"><span class="c019">h</span></dt><dd class="dd-description"> The initial size of the major heap (in words).
</dd><dt class="dt-description"><span class="c019">s</span></dt><dd class="dd-description"> (<span class="c007">minor_heap_size</span>) Size of the minor heap. (in words)
</dd><dt class="dt-description"><span class="c019">i</span></dt><dd class="dd-description"> (<span class="c007">major_heap_increment</span>) Default size increment for the
major heap. (in words)
</dd><dt class="dt-description"><span class="c019">o</span></dt><dd class="dd-description"> (<span class="c007">space_overhead</span>) The major GC speed setting.
</dd><dt class="dt-description"><span class="c019">O</span></dt><dd class="dd-description"> (<span class="c007">max_overhead</span>) The heap compaction trigger setting.
</dd><dt class="dt-description"><span class="c019">v</span></dt><dd class="dd-description"> (<span class="c007">verbose</span>) What GC messages to print to stderr. This
is a sum of values selected from the following:
<dl class="description"><dt class="dt-description">
<span class="c019">1 (= 0x001)</span></dt><dd class="dd-description"> Start of major GC cycle.
</dd><dt class="dt-description"><span class="c019">2 (= 0x002)</span></dt><dd class="dd-description"> Minor collection and major GC slice.
</dd><dt class="dt-description"><span class="c019">4 (= 0x004)</span></dt><dd class="dd-description"> Growing and shrinking of the heap.
</dd><dt class="dt-description"><span class="c019">8 (= 0x008)</span></dt><dd class="dd-description"> Resizing of stacks and memory manager tables.
</dd><dt class="dt-description"><span class="c019">16 (= 0x010)</span></dt><dd class="dd-description"> Heap compaction.
</dd><dt class="dt-description"><span class="c019">32 (= 0x020)</span></dt><dd class="dd-description"> Change of GC parameters.
</dd><dt class="dt-description"><span class="c019">64 (= 0x040)</span></dt><dd class="dd-description"> Computation of major GC slice size.
</dd><dt class="dt-description"><span class="c019">128 (= 0x080)</span></dt><dd class="dd-description"> Calling of finalisation functions
</dd><dt class="dt-description"><span class="c019">256 (= 0x100)</span></dt><dd class="dd-description"> Startup messages (loading the bytecode
executable file, resolving shared libraries).
</dd></dl>
</dd><dt class="dt-description"><span class="c019">l</span></dt><dd class="dd-description"> (<span class="c007">stack_limit</span>) The limit (in words) of the stack size.
</dd></dl>
The multiplier is <span class="c007">k</span>, <span class="c007">M</span>, or <span class="c007">G</span>, for multiplication by 2<sup>10</sup>,
2<sup>20</sup>, and 2<sup>30</sup> respectively.
For example, on a 32-bit machine, under <span class="c007">bash</span> the command
<pre>        export OCAMLRUNPARAM='b,s=256k,v=0x015'
</pre> tells a subsequent <span class="c007">ocamlrun</span> to print backtraces for uncaught exceptions,
set its initial minor heap size to 1&#XA0;megabyte and
print a message at the start of each major GC cycle, when the heap
size changes, and when compaction is triggered.</dd><dt class="dt-description"><span class="c010">CAMLRUNPARAM</span></dt><dd class="dd-description"> If <span class="c007">OCAMLRUNPARAM</span> is not found in the
environment, then <span class="c007">CAMLRUNPARAM</span> will be used instead. If
<span class="c007">CAMLRUNPARAM</span> is not found, then the default values will be used.</dd><dt class="dt-description"><span class="c010">PATH</span></dt><dd class="dd-description"> List of directories searched to find the bytecode
executable file.
</dd></dl>
<!--TOC section id="sec256" Dynamic loading of shared libraries-->
<h2 class="section" id="sec256">10.3&#XA0;&#XA0;Dynamic loading of shared libraries</h2><!--SEC END --><p> <a id="s-ocamlrun-dllpath"></a></p><p>On platforms that support dynamic loading, <span class="c007">ocamlrun</span> can link
dynamically with C shared libraries (DLLs) providing additional C primitives
beyond those provided by the standard runtime system. The names for
these libraries are provided at link time as described in
section&#XA0;<a href="#dynlink-c-code">19.1.4</a>), and recorded in the bytecode executable
file; <span class="c007">ocamlrun</span>, then, locates these libraries and resolves references
to their primitives when the bytecode executable program starts.</p><p>The <span class="c007">ocamlrun</span> command searches shared libraries in the following
directories, in the order indicated:
</p><ol class="enumerate" type=1><li class="li-enumerate">
Directories specified on the <span class="c007">ocamlrun</span> command line with the
<span class="c007">-I</span> option.
</li><li class="li-enumerate">Directories specified in the <span class="c007">CAML_LD_LIBRARY_PATH</span> environment
variable.
</li><li class="li-enumerate">Directories specified at link-time via the <span class="c007">-dllpath</span> option to
<span class="c007">ocamlc</span>. (These directories are recorded in the bytecode executable
file.)
</li><li class="li-enumerate">Directories specified in the file <span class="c007">ld.conf</span>. This file resides
in the OCaml standard library directory, and lists directory
names (one per line) to be searched. Typically, it contains only one
line naming the <span class="c007">stublibs</span> subdirectory of the OCaml standard
library directory. Users can add there the names of other directories
containing frequently-used shared libraries; however, for consistency
of installation, we recommend that shared libraries are installed
directly in the system <span class="c007">stublibs</span> directory, rather than adding lines
to the <span class="c007">ld.conf</span> file.
</li><li class="li-enumerate">Default directories searched by the system dynamic loader.
Under Unix, these generally include <span class="c007">/lib</span> and <span class="c007">/usr/lib</span>, plus the
directories listed in the file <span class="c007">/etc/ld.so.conf</span> and the environment
variable <span class="c007">LD_LIBRARY_PATH</span>. Under Windows, these include the Windows
system directories, plus the directories listed in the <span class="c007">PATH</span>
environment variable.
</li></ol>
<!--TOC section id="sec257" Common errors-->
<h2 class="section" id="sec257">10.4&#XA0;&#XA0;Common errors</h2><!--SEC END --><p>This section describes and explains the most frequently encountered
error messages.</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c013">filename</span><span class="c007">: no such file or directory</span></span></dt><dd class="dd-description">
If <span class="c013">filename</span> is the name of a self-executable bytecode file, this
means that either that file does not exist, or that it failed to run
the <span class="c007">ocamlrun</span> bytecode interpreter on itself. The second possibility
indicates that OCaml has not been properly installed on your
system.</dd><dt class="dt-description"><span class="c010">Cannot exec ocamlrun</span></dt><dd class="dd-description">
(When launching a self-executable bytecode file.) The <span class="c007">ocamlrun</span>
could not be found in the executable path. Check that OCaml
has been properly installed on your system.</dd><dt class="dt-description"><span class="c010">Cannot find the bytecode file</span></dt><dd class="dd-description">
The file that <span class="c007">ocamlrun</span> is trying to execute (e.g. the file given as
first non-option argument to <span class="c007">ocamlrun</span>) either does not exist, or is
not a valid executable bytecode file.</dd><dt class="dt-description"><span class="c010">Truncated bytecode file</span></dt><dd class="dd-description">
The file that <span class="c007">ocamlrun</span> is trying to execute is not a valid executable
bytecode file. Probably it has been truncated or mangled since
created. Erase and rebuild it.</dd><dt class="dt-description"><span class="c010">Uncaught exception</span></dt><dd class="dd-description">
The program being executed contains a &#X201C;stray&#X201D; exception. That is,
it raises an exception at some point, and this exception is never
caught. This causes immediate termination of the program. The name of
the exception is printed, along with its string and integer arguments
(arguments of more complex types are not correctly printed).
To locate the context of the uncaught exception, compile the program
with the <span class="c007">-g</span> option and either run it again under the <span class="c007">ocamldebug</span>
debugger (see chapter&#XA0;<a href="#c%3Adebugger">16</a>), or run it with <span class="c007">ocamlrun -b</span>
or with the <span class="c007">OCAMLRUNPARAM</span> environment variable set to <span class="c007">b=1</span>.</dd><dt class="dt-description"><span class="c010">Out of memory</span></dt><dd class="dd-description">
The program being executed requires more memory than available. Either
the program builds excessively large data structures; or the program
contains too many nested function calls, and the stack overflows. In
some cases, your program is perfectly correct, it just requires more
memory than your machine provides. In other cases, the &#X201C;out of
memory&#X201D; message reveals an error in your program: non-terminating
recursive function, allocation of an excessively large array or
string, attempts to build an infinite list or other data structure,
&#X2026;<p>To help you diagnose this error, run your program with the <span class="c007">-v</span> option
to <span class="c007">ocamlrun</span>, or with the <span class="c007">OCAMLRUNPARAM</span> environment variable set to
<span class="c007">v=63</span>. If it displays lots of &#X201C;<span class="c007">Growing stack</span>&#X2026;&#X201D;
messages, this is probably a looping recursive function. If it
displays lots of &#X201C;<span class="c007">Growing heap</span>&#X2026;&#X201D; messages, with the heap size
growing slowly, this is probably an attempt to construct a data
structure with too many (infinitely many?) cells. If it displays few
&#X201C;<span class="c007">Growing heap</span>&#X2026;&#X201D; messages, but with a huge increment in the
heap size, this is probably an attempt to build an excessively large
array or string.</p></dd></dl>
<!--TOC chapter id="sec258" Native-code compilation (ocamlopt)-->
<h1 class="chapter" id="sec258">Chapter&#XA0;11&#XA0;&#XA0;Native-code compilation (ocamlopt)</h1><!--SEC END --><p> <a id="c:nativecomp"></a>

</p><!--NAME native.html-->
<p>This chapter describes the OCaml high-performance
native-code compiler <span class="c007">ocamlopt</span>, which compiles OCaml source files to
native code object files and link these object files to produce
standalone executables.</p><p>The native-code compiler is only available on certain platforms.
It produces code that runs faster than the bytecode produced by
<span class="c007">ocamlc</span>, at the cost of increased compilation time and executable code
size. Compatibility with the bytecode compiler is extremely high: the
same source code should run identically when compiled with <span class="c007">ocamlc</span> and
<span class="c007">ocamlopt</span>.</p><p>It is not possible to mix native-code object files produced by <span class="c007">ocamlopt</span>
with bytecode object files produced by <span class="c007">ocamlc</span>: a program must be
compiled entirely with <span class="c007">ocamlopt</span> or entirely with <span class="c007">ocamlc</span>. Native-code
object files produced by <span class="c007">ocamlopt</span> cannot be loaded in the toplevel
system <span class="c007">ocaml</span>.</p>
<!--TOC section id="sec259" Overview of the compiler-->
<h2 class="section" id="sec259">11.1&#XA0;&#XA0;Overview of the compiler</h2><!--SEC END --><p>The <span class="c007">ocamlopt</span> command has a command-line interface very close to that
of <span class="c007">ocamlc</span>. It accepts the same types of arguments, and processes them
sequentially:</p><ul class="itemize"><li class="li-itemize">
Arguments ending in <span class="c007">.mli</span> are taken to be source files for
compilation unit interfaces. Interfaces specify the names exported by
compilation units: they declare value names with their types, define
public data types, declare abstract data types, and so on. From the
file <span class="c013">x</span><span class="c007">.mli</span>, the <span class="c007">ocamlopt</span> compiler produces a compiled interface
in the file <span class="c013">x</span><span class="c007">.cmi</span>. The interface produced is identical to that
produced by the bytecode compiler <span class="c007">ocamlc</span>.</li><li class="li-itemize">Arguments ending in <span class="c007">.ml</span> are taken to be source files for compilation
unit implementations. Implementations provide definitions for the
names exported by the unit, and also contain expressions to be
evaluated for their side-effects. From the file <span class="c013">x</span><span class="c007">.ml</span>, the <span class="c007">ocamlopt</span>
compiler produces two files: <span class="c013">x</span><span class="c007">.o</span>, containing native object code,
and <span class="c013">x</span><span class="c007">.cmx</span>, containing extra information for linking and
optimization of the clients of the unit. The compiled implementation
should always be referred to under the name <span class="c013">x</span><span class="c007">.cmx</span> (when given
a <span class="c007">.o</span> or <span class="c007">.obj</span> file, <span class="c007">ocamlopt</span> assumes that it contains code compiled from C,
not from OCaml).<p>The implementation is checked against the interface file <span class="c013">x</span><span class="c007">.mli</span>
(if it exists) as described in the manual for <span class="c007">ocamlc</span>
(chapter&#XA0;<a href="#c%3Acamlc">8</a>).</p></li><li class="li-itemize">Arguments ending in <span class="c007">.cmx</span> are taken to be compiled object code. These
files are linked together, along with the object files obtained
by compiling <span class="c007">.ml</span> arguments (if any), and the OCaml standard
library, to produce a native-code executable program. The order in
which <span class="c007">.cmx</span> and <span class="c007">.ml</span> arguments are presented on the command line is
relevant: compilation units are initialized in that order at
run-time, and it is a link-time error to use a component of a unit
before having initialized it. Hence, a given <span class="c013">x</span><span class="c007">.cmx</span> file must come
before all <span class="c007">.cmx</span> files that refer to the unit <span class="c013">x</span>.</li><li class="li-itemize">Arguments ending in <span class="c007">.cmxa</span> are taken to be libraries of object code.
Such a library packs in two files (<span class="c013">lib</span><span class="c007">.cmxa</span> and <span class="c013">lib</span><span class="c007">.a</span>/<span class="c007">.lib</span>)
a set of object files (<span class="c007">.cmx</span> and <span class="c007">.o</span>/<span class="c007">.obj</span> files). Libraries are build with
<span class="c007">ocamlopt -a</span> (see the description of the <span class="c007">-a</span> option below). The object
files contained in the library are linked as regular <span class="c007">.cmx</span> files (see
above), in the order specified when the library was built. The only
difference is that if an object file contained in a library is not
referenced anywhere in the program, then it is not linked in.</li><li class="li-itemize">Arguments ending in <span class="c007">.c</span> are passed to the C compiler, which generates
a <span class="c007">.o</span>/<span class="c007">.obj</span> object file. This object file is linked with the program.</li><li class="li-itemize">Arguments ending in <span class="c007">.o</span>, <span class="c007">.a</span> or <span class="c007">.so</span> (<span class="c007">.obj</span>, <span class="c007">.lib</span> and <span class="c007">.dll</span>
under Windows) are assumed to be C object files and
libraries. They are linked with the program.</li></ul><p>The output of the linking phase is a regular Unix or Windows
executable file. It does not need <span class="c007">ocamlrun</span> to run.</p>
<!--TOC section id="sec260" Options-->
<h2 class="section" id="sec260">11.2&#XA0;&#XA0;Options</h2><!--SEC END --><p>The following command-line options are recognized by <span class="c007">ocamlopt</span>.
The options <span class="c007">-pack</span>, <span class="c007">-a</span>, <span class="c007">-shared</span>, <span class="c007">-c</span> and <span class="c007">-output-obj</span> are mutually
exclusive.</p><dl class="description"><dt class="dt-description"><span class="c010">-a</span></dt><dd class="dd-description">
Build a library (<span class="c007">.cmxa</span> and <span class="c007">.a</span>/<span class="c007">.lib</span> files) with the object files
(<span class="c007">.cmx</span> and <span class="c007">.o</span>/<span class="c007">.obj</span> files) given on the command line, instead of
linking them into an executable file. The name of the library must be
set with the <span class="c007">-o</span> option.<p>If <span class="c007">-cclib</span> or <span class="c007">-ccopt</span> options are passed on the command
line, these options are stored in the resulting <span class="c007">.cmxa</span> library. Then,
linking with this library automatically adds back the
<span class="c007">-cclib</span> and <span class="c007">-ccopt</span> options as if they had been provided on the
command line, unless the <span class="c007">-noautolink</span> option is given.</p></dd><dt class="dt-description"><span class="c010">-absname</span></dt><dd class="dd-description">
Force error messages to show absolute paths for file names.</dd><dt class="dt-description"><span class="c010">-annot</span></dt><dd class="dd-description">
Dump detailed information about the compilation (types, bindings,
tail-calls, etc). The information for file <span class="c013">src</span><span class="c007">.ml</span>
is put into file <span class="c013">src</span><span class="c007">.annot</span>. In case of a type error, dump
all the information inferred by the type-checker before the error.
The <span class="c013">src</span><span class="c007">.annot</span> file can be used with the emacs commands given in
<span class="c007">emacs/caml-types.el</span> to display types and other annotations
interactively.</dd><dt class="dt-description"><span class="c010">-bin-annot</span></dt><dd class="dd-description">
Dump detailed information about the compilation (types, bindings,
tail-calls, etc) in binary format. The information for file <span class="c013">src</span><span class="c007">.ml</span>
is put into file <span class="c013">src</span><span class="c007">.cmt</span>. In case of a type error, dump
all the information inferred by the type-checker before the error.
The <span class="c007">*.cmt</span> files produced by <span class="c007">-bin-annot</span> contain more information
and are much more compact than the files produced by <span class="c007">-annot</span>.</dd><dt class="dt-description"><span class="c010">-c</span></dt><dd class="dd-description">
Compile only. Suppress the linking phase of the
compilation. Source code files are turned into compiled files, but no
executable file is produced. This option is useful to
compile modules separately.</dd><dt class="dt-description"><span class="c019"><span class="c007">-cc</span> <span class="c013">ccomp</span></span></dt><dd class="dd-description">
Use <span class="c013">ccomp</span> as the C linker called to build the final executable
and as the C compiler for compiling <span class="c007">.c</span> source files.</dd><dt class="dt-description"><span class="c019"><span class="c007">-cclib</span> <span class="c007">-l</span><span class="c013">libname</span></span></dt><dd class="dd-description">
Pass the <span class="c007">-l</span><span class="c013">libname</span> option to the linker. This causes the given
C library to be linked with the program.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ccopt</span> <span class="c013">option</span></span></dt><dd class="dd-description">
Pass the given option to the C compiler and linker. For instance,
<span class="c007">-ccopt -L</span><span class="c013">dir</span> causes the C linker to search for C libraries in
directory <span class="c013">dir</span>.</dd><dt class="dt-description"><span class="c010">-compact</span></dt><dd class="dd-description">
Optimize the produced code for space rather than for time. This
results in slightly smaller but slightly slower programs. The default is to
optimize for speed.</dd><dt class="dt-description"><span class="c010">-config</span></dt><dd class="dd-description">
Print the version number of <span class="c007">ocamlopt</span> and a detailed summary of its
configuration, then exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-for-pack</span> <span class="c013">module-path</span></span></dt><dd class="dd-description">
Generate an object file (<span class="c007">.cmx</span> and <span class="c007">.o</span>/<span class="c007">.obj</span> files) that can later be included
as a sub-module (with the given access path) of a compilation unit
constructed with <span class="c007">-pack</span>. For instance, <span class="c007">ocamlopt -for-pack P -c A.ml</span>
will generate <span class="c007">a.cmx</span> and <span class="c007">a.o</span> files that can later be used with
<span class="c007">ocamlopt -pack -o P.cmx a.cmx</span>.</dd><dt class="dt-description"><span class="c010">-g</span></dt><dd class="dd-description">
Add debugging information while compiling and linking. This option is
required in order to produce stack backtraces when
the program terminates on an uncaught exception (see
section&#XA0;<a href="#ocamlrun-options">10.2</a>).</dd><dt class="dt-description"><span class="c010">-i</span></dt><dd class="dd-description">
Cause the compiler to print all defined names (with their inferred
types or their definitions) when compiling an implementation (<span class="c007">.ml</span>
file). No compiled files (<span class="c007">.cmo</span> and <span class="c007">.cmi</span> files) are produced.
This can be useful to check the types inferred by the
compiler. Also, since the output follows the syntax of interfaces, it
can help in writing an explicit interface (<span class="c007">.mli</span> file) for a file:
just redirect the standard output of the compiler to a <span class="c007">.mli</span> file,
and edit that file to remove all declarations of unexported names.</dd><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
compiled interface files (<span class="c007">.cmi</span>), compiled object code files
(<span class="c007">.cmx</span>), and libraries (<span class="c007">.cmxa</span>). By default, the current directory
is searched first, then the standard library directory. Directories
added with <span class="c007">-I</span> are searched after the current directory, in the order
in which they were given on the command line, but before the standard
library directory.<p>If the given directory starts with <span class="c007">+</span>, it is taken relative to the
standard library directory. For instance, <span class="c007">-I +labltk</span> adds the
subdirectory <span class="c007">labltk</span> of the standard library to the search path.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-impl</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Compile the file <span class="c013">filename</span> as an implementation file, even if its
extension is not <span class="c007">.ml</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-inline</span> <span class="c013">n</span></span></dt><dd class="dd-description">
Set aggressiveness of inlining to <span class="c013">n</span>, where <span class="c013">n</span> is a positive
integer. Specifying <span class="c007">-inline 0</span> prevents all functions from being
inlined, except those whose body is smaller than the call site. Thus,
inlining causes no expansion in code size. The default aggressiveness,
<span class="c007">-inline 1</span>, allows slightly larger functions to be inlined, resulting
in a slight expansion in code size. Higher values for the <span class="c007">-inline</span>
option cause larger and larger functions to become candidate for
inlining, but can result in a serious increase in code size.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intf</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Compile the file <span class="c013">filename</span> as an interface file, even if its
extension is not <span class="c007">.mli</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intf-suffix</span> <span class="c013">string</span></span></dt><dd class="dd-description">
Recognize file names ending with <span class="c013">string</span> as interface files
(instead of the default <span class="c007">.mli</span>).</dd><dt class="dt-description"><span class="c010">-labels</span></dt><dd class="dd-description">
Labels are not ignored in types, labels may be used in applications,
and labelled parameters can be given in any order. This is the default.</dd><dt class="dt-description"><span class="c010">-linkall</span></dt><dd class="dd-description">
Force all modules contained in libraries to be linked in. If this
flag is not given, unreferenced modules are not linked in. When
building a library (<span class="c007">-a</span> flag), setting the <span class="c007">-linkall</span> flag forces all
subsequent links of programs involving that library to link all the
modules contained in the library.</dd><dt class="dt-description"><span class="c010">-no-app-funct</span></dt><dd class="dd-description">
Deactivates the applicative behaviour of functors. With this option,
each functor application generates new types in its result and
applying the same functor twice to the same argument yields two
incompatible structures.</dd><dt class="dt-description"><span class="c010">-noassert</span></dt><dd class="dd-description">
Do not compile assertion checks. Note that the special form
<span class="c007">assert false</span> is always compiled because it is typed specially.
This flag has no effect when linking already-compiled files.</dd><dt class="dt-description"><span class="c010">-noautolink</span></dt><dd class="dd-description">
When linking <span class="c007">.cmxa</span> libraries, ignore <span class="c007">-cclib</span> and <span class="c007">-ccopt</span>
options potentially contained in the libraries (if these options were
given when building the libraries). This can be useful if a library
contains incorrect specifications of C libraries or C options; in this
case, during linking, set <span class="c007">-noautolink</span> and pass the correct C
libraries and options on the command line.</dd><dt class="dt-description"><span class="c010">-nodynlink</span></dt><dd class="dd-description">
Allow the compiler to use some optimizations that are valid only for code
that is never dynlinked.</dd><dt class="dt-description"><span class="c010">-nolabels</span></dt><dd class="dd-description">
Ignore non-optional labels in types. Labels cannot be used in
applications, and parameter order becomes strict.</dd><dt class="dt-description"><span class="c019"><span class="c007">-o</span> <span class="c013">exec-file</span></span></dt><dd class="dd-description">
Specify the name of the output file produced by the linker. The
default output name is <span class="c007">a.out</span> under Unix and <span class="c007">camlprog.exe</span> under
Windows. If the <span class="c007">-a</span> option is given, specify the name of the library
produced. If the <span class="c007">-pack</span> option is given, specify the name of the
packed object file produced. If the <span class="c007">-output-obj</span> option is given,
specify the name of the output file produced. If the <span class="c007">-shared</span> option
is given, specify the name of plugin file produced.</dd><dt class="dt-description"><span class="c010">-output-obj</span></dt><dd class="dd-description">
Cause the linker to produce a C object file instead of an executable
file. This is useful to wrap OCaml code as a C library,
callable from any C program. See chapter&#XA0;<a href="#c%3Aintf-c">19</a>,
section&#XA0;<a href="#s%3Aembedded-code">19.7.5</a>. The name of the output object file
must be set with the <span class="c007">-o</span> option.
This option can also be used to produce a compiled shared/dynamic
library (<span class="c007">.so</span> extension, <span class="c007">.dll</span> under Windows).</dd><dt class="dt-description"><span class="c010">-p</span></dt><dd class="dd-description">
Generate extra code to write profile information when the program is
executed. The profile information can then be examined with the
analysis program <span class="c007">gprof</span>. (See chapter&#XA0;<a href="#c%3Aprofiler">17</a> for more
information on profiling.) The <span class="c007">-p</span> option must be given both at
compile-time and at link-time. Linking object files not compiled with
<span class="c007">-p</span> is possible, but results in less precise profiling.<blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0; See the Unix manual page for <span class="c007">gprof(1)</span> for more
information about the profiles.<p>Full support for <span class="c007">gprof</span> is only available for certain platforms
(currently: Intel x86 32 and 64 bits under Linux, BSD and MacOS X).
On other platforms, the <span class="c007">-p</span> option will result in a less precise
profile (no call graph information, only a time profile).
</p></blockquote><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
The <span class="c007">-p</span> option does not work under Windows.
</blockquote></dd><dt class="dt-description"><span class="c010">-pack</span></dt><dd class="dd-description">
Build an object file (<span class="c007">.cmx</span> and <span class="c007">.o</span>/<span class="c007">.obj</span> files) and its associated compiled
interface (<span class="c007">.cmi</span>) that combines the <span class="c007">.cmx</span> object
files given on the command line, making them appear as sub-modules of
the output <span class="c007">.cmx</span> file. The name of the output <span class="c007">.cmx</span> file must be
given with the <span class="c007">-o</span> option. For instance,
<pre>        ocamlopt -pack -o P.cmx A.cmx B.cmx C.cmx
</pre>generates compiled files <span class="c007">P.cmx</span>, <span class="c007">P.o</span> and <span class="c007">P.cmi</span> describing a
compilation unit having three sub-modules <span class="c007">A</span>, <span class="c007">B</span> and <span class="c007">C</span>,
corresponding to the contents of the object files <span class="c007">A.cmx</span>, <span class="c007">B.cmx</span> and
<span class="c007">C.cmx</span>. These contents can be referenced as <span class="c007">P.A</span>, <span class="c007">P.B</span> and <span class="c007">P.C</span>
in the remainder of the program.<p>The <span class="c007">.cmx</span> object files being combined must have been compiled with
the appropriate <span class="c007">-for-pack</span> option. In the example above,
<span class="c007">A.cmx</span>, <span class="c007">B.cmx</span> and <span class="c007">C.cmx</span> must have been compiled with
<span class="c007">ocamlopt -for-pack P</span>.</p><p>Multiple levels of packing can be achieved by combining <span class="c007">-pack</span> with
<span class="c007">-for-pack</span>. Consider the following example:
</p><pre>        ocamlopt -for-pack P.Q -c A.ml
        ocamlopt -pack -o Q.cmx -for-pack P A.cmx
        ocamlopt -for-pack P -c B.ml
        ocamlopt -pack -o P.cmx Q.cmx B.cmx
</pre><p>The resulting <span class="c007">P.cmx</span> object file has sub-modules <span class="c007">P.Q</span>, <span class="c007">P.Q.A</span>
and <span class="c007">P.B</span>.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-pp</span> <span class="c013">command</span></span></dt><dd class="dd-description">
Cause the compiler to call the given <span class="c013">command</span> as a preprocessor
for each source file. The output of <span class="c013">command</span> is redirected to
an intermediate file, which is compiled. If there are no compilation
errors, the intermediate file is deleted afterwards.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ppx</span> <span class="c013">command</span></span></dt><dd class="dd-description">
After parsing, pipe the abstract syntax tree through the preprocessor
<span class="c013">command</span>. The format of the input and ouput of the preprocessor
are not yet documented.</dd><dt class="dt-description"><span class="c010">-principal</span></dt><dd class="dd-description">
Check information path during type-checking, to make sure that all
types are derived in a principal way. All programs accepted in
<span class="c007">-principal</span> mode are also accepted in default mode with equivalent
types, but different binary signatures.</dd><dt class="dt-description"><span class="c010">-rectypes</span></dt><dd class="dd-description">
Allow arbitrary recursive types during type-checking. By default,
only recursive types where the recursion goes through an object type
are supported. Note that once you have created an interface using this
flag, you must use it again for all dependencies.</dd><dt class="dt-description"><span class="c019"><span class="c007">-runtime-variant</span> <span class="c013">suffix</span></span></dt><dd class="dd-description">
Add the <span class="c013">suffix</span> string to the name of the runtime library used by
the program. Currently, only one such suffix is supported: <span class="c007">d</span>, and
only if the OCaml compiler was configured with option
<span class="c007">-with-debug-runtime</span>. This suffix gives the debug version of the
runtime, which is useful for debugging pointer problems in low-level
code such as C stubs.</dd><dt class="dt-description"><span class="c010">-S</span></dt><dd class="dd-description">
Keep the assembly code produced during the compilation. The assembly
code for the source file <span class="c013">x</span><span class="c007">.ml</span> is saved in the file <span class="c013">x</span><span class="c007">.s</span>.</dd><dt class="dt-description"><span class="c010">-shared</span></dt><dd class="dd-description">
Build a plugin (usually <span class="c007">.cmxs</span>) that can be dynamically loaded with
the <span class="c007">Dynlink</span> module. The name of the plugin must be
set with the <span class="c007">-o</span> option. A plugin can include a number of OCaml
modules and libraries, and extra native objects (<span class="c007">.o</span>, <span class="c007">.obj</span>, <span class="c007">.a</span>,
<span class="c007">.lib</span> files). Building native plugins is only supported for some
operating system. Under some systems (currently,
only Linux AMD 64), all the OCaml code linked in a plugin must have
been compiled without the <span class="c007">-nodynlink</span> flag. Some constraints might also
apply to the way the extra native objects have been compiled (under
Linux AMD 64, they must contain only position-independent code).</dd><dt class="dt-description"><span class="c010">-short-paths</span></dt><dd class="dd-description">
When a type is visible under several module-paths, use the shortest
one when printing the type&#X2019;s name in inferred interfaces and error and
warning messages.</dd><dt class="dt-description"><span class="c010">-strict-sequence</span></dt><dd class="dd-description">
Force the left-hand part of each sequence to have type unit.</dd><dt class="dt-description"><span class="c010">-thread</span></dt><dd class="dd-description">
Compile or link multithreaded programs, in combination with the
system <span class="c007">threads</span> library described in chapter&#XA0;<a href="#c%3Athreads">25</a>.</dd><dt class="dt-description"><span class="c010">-unsafe</span></dt><dd class="dd-description">
Turn bound checking off for array and string accesses (the <span class="c007">v.(i)</span> and
<span class="c007">s.[i]</span> constructs). Programs compiled with <span class="c007">-unsafe</span> are therefore
faster, but unsafe: anything can happen if the program accesses an
array or string outside of its bounds. Additionally, turn off the
check for zero divisor in integer division and modulus operations.
With <span class="c007">-unsafe</span>, an integer division (or modulus) by zero can halt the
program or continue with an unspecified result instead of raising a
<span class="c007">Division_by_zero</span> exception.</dd><dt class="dt-description"><span class="c010">-v</span></dt><dd class="dd-description">
Print the version number of the compiler and the location of the
standard library directory, then exit.</dd><dt class="dt-description"><span class="c010">-verbose</span></dt><dd class="dd-description">
Print all external commands before they are executed, in particular
invocations of the assembler, C compiler, and linker.</dd><dt class="dt-description"><span class="c019"><span class="c007">-vnum</span> or <span class="c007">-version</span></span></dt><dd class="dd-description">
Print the version number of the compiler in short form (e.g. <span class="c007">3.11.0</span>),
then exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-w</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Enable, disable, or mark as fatal the warnings specified by the argument
<span class="c013">warning-list</span>.
Each warning can be <em>enabled</em> or <em>disabled</em>, and each warning
can be <em>fatal</em> or <em>non-fatal</em>.
If a warning is disabled, it isn&#X2019;t displayed and doesn&#X2019;t affect
compilation in any way (even if it is fatal). If a warning is
enabled, it is displayed normally by the compiler whenever the source
code triggers it. If it is enabled and fatal, the compiler will also
stop with an error after displaying it.<p>The <span class="c013">warning-list</span> argument is a sequence of warning specifiers,
with no separators between them. A warning specifier is one of the
following:</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">+</span><span class="c013">num</span></span></dt><dd class="dd-description"> Enable warning number <span class="c013">num</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span><span class="c013">num</span></span></dt><dd class="dd-description"> Disable warning number <span class="c013">num</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">@</span><span class="c013">num</span></span></dt><dd class="dd-description"> Enable and mark as fatal warning number <span class="c013">num</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">+</span><span class="c013">num1</span>..<span class="c013">num2</span></span></dt><dd class="dd-description"> Enable warnings in the given range.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span><span class="c013">num1</span>..<span class="c013">num2</span></span></dt><dd class="dd-description"> Disable warnings in the given range.
</dd><dt class="dt-description"><span class="c019"><span class="c007">@</span><span class="c013">num1</span>..<span class="c013">num2</span></span></dt><dd class="dd-description"> Enable and mark as fatal warnings in
the given range.
</dd><dt class="dt-description"><span class="c019"><span class="c007">+</span><span class="c013">letter</span></span></dt><dd class="dd-description"> Enable the set of warnings corresponding to
<span class="c013">letter</span>. The letter may be uppercase or lowercase.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span><span class="c013">letter</span></span></dt><dd class="dd-description"> Disable the set of warnings corresponding to
<span class="c013">letter</span>. The letter may be uppercase or lowercase.
</dd><dt class="dt-description"><span class="c019"><span class="c007">@</span><span class="c013">letter</span></span></dt><dd class="dd-description"> Enable and mark as fatal the set of warnings
corresponding to <span class="c013">letter</span>. The letter may be uppercase or
lowercase.
</dd><dt class="dt-description"><span class="c017">uppercase-letter</span></dt><dd class="dd-description"> Enable the set of warnings corresponding
to <span class="c013">uppercase-letter</span>.
</dd><dt class="dt-description"><span class="c017">lowercase-letter</span></dt><dd class="dd-description"> Disable the set of warnings corresponding
to <span class="c013">lowercase-letter</span>.
</dd></dl><p>Warning numbers and letters which are out of the range of warnings
that are currently defined are ignored. The warning are as follows.
</p><dl class="description"><dt class="dt-description">
<span class="c019">1</span></dt><dd class="dd-description"> Suspicious-looking start-of-comment mark.
</dd><dt class="dt-description"><span class="c019">2</span></dt><dd class="dd-description"> Suspicious-looking end-of-comment mark.
</dd><dt class="dt-description"><span class="c019">3</span></dt><dd class="dd-description"> Deprecated feature.
</dd><dt class="dt-description"><span class="c019">4</span></dt><dd class="dd-description"> Fragile pattern matching: matching that will remain complete even
if additional constructors are added to one of the variant types
matched.
</dd><dt class="dt-description"><span class="c019">5</span></dt><dd class="dd-description"> Partially applied function: expression whose result has function
type and is ignored.
</dd><dt class="dt-description"><span class="c019">6</span></dt><dd class="dd-description"> Label omitted in function application.
</dd><dt class="dt-description"><span class="c019">7</span></dt><dd class="dd-description"> Method overridden.
</dd><dt class="dt-description"><span class="c019">8</span></dt><dd class="dd-description"> Partial match: missing cases in pattern-matching.
</dd><dt class="dt-description"><span class="c019">9</span></dt><dd class="dd-description"> Missing fields in a record pattern.
</dd><dt class="dt-description"><span class="c019">10</span></dt><dd class="dd-description"> Expression on the left-hand side of a sequence that doesn&#X2019;t have type
<span class="c007">unit</span> (and that is not a function, see warning number 5).
</dd><dt class="dt-description"><span class="c019">11</span></dt><dd class="dd-description"> Redundant case in a pattern matching (unused match case).
</dd><dt class="dt-description"><span class="c019">12</span></dt><dd class="dd-description"> Redundant sub-pattern in a pattern-matching.
</dd><dt class="dt-description"><span class="c019">13</span></dt><dd class="dd-description"> Instance variable overridden.
</dd><dt class="dt-description"><span class="c019">14</span></dt><dd class="dd-description"> Illegal backslash escape in a string constant.
</dd><dt class="dt-description"><span class="c019">15</span></dt><dd class="dd-description"> Private method made public implicitly.
</dd><dt class="dt-description"><span class="c019">16</span></dt><dd class="dd-description"> Unerasable optional argument.
</dd><dt class="dt-description"><span class="c019">17</span></dt><dd class="dd-description"> Undeclared virtual method.
</dd><dt class="dt-description"><span class="c019">18</span></dt><dd class="dd-description"> Non-principal type.
</dd><dt class="dt-description"><span class="c019">19</span></dt><dd class="dd-description"> Type without principality.
</dd><dt class="dt-description"><span class="c019">20</span></dt><dd class="dd-description"> Unused function argument.
</dd><dt class="dt-description"><span class="c019">21</span></dt><dd class="dd-description"> Non-returning statement.
</dd><dt class="dt-description"><span class="c019">22</span></dt><dd class="dd-description"> Camlp4 warning.
</dd><dt class="dt-description"><span class="c019">23</span></dt><dd class="dd-description"> Useless record <span class="c007">with</span> clause.
</dd><dt class="dt-description"><span class="c019">24</span></dt><dd class="dd-description"> Bad module name: the source file name is not a valid OCaml module name.
</dd><dt class="dt-description"><span class="c019">25</span></dt><dd class="dd-description"> Pattern-matching with all clauses guarded. Exhaustiveness cannot be
checked.
</dd><dt class="dt-description"><span class="c019">26</span></dt><dd class="dd-description"> Suspicious unused variable: unused variable that is bound
with <span class="c007">let</span> or <span class="c007">as</span>, and doesn&#X2019;t start with an underscore (<span class="c007">_</span>)
character.
</dd><dt class="dt-description"><span class="c019">27</span></dt><dd class="dd-description"> Innocuous unused variable: unused variable that is not bound with
<span class="c007">let</span> nor <span class="c007">as</span>, and doesn&#X2019;t start with an underscore (<span class="c007">_</span>)
character.
</dd><dt class="dt-description"><span class="c019">28</span></dt><dd class="dd-description"> Wildcard pattern given as argument to a constant constructor.
</dd><dt class="dt-description"><span class="c019">29</span></dt><dd class="dd-description"> Unescaped end-of-line in a string constant (non-portable code).
</dd><dt class="dt-description"><span class="c019">30</span></dt><dd class="dd-description"> Two labels or constructors of the same name are defined in two
mutually recursive types.
</dd><dt class="dt-description"><span class="c019">31</span></dt><dd class="dd-description"> A module is linked twice in the same executable.
</dd><dt class="dt-description"><span class="c019">32</span></dt><dd class="dd-description"> Unused value declaration.
</dd><dt class="dt-description"><span class="c019">33</span></dt><dd class="dd-description"> Unused open statement.
</dd><dt class="dt-description"><span class="c019">34</span></dt><dd class="dd-description"> Unused type declaration.
</dd><dt class="dt-description"><span class="c019">35</span></dt><dd class="dd-description"> Unused for-loop index.
</dd><dt class="dt-description"><span class="c019">36</span></dt><dd class="dd-description"> Unused ancestor variable.
</dd><dt class="dt-description"><span class="c019">37</span></dt><dd class="dd-description"> Unused constructor.
</dd><dt class="dt-description"><span class="c019">38</span></dt><dd class="dd-description"> Unused exception constructor.
</dd><dt class="dt-description"><span class="c019">39</span></dt><dd class="dd-description"> Unused rec flag.
</dd><dt class="dt-description"><span class="c019">40</span></dt><dd class="dd-description"> Constructor or label name used out of scope.
</dd><dt class="dt-description"><span class="c019">41</span></dt><dd class="dd-description"> Ambiguous constructor or label name.
</dd><dt class="dt-description"><span class="c019">42</span></dt><dd class="dd-description"> Disambiguated constructor or label name.
</dd><dt class="dt-description"><span class="c019">43</span></dt><dd class="dd-description"> Nonoptional label applied as optional.
</dd><dt class="dt-description"><span class="c019">44</span></dt><dd class="dd-description"> Open statement shadows an already defined identifier.
</dd><dt class="dt-description"><span class="c019">45</span></dt><dd class="dd-description"> Open statement shadows an already defined label or constructor.
</dd><dt class="dt-description"><span class="c019">A</span></dt><dd class="dd-description"> All warnings.
</dd><dt class="dt-description"><span class="c019">C</span></dt><dd class="dd-description"> Set of warnings 1, 2.
</dd><dt class="dt-description"><span class="c019">D</span></dt><dd class="dd-description"> Synonym for warning 3.
</dd><dt class="dt-description"><span class="c019">E</span></dt><dd class="dd-description"> Synonym for warning 4.
</dd><dt class="dt-description"><span class="c019">F</span></dt><dd class="dd-description"> Synonym for warning 5.
</dd><dt class="dt-description"><span class="c019">K</span></dt><dd class="dd-description"> Set of warnings 32, 33, 34, 35, 36, 37, 38, 39.
</dd><dt class="dt-description"><span class="c019">L</span></dt><dd class="dd-description"> Synonym for warning 6.
</dd><dt class="dt-description"><span class="c019">M</span></dt><dd class="dd-description"> Synonym for warning 7.
</dd><dt class="dt-description"><span class="c019">P</span></dt><dd class="dd-description"> Synonym for warning 8.
</dd><dt class="dt-description"><span class="c019">R</span></dt><dd class="dd-description"> Synonym for warning 9.
</dd><dt class="dt-description"><span class="c019">S</span></dt><dd class="dd-description"> Synonym for warning 10.
</dd><dt class="dt-description"><span class="c019">U</span></dt><dd class="dd-description"> Set of warnings 11, 12.
</dd><dt class="dt-description"><span class="c019">V</span></dt><dd class="dd-description"> Synonym for warning 13.
</dd><dt class="dt-description"><span class="c019">X</span></dt><dd class="dd-description"> Set of warnings 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 30.
</dd><dt class="dt-description"><span class="c019">Y</span></dt><dd class="dd-description"> Synonym for warning 26.
</dd><dt class="dt-description"><span class="c019">Z</span></dt><dd class="dd-description"> Synonym for warning 27.

</dd></dl><p>The default setting is <span class="c007">-w +a-4-6-7-9-27-29-32..39-41..42-44-45</span>.
It is displayed by <span class="c007">ocamlopt -help</span>.
Note that warnings 5 and 10 are not always triggered, depending on
the internals of the type checker.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-warn-error</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Mark as fatal the warnings specified in the argument <span class="c013">warning-list</span>.
The compiler will stop with an error when one of these warnings is
emitted. The <span class="c013">warning-list</span> has the same meaning as for
the <span class="c007">-w</span> option: a <span class="c007">+</span> sign (or an uppercase letter) marks the
corresponding warnings as fatal, a <span class="c007">-</span>
sign (or a lowercase letter) turns them back into non-fatal warnings,
and a <span class="c007">@</span> sign both enables and marks as fatal the corresponding
warnings.<p>Note: it is not recommended to use warning sets (i.e. letters) as
arguments to <span class="c007">-warn-error</span>
in production code, because this can break your build when future versions
of OCaml add some new warnings.</p><p>The default setting is <span class="c007">-warn-error -a</span> (all warnings are non-fatal).</p></dd><dt class="dt-description"><span class="c010">-warn-help</span></dt><dd class="dd-description">
Show the description of all available warning numbers.</dd><dt class="dt-description"><span class="c010">-where</span></dt><dd class="dd-description">
Print the location of the standard library, then exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Process <span class="c013">file</span> as a file name, even if it starts with a dash (-)
character.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl>
<!--TOC paragraph id="sec261" Options for the IA32 architecture-->
<h5 class="paragraph" id="sec261">Options for the IA32 architecture</h5><!--SEC END --><p>
The IA32 code generator (Intel Pentium, AMD Athlon) supports the
following additional option:</p><dl class="description"><dt class="dt-description">
<span class="c010">-ffast-math</span></dt><dd class="dd-description"> Use the IA32 instructions to compute
trigonometric and exponential functions, instead of calling the
corresponding library routines. The functions affected are:
<span class="c007">atan</span>, <span class="c007">atan2</span>, <span class="c007">cos</span>, <span class="c007">log</span>, <span class="c007">log10</span>, <span class="c007">sin</span>, <span class="c007">sqrt</span> and <span class="c007">tan</span>.
The resulting code runs faster, but the range of supported arguments
and the precision of the result can be reduced. In particular,
trigonometric operations <span class="c007">cos</span>, <span class="c007">sin</span>, <span class="c007">tan</span> have their range reduced to
[&#X2212;2<sup>64</sup>, 2<sup>64</sup>].
</dd></dl>
<!--TOC paragraph id="sec262" Options for the AMD64 architecture-->
<h5 class="paragraph" id="sec262">Options for the AMD64 architecture</h5><!--SEC END --><p>
The AMD64 code generator (64-bit versions of Intel Pentium and AMD
Athlon) supports the following additional options:</p><dl class="description"><dt class="dt-description">
<span class="c010">-fPIC</span></dt><dd class="dd-description"> Generate position-independent machine code. This is
the default.
</dd><dt class="dt-description"><span class="c010">-fno-PIC</span></dt><dd class="dd-description"> Generate position-dependent machine code.
</dd></dl>
<!--TOC paragraph id="sec263" Options for the Sparc architecture-->
<h5 class="paragraph" id="sec263">Options for the Sparc architecture</h5><!--SEC END --><p>
The Sparc code generator supports the following additional options:
</p><dl class="description"><dt class="dt-description">
<span class="c010">-march=v8</span></dt><dd class="dd-description"> Generate SPARC version 8 code.
</dd><dt class="dt-description"><span class="c010">-march=v9</span></dt><dd class="dd-description"> Generate SPARC version 9 code.
</dd></dl><p>
The default is to generate code for SPARC version 7, which runs on all
SPARC processors.</p>
<!--TOC section id="sec264" Common errors-->
<h2 class="section" id="sec264">11.3&#XA0;&#XA0;Common errors</h2><!--SEC END --><p>The error messages are almost identical to those of <span class="c007">ocamlc</span>.
See section&#XA0;<a href="#s%3Acomp-errors">8.4</a>.</p>
<!--TOC section id="sec265" Running executables produced by ocamlopt-->
<h2 class="section" id="sec265">11.4&#XA0;&#XA0;Running executables produced by ocamlopt</h2><!--SEC END --><p>Executables generated by <span class="c007">ocamlopt</span> are native, stand-alone executable
files that can be invoked directly. They do
not depend on the <span class="c007">ocamlrun</span> bytecode runtime system nor on
dynamically-loaded C/OCaml stub libraries.</p><p>During execution of an <span class="c007">ocamlopt</span>-generated executable,
the following environment variables are also consulted:
</p><dl class="description"><dt class="dt-description">
<span class="c010">OCAMLRUNPARAM</span></dt><dd class="dd-description"> Same usage as in <span class="c007">ocamlrun</span>
(see section&#XA0;<a href="#ocamlrun-options">10.2</a>), except that option <span class="c007">l</span>
is ignored (the operating system&#X2019;s stack size limit
is used instead).
</dd><dt class="dt-description"><span class="c010">CAMLRUNPARAM</span></dt><dd class="dd-description"> If <span class="c007">OCAMLRUNPARAM</span> is not found in the
environment, then <span class="c007">CAMLRUNPARAM</span> will be used instead. If
<span class="c007">CAMLRUNPARAM</span> is not found, then the default values will be used.
</dd></dl>
<!--TOC section id="sec266" Compatibility with the bytecode compiler-->
<h2 class="section" id="sec266">11.5&#XA0;&#XA0;Compatibility with the bytecode compiler</h2><!--SEC END --><p>
<a id="s:compat-native-bytecode"></a></p><p>This section lists the known incompatibilities between the bytecode
compiler and the native-code compiler. Except on those points, the two
compilers should generate code that behave identically.</p><ul class="itemize"><li class="li-itemize">Signals are detected only when the program performs an
allocation in the heap. That is, if a signal is delivered while in a
piece of code that does not allocate, its handler will not be called
until the next heap allocation.</li><li class="li-itemize">Stack overflow, typically caused by excessively deep recursion,
is handled in one of the following ways, depending on the
platform used:
<ul class="itemize"><li class="li-itemize">
By raising a <span class="c007">Stack_overflow</span> exception, like the bytecode
compiler does. (IA32/Linux, AMD64/Linux, PowerPC/MacOSX, MS Windows
32-bit ports).
</li><li class="li-itemize">By aborting the program on a &#X201C;segmentation fault&#X201D; signal.
(All other Unix systems.)
</li><li class="li-itemize">By terminating the program silently.
(MS Windows 64 bits).
</li></ul></li><li class="li-itemize">On IA32 processors only (Intel and AMD x86 processors in 32-bit
mode), some intermediate results in floating-point computations are
kept in extended precision rather than being rounded to double
precision like the bytecode compiler always does. Floating-point
results can therefore differ slightly between bytecode and native code.</li></ul>
<!--TOC chapter id="sec267" Lexer and parser generators (ocamllex, ocamlyacc)-->
<h1 class="chapter" id="sec267">Chapter&#XA0;12&#XA0;&#XA0;Lexer and parser generators (ocamllex, ocamlyacc)</h1><!--SEC END --><p>
<a id="c:ocamlyacc"></a>

</p><!--NAME lexyacc.html-->
<p>This chapter describes two program generators: <span class="c007">ocamllex</span>, that
produces a lexical analyzer from a set of regular expressions with
associated semantic actions, and <span class="c007">ocamlyacc</span>, that produces a parser
from a grammar with associated semantic actions.</p><p>These program generators are very close to the well-known <span class="c007">lex</span> and
<span class="c007">yacc</span> commands that can be found in most C programming environments.
This chapter assumes a working knowledge of <span class="c007">lex</span> and <span class="c007">yacc</span>: while
it describes the input syntax for <span class="c007">ocamllex</span> and <span class="c007">ocamlyacc</span> and the
main differences with <span class="c007">lex</span> and <span class="c007">yacc</span>, it does not explain the basics
of writing a lexer or parser description in <span class="c007">lex</span> and <span class="c007">yacc</span>. Readers
unfamiliar with <span class="c007">lex</span> and <span class="c007">yacc</span> are referred to &#X201C;Compilers:
principles, techniques, and tools&#X201D; by Aho, Sethi and Ullman
(Addison-Wesley, 1986), or &#X201C;Lex &amp; Yacc&#X201D;, by Levine, Mason and
Brown (O&#X2019;Reilly, 1992).</p>
<!--TOC section id="sec268" Overview of <span class="c007">ocamllex</span>-->
<h2 class="section" id="sec268">12.1&#XA0;&#XA0;Overview of <span class="c007">ocamllex</span></h2><!--SEC END --><p>The <span class="c007">ocamllex</span> command produces a lexical analyzer from a set of regular
expressions with attached semantic actions, in the style of
<span class="c007">lex</span>. Assuming the input file is <span class="c013">lexer</span><span class="c007">.mll</span>, executing
</p><pre>
        ocamllex <span class="c013">lexer</span>.mll
</pre><p>
produces OCaml code for a lexical analyzer in file <span class="c013">lexer</span><span class="c007">.ml</span>.
This file defines one lexing function per entry point in the lexer
definition. These functions have the same names as the entry
points. Lexing functions take as argument a lexer buffer, and return
the semantic attribute of the corresponding entry point.</p><p>Lexer buffers are an abstract data type implemented in the standard
library module <span class="c007">Lexing</span>. The functions <span class="c007">Lexing.from_channel</span>,
<span class="c007">Lexing.from_string</span> and <span class="c007">Lexing.from_function</span> create
lexer buffers that read from an input channel, a character string, or
any reading function, respectively. (See the description of module
<span class="c007">Lexing</span> in chapter&#XA0;<a href="#c%3Astdlib">21</a>.)</p><p>When used in conjunction with a parser generated by <span class="c007">ocamlyacc</span>, the
semantic actions compute a value belonging to the type <span class="c007">token</span> defined
by the generated parsing module. (See the description of <span class="c007">ocamlyacc</span>
below.)</p>
<!--TOC subsection id="sec269" Options-->
<h3 class="subsection" id="sec269">12.1.1&#XA0;&#XA0;Options</h3><!--SEC END --><p>
The following command-line options are recognized by <span class="c007">ocamllex</span>.</p><dl class="description"><dt class="dt-description"><span class="c010">-ml</span></dt><dd class="dd-description">
Output code that does not use OCaml&#X2019;s built-in automata
interpreter. Instead, the automaton is encoded by OCaml functions.
This option mainly is useful for debugging <span class="c007">ocamllex</span>, using it for
production lexers is not recommended.</dd><dt class="dt-description"><span class="c019"><span class="c007">-o</span> <span class="c013">output-file</span></span></dt><dd class="dd-description">
Specify the name of the output file produced by <span class="c007">ocamllex</span>.
The default is the input file name with its extension replaced by <span class="c007">.ml</span>.</dd><dt class="dt-description"><span class="c010">-q</span></dt><dd class="dd-description">
Quiet mode. <span class="c007">ocamllex</span> normally outputs informational messages
to standard output. They are suppressed if option <span class="c007">-q</span> is used.</dd><dt class="dt-description"><span class="c019"><span class="c007">-v</span> or <span class="c007">-version</span></span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl>
<!--TOC section id="sec270" Syntax of lexer definitions-->
<h2 class="section" id="sec270">12.2&#XA0;&#XA0;Syntax of lexer definitions</h2><!--SEC END --><p>The format of lexer definitions is as follows:
</p><pre>
{ <span class="c013">header</span> }
let <span class="c013">ident</span> = <span class="c013">regexp</span> &#X2026;
rule <span class="c013">entrypoint</span> [<span class="c013">arg</span><sub>1</sub>&#X2026; <span class="c013">arg</span><sub><span class="c013">n</span></sub>] =
  parse <span class="c013">regexp</span> { <span class="c013">action</span> }
      | &#X2026;
      | <span class="c013">regexp</span> { <span class="c013">action</span> }
and <span class="c013">entrypoint</span> [<span class="c013">arg</span><sub>1</sub>&#X2026; <span class="c013">arg</span><sub><span class="c013">n</span></sub>] =
  parse &#X2026;
and &#X2026;
{ <span class="c013">trailer</span> }
</pre><p>
Comments are delimited by <span class="c007">(*</span> and <span class="c007">*)</span>, as in OCaml.
The <span class="c007">parse</span> keyword, can be replaced by the <span class="c007">shortest</span> keyword, with
the semantic consequences explained below.</p>
<!--TOC subsection id="sec271" Header and trailer-->
<h3 class="subsection" id="sec271">12.2.1&#XA0;&#XA0;Header and trailer</h3><!--SEC END --><p>
The <span class="c013">header</span> and <span class="c013">trailer</span> sections are arbitrary OCaml
text enclosed in curly braces. Either or both can be omitted. If
present, the header text is copied as is at the beginning of the
output file and the trailer text at the end. Typically, the
header section contains the <span class="c007">open</span> directives required
by the actions, and possibly some auxiliary functions used in the
actions.</p>
<!--TOC subsection id="sec272" Naming regular expressions-->
<h3 class="subsection" id="sec272">12.2.2&#XA0;&#XA0;Naming regular expressions</h3><!--SEC END --><p>Between the header and the entry points, one can give names to
frequently-occurring regular expressions. This is written
<span class="c008">let</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#regexp"><span class="c014">regexp</span></a>.
In regular expressions that follow this declaration, the identifier
<span class="c013">ident</span> can be used as shorthand for <span class="c013">regexp</span>.</p>
<!--TOC subsection id="sec273" Entry points-->
<h3 class="subsection" id="sec273">12.2.3&#XA0;&#XA0;Entry points</h3><!--SEC END --><p>The names of the entry points must be valid identifiers for OCaml
values (starting with a lowercase letter).
Similarily, the arguments <span class="c009">arg</span><sub>1</sub><span class="c007">&#X2026;
<span class="c013">arg</span></span><sub><span class="c013">n</span></sub> must be valid identifiers for OCaml.
Each entry point becomes an
OCaml function that takes <span class="c013">n</span>+1 arguments,
the extra implicit last argument being of type <span class="c007">Lexing.lexbuf</span>.
Characters are read from the <span class="c007">Lexing.lexbuf</span> argument and matched
against the regular expressions provided in the rule, until a prefix
of the input matches one of the rule. The corresponding action is
then evaluated and returned as the result of the function.</p><p>If several regular expressions match a prefix of the input, the
&#X201C;longest match&#X201D; rule applies: the regular expression that matches
the longest prefix of the input is selected. In case of tie, the
regular expression that occurs earlier in the rule is selected.</p><p>However, if lexer rules are introduced with the <span class="c007">shortest</span> keyword in
place of the <span class="c007">parse</span> keyword, then the &#X201C;shortest match&#X201D; rule applies:
the shortest prefix of the input is selected. In case of tie, the
regular expression that occurs earlier in the rule is still selected.
This feature is not intended for use in ordinary lexical analyzers, it
may facilitate the use of <span class="c007">ocamllex</span> as a simple text processing tool.</p>
<!--TOC subsection id="sec274" Regular expressions-->
<h3 class="subsection" id="sec274">12.2.4&#XA0;&#XA0;Regular expressions</h3><!--SEC END --><p>The regular expressions are in the style of <span class="c007">lex</span>, with a more
OCaml-like syntax.
</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="regexp"><span class="c014">regexp</span></a></td><td class="c022">::=</td><td class="c024">
&#X2026;
</td></tr>
</table></td></tr>
</table><dl class="description"><dt class="dt-description"><span class="c008">'</span> <span class="c014">regular-char</span> &#X2223;  <a class="syntax" href="#escape-sequence"><span class="c014">escape-sequence</span></a> <span class="c008">'</span></dt><dd class="dd-description">
A character constant, with the same syntax as OCaml character
constants. Match the denoted character.</dd><dt class="dt-description"><span class="c010">_</span></dt><dd class="dd-description">
(underscore) Match any character.</dd><dt class="dt-description"><span class="c008">eof</span></dt><dd class="dd-description">
Match the end of the lexer input.<br>
<span class="c019">Note:</span> On some systems, with interactive input, an end-of-file
may be followed by more characters. However, <span class="c007">ocamllex</span> will not
correctly handle regular expressions that contain <span class="c007">eof</span> followed by
something else.</dd><dt class="dt-description"><span class="c008">"</span> { <a class="syntax" href="#string-character"><span class="c014">string-character</span></a> } <span class="c008">"</span></dt><dd class="dd-description">
A string constant, with the same syntax as OCaml string
constants. Match the corresponding sequence of characters.</dd><dt class="dt-description"><span class="c005"><span class="c007">[</span> <span class="c014">character-set</span> <span class="c007">]</span></span></dt><dd class="dd-description">
Match any single character belonging to the given
character set. Valid character sets are: single
character constants <span class="c005"><span class="c007">'</span> <span class="c014">c</span> <span class="c007">'</span></span>; ranges of characters
<span class="c008">'</span> <span class="c014">c</span><sub>1</sub> <span class="c005"><span class="c007">'</span> <span class="c007">-</span> <span class="c007">'</span></span> <span class="c014">c</span><sub>2</sub> <span class="c008">'</span> (all characters between <span class="c013">c</span><sub>1</sub> and <span class="c013">c</span><sub>2</sub>,
inclusive); and the union of two or more character sets, denoted by
concatenation.</dd><dt class="dt-description"><span class="c005"><span class="c007">[</span> <span class="c007">^</span> <span class="c014">character-set</span> <span class="c007">]</span></span></dt><dd class="dd-description">
Match any single character not belonging to the given character set.</dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub> <span class="c008">#</span> &#XA0;<a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub></dt><dd class="dd-description">
(difference of character sets)
Regular expressions <a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub> and <a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub> must be character sets
defined with <span class="c008">[</span>&#X2026; <span class="c008">]</span> (or a a single character expression or
underscore <span class="c007">_</span>).
Match the difference of the two specified character sets.</dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">*</span></dt><dd class="dd-description">
(repetition) Match the concatenation of zero or more
strings that match <a class="syntax" href="#regexp"><span class="c014">regexp</span></a>.</dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">+</span></dt><dd class="dd-description">
(strict repetition) Match the concatenation of one or more
strings that match <a class="syntax" href="#regexp"><span class="c014">regexp</span></a>.</dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">?</span></dt><dd class="dd-description">
(option) Match the empty string, or a string matching <a class="syntax" href="#regexp"><span class="c014">regexp</span></a>.</dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub> <span class="c008">|</span> &#XA0;<a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub></dt><dd class="dd-description">
(alternative) Match any string that matches <a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub> or <a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub></dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub> &#XA0;<a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub></dt><dd class="dd-description">
(concatenation) Match the concatenation of two strings, the first
matching <a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub>, the second matching <a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub>.</dd><dt class="dt-description"><span class="c008">(</span> <a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">)</span></dt><dd class="dd-description">
Match the same strings as <a class="syntax" href="#regexp"><span class="c014">regexp</span></a>.</dd><dt class="dt-description"><a class="syntax" href="#ident"><span class="c014">ident</span></a></dt><dd class="dd-description">
Reference the regular expression bound to <a class="syntax" href="#ident"><span class="c014">ident</span></a> by an earlier
<span class="c008">let</span> <a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c008">=</span> &#XA0;<a class="syntax" href="#regexp"><span class="c014">regexp</span></a> definition.</dd><dt class="dt-description"><a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">as</span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a></dt><dd class="dd-description">
Bind the substring matched by <a class="syntax" href="#regexp"><span class="c014">regexp</span></a> to identifier <a class="syntax" href="#ident"><span class="c014">ident</span></a>.
</dd></dl><p>Concerning the precedences of operators, <span class="c007">#</span> has the highest precedence,
followed by <span class="c007">*</span>, <span class="c007">+</span> and <span class="c007">?</span>,
then concatenation, then <span class="c007">|</span> (alternation), then <span class="c007">as</span>.</p>
<!--TOC subsection id="sec275" Actions-->
<h3 class="subsection" id="sec275">12.2.5&#XA0;&#XA0;Actions</h3><!--SEC END --><p>The actions are arbitrary OCaml expressions. They are evaluated in
a context where the identifiers defined by using the <span class="c007">as</span> construct
are bound to subparts of the matched string.
Additionally, <span class="c007">lexbuf</span> is bound to the current lexer
buffer. Some typical uses for <span class="c007">lexbuf</span>, in conjunction with the
operations on lexer buffers provided by the <span class="c007">Lexing</span> standard library
module, are listed below.</p><dl class="description"><dt class="dt-description">
<span class="c010">Lexing.lexeme lexbuf</span></dt><dd class="dd-description">
Return the matched string.</dd><dt class="dt-description"><span class="c010">Lexing.lexeme_char lexbuf </span><span class="c013">n</span></dt><dd class="dd-description">
Return the <span class="c013">n</span><sup><span class="c012">th</span></sup>
character in the matched string. The first character corresponds to <span class="c013">n</span> = 0.</dd><dt class="dt-description"><span class="c010">Lexing.lexeme_start lexbuf</span></dt><dd class="dd-description">
Return the absolute position in the input text of the beginning of the
matched string (i.e. the offset of the first character of the matched
string). The first character read from the input text has offset 0.</dd><dt class="dt-description"><span class="c010">Lexing.lexeme_end lexbuf</span></dt><dd class="dd-description">
Return the absolute position in the input text of the end of the
matched string (i.e. the offset of the first character after the
matched string). The first character read from the input text has
offset 0.</dd><dt class="dt-description"><span class="c019"><span class="c013">entrypoint</span> [<span class="c013">exp</span></span><sub>1</sub><span class="c019">&#X2026; <span class="c013">exp</span></span><sub><span class="c013">n</span></sub><span class="c019">] <span class="c007">lexbuf</span></span></dt><dd class="dd-description">
(Where <span class="c013">entrypoint</span> is the name of another entry point in the same
lexer definition.) Recursively call the lexer on the given entry point.
Notice that <span class="c007">lexbuf</span> is the last argument.
Useful for lexing nested comments, for example.</dd></dl>
<!--TOC subsection id="sec276" Variables in regular expressions-->
<h3 class="subsection" id="sec276">12.2.6&#XA0;&#XA0;Variables in regular expressions</h3><!--SEC END --><p>
The <span class="c007">as</span> construct is similar to &#X201C;<em>groups</em>&#X201D; as provided by
numerous regular expression packages.
The type of these variables can be <span class="c007">string</span>, <span class="c007">char</span>, <span class="c007">string option</span>
or <span class="c007">char option</span>.</p><p>We first consider the case of linear patterns, that is the case when
all <span class="c007">as</span> bound variables are distinct.
In <a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">as</span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a>, the type of <a class="syntax" href="#ident"><span class="c014">ident</span></a> normally is <span class="c007">string</span> (or
<span class="c007">string option</span>) except
when <a class="syntax" href="#regexp"><span class="c014">regexp</span></a> is a character constant, an underscore, a string
constant of length one, a character set specification, or an
alternation of those. Then, the type of <a class="syntax" href="#ident"><span class="c014">ident</span></a> is <span class="c007">char</span> (or <span class="c007">char option</span>).
Option types are introduced when overall rule matching does not
imply matching of the bound sub-pattern. This is in particular the
case of <span class="c008">(</span> <a class="syntax" href="#regexp"><span class="c014">regexp</span></a> <span class="c008">as</span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c005"><span class="c007">)</span> <span class="c007">?</span></span> and of
<a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>1</sub> <span class="c005"><span class="c007">|</span> <span class="c007">(</span></span> &#XA0;<a class="syntax" href="#regexp"><span class="c014">regexp</span></a><sub>2</sub> <span class="c008">as</span> &#XA0;<a class="syntax" href="#ident"><span class="c014">ident</span></a> <span class="c008">)</span>.</p><p>There is no linearity restriction over <span class="c007">as</span> bound variables.
When a variable is bound more than once, the previous rules are to be
extended as follows:
</p><ul class="itemize"><li class="li-itemize">
A variable is a <span class="c007">char</span> variable when all its occurrences bind
<span class="c007">char</span> occurrences in the previous sense.
</li><li class="li-itemize">A variable is an <span class="c007">option</span> variable when the overall expression
can be matched without binding this variable.
</li></ul><p>
For instance, in
<span class="c007">('a' as x) | ( 'a' (_ as x) )</span> the variable <span class="c007">x</span> is of type
<span class="c007">char</span>, whereas in
<span class="c007">("ab" as x) | ( 'a' (_ as x) ? )</span> the variable <span class="c007">x</span> is of type
<span class="c007">string option</span>.</p><p>In some cases, a sucessful match may not yield a unique set of bindings.
For instance the matching of <code>aba</code> by the regular expression
<span class="c007">(('a'|"ab") as x) (("ba"|'a') as y)</span> may result in binding
either
<code>x</code> to <code>"ab"</code> and <code>y</code> to <code>"a"</code>, or
<code>x</code> to <code>"a"</code> and <code>y</code> to <code>"ba"</code>.
The automata produced <span class="c007">ocamllex</span> on such ambiguous regular
expressions will select one of the possible resulting sets of
bindings.
The selected set of bindings is purposely left unspecified.</p>
<!--TOC subsection id="sec277" Reserved identifiers-->
<h3 class="subsection" id="sec277">12.2.7&#XA0;&#XA0;Reserved identifiers</h3><!--SEC END --><p>All identifiers starting with <span class="c007">__ocaml_lex</span> are reserved for use by
<span class="c007">ocamllex</span>; do not use any such identifier in your programs.</p>
<!--TOC section id="sec278" Overview of <span class="c007">ocamlyacc</span>-->
<h2 class="section" id="sec278">12.3&#XA0;&#XA0;Overview of <span class="c007">ocamlyacc</span></h2><!--SEC END --><p>The <span class="c007">ocamlyacc</span> command produces a parser from a context-free grammar
specification with attached semantic actions, in the style of <span class="c007">yacc</span>.
Assuming the input file is <span class="c013">grammar</span><span class="c007">.mly</span>, executing
</p><pre>
        ocamlyacc <span class="c013">options grammar</span>.mly
</pre><p>
produces OCaml code for a parser in the file <span class="c013">grammar</span><span class="c007">.ml</span>,
and its interface in file <span class="c013">grammar</span><span class="c007">.mli</span>.</p><p>The generated module defines one parsing function per entry point in
the grammar. These functions have the same names as the entry points.
Parsing functions take as arguments a lexical analyzer (a function
from lexer buffers to tokens) and a lexer buffer, and return the
semantic attribute of the corresponding entry point. Lexical analyzer
functions are usually generated from a lexer specification by the
<span class="c007">ocamllex</span> program. Lexer buffers are an abstract data type
implemented in the standard library module <span class="c007">Lexing</span>. Tokens are values from
the concrete type <span class="c007">token</span>, defined in the interface file
<span class="c013">grammar</span><span class="c007">.mli</span> produced by <span class="c007">ocamlyacc</span>.</p>
<!--TOC section id="sec279" Syntax of grammar definitions-->
<h2 class="section" id="sec279">12.4&#XA0;&#XA0;Syntax of grammar definitions</h2><!--SEC END --><p>Grammar definitions have the following format:
</p><pre>
%{
  <span class="c013">header</span>
%}
  <span class="c013">declarations</span>
%%
  <span class="c013">rules</span>
%%
  <span class="c013">trailer</span>
</pre><p>Comments are enclosed between <code>/*</code> and <code>*/</code> (as in C) in the
&#X201C;declarations&#X201D; and &#X201C;rules&#X201D; sections, and between <code>(*</code> and
<code>*)</code> (as in OCaml) in the &#X201C;header&#X201D; and &#X201C;trailer&#X201D; sections.</p>
<!--TOC subsection id="sec280" Header and trailer-->
<h3 class="subsection" id="sec280">12.4.1&#XA0;&#XA0;Header and trailer</h3><!--SEC END --><p>The header and the trailer sections are OCaml code that is copied
as is into file <span class="c013">grammar</span><span class="c007">.ml</span>. Both sections are optional. The header
goes at the beginning of the output file; it usually contains
<span class="c007">open</span> directives and auxiliary functions required by the semantic
actions of the rules. The trailer goes at the end of the output file.</p>
<!--TOC subsection id="sec281" Declarations-->
<h3 class="subsection" id="sec281">12.4.2&#XA0;&#XA0;Declarations</h3><!--SEC END --><p>Declarations are given one per line. They all start with a <code>%</code> sign.</p><dl class="description"><dt class="dt-description"><span class="c008">%token</span> <a class="syntax" href="#constr"><span class="c014">constr</span></a> &#X2026; &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a></dt><dd class="dd-description">
Declare the given symbols <a class="syntax" href="#constr"><span class="c014">constr</span></a> &#X2026; &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a>
as tokens (terminal symbols). These symbols
are added as constant constructors for the <span class="c007">token</span> concrete type.</dd><dt class="dt-description"><span class="c005"><span class="c007">%token</span> <span class="c007">&lt;</span></span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">&gt;</span> &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a> &#X2026; &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a></dt><dd class="dd-description">
Declare the given symbols <a class="syntax" href="#constr"><span class="c014">constr</span></a> &#X2026; &#XA0;<a class="syntax" href="#constr"><span class="c014">constr</span></a> as tokens with an
attached attribute of the
given type. These symbols are added as constructors with arguments of
the given type for the <span class="c007">token</span> concrete type. The <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> part is
an arbitrary OCaml type expression, except that all type
constructor names must be fully qualified (e.g. <span class="c007">Modname.typename</span>)
for all types except standard built-in types, even if the proper
<code>open</code> directives (e.g. <code>open Modname</code>) were given in the
header section. That&#X2019;s because the header is copied only to the <span class="c007">.ml</span>
output file, but not to the <span class="c007">.mli</span> output file, while the <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> part
of a <code>%token</code> declaration is copied to both.</dd><dt class="dt-description"><span class="c008">%start</span> <span class="c014">symbol</span> &#X2026; &#XA0;<span class="c014">symbol</span></dt><dd class="dd-description">
Declare the given symbols as entry points for the grammar. For each
entry point, a parsing function with the same name is defined in the
output module. Non-terminals that are not declared as entry points
have no such parsing function. Start symbols must be given a type with
the <code>%type</code> directive below.</dd><dt class="dt-description"><span class="c005"><span class="c007">%type</span> <span class="c007">&lt;</span></span> <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> <span class="c008">&gt;</span> &#XA0;<span class="c014">symbol</span> &#X2026; &#XA0;<span class="c014">symbol</span></dt><dd class="dd-description">
Specify the type of the semantic attributes for the given symbols.
This is mandatory for start symbols only. Other nonterminal symbols
need not be given types by hand: these types will be inferred when
running the output files through the OCaml compiler (unless the
<code>-s</code> option is in effect). The <a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a> part is an arbitrary OCaml
type expression, except that all type constructor names must be
fully qualified, as explained above for <span class="c007">%token</span>.</dd><dt class="dt-description"><span class="c008">%left</span> <span class="c014">symbol</span> &#X2026; &#XA0;<span class="c014">symbol</span></dt><dd class="dd-description">
</dd><dt class="dt-description"><span class="c008">%right</span> <span class="c014">symbol</span> &#X2026; &#XA0;<span class="c014">symbol</span></dt><dd class="dd-description">
</dd><dt class="dt-description"><span class="c008">%nonassoc</span> <span class="c014">symbol</span> &#X2026; &#XA0;<span class="c014">symbol</span></dt><dd class="dd-description"><p>Associate precedences and associativities to the given symbols. All
symbols on the same line are given the same precedence. They have
higher precedence than symbols declared before in a <code>%left</code>,
<code>%right</code> or <code>%nonassoc</code> line. They have lower precedence
than symbols declared after in a <code>%left</code>, <code>%right</code> or
<code>%nonassoc</code> line. The symbols are declared to associate to the
left (<code>%left</code>), to the right (<code>%right</code>), or to be
non-associative (<code>%nonassoc</code>). The symbols are usually tokens.
They can also be dummy nonterminals, for use with the <code>%prec</code>
directive inside the rules.</p><p>The precedence declarations are used in the following way to
resolve reduce/reduce and shift/reduce conflicts:
</p><ul class="itemize"><li class="li-itemize">
Tokens and rules have precedences. By default, the precedence
of a rule is the precedence of its rightmost terminal. You
can override this default by using the <span class="c008">%prec</span> directive in the rule.
</li><li class="li-itemize">A reduce/reduce conflict
is resolved in favor of the first rule (in the order given by the
source file), and <span class="c007">ocamlyacc</span> outputs a warning.
</li><li class="li-itemize">A shift/reduce conflict
is resolved by comparing the precedence of the rule to be
reduced with the precedence of the token to be shifted. If the
precedence of the rule is higher, then the rule will be reduced;
if the precedence of the token is higher, then the token will
be shifted.
</li><li class="li-itemize">A shift/reduce conflict between a rule and a token with the
same precedence will be resolved using the associativity: if the
token is left-associative, then the parser will reduce; if the
token is right-associative, then the parser will shift. If the
token is non-associative, then the parser will declare a syntax
error.
</li><li class="li-itemize">When a shift/reduce conflict cannot be resolved using the above
method, then <span class="c007">ocamlyacc</span> will output a warning and the parser will
always shift.
</li></ul></dd></dl>
<!--TOC subsection id="sec282" Rules-->
<h3 class="subsection" id="sec282">12.4.3&#XA0;&#XA0;Rules</h3><!--SEC END --><p>The syntax for rules is as usual:
</p><pre>
<span class="c013">nonterminal</span> :
    <span class="c013">symbol</span> &#X2026; <span class="c013">symbol</span> { <span class="c013">semantic-action</span> }
  | &#X2026;
  | <span class="c013">symbol</span> &#X2026; <span class="c013">symbol</span> { <span class="c013">semantic-action</span> }
;
</pre><p>
Rules can also contain the <code>%prec </code><span class="c013">symbol</span> directive in the
right-hand side part, to override the default precedence and
associativity of the rule with the precedence and associativity of the
given symbol.</p><p>Semantic actions are arbitrary OCaml expressions, that
are evaluated to produce the semantic attribute attached to
the defined nonterminal. The semantic actions can access the
semantic attributes of the symbols in the right-hand side of
the rule with the <code>$</code> notation: <code>$1</code> is the attribute for the
first (leftmost) symbol, <code>$2</code> is the attribute for the second
symbol, etc.</p><p>The rules may contain the special symbol <span class="c007">error</span> to indicate
resynchronization points, as in <span class="c007">yacc</span>.</p><p>Actions occurring in the middle of rules are not supported.</p><p>Nonterminal symbols are like regular OCaml symbols, except that they
cannot end with <span class="c007">'</span> (single quote).</p>
<!--TOC subsection id="sec283" Error handling-->
<h3 class="subsection" id="sec283">12.4.4&#XA0;&#XA0;Error handling</h3><!--SEC END --><p>Error recovery is supported as follows: when the parser reaches an
error state (no grammar rules can apply), it calls a function named
<span class="c007">parse_error</span> with the string <span class="c007">"syntax error"</span> as argument. The default
<span class="c007">parse_error</span> function does nothing and returns, thus initiating error
recovery (see below). The user can define a customized <span class="c007">parse_error</span>
function in the header section of the grammar file.</p><p>The parser also enters error recovery mode if one of the grammar
actions raises the <span class="c007">Parsing.Parse_error</span> exception.</p><p>In error recovery mode, the parser discards states from the
stack until it reaches a place where the error token can be shifted.
It then discards tokens from the input until it finds three successive
tokens that can be accepted, and starts processing with the first of
these. If no state can be uncovered where the error token can be
shifted, then the parser aborts by raising the <span class="c007">Parsing.Parse_error</span>
exception.</p><p>Refer to documentation on <span class="c007">yacc</span> for more details and guidance in how
to use error recovery.</p>
<!--TOC section id="sec284" Options-->
<h2 class="section" id="sec284">12.5&#XA0;&#XA0;Options</h2><!--SEC END --><p>The <span class="c007">ocamlyacc</span> command recognizes the following options:</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-b</span><span class="c013">prefix</span></span></dt><dd class="dd-description">
Name the output files <span class="c013">prefix</span><span class="c007">.ml</span>, <span class="c013">prefix</span><span class="c007">.mli</span>,
<span class="c013">prefix</span><span class="c007">.output</span>, instead of the default naming convention.</dd><dt class="dt-description"><span class="c010">-q</span></dt><dd class="dd-description">
This option has no effect.</dd><dt class="dt-description"><span class="c010">-v</span></dt><dd class="dd-description">
Generate a description of the parsing tables and a report on conflicts
resulting from ambiguities in the grammar. The description is put in
file <span class="c013">grammar</span><span class="c007">.output</span>.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c010">-</span></dt><dd class="dd-description">
Read the grammar specification from standard input. The default
output file names are <span class="c007">stdin.ml</span> and <span class="c007">stdin.mli</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">--</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Process <span class="c013">file</span> as the grammar specification, even if its name
starts with a dash (-) character. This option must be the last on the
command line.</dd></dl><p>At run-time, the <span class="c007">ocamlyacc</span>-generated parser can be debugged by
setting the <span class="c007">p</span> option in the <span class="c007">OCAMLRUNPARAM</span> environment variable
(see section&#XA0;<a href="#ocamlrun-options">10.2</a>). This causes the pushdown
automaton executing the parser to print a trace of its action (tokens
shifted, rules reduced, etc). The trace mentions rule numbers and
state numbers that can be interpreted by looking at the file
<span class="c013">grammar</span><span class="c007">.output</span> generated by <span class="c007">ocamlyacc -v</span>.</p>
<!--TOC section id="sec285" A complete example-->
<h2 class="section" id="sec285">12.6&#XA0;&#XA0;A complete example</h2><!--SEC END --><p>The all-time favorite: a desk calculator. This program reads
arithmetic expressions on standard input, one per line, and prints
their values. Here is the grammar definition:
</p><pre>        /* File parser.mly */
        %token &lt;int&gt; INT
        %token PLUS MINUS TIMES DIV
        %token LPAREN RPAREN
        %token EOL
        %left PLUS MINUS        /* lowest precedence */
        %left TIMES DIV         /* medium precedence */
        %nonassoc UMINUS        /* highest precedence */
        %start main             /* the entry point */
        %type &lt;int&gt; main
        %%
        main:
            expr EOL                { $1 }
        ;
        expr:
            INT                     { $1 }
          | LPAREN expr RPAREN      { $2 }
          | expr PLUS expr          { $1 + $3 }
          | expr MINUS expr         { $1 - $3 }
          | expr TIMES expr         { $1 * $3 }
          | expr DIV expr           { $1 / $3 }
          | MINUS expr %prec UMINUS { - $2 }
        ;
</pre><p>Here is the definition for the corresponding lexer:
</p><pre>        (* File lexer.mll *)
        {
        open Parser        (* The type token is defined in parser.mli *)
        exception Eof
        }
        rule token = parse
            [' ' '\t']     { token lexbuf }     (* skip blanks *)
          | ['\n' ]        { EOL }
          | ['0'-'9']+ as lxm { INT(int_of_string lxm) }
          | '+'            { PLUS }
          | '-'            { MINUS }
          | '*'            { TIMES }
          | '/'            { DIV }
          | '('            { LPAREN }
          | ')'            { RPAREN }
          | eof            { raise Eof }
</pre><p>Here is the main program, that combines the parser with the lexer:
</p><pre>        (* File calc.ml *)
        let _ =
          try
            let lexbuf = Lexing.from_channel stdin in
            while true do
              let result = Parser.main Lexer.token lexbuf in
                print_int result; print_newline(); flush stdout
            done
          with Lexer.Eof -&gt;
            exit 0
</pre><p>To compile everything, execute:
</p><pre>        ocamllex lexer.mll       # generates lexer.ml
        ocamlyacc parser.mly     # generates parser.ml and parser.mli
        ocamlc -c parser.mli
        ocamlc -c lexer.ml
        ocamlc -c parser.ml
        ocamlc -c calc.ml
        ocamlc -o calc lexer.cmo parser.cmo calc.cmo
</pre>
<!--TOC section id="sec286" Common errors-->
<h2 class="section" id="sec286">12.7&#XA0;&#XA0;Common errors</h2><!--SEC END --><dl class="description"><dt class="dt-description"><span class="c019">ocamllex: transition table overflow, automaton is too big</span></dt><dd class="dd-description"><p>The deterministic automata generated by <span class="c007">ocamllex</span> are limited to at
most 32767 transitions. The message above indicates that your lexer
definition is too complex and overflows this limit. This is commonly
caused by lexer definitions that have separate rules for each of the
alphabetic keywords of the language, as in the following example.
</p><pre>rule token = parse
  "keyword1"   { KWD1 }
| "keyword2"   { KWD2 }
| ...
| "keyword100" { KWD100 }
| ['A'-'Z' 'a'-'z'] ['A'-'Z' 'a'-'z' '0'-'9' '_'] * as id
               { IDENT id}
</pre><p>To keep the generated automata small, rewrite those definitions with
only one general &#X201C;identifier&#X201D; rule, followed by a hashtable lookup
to separate keywords from identifiers:
</p><pre>{ let keyword_table = Hashtbl.create 53
  let _ =
    List.iter (fun (kwd, tok) -&gt; Hashtbl.add keyword_table kwd tok)
              [ "keyword1", KWD1;
                "keyword2", KWD2; ...
                "keyword100", KWD100 ]
}
rule token = parse
  ['A'-'Z' 'a'-'z'] ['A'-'Z' 'a'-'z' '0'-'9' '_'] * as id
               { try
                   Hashtbl.find keyword_table id
                 with Not_found -&gt;
                   IDENT id }
</pre></dd><dt class="dt-description"><span class="c019">ocamllex: Position memory overflow, too many bindings</span></dt><dd class="dd-description">
The deterministic automata generated by <span class="c007">ocamllex</span> maintain a table of
positions inside the scanned lexer buffer. The size of this table is
limited to at most 255 cells. This error should not show up in normal
situations.</dd></dl>
<!--TOC chapter id="sec287" Dependency generator (ocamldep)-->
<h1 class="chapter" id="sec287">Chapter&#XA0;13&#XA0;&#XA0;Dependency generator (ocamldep)</h1><!--SEC END --><p> <a id="c:camldep"></a>

</p><!--NAME depend.html-->
<p>The <span class="c007">ocamldep</span> command scans a set of OCaml source files
(<span class="c007">.ml</span> and <span class="c007">.mli</span> files) for references to external compilation units,
and outputs dependency lines in a format suitable for the <span class="c007">make</span>
utility. This ensures that <span class="c007">make</span> will compile the source files in the
correct order, and recompile those files that need to when a source
file is modified.</p><p>The typical usage is:
</p><pre>
        ocamldep <span class="c013">options</span> *.mli *.ml &gt; .depend
</pre><p>
where <span class="c007">*.mli *.ml</span> expands to all source files in the current
directory and <span class="c007">.depend</span> is the file that should contain the
dependencies. (See below for a typical <span class="c007">Makefile</span>.)</p><p>Dependencies are generated both for compiling with the bytecode
compiler <span class="c007">ocamlc</span> and with the native-code compiler <span class="c007">ocamlopt</span>.</p><p>The <span class="c007">ocamlbuild</span> compilation manager (see chapter&#XA0;<a href="#c%3Aocamlbuild">18</a>)
provide a higher-level, more automated alternative to the combination
of <span class="c007">make</span> and <span class="c007">ocamldep</span>. </p>
<!--TOC section id="sec288" Options-->
<h2 class="section" id="sec288">13.1&#XA0;&#XA0;Options</h2><!--SEC END --><p>The following command-line options are recognized by <span class="c007">ocamldep</span>.</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
source files. If a source file <span class="c007">foo.ml</span> mentions an external
compilation unit <span class="c007">Bar</span>, a dependency on that unit&#X2019;s interface
<span class="c007">bar.cmi</span> is generated only if the source for <span class="c007">bar</span> is found in the
current directory or in one of the directories specified with <span class="c007">-I</span>.
Otherwise, <span class="c007">Bar</span> is assumed to be a module from the standard library,
and no dependencies are generated. For programs that span multiple
directories, it is recommended to pass <span class="c007">ocamldep</span> the same <span class="c007">-I</span> options
that are passed to the compiler.</dd><dt class="dt-description"><span class="c019"><span class="c007">-ml-synonym</span> <span class="c013">.ext</span></span></dt><dd class="dd-description">
Consider the given extension (with leading dot) to be a synonym for .ml.</dd><dt class="dt-description"><span class="c019"><span class="c007">-mli-synonym</span> <span class="c013">.ext</span></span></dt><dd class="dd-description">
Consider the given extension (with leading dot) to be a synonym for .mli.</dd><dt class="dt-description"><span class="c010">-modules</span></dt><dd class="dd-description">
Output raw dependencies of the form
<pre>      filename: Module1 Module2 ... ModuleN
</pre>where <span class="c007">Module1</span>, &#X2026;, <span class="c007">ModuleN</span> are the names of the compilation
units referenced within the file <span class="c007">filename</span>, but these names are not
resolved to source file names. Such raw dependencies cannot be used
by <span class="c007">make</span>, but can be post-processed by other tools such as <span class="c007">Omake</span>.</dd><dt class="dt-description"><span class="c010">-native</span></dt><dd class="dd-description">
Generate dependencies for a pure native-code program (no bytecode
version). When an implementation file (<span class="c007">.ml</span> file) has no explicit
interface file (<span class="c007">.mli</span> file), <span class="c007">ocamldep</span> generates dependencies on the
bytecode compiled file (<span class="c007">.cmo</span> file) to reflect interface changes.
This can cause unnecessary bytecode recompilations for programs that
are compiled to native-code only. The flag <span class="c007">-native</span> causes
dependencies on native compiled files (<span class="c007">.cmx</span>) to be generated instead
of on <span class="c007">.cmo</span> files. (This flag makes no difference if all source files
have explicit <span class="c007">.mli</span> interface files.)</dd><dt class="dt-description"><span class="c019"><span class="c007">-pp</span> <span class="c013">command</span></span></dt><dd class="dd-description">
Cause <span class="c007">ocamldep</span> to call the given <span class="c013">command</span> as a preprocessor
for each source file.</dd><dt class="dt-description"><span class="c010">-slash</span></dt><dd class="dd-description">
Under Windows, use a forward slash (/) as the path separator instead
of the usual backward slash (\). Under Unix, this option does
nothing.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl>
<!--TOC section id="sec289" A typical Makefile-->
<h2 class="section" id="sec289">13.2&#XA0;&#XA0;A typical Makefile</h2><!--SEC END --><p>Here is a template <span class="c007">Makefile</span> for a OCaml program.</p><pre>OCAMLC=ocamlc
OCAMLOPT=ocamlopt
OCAMLDEP=ocamldep
INCLUDES=                 # all relevant -I options here
OCAMLFLAGS=$(INCLUDES)    # add other options for ocamlc here
OCAMLOPTFLAGS=$(INCLUDES) # add other options for ocamlopt here

# prog1 should be compiled to bytecode, and is composed of three
# units: mod1, mod2 and mod3.

# The list of object files for prog1
PROG1_OBJS=mod1.cmo mod2.cmo mod3.cmo

prog1: $(PROG1_OBJS)
        $(OCAMLC) -o prog1 $(OCAMLFLAGS) $(PROG1_OBJS)

# prog2 should be compiled to native-code, and is composed of two
# units: mod4 and mod5.

# The list of object files for prog2
PROG2_OBJS=mod4.cmx mod5.cmx

prog2: $(PROG2_OBJS)
        $(OCAMLOPT) -o prog2 $(OCAMLFLAGS) $(PROG2_OBJS)

# Common rules
.SUFFIXES: .ml .mli .cmo .cmi .cmx

.ml.cmo:
        $(OCAMLC) $(OCAMLFLAGS) -c $&lt;

.mli.cmi:
        $(OCAMLC) $(OCAMLFLAGS) -c $&lt;

.ml.cmx:
        $(OCAMLOPT) $(OCAMLOPTFLAGS) -c $&lt;

# Clean up
clean:
        rm -f prog1 prog2
        rm -f *.cm[iox]

# Dependencies
depend:
        $(OCAMLDEP) $(INCLUDES) *.mli *.ml &gt; .depend

include .depend
</pre>
<!--TOC chapter id="sec290" The browser/editor (ocamlbrowser)-->
<h1 class="chapter" id="sec290">Chapter&#XA0;14&#XA0;&#XA0;The browser/editor (ocamlbrowser)</h1><!--SEC END --><p> <a id="c:browser"></a>

</p><!--NAME browser.html-->
<p>This chapter describes OCamlBrowser, a source and compiled interface
browser, written using LablTk. This is a useful companion to the
programmer.</p><p>Its functions are:
</p><ul class="itemize"><li class="li-itemize">
navigation through OCaml&#X2019;s modules (using compiled interfaces).
</li><li class="li-itemize">source editing, type-checking, and browsing.
</li><li class="li-itemize">integrated OCaml shell, running as a subprocess.
</li></ul>
<!--TOC section id="sec291" Invocation-->
<h2 class="section" id="sec291">14.1&#XA0;&#XA0;Invocation</h2><!--SEC END --><p> <a id="s:browser-options"></a></p><p>The browser is started by the command <span class="c007">ocamlbrowser</span>, as follows:
</p><pre>
        ocamlbrowser <span class="c013">options</span>
</pre><p>The following command-line options are recognized by <span class="c007">ocamlbrowser</span>.</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the list of directories searched for
source and compiled files. By default, only the standard library
directory is searched. The standard library can also be changed by
setting the <span class="c007">OCAMLLIB</span> environment variable.</dd><dt class="dt-description"><span class="c010">-nolabels</span></dt><dd class="dd-description">
Ignore non-optional labels in types. Labels cannot be used in
applications, and parameter order becomes strict.</dd><dt class="dt-description"><span class="c010">-oldui</span></dt><dd class="dd-description">
Old multi-window interface. The default is now more like Smalltalk&#X2019;s
class browser.</dd><dt class="dt-description"><span class="c010">-rectypes</span></dt><dd class="dd-description">
Allow arbitrary recursive types during type-checking. By default,
only recursive types where the recursion goes through an object type
are supported.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-w</span> <span class="c013">warning-list</span></span></dt><dd class="dd-description">
Enable or disable warnings according to the argument <span class="c013">warning-list</span>.</dd></dl><p>Most options can also be modified inside the application by the <span class="c019">Modules - Path editor</span> and <span class="c019">Compiler - Preferences</span> commands.
They are inherited when you start a toplevel shell.</p>
<!--TOC section id="sec292" Viewer-->
<h2 class="section" id="sec292">14.2&#XA0;&#XA0;Viewer</h2><!--SEC END --><p>
This is the first window you get when you start OCamlBrowser.
It displays a search window, and the list of modules in the load path.
At the top a row of menus.</p><ul class="itemize"><li class="li-itemize">
<span class="c019">File - Open</span> and <span class="c019">File - Editor</span> give access to the
editor.</li><li class="li-itemize"><span class="c019">File - Shell</span> creates an OCaml subprocess in a shell.</li><li class="li-itemize"><span class="c019">View - Show all defs</span> displays the signature of the currently
selected module.</li><li class="li-itemize"><span class="c019">View - Search entry</span> shows/hides the search entry just
below the menu bar.</li><li class="li-itemize"><span class="c019">Modules - Path editor</span> changes the load path. <span class="c019">Modules
- Reset cache</span> rescans the load path and resets the module cache.
Do it if you recompile some interface, or get confused about what is
in the cache.</li><li class="li-itemize"><span class="c019">Modules - Search symbol</span> allows searching a symbol either
by its name, like the bottom line of the viewer, or more
interestingly, by its type. <span class="c019">Exact type</span> searches for a type
with exactly the same information as the pattern (variables match
only variables). <span class="c019">Included type</span> allows giving only partial
information: the actual type may take more arguments and return more
results, and variables in the pattern match anything. In both cases,
argument and tuple order is irrelevant<sup><a id="text2" href="#note2">1</a></sup>,
and unlabeled arguments in the pattern match any label.</li><li class="li-itemize">The <span class="c019">Search entry</span> just below the menu bar allows one to
search for an identifier in all modules (wildcards &#X201C;?&#X201D; and &#X201C;*&#X201D;
allowed). If you choose the <span class="c007">type</span> option, the search is done by type
inclusion (<em>cf.</em> Search Symbol - Included type).</li><li class="li-itemize">The <span class="c019">Close all</span> button is there to dismiss the windows
created by the Detach button.
By double-clicking on it you will quit the browser.</li></ul>
<!--TOC section id="sec293" Module browsing-->
<h2 class="section" id="sec293">14.3&#XA0;&#XA0;Module browsing</h2><!--SEC END --><p>You select a module in the leftmost box by either cliking on it or
pressing return when it is selected. Fast access is available in all
boxes pressing the first few letter of the desired name.
Double-clicking / double-return displays the whole signature for the
module.</p><p>Defined identifiers inside the module are displayed in a box to the
right of the previous one. If you click on one, this will either
display its contents in another box (if this is a sub-module) or
display the signature for this identifier below.</p><p>Signatures are clickable. Double clicking with the left mouse
button on an identifier in a signature brings you to its signature.
A single click on the right button pops up a menu displaying the
type declaration for the selected identifier. Its title, when
selectable, also brings you to its signature.</p><p>At the bottom, a series of buttons, depending on the context.
</p><ul class="itemize"><li class="li-itemize">
<span class="c019">Detach</span> copies the currently displayed signature in a new window,
to keep it.
</li><li class="li-itemize"><span class="c019">Impl</span> and <span class="c019">Intf</span> bring you to the implementation or
interface of the currently displayed signature, if it is available.
</li></ul><p>Control-S lets you search a string in the signature.</p>
<!--TOC section id="sec294" File editor-->
<h2 class="section" id="sec294">14.4&#XA0;&#XA0;File editor</h2><!--SEC END --><p>
You can edit files with it, if you&#X2019;re not yet used to emacs. Otherwise
you can use it as a browser, making occasional corrections.</p><p>The <span class="c019">Edit</span> menu contains commands for jump (C-g), search (C-s),
and sending the current phrase (or selection if some text is selected)
to a sub-shell (M-x). For this last option, you may choose the shell
via a dialog.</p><p>Essential functions are in the <span class="c019">Compiler</span> menu.</p><ul class="itemize"><li class="li-itemize">
<span class="c019">Preferences</span> opens a dialog to set internals of the editor
and type-checker.</li><li class="li-itemize"><span class="c019">Lex</span> adds colors according to lexical categories.</li><li class="li-itemize"><span class="c019">Typecheck</span> verifies typing, and memorizes to let one see an
expression&#X2019;s type by double-clicking on it. This is also valid for
interfaces. If an error occurs, the part of the interface preceding
the error is computed.<p>After typechecking, pressing the right button pops up a menu that gives
the type of the pointed expression and, where applicable, provides
some links that can be followed.</p></li><li class="li-itemize"><span class="c019">Clear errors</span> dismisses type-checker error messages and warnings.</li><li class="li-itemize"><span class="c019">Signature</span> shows the signature of the current file
(after type checking).
</li></ul>
<!--TOC section id="sec295" Shell-->
<h2 class="section" id="sec295">14.5&#XA0;&#XA0;Shell</h2><!--SEC END --><p>
When you create a shell, a dialog is presented to you, letting you
choose which command you want to run, and the title of the shell (to
choose it in the Editor).</p><p>The executed subshell is given the current load path.</p><ul class="itemize"><li class="li-itemize">
<span class="c019">File</span> use a source file or load a bytecode file. You may
also import the browser&#X2019;s path into the subprocess.
</li><li class="li-itemize"><span class="c019">History</span> M-p and M-n browse up and down.
</li><li class="li-itemize"><span class="c019">Signal</span> C-c interrupts, and you can also kill the subprocess.
</li></ul>
<!--BEGIN NOTES chapter-->
<hr class="ffootnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note2" href="#text2">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">To avoid
combinatorial explosion of the search space, optional arguments in
the actual type are ignored in the actual if (1) there are too many
of them, and (2) they do not appear explicitly in the pattern.</div>
</dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec296" The documentation generator (ocamldoc)-->
<h1 class="chapter" id="sec296">Chapter&#XA0;15&#XA0;&#XA0;The documentation generator (ocamldoc)</h1><!--SEC END --><p> <a id="c:ocamldoc"></a>

</p><!--NAME ocamldoc.html-->
<p>This chapter describes OCamldoc, a tool that generates documentation from
special comments embedded in source files. The comments used by OCamldoc
are of the form <span class="c007">(**</span>&#X2026;<span class="c007">*)</span> and follow the format described
in section <a href="#s%3Aocamldoc-comments">15.2</a>.</p><p>OCamldoc can produce documentation in various formats: HTML, L<sup>A</sup>T<sub>E</sub>X,
TeXinfo, Unix man pages, and <span class="c007">dot</span> dependency graphs. Moreover,
users can add their own custom generators, as explained in
section <a href="#s%3Aocamldoc-custom-generators">15.3</a>.</p><p>In this chapter, we use the word <em>element</em> to refer to any of the
following parts of an OCaml source file: a type declaration, a value,
a module, an exception, a module type, a type constructor, a record
field, a class, a class type, a class method, a class value or a class
inheritance clause.</p>
<!--TOC section id="sec297" Usage-->
<h2 class="section" id="sec297">15.1&#XA0;&#XA0;Usage</h2><!--SEC END --><p> <a id="s:ocamldoc-usage"></a></p>
<!--TOC subsection id="sec298" Invocation-->
<h3 class="subsection" id="sec298">15.1.1&#XA0;&#XA0;Invocation</h3><!--SEC END --><p>OCamldoc is invoked via the command <span class="c007">ocamldoc</span>, as follows:
</p><pre>
        ocamldoc <span class="c013">options sourcefiles</span>
</pre><!--TOC subsubsection id="sec299" Options for choosing the output format-->
<h4 class="subsubsection" id="sec299">Options for choosing the output format</h4><!--SEC END --><p>The following options determine the format for the generated
documentation.</p><dl class="description"><dt class="dt-description">
<span class="c010">-html</span></dt><dd class="dd-description">
Generate documentation in HTML default format. The generated HTML pages
are stored in the current directory, or in the directory specified
with the <span class="c010">-d</span> option. You can customize the style of the
generated pages by editing the generated <span class="c007">style.css</span> file, or by providing
your own style sheet using option <span class="c007">-css-style</span>.
The file <span class="c007">style.css</span> is not generated if it already exists or if -css-style is used.</dd><dt class="dt-description"><span class="c010">-latex</span></dt><dd class="dd-description">
Generate documentation in L<sup>A</sup>T<sub>E</sub>X default format. The generated
L<sup>A</sup>T<sub>E</sub>X document is saved in file <span class="c007">ocamldoc.out</span>, or in the file
specified with the <span class="c010">-o</span> option. The document uses the style file
<span class="c007">ocamldoc.sty</span>. This file is generated when using the <span class="c007">-latex</span> option,
if it does not already exist.
You can change this file to customize the style of your L<sup>A</sup>T<sub>E</sub>X documentation.</dd><dt class="dt-description"><span class="c010">-texi</span></dt><dd class="dd-description">
Generate documentation in TeXinfo default format. The generated
L<sup>A</sup>T<sub>E</sub>X document is saved in file <span class="c007">ocamldoc.out</span>, or in the file
specified with the <span class="c010">-o</span> option.</dd><dt class="dt-description"><span class="c010">-man</span></dt><dd class="dd-description">
Generate documentation as a set of Unix <span class="c007">man</span> pages. The generated pages
are stored in the current directory, or in the directory specified
with the <span class="c010">-d</span> option.</dd><dt class="dt-description"><span class="c010">-dot</span></dt><dd class="dd-description">
Generate a dependency graph for the toplevel modules, in a format suitable
for displaying and processing by <span class="c007">dot</span>. The <span class="c007">dot</span> tool is available from
<a href="http://www.research.att.com/sw/tools/graphviz/"><span class="c007">http://www.research.att.com/sw/tools/graphviz/</span></a>.
The textual representation of the graph is written to the file
<span class="c007">ocamldoc.out</span>, or to the file specified with the <span class="c010">-o</span> option.
Use <span class="c007">dot ocamldoc.out</span> to display it.</dd><dt class="dt-description"><span class="c019"><span class="c007">-g</span> <span class="c013">file.cm[o,a,xs]</span></span></dt><dd class="dd-description">
Dynamically load the given file, which defines a custom documentation
generator. See section <a href="#s%3Aocamldoc-compilation-and-usage">15.4.1</a>. This
option is supported by the <span class="c007">ocamldoc</span> command (to load <span class="c007">.cmo</span> and <span class="c007">.cma</span> files)
and by its native-code version <span class="c007">ocamldoc.opt</span> (to load <span class="c007">.cmxs</span> files).
If the given file is a simple one and does not exist in
the current directory, then ocamldoc looks for it in the custom
generators default directory, and in the directories specified with
optional <span class="c007">-i</span> options.</dd><dt class="dt-description"><span class="c010">-customdir</span></dt><dd class="dd-description">
Display the custom generators default directory.</dd><dt class="dt-description"><span class="c019"><span class="c007">-i</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add the given directory to the path where to look for custom generators.</dd></dl><!--TOC subsubsection id="sec300" General options-->
<h4 class="subsubsection" id="sec300">General options</h4><!--SEC END --><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-d</span> <span class="c013">dir</span></span></dt><dd class="dd-description">
Generate files in directory <span class="c013">dir</span>, rather than the current directory.</dd><dt class="dt-description"><span class="c019"><span class="c007">-dump</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Dump collected information into <span class="c013">file</span>. This information can be
read with the <span class="c007">-load</span> option in a subsequent invocation of <span class="c007">ocamldoc</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-hide</span> <span class="c013">modules</span></span></dt><dd class="dd-description">
Hide the given complete module names in the generated documentation.
<span class="c013">modules</span> is a list of complete module names separated
by &#X2019;<span class="c007">,</span>&#X2019;, without blanks. For instance: <span class="c007">Pervasives,M2.M3</span>.</dd><dt class="dt-description"><span class="c010">-inv-merge-ml-mli</span></dt><dd class="dd-description">
Reverse the precedence of implementations and interfaces when merging.
All elements
in implementation files are kept, and the <span class="c010">-m</span> option
indicates which parts of the comments in interface files are merged
with the comments in implementation files.</dd><dt class="dt-description"><span class="c010">-keep-code</span></dt><dd class="dd-description">
Always keep the source code for values, methods and instance variables,
when available.
The source code is always kept when a <span class="c007">.ml</span>
file is given, but is by default discarded when a <span class="c007">.mli</span> is given.
This option keeps the source code in all cases.</dd><dt class="dt-description"><span class="c019"><span class="c007">-load</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Load information from <span class="c013">file</span>, which has been produced by
<span class="c007">ocamldoc -dump</span>. Several <span class="c007">-load</span> options can be given.</dd><dt class="dt-description"><span class="c019"><span class="c007">-m</span> <span class="c013">flags</span></span></dt><dd class="dd-description">
Specify merge options between interfaces and implementations.
(see section <a href="#s%3Aocamldoc-merge">15.1.2</a> for details).
<span class="c013">flags</span> can be one or several of the following characters:
<dl class="description"><dt class="dt-description">
<span class="c010">d</span></dt><dd class="dd-description"> merge description
</dd><dt class="dt-description"><span class="c010">a</span></dt><dd class="dd-description"> merge <span class="c007">@author</span>
</dd><dt class="dt-description"><span class="c010">v</span></dt><dd class="dd-description"> merge <span class="c007">@version</span>
</dd><dt class="dt-description"><span class="c010">l</span></dt><dd class="dd-description"> merge <span class="c007">@see</span>
</dd><dt class="dt-description"><span class="c010">s</span></dt><dd class="dd-description"> merge <span class="c007">@since</span>
</dd><dt class="dt-description"><span class="c010">b</span></dt><dd class="dd-description"> merge <span class="c007">@before</span>
</dd><dt class="dt-description"><span class="c010">o</span></dt><dd class="dd-description"> merge <span class="c007">@deprecated</span>
</dd><dt class="dt-description"><span class="c010">p</span></dt><dd class="dd-description"> merge <span class="c007">@param</span>
</dd><dt class="dt-description"><span class="c010">e</span></dt><dd class="dd-description"> merge <span class="c007">@raise</span>
</dd><dt class="dt-description"><span class="c010">r</span></dt><dd class="dd-description"> merge <span class="c007">@return</span>
</dd><dt class="dt-description"><span class="c010">A</span></dt><dd class="dd-description"> merge everything
</dd></dl></dd><dt class="dt-description"><span class="c010">-no-custom-tags</span></dt><dd class="dd-description">
Do not allow custom @-tags (see section <a href="#s%3Aocamldoc-tags">15.2.5</a>).</dd><dt class="dt-description"><span class="c010">-no-stop</span></dt><dd class="dd-description">
Keep elements placed after/between the <span class="c007">(**/**)</span> special comment(s)
(see section <a href="#s%3Aocamldoc-comments">15.2</a>).</dd><dt class="dt-description"><span class="c019"><span class="c007">-o</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Output the generated documentation to <span class="c013">file</span> instead of <span class="c007">ocamldoc.out</span>.
This option is meaningful only in conjunction with the
<span class="c010">-latex</span>, <span class="c010">-texi</span>, or <span class="c010">-dot</span> options.</dd><dt class="dt-description"><span class="c019"><span class="c007">-pp</span> <span class="c013">command</span></span></dt><dd class="dd-description">
Pipe sources through preprocessor <span class="c013">command</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-impl</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Process the file <span class="c013">filename</span> as an implementation file, even if its
extension is not <span class="c007">.ml</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intf</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Process the file <span class="c013">filename</span> as an interface file, even if its
extension is not <span class="c007">.mli</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-text</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Process the file <span class="c013">filename</span> as a text file, even if its
extension is not <span class="c007">.txt</span>.</dd><dt class="dt-description"><span class="c010">-sort</span></dt><dd class="dd-description">
Sort the list of top-level modules before generating the documentation.</dd><dt class="dt-description"><span class="c010">-stars</span></dt><dd class="dd-description">
Remove blank characters until the first asterisk (&#X2019;<span class="c007">*</span>&#X2019;) in each
line of comments.</dd><dt class="dt-description"><span class="c019"><span class="c007">-t</span> <span class="c013">title</span></span></dt><dd class="dd-description">
Use <span class="c013">title</span> as the title for the generated documentation.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intro</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Use content of <span class="c013">file</span> as ocamldoc text to use as introduction (HTML,
L<sup>A</sup>T<sub>E</sub>X and TeXinfo only).
For HTML, the file is used to create the whole <span class="c007">index.html</span> file.</dd><dt class="dt-description"><span class="c010">-v</span></dt><dd class="dd-description">
Verbose mode. Display progress information.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c010">-warn-error</span></dt><dd class="dd-description">
Treat Ocamldoc warnings as errors.</dd><dt class="dt-description"><span class="c010">-hide-warnings</span></dt><dd class="dd-description">
Do not print OCamldoc warnings.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl><!--TOC subsubsection id="sec301" Type-checking options-->
<h4 class="subsubsection" id="sec301">Type-checking options</h4><!--SEC END --><p>OCamldoc calls the OCaml type-checker to obtain type
information. The following options impact the type-checking phase.
They have the same meaning as for the <span class="c007">ocamlc</span> and <span class="c007">ocamlopt</span> commands.</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-I</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Add <span class="c013">directory</span> to the list of directories search for compiled
interface files (<span class="c007">.cmi</span> files).</dd><dt class="dt-description"><span class="c010">-nolabels</span></dt><dd class="dd-description">
Ignore non-optional labels in types.</dd><dt class="dt-description"><span class="c010">-rectypes</span></dt><dd class="dd-description">
Allow arbitrary recursive types. (See the <span class="c007">-rectypes</span> option to <span class="c007">ocamlc</span>.)</dd></dl><!--TOC subsubsection id="sec302" Options for generating HTML pages-->
<h4 class="subsubsection" id="sec302">Options for generating HTML pages</h4><!--SEC END --><p>The following options apply in conjunction with the <span class="c007">-html</span> option:</p><dl class="description"><dt class="dt-description">
<span class="c010">-all-params</span></dt><dd class="dd-description">
Display the complete list of parameters for functions and methods.</dd><dt class="dt-description"><span class="c019"><span class="c007">-charset</span> <span class="c013">charset</span></span></dt><dd class="dd-description">
Add information about character encoding being <span class="c013">charset</span>
(default is iso-8859-1).</dd><dt class="dt-description"><span class="c010">-colorize-code</span></dt><dd class="dd-description">
Colorize the OCaml code enclosed in <span class="c007">[ ]</span> and <span class="c007">{[ ]}</span>, using colors
to emphasize keywords, etc. If the code fragments are not
syntactically correct, no color is added.</dd><dt class="dt-description"><span class="c019"><span class="c007">-css-style</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Use <span class="c013">filename</span> as the Cascading Style Sheet file.</dd><dt class="dt-description"><span class="c010">-index-only</span></dt><dd class="dd-description">
Generate only index files.</dd><dt class="dt-description"><span class="c010">-short-functors</span></dt><dd class="dd-description">
Use a short form to display functors:
<pre>
module M : functor (A:Module) -&gt; functor (B:Module2) -&gt; sig .. end
</pre>
is displayed as:
<pre>
module M (A:Module) (B:Module2) : sig .. end
</pre></dd></dl><!--TOC subsubsection id="sec303" Options for generating L<sup>A</sup>T<sub>E</sub>X files-->
<h4 class="subsubsection" id="sec303">Options for generating L<sup>A</sup>T<sub>E</sub>X files</h4><!--SEC END --><p>The following options apply in conjunction with the <span class="c007">-latex</span> option:</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">-latex-value-prefix</span> <span class="c013">prefix</span></span></dt><dd class="dd-description">
Give a prefix to use for the labels of the values in the generated
L<sup>A</sup>T<sub>E</sub>X document.
The default prefix is the empty string. You can also use the options
<span class="c007">-latex-type-prefix</span>, <span class="c007">-latex-exception-prefix</span>,
<span class="c007">-latex-module-prefix</span>,
<span class="c007">-latex-module-type-prefix</span>, <span class="c007">-latex-class-prefix</span>,
<span class="c007">-latex-class-type-prefix</span>,
<span class="c007">-latex-attribute-prefix</span> and <span class="c007">-latex-method-prefix</span>.<p>These options are useful when you have, for example, a type and a value with
the same name. If you do not specify prefixes, L<sup>A</sup>T<sub>E</sub>X will complain about
multiply defined labels.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">-latextitle</span> <span class="c013">n,style</span></span></dt><dd class="dd-description">
Associate style number <span class="c013">n</span> to the given L<sup>A</sup>T<sub>E</sub>X sectioning command
<span class="c013">style</span>, e.g. <span class="c007">section</span> or <span class="c007">subsection</span>. (L<sup>A</sup>T<sub>E</sub>X only.) This is
useful when including the generated document in another L<sup>A</sup>T<sub>E</sub>X document,
at a given sectioning level. The default association is 1 for <span class="c007">section</span>,
2 for <span class="c007">subsection</span>, 3 for <span class="c007">subsubsection</span>, 4 for <span class="c007">paragraph</span> and 5 for
<span class="c007">subparagraph</span>.</dd><dt class="dt-description"><span class="c010">-noheader</span></dt><dd class="dd-description">
Suppress header in generated documentation.</dd><dt class="dt-description"><span class="c010">-notoc</span></dt><dd class="dd-description">
Do not generate a table of contents.</dd><dt class="dt-description"><span class="c010">-notrailer</span></dt><dd class="dd-description">
Suppress trailer in generated documentation.</dd><dt class="dt-description"><span class="c010">-sepfiles</span></dt><dd class="dd-description">
Generate one <span class="c007">.tex</span> file per toplevel module, instead of the global
<span class="c007">ocamldoc.out</span> file.
</dd></dl><!--TOC subsubsection id="sec304" Options for generating TeXinfo files-->
<h4 class="subsubsection" id="sec304">Options for generating TeXinfo files</h4><!--SEC END --><p>The following options apply in conjunction with the <span class="c007">-texi</span> option:</p><dl class="description"><dt class="dt-description">
<span class="c010">-esc8</span></dt><dd class="dd-description">
Escape accented characters in Info files.</dd><dt class="dt-description"><span class="c010">-info-entry</span></dt><dd class="dd-description">
Specify Info directory entry.</dd><dt class="dt-description"><span class="c010">-info-section</span></dt><dd class="dd-description">
Specify section of Info directory.</dd><dt class="dt-description"><span class="c010">-noheader</span></dt><dd class="dd-description">
Suppress header in generated documentation.</dd><dt class="dt-description"><span class="c010">-noindex</span></dt><dd class="dd-description">
Do not build index for Info files.</dd><dt class="dt-description"><span class="c010">-notrailer</span></dt><dd class="dd-description">
Suppress trailer in generated documentation.
</dd></dl><!--TOC subsubsection id="sec305" Options for generating <span class="c007">dot</span> graphs-->
<h4 class="subsubsection" id="sec305">Options for generating <span class="c007">dot</span> graphs</h4><!--SEC END --><p>The following options apply in conjunction with the <span class="c007">-dot</span> option:</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">-dot-colors</span> <span class="c013">colors</span></span></dt><dd class="dd-description">
Specify the colors to use in the generated <span class="c007">dot</span> code.
When generating module dependencies, <span class="c007">ocamldoc</span> uses different colors
for modules, depending on the directories in which they reside.
When generating types dependencies, <span class="c007">ocamldoc</span> uses different colors
for types, depending on the modules in which they are defined.
<span class="c013">colors</span> is a list of color names separated by &#X2019;<span class="c007">,</span>&#X2019;, as
in <span class="c007">Red,Blue,Green</span>. The available colors are the ones supported by
the <span class="c007">dot</span> tool.</dd><dt class="dt-description"><span class="c010">-dot-include-all</span></dt><dd class="dd-description">
Include all modules in the <span class="c007">dot</span> output, not only modules given
on the command line or loaded with the <span class="c010">-load</span> option.</dd><dt class="dt-description"><span class="c010">-dot-reduce</span></dt><dd class="dd-description">
Perform a transitive reduction of the dependency graph before
outputting the <span class="c007">dot</span> code. This can be useful if there are
a lot of transitive dependencies that clutter the graph.</dd><dt class="dt-description"><span class="c010">-dot-types</span></dt><dd class="dd-description">
Output <span class="c007">dot</span> code describing the type dependency graph instead of
the module dependency graph.
</dd></dl><!--TOC subsubsection id="sec306" Options for generating man files-->
<h4 class="subsubsection" id="sec306">Options for generating man files</h4><!--SEC END --><p>The following options apply in conjunction with the <span class="c007">-man</span> option:</p><dl class="description"><dt class="dt-description">
<span class="c010">-man-mini</span></dt><dd class="dd-description">
Generate man pages only for modules, module types, clases and class
types, instead of pages for all elements.</dd><dt class="dt-description"><span class="c019"><span class="c007">-man-suffix</span> <span class="c013">suffix</span></span></dt><dd class="dd-description">
Set the suffix used for generated man filenames. Default is &#X2019;<span class="c007">3o</span>&#X2019;,
as in <span class="c007">List.3o</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-man-section</span> <span class="c013">section</span></span></dt><dd class="dd-description">
Set the section number used for generated man filenames. Default is &#X2019;<span class="c007">3</span>&#X2019;.</dd></dl>
<!--TOC subsection id="sec307" Merging of module information-->
<h3 class="subsection" id="sec307">15.1.2&#XA0;&#XA0;Merging of module information</h3><!--SEC END --><p>
<a id="s:ocamldoc-merge"></a></p><p>Information on a module can be extracted either from the <span class="c007">.mli</span> or <span class="c007">.ml</span>
file, or both, depending on the files given on the command line.
When both <span class="c007">.mli</span> and <span class="c007">.ml</span> files are given for the same module,
information extracted from these files is merged according to the
following rules:
</p><ul class="itemize"><li class="li-itemize">
Only elements (values, types, classes, ...) declared in the <span class="c007">.mli</span>
file are kept. In other terms, definitions from the <span class="c007">.ml</span> file that are
not exported in the <span class="c007">.mli</span> file are not documented.
</li><li class="li-itemize">Descriptions of elements and descriptions in @-tags are handled
as follows. If a description for the same element or in the same
@-tag of the same element is present in both files, then the
description of the <span class="c007">.ml</span> file is concatenated to the one in the <span class="c007">.mli</span> file,
if the corresponding <span class="c007">-m</span> flag is given on the command line.
If a description is present in the <span class="c007">.ml</span> file and not in the
<span class="c007">.mli</span> file, the <span class="c007">.ml</span> description is kept.
In either case, all the information given in the <span class="c007">.mli</span> file is kept.
</li></ul>
<!--TOC subsection id="sec308" Coding rules-->
<h3 class="subsection" id="sec308">15.1.3&#XA0;&#XA0;Coding rules</h3><!--SEC END --><p>
<a id="s:ocamldoc-rules"></a>
The following rules must be respected in order to avoid name clashes
resulting in cross-reference errors:
</p><ul class="itemize"><li class="li-itemize">
In a module, there must not be two modules, two module types or
a module and a module type with the same name.
In the default HTML generator, modules <span class="c007">ab</span> and <span class="c007">AB</span> will be printed
to the same file on case insensitive file systems.
</li><li class="li-itemize">In a module, there must not be two classes, two class types or
a class and a class type with the same name.
</li><li class="li-itemize">In a module, there must not be two values, two types, or two
exceptions with the same name.
</li><li class="li-itemize">Values defined in tuple, as in <span class="c007">let (x,y,z) = (1,2,3)</span>
are not kept by OCamldoc.
</li><li class="li-itemize">Avoid the following construction:
<pre>open Foo (* which has a module Bar with a value x *)
module Foo =
  struct
    module Bar =
      struct
        let x = 1
      end
  end
  let dummy = Bar.x
</pre>In this case, OCamldoc will associate <span class="c007">Bar.x</span> to the <span class="c007">x</span> of module
<span class="c007">Foo</span> defined just above, instead of to the <span class="c007">Bar.x</span> defined in the
opened module <span class="c007">Foo</span>.
</li></ul>
<!--TOC section id="sec309" Syntax of documentation comments-->
<h2 class="section" id="sec309">15.2&#XA0;&#XA0;Syntax of documentation comments</h2><!--SEC END --><p>
<a id="s:ocamldoc-comments"></a></p><p>Comments containing documentation material are called <em>special
comments</em> and are written between <span class="c007">(**</span> and <span class="c007">*)</span>. Special comments
must start exactly with <span class="c007">(**</span>. Comments beginning with <span class="c007">(</span> and more
than two <span class="c007">*</span> are ignored.</p>
<!--TOC subsection id="sec310" Placement of documentation comments-->
<h3 class="subsection" id="sec310">15.2.1&#XA0;&#XA0;Placement of documentation comments</h3><!--SEC END --><p>
OCamldoc can associate comments to some elements of the language
encountered in the source files. The association is made according to
the locations of comments with respect to the language elements. The
locations of comments in <span class="c007">.mli</span> and <span class="c007">.ml</span> files are different.</p>
<!--TOC subsubsection id="sec311" Comments in <span class="c007">.mli</span> files-->
<h4 class="subsubsection" id="sec311">Comments in <span class="c007">.mli</span> files</h4><!--SEC END --><p>
A special comment is associated to an element if it is placed before or
after the element.<br>
A special comment before an element is associated to this element if&#XA0;:
</p><ul class="itemize"><li class="li-itemize">
There is no blank line or another special comment between the special
comment and the element. However, a regular comment can occur between
the special comment and the element.
</li><li class="li-itemize">The special comment is not already associated to the previous element.
</li><li class="li-itemize">The special comment is not the first one of a toplevel module.
</li></ul><p>A special comment after an element is associated to this element if
there is no blank line or comment between the special comment and the
element.</p><p>There are two exceptions: for constructors and record fields in
type definitions, the associated comment can only be placed after the
constructor or field definition, without blank lines or other comments
between them. The special comment for a constructor
with another constructor following must be placed before the &#X2019;<span class="c007">|</span>&#X2019;
character separating the two constructors.</p><p>The following sample interface file <span class="c007">foo.mli</span> illustrates the
placement rules for comments in <span class="c007">.mli</span> files.</p><pre>(** The first special comment of the file is the comment associated
    with the whole module.*)


(** Special comments can be placed between elements and are kept
    by the OCamldoc tool, but are not associated to any element.
    @-tags in these comments are ignored.*)

(*******************************************************************)
(** Comments like the one above, with more than two asterisks,
    are ignored. *)

(** The comment for function f. *)
val f : int -&gt; int -&gt; int
(** The continuation of the comment for function f. *)

(** Comment for exception My_exception, even with a simple comment
    between the special comment and the exception.*)
(* Hello, I'm a simple comment :-) *)
exception My_exception of (int -&gt; int) * int

(** Comment for type weather  *)
type weather =
| Rain of int (** The comment for construtor Rain *)
| Sun (** The comment for constructor Sun *)

(** Comment for type weather2  *)
type weather2 =
| Rain of int (** The comment for construtor Rain *)
| Sun (** The comment for constructor Sun *)
(** I can continue the comment for type weather2 here
  because there is already a comment associated to the last constructor.*)

(** The comment for type my_record *)
type my_record = {
    val foo : int ;    (** Comment for field foo *)
    val bar : string ; (** Comment for field bar *)
  }
  (** Continuation of comment for type my_record *)

(** Comment for foo *)
val foo : string
(** This comment is associated to foo and not to bar. *)
val bar : string
(** This comment is assciated to bar. *)

(** The comment for class my_class *)
class my_class :
  object
    (** A comment to describe inheritance from cl *)
    inherit cl

    (** The comment for attribute tutu *)
    val mutable tutu : string

    (** The comment for attribute toto. *)
    val toto : int

    (** This comment is not attached to titi since
        there is a blank line before titi, but is kept
        as a comment in the class. *)

    val titi : string

    (** Comment for method toto *)
    method toto : string

    (** Comment for method m *)
    method m : float -&gt; int
  end

(** The comment for the class type my_class_type *)
class type my_class_type =
  object
    (** The comment for variable x. *)
    val mutable x : int

    (** The commend for method m. *)
    method m : int -&gt; int
end

(** The comment for module Foo *)
module Foo =
  struct
    (** The comment for x *)
    val x : int

    (** A special comment that is kept but not associated to any element *)
  end

(** The comment for module type my_module_type. *)
module type my_module_type =
  sig
    (** The comment for value x. *)
    val x : int

    (** The comment for module M. *)
    module M =
      struct
        (** The comment for value y. *)
        val y : int

        (* ... *)
      end

  end

</pre>
<!--TOC subsubsection id="sec312" Comments in <span class="c007">.ml</span> files-->
<h4 class="subsubsection" id="sec312">Comments in <span class="c007">.ml</span> files</h4><!--SEC END --><p>A special comment is associated to an element if it is placed before
the element and there is no blank line between the comment and the
element. Meanwhile, there can be a simple comment between the special
comment and the element. There are two exceptions, for
constructors and record fields in type definitions, whose associated
comment must be placed after the constructor or field definition,
without blank line between them. The special comment for a constructor
with another constructor following must be placed before the &#X2019;<span class="c007">|</span>&#X2019;
character separating the two constructors.</p><p>The following example of file <span class="c007">toto.ml</span> shows where to place comments
in a <span class="c007">.ml</span> file.</p><pre>(** The first special comment of the file is the comment associated
    to the whole module. *)

(** The comment for function f *)
let f x y = x + y

(** This comment is not attached to any element since there is another
    special comment just before the next element. *)

(** Comment for exception My_exception, even with a simple comment
    between the special comment and the exception.*)
(* A simple comment. *)
exception My_exception of (int -&gt; int) * int

(** Comment for type weather  *)
type weather =
| Rain of int (** The comment for constructor Rain *)
| Sun (** The comment for constructor Sun *)

(** The comment for type my_record *)
type my_record = {
    val foo : int ;    (** Comment for field foo *)
    val bar : string ; (** Comment for field bar *)
  }

(** The comment for class my_class *)
class my_class =
    object
      (** A comment to describe inheritance from cl *)
      inherit cl

      (** The comment for the instance variable tutu *)
      val mutable tutu = "tutu"
      (** The comment for toto *)
      val toto = 1
      val titi = "titi"
      (** Comment for method toto *)
      method toto = tutu ^ "!"
      (** Comment for method m *)
      method m (f : float) = 1
    end

(** The comment for class type my_class_type *)
class type my_class_type =
  object
    (** The comment for the instance variable x. *)
    val mutable x : int
    (** The commend for method m. *)
    method m : int -&gt; int
  end

(** The comment for module Foo *)
module Foo =
  struct
    (** The comment for x *)
    val x : int
    (** A special comment in the class, but not associated to any element. *)
  end

(** The comment for module type my_module_type. *)
module type my_module_type =
  sig
    (* Comment for value x. *)
    val x : int
    (* ... *)
  end
</pre>
<!--TOC subsection id="sec313" The Stop special comment-->
<h3 class="subsection" id="sec313">15.2.2&#XA0;&#XA0;The Stop special comment</h3><!--SEC END --><p>
The special comment <span class="c007">(**/**)</span> tells OCamldoc to discard
elements placed after this comment, up to the end of the current
class, class type, module or module type, or up to the next stop comment.
For instance:
</p><pre>class type foo =
  object
    (** comment for method m *)
    method m : string

    (**/**)

    (** This method won't appear in the documentation *)
    method bar : int
  end

(** This value appears in the documentation, since the Stop special comment
    in the class does not affect the parent module of the class.*)
val foo : string

(**/**)
(** The value bar does not appear in the documentation.*)
val bar : string
(**/**)

(** The type t appears since in the documentation since the previous stop comment
toggled off the "no documentation mode". *)
type t = string
</pre><p>
The <span class="c010">-no-stop</span> option to <span class="c007">ocamldoc</span> causes the Stop special
comments to be ignored.</p>
<!--TOC subsection id="sec314" Syntax of documentation comments-->
<h3 class="subsection" id="sec314">15.2.3&#XA0;&#XA0;Syntax of documentation comments</h3><!--SEC END --><p>The inside of documentation comments <span class="c007">(**</span>&#X2026;<span class="c007">*)</span> consists of
free-form text with optional formatting annotations, followed by
optional <em>tags</em> giving more specific information about parameters,
version, authors, &#X2026; The tags are distinguished by a leading <span class="c007">@</span>
character. Thus, a documentation comment has the following shape:
</p><pre>(** The comment begins with a description, which is text formatted
   according to the rules described in the next section.
   The description continues until the first non-escaped '@' character.
   @author Mr Smith
   @param x description for parameter x
*)
</pre><p>Some elements support only a subset of all @-tags. Tags that are not
relevant to the documented element are simply ignored. For instance,
all tags are ignored when documenting type constructors, record
fields, and class inheritance clauses. Similarly, a <span class="c007">@param</span> tag on a
class instance variable is ignored.</p><p>At last, <span class="c007">(**)</span> is the empty documentation comment.</p>
<!--TOC subsection id="sec315" Text formatting-->
<h3 class="subsection" id="sec315">15.2.4&#XA0;&#XA0;Text formatting</h3><!--SEC END --><p>Here is the BNF grammar for the simple markup language used to format
text descriptions.</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="text"><span class="c014">text</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;{<a class="syntax" href="#text-element"><span class="c014">text-element</span></a>}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
</table></td></tr>
</table><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="text-element"><span class="c014">text-element</span></a></td><td class="c022">::=</td></tr>
</table><table class="c002 cellpading0"><tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{</span> { <span class="c008">0</span> &#X2026; <span class="c008">9</span> }<sup>+</sup> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">format <a class="syntax" href="#text"><span class="c014">text</span></a> as a section header;
the integer following <span class="c007">{</span> indicates the sectioning level. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{</span> { <span class="c008">0</span> &#X2026; <span class="c008">9</span> }<sup>+</sup> <span class="c008">:</span>  <span class="c014">label</span>  <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027"> same, but also associate the name <span class="c014">label</span> to the current point.
This point can be referenced by its fully-qualified label in a
<span class="c007">{!</span> command, just like any other element. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{b</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">set <a class="syntax" href="#text"><span class="c014">text</span></a> in bold. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{i</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">set <a class="syntax" href="#text"><span class="c014">text</span></a> in italic. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{e</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">emphasize <a class="syntax" href="#text"><span class="c014">text</span></a>. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{C</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">center <a class="syntax" href="#text"><span class="c014">text</span></a>. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{L</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">left align <a class="syntax" href="#text"><span class="c014">text</span></a>. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{R</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">right align <a class="syntax" href="#text"><span class="c014">text</span></a>. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{ul</span> <a class="syntax" href="#list"><span class="c014">list</span></a> <span class="c008">}</span> </td><td class="c027">build a list. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{ol</span> <a class="syntax" href="#list"><span class="c014">list</span></a> <span class="c008">}</span> </td><td class="c027">build an enumerated list. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c005"><span class="c007">{{:</span> <span class="c014">string</span> <span class="c007">}</span></span> &#XA0;<a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">put a link to the given address
(given as <span class="c014">string</span>) on the given <a class="syntax" href="#text"><span class="c014">text</span></a>. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c005"><span class="c007">[</span> <span class="c014">string</span> <span class="c007">]</span></span> </td><td class="c027">set the given <span class="c014">string</span> in source code style. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c005"><span class="c007">{[</span> <span class="c014">string</span> <span class="c007">]}</span></span> </td><td class="c027">set the given <span class="c014">string</span> in preformatted
				source code style.</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c005"><span class="c007">{v</span> <span class="c014">string</span> <span class="c007">v}</span></span> </td><td class="c027">set the given <span class="c014">string</span> in verbatim style. </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c005"><span class="c007">{%</span> <span class="c014">string</span> <span class="c007">%}</span></span> </td><td class="c027">target-specific content
(L<sup>A</sup>T<sub>E</sub>X code by default, see details
in <a href="#sss%3Atarget-specific-syntax">15.2.4</a>) </td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c005"><span class="c007">{!</span> <span class="c014">string</span> <span class="c007">}</span></span> </td><td class="c027">insert a cross-reference to an element
(see below <a href="#sss%3Acrossref">15.2.4</a> for the syntax of cross-references).</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{!modules:</span> <span class="c014">string</span> &#XA0;<span class="c014">string</span> ... <span class="c008">}</span> </td><td class="c027">insert an index table
for the given module names. Used in HTML only.</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{!indexlist}</span> </td><td class="c027">insert a table of links to the various indexes
(types, values, modules, ...). Used in HTML only.</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{^</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">set text in superscript.</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"> <span class="c008">{_</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> </td><td class="c027">set text in subscript.</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"><span class="c014">escaped-string</span></td><td class="c027">typeset the given string as is;
special characters (&#X2019;<span class="c007">{</span>&#X2019;, &#X2019;<span class="c007">}</span>&#X2019;, &#X2019;<span class="c007">[</span>&#X2019;, &#X2019;<span class="c007">]</span>&#X2019; and &#X2019;<span class="c007">@</span>&#X2019;)
must be	escaped by a &#X2019;<span class="c007">\</span>&#X2019;</td></tr>
<tr><td class="c031">&#X2223; </td><td class="c030"><span class="c014">blank-line</span></td><td class="c027">force a new line.
</td></tr>
</table><p> <br>

</p><!--TOC subsubsection id="sec316" List formatting-->
<h4 class="subsubsection" id="sec316">List formatting</h4><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="list"><span class="c014">list</span></a></td><td class="c022">::=</td><td class="c024">
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;{&#XA0;<span class="c008">{-</span>&#XA0;<a class="syntax" href="#text"><span class="c014">text</span></a>&#XA0;<span class="c008">}</span>&#XA0;}<sup>+</sup>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;{&#XA0;<span class="c008">{li</span>&#XA0;<a class="syntax" href="#text"><span class="c014">text</span></a>&#XA0;<span class="c008">}</span>&#XA0;}<sup>+</sup>
</td></tr>
</table></td></tr>
</table><p>A shortcut syntax exists for lists and enumerated lists:
</p><pre>(** Here is a {b list}
- item 1
- item 2
- item 3

The list is ended by the blank line.*)
</pre><p>is equivalent to:
</p><pre>(** Here is a {b list}
{ul {- item 1}
{- item 2}
{- item 3}}
The list is ended by the blank line.*)
</pre><p>
The same shortcut is available for enumerated lists, using &#X2019;<span class="c007">+</span>&#X2019;
instead of &#X2019;<span class="c007">-</span>&#X2019;.
Note that only one list can be defined by this shortcut in nested lists.</p><!--TOC subsubsection id="sss:crossref" Cross-reference formatting-->
<h4 class="subsubsection" id="sss:crossref">Cross-reference formatting</h4><!--SEC END --><p>Cross-references are fully qualified element names, as in the example
<span class="c007">{!Foo.Bar.t}</span>. This is an ambiguous reference as it may designate
a type name, a value name, a class name, etc. It is possible to make
explicit the intended syntactic class, using <span class="c007">{!type:Foo.Bar.t}</span> to
designate a type, and <span class="c007">{!val:Foo.Bar.t}</span> a value of the same name.</p><p>The list of possible syntactic class is as follows:
</p><div class="center">
<table class="c002 cellpading0"><tr><td class="c022"><span class="c007">tag</span></td><td class="c022">syntactic class</td></tr>
<tr><td class="hbar" colspan=2></td></tr>
<tr><td class="c025"><span class="c007">module:</span></td><td class="c024">module </td></tr>
<tr><td class="c025"><span class="c007">modtype:</span></td><td class="c024">module type </td></tr>
<tr><td class="c025"><span class="c007">class:</span></td><td class="c024">class </td></tr>
<tr><td class="c025"><span class="c007">classtype:</span></td><td class="c024">class type </td></tr>
<tr><td class="c025"><span class="c007">val:</span></td><td class="c024">value </td></tr>
<tr><td class="c025"><span class="c007">type:</span></td><td class="c024">type </td></tr>
<tr><td class="c025"><span class="c007">exception:</span></td><td class="c024">exception </td></tr>
<tr><td class="c025"><span class="c007">attribute:</span></td><td class="c024">attribute </td></tr>
<tr><td class="c025"><span class="c007">method:</span></td><td class="c024">class method </td></tr>
<tr><td class="c025"><span class="c007">section:</span></td><td class="c024">ocamldoc section </td></tr>
<tr><td class="c025"><span class="c007">const:</span></td><td class="c024">variant constructor </td></tr>
<tr><td class="c025"><span class="c007">recfield:</span></td><td class="c024">record field 
</td></tr>
</table>
</div><p>In the case of variant constructors or record field, the constructor
or field name should be preceded by the name of the correspond type &#X2013;
to avoid the ambiguity of several types having the same constructor
names. For example, the constructor <span class="c007">Node</span> of the type <span class="c007">tree</span> will be
referenced as <span class="c007">{!tree.Node}</span> or <span class="c007">{!const:tree.Node}</span>, or possibly
<span class="c007">{!Mod1.Mod2.tree.Node}</span> from outside the module.</p><!--TOC subsubsection id="sec318" First sentence-->
<h4 class="subsubsection" id="sec318">First sentence</h4><!--SEC END --><p>In the description of a value, type, exception, module, module type, class
or class type, the <em>first sentence</em> is sometimes used in indexes, or
when just a part of the description is needed. The first sentence
is composed of the first characters of the description, until
</p><ul class="itemize"><li class="li-itemize">
the first dot followed by a blank, or
</li><li class="li-itemize">the first blank line
</li></ul><p>
outside of the following text formatting :
 <span class="c008">{ul</span> <a class="syntax" href="#list"><span class="c014">list</span></a> <span class="c008">}</span> ,
 <span class="c008">{ol</span> <a class="syntax" href="#list"><span class="c014">list</span></a> <span class="c008">}</span> ,
 <span class="c005"><span class="c007">[</span> <span class="c014">string</span> <span class="c007">]</span></span> ,
 <span class="c005"><span class="c007">{[</span> <span class="c014">string</span> <span class="c007">]}</span></span> ,
 <span class="c005"><span class="c007">{v</span> <span class="c014">string</span> <span class="c007">v}</span></span> ,
 <span class="c005"><span class="c007">{%</span> <span class="c014">string</span> <span class="c007">%}</span></span> ,
 <span class="c005"><span class="c007">{!</span> <span class="c014">string</span> <span class="c007">}</span></span> ,
 <span class="c008">{^</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> ,
 <span class="c008">{_</span> <a class="syntax" href="#text"><span class="c014">text</span></a> <span class="c008">}</span> .</p><!--TOC subsubsection id="sss:target-specific-syntax" Target-specific formatting-->
<h4 class="subsubsection" id="sss:target-specific-syntax">Target-specific formatting</h4><!--SEC END --><p>The content inside <span class="c007">{%foo: ... %}</span> is target-specific and will only be
interpreted by the backend <span class="c007">foo</span>, and ignored by the others. The
backends of the distribution are <span class="c007">latex</span>, <span class="c007">html</span>, <span class="c007">texi</span> and <span class="c007">man</span>. If
no target is specified (syntax <span class="c007">{% ... %}</span>), <span class="c007">latex</span> is chosen by
default. Custom generators may support their own target prefix.</p><!--TOC subsubsection id="sec320" Recognized HTML tags-->
<h4 class="subsubsection" id="sec320">Recognized HTML tags</h4><!--SEC END --><p>
The HTML tags <span class="c007">&lt;b&gt;..&lt;/b&gt;</span>,
<span class="c007">&lt;code&gt;..&lt;/code&gt;</span>,
<span class="c007">&lt;i&gt;..&lt;/i&gt;</span>,
<span class="c007">&lt;ul&gt;..&lt;/ul&gt;</span>,
<span class="c007">&lt;ol&gt;..&lt;/ol&gt;</span>,
<span class="c007">&lt;li&gt;..&lt;/li&gt;</span>,
<span class="c007">&lt;center&gt;..&lt;/center&gt;</span> and
<span class="c007">&lt;h[0-9]&gt;..&lt;/h[0-9]&gt;</span> can be used instead of, respectively,
 <span class="c008">{b ..}</span> ,
 <span class="c008">[..]</span> ,
 <span class="c008">{i ..}</span> ,
 <span class="c008">{ul ..}</span> ,
 <span class="c008">{ol ..}</span> ,
 <span class="c008">{li ..}</span> ,
 <span class="c008">{C ..}</span>  and
<span class="c007">{[0-9] ..}</span>.</p>
<!--TOC subsection id="sec321" Documentation tags (@-tags)-->
<h3 class="subsection" id="sec321">15.2.5&#XA0;&#XA0;Documentation tags (@-tags)</h3><!--SEC END --><p>
<a id="s:ocamldoc-tags"></a></p>
<!--TOC subsubsection id="sec322" Predefined tags-->
<h4 class="subsubsection" id="sec322">Predefined tags</h4><!--SEC END --><p>
The following table gives the list of predefined @-tags, with their
syntax and meaning.<br>

</p><table class="c000 cellpadding1" border=1><tr><td class="c028"> <span class="c008">@author</span> <span class="c014">string</span> </td><td class="c028">The author of the element. One author per
<span class="c007">@author</span> tag.
There may be several <span class="c007">@author</span> tags for the same element. </td></tr>
<tr><td class="c028">
 <span class="c008">@deprecated</span> <a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">The <a class="syntax" href="#text"><span class="c014">text</span></a> should describe when the element was
deprecated, what to use as a replacement, and possibly the reason
for deprecation. </td></tr>
<tr><td class="c028">
 <span class="c008">@param</span> <span class="c014">id</span> &#XA0;<a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Associate the given description (<a class="syntax" href="#text"><span class="c014">text</span></a>) to the
given parameter name <span class="c014">id</span>. This tag is used for functions,
methods, classes and functors. </td></tr>
<tr><td class="c028">
 <span class="c008">@raise</span> <span class="c014">Exc</span> &#XA0;<a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Explain that the element may raise
the exception <span class="c014">Exc</span>. </td></tr>
<tr><td class="c028">
 <span class="c008">@return</span> <a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Describe the return value and
its possible values. This tag is used for functions
and methods. </td></tr>
<tr><td class="c028">
 <span class="c005"><span class="c007">@see</span> <span class="c007">&lt;</span> <span class="c014">URL</span> <span class="c007">&gt;</span></span> &#XA0;<a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Add a reference to the <span class="c014">URL</span>
with the given <a class="syntax" href="#text"><span class="c014">text</span></a> as comment. </td></tr>
<tr><td class="c028">
 <span class="c005"><span class="c007">@see</span> <span class="c007">'</span><span class="c014">filename</span><span class="c007">'</span></span> <a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Add a reference to the given file name
(written between single quotes), with the given <a class="syntax" href="#text"><span class="c014">text</span></a> as comment. </td></tr>
<tr><td class="c028">
 <span class="c005"><span class="c007">@see</span> <span class="c007">"</span><span class="c014">document-name</span><span class="c007">"</span></span> <a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Add a reference to the given
document name (written between double quotes), with the given <a class="syntax" href="#text"><span class="c014">text</span></a>
as comment. </td></tr>
<tr><td class="c028">
 <span class="c008">@since</span> <span class="c014">string</span> </td><td class="c028">Indicate when the element was introduced. </td></tr>
<tr><td class="c028">
 <span class="c008">@before</span>  <span class="c014">version</span>  <a class="syntax" href="#text"><span class="c014">text</span></a> </td><td class="c028">Associate the given description (<a class="syntax" href="#text"><span class="c014">text</span></a>)
to the given <span class="c014">version</span> in order to document compatibility issues. </td></tr>
<tr><td class="c028">
 <span class="c008">@version</span> <span class="c014">string</span> </td><td class="c028">The version number for the element. </td></tr>
</table>
<!--TOC subsubsection id="sec323" Custom tags-->
<h4 class="subsubsection" id="sec323">Custom tags</h4><!--SEC END --><p>
<a id="s:ocamldoc-custom-tags"></a>
You can use custom tags in the documentation comments, but they will
have no effect if the generator used does not handle them. To use a
custom tag, for example <span class="c007">foo</span>, just put <span class="c007">@foo</span> with some text in your
comment, as in:
</p><pre>(** My comment to show you a custom tag.
@foo this is the text argument to the [foo] custom tag.
*)
</pre><p>
To handle custom tags, you need to define a custom generator,
as explained in section <a href="#s%3Aocamldoc-handling-custom-tags">15.3.2</a>.</p>
<!--TOC section id="sec324" Custom generators-->
<h2 class="section" id="sec324">15.3&#XA0;&#XA0;Custom generators</h2><!--SEC END --><p>
<a id="s:ocamldoc-custom-generators"></a></p><p>OCamldoc operates in two steps:
</p><ol class="enumerate" type=1><li class="li-enumerate">
analysis of the source files;
</li><li class="li-enumerate">generation of documentation, through a documentation generator,
	which is an object of class <span class="c007">Odoc_args.class_generator</span>.
</li></ol><p>
Users can provide their own documentation generator to be used during
step 2 instead of the default generators.
All the information retrieved during the analysis step is available through
the <span class="c007">Odoc_info</span> module, which gives access to all the types and functions
representing the elements found in the given modules, with their associated
description.</p><p>The files you can use to define custom generators are installed in the
<span class="c007">ocamldoc</span> sub-directory of the OCaml standard library.</p>
<!--TOC subsection id="sec325" The generator modules-->
<h3 class="subsection" id="sec325">15.3.1&#XA0;&#XA0;The generator modules</h3><!--SEC END --><p>
The type of a generator module depends on the kind of generated documentation.
Here is the list of generator module types, with the name of the generator
class in the module&#XA0;:
</p><ul class="itemize"><li class="li-itemize">
for HTML&#XA0;: <span class="c007">Odoc_html.Html_generator</span> (class <span class="c007">html</span>),
</li><li class="li-itemize">for L<sup>A</sup>T<sub>E</sub>X&#XA0;: <span class="c007">Odoc_latex.Latex_generator</span> (class <span class="c007">latex</span>),
</li><li class="li-itemize">for TeXinfo&#XA0;: <span class="c007">Odoc_texi.Texi_generator</span> (class <span class="c007">texi</span>),
</li><li class="li-itemize">for man pages&#XA0;: <span class="c007">Odoc_man.Man_generator</span> (class <span class="c007">man</span>),
</li><li class="li-itemize">for graphviz (dot)&#XA0;: <span class="c007">Odoc_dot.Dot_generator</span> (class <span class="c007">dot</span>),
</li><li class="li-itemize">for other kinds&#XA0;: <span class="c007">Odoc_gen.Base</span> (class <span class="c007">generator</span>).
</li></ul><p>
That is, to define a new generator, one must implement a module with
the expected signature, and with the given generator class, providing
the <span class="c007">generate</span> method as entry point to make the generator generates
documentation for a given list of modules&#XA0;:</p><pre>        method generate : Odoc_info.Module.t_module list -&gt; unit
</pre><p>
This method will be called with the list of analysed and possibly
merged <span class="c007">Odoc_info.t_module</span> structures.</p><p>It is recommanded to inherit from the current generator of the same
kind as the one you want to define. Doing so, it is possible to
load various custom generators to combine improvments brought by each one.</p><p>This is done using first class modules (see chapter <a href="#s-first-class-modules">7.14</a>).</p><p>The easiest way to define a custom generator is the following this example,
here extending the current HTML generator. We don&#X2019;t have to know if this is
the original HTML generator defined in ocamldoc or if it has been extended
already by a previously loaded custom generator&#XA0;:</p><pre>module Generator (G : Odoc_html.Html_generator) =
struct
  class html =
    object(self)
      inherit G.html as html
      (* ... *)

      method generate module_list =
        (* ... *)
        ()

      (* ... *)
  end
end;;

let _ = Odoc_args.extend_html_generator (module Generator : Odoc_gen.Html_functor);;
</pre><p>
To know which methods to override and/or which methods are available,
have a look at the different base implementations, depending on the
kind of generator you are extending&#XA0;:
</p><ul class="itemize"><li class="li-itemize">
for HTML&#XA0;: <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/version/4.00/ocamldoc/odoc_html.ml?view=markup"><span class="c007">odoc_html.ml</span></a>,
</li><li class="li-itemize">for L<sup>A</sup>T<sub>E</sub>X&#XA0;: <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/version/4.00/ocamldoc/odoc_latex.ml?view=markup"><span class="c007">odoc_latex.ml</span></a>,
</li><li class="li-itemize">for TeXinfo&#XA0;: <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/version/4.00/ocamldoc/odoc_texi.ml?view=markup"><span class="c007">odoc_texi.ml</span></a>,
</li><li class="li-itemize">for man pages&#XA0;: <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/version/4.00/ocamldoc/odoc_man.ml?view=markup"><span class="c007">odoc_man.ml</span></a>,
</li><li class="li-itemize">for graphviz (dot)&#XA0;: <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/version/4.00/ocamldoc/odoc_dot.ml?view=markup"><span class="c007">odoc_dot.ml</span></a>.
</li></ul>
<!--TOC subsection id="sec326" Handling custom tags-->
<h3 class="subsection" id="sec326">15.3.2&#XA0;&#XA0;Handling custom tags</h3><!--SEC END --><p>
<a id="s:ocamldoc-handling-custom-tags"></a></p><p>Making a custom generator handle custom tags (see
<a href="#s%3Aocamldoc-custom-tags">15.2.5</a>) is very simple.</p><!--TOC subsubsection id="sec327" For HTML-->
<h4 class="subsubsection" id="sec327">For HTML</h4><!--SEC END --><p>
Here is how to develop a HTML generator handling your custom tags.</p><p>The class <span class="c007">Odoc_html.Generator.html</span> inherits
from the class <span class="c007">Odoc_html.info</span>, containing a field <span class="c007">tag_functions</span> which is a
list pairs composed of a custom tag (e.g. <span class="c007">"foo"</span>) and a function taking
a <span class="c007">text</span> and returning HTML code (of type <span class="c007">string</span>).
To handle a new tag <span class="c007">bar</span>, extend the current HTML generator
and complete the <span class="c007">tag_functions</span> field:
</p><pre>module Generator (G : Odoc_html.Html_generator) =
struct
  class html =
    object(self)
      inherit G.html

      (** Return HTML code for the given text of a bar tag. *)
      method html_of_bar t = (* your code here *)

      initializer
        tag_functions &lt;- ("bar", self#html_of_bar) :: tag_functions
  end
end
let _ = Odoc_args.extend_html_generator (module Generator : Odoc_gen.Html_functor);;
</pre><p>
Another method of the class <span class="c007">Odoc_html.info</span> will look for the
function associated to a custom tag and apply it to the text given to
the tag. If no function is associated to a custom tag, then the method
prints a warning message on <span class="c007">stderr</span>.</p>
<!--TOC subsubsection id="sec328" For other generators-->
<h4 class="subsubsection" id="sec328">For other generators</h4><!--SEC END --><p>
You can act the same way for other kinds of generators.</p>
<!--TOC section id="sec329" Adding command line options-->
<h2 class="section" id="sec329">15.4&#XA0;&#XA0;Adding command line options</h2><!--SEC END --><p>
The command line analysis is performed after loading the module containing the
documentation generator, thus allowing command line options to be added to the
list of existing ones. Adding an option can be done with the function
</p><pre>        Odoc_args.add_option : string * Arg.spec * string -&gt; unit
</pre><p>Note: Existing command line options can be redefined using
this function.</p>
<!--TOC subsection id="sec330" Compilation and usage-->
<h3 class="subsection" id="sec330">15.4.1&#XA0;&#XA0;Compilation and usage</h3><!--SEC END --><p>
<a id="s:ocamldoc-compilation-and-usage"></a></p>
<!--TOC subsubsection id="sec331" Defining a custom generator class in one file-->
<h4 class="subsubsection" id="sec331">Defining a custom generator class in one file</h4><!--SEC END --><p>
Let <span class="c007">custom.ml</span> be the file defining a new generator class.
Compilation of <span class="c007">custom.ml</span> can be performed by the following command&#XA0;:
</p><pre>
        ocamlc -I +ocamldoc -c custom.ml
</pre><p>
The file <span class="c007">custom.cmo</span> is created and can be used this way&#XA0;:
</p><pre>
        ocamldoc -g custom.cmo <span class="c013">other-options source-files</span>
</pre><p>
It is important not to give the <span class="c007">-html</span> or any other option
selecting a built-in generator to <span class="c007">ocamldoc</span>,
which would result in using this generator instead of the one you just loaded.</p>
<!--TOC subsubsection id="sec332" Defining a custom generator class in several files-->
<h4 class="subsubsection" id="sec332">Defining a custom generator class in several files</h4><!--SEC END --><p>
It is possible to define a generator class in several modules, which
are defined in several files <span class="c013">file</span><sub>1</sub><span class="c007">.ml</span>[<span class="c007">i</span>],
<span class="c013">file</span><sub>2</sub><span class="c007">.ml</span>[<span class="c007">i</span>], ..., <span class="c013">file</span><sub><span class="c013">n</span></sub><span class="c007">.ml</span>[<span class="c007">i</span>]. A <span class="c007">.cma</span>
library file must be created, including all these files.</p><p>The following commands create the <span class="c007">custom.cma</span> file from files
<span class="c013">file</span><sub>1</sub><span class="c007">.ml</span>[<span class="c007">i</span>], ..., <span class="c013">file</span><sub><span class="c013">n</span></sub><span class="c007">.ml</span>[<span class="c007">i</span>]&#XA0;:
</p><pre>
ocamlc -I +ocamldoc -c <span class="c013">file</span><sub>1</sub>.ml[i]
ocamlc -I +ocamldoc -c <span class="c013">file</span><sub>2</sub>.ml[i]
...
ocamlc -I +ocamldoc -c <span class="c013">file</span><sub><span class="c013">n</span></sub>.ml[i]
ocamlc -o custom.cma -a <span class="c013">file</span><sub>1</sub>.cmo <span class="c013">file</span><sub>2</sub>.cmo ... <span class="c013">file</span><sub><span class="c013">n</span></sub>.cmo
</pre><p>
Then, the following command uses <span class="c007">custom.cma</span> as custom generator:
</p><pre>
        ocamldoc -g custom.cma <span class="c013">other-options source-files</span>
</pre><p>
Again, it is important not to give the <span class="c007">-html</span> or any other
option selecting a built-in generator to <span class="c007">ocamldoc</span>,
which would result in using this generator instead of the one you just loaded.

</p>
<!--TOC chapter id="sec333" The debugger (ocamldebug)-->
<h1 class="chapter" id="sec333">Chapter&#XA0;16&#XA0;&#XA0;The debugger (ocamldebug)</h1><!--SEC END --><p> <a id="c:debugger"></a>

</p><!--NAME debugger.html-->
<p>This chapter describes the OCaml source-level replay debugger
<span class="c007">ocamldebug</span>.</p><blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0; The debugger is available on Unix systems that provide
BSD sockets.
</blockquote><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0; The debugger is available under the Cygwin port of
OCaml, but not under the native Win32 ports.
</blockquote>
<!--TOC section id="sec334" Compiling for debugging-->
<h2 class="section" id="sec334">16.1&#XA0;&#XA0;Compiling for debugging</h2><!--SEC END --><p>Before the debugger can be used, the program must be compiled and
linked with the <span class="c007">-g</span> option: all <span class="c007">.cmo</span> and <span class="c007">.cma</span> files that are part
of the program should have been created with <span class="c007">ocamlc -g</span>, and they
must be linked together with <span class="c007">ocamlc -g</span>.</p><p>Compiling with <span class="c007">-g</span> entails no penalty on the running time of
programs: object files and bytecode executable files are bigger and
take longer to produce, but the executable files run at
exactly the same speed as if they had been compiled without <span class="c007">-g</span>.</p>
<!--TOC section id="sec335" Invocation-->
<h2 class="section" id="sec335">16.2&#XA0;&#XA0;Invocation</h2><!--SEC END -->
<!--TOC subsection id="sec336" Starting the debugger-->
<h3 class="subsection" id="sec336">16.2.1&#XA0;&#XA0;Starting the debugger</h3><!--SEC END --><p>The OCaml debugger is invoked by running the program
<span class="c007">ocamldebug</span> with the name of the bytecode executable file as first
argument:
</p><pre>
        ocamldebug [<span class="c013">options</span>] <span class="c013">program</span> [<span class="c013">arguments</span>]
</pre><p>
The arguments following <span class="c013">program</span> are optional, and are passed as
command-line arguments to the program being debugged. (See also the
<span class="c007">set arguments</span> command.)</p><p>The following command-line options are recognized:
</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">-c </span> <span class="c013">count</span></span></dt><dd class="dd-description">
Set the maximum number of simultaneously live checkpoints to <span class="c013">count</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-cd </span> <span class="c013">dir</span></span></dt><dd class="dd-description">
Run the debugger program from the working directory <span class="c013">dir</span>,
instead of the current directory. (See also the <span class="c007">cd</span> command.)</dd><dt class="dt-description"><span class="c010">-emacs</span></dt><dd class="dd-description">
Tell the debugger it is executed under Emacs. (See
section&#XA0;<a href="#s%3Ainf-debugger">16.10</a> for information on how to run the
debugger under Emacs.)</dd><dt class="dt-description"><span class="c019"><span class="c007">-I </span><span class="c013">directory</span></span></dt><dd class="dd-description">
Add <span class="c013">directory</span> to the list of directories searched for source
files and compiled files. (See also the <span class="c007">directory</span> command.)</dd><dt class="dt-description"><span class="c019"><span class="c007">-s </span><span class="c013">socket</span></span></dt><dd class="dd-description">
Use <span class="c013">socket</span> for communicating with the debugged program. See the
description of the command <span class="c007">set socket</span> (section&#XA0;<a href="#s%3Acommunication">16.8.6</a>)
for the format of <span class="c013">socket</span>.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl>
<!--TOC subsection id="sec337" Exiting the debugger-->
<h3 class="subsection" id="sec337">16.2.2&#XA0;&#XA0;Exiting the debugger</h3><!--SEC END --><p>The command <span class="c007">quit</span> exits the debugger. You can also exit the debugger
by typing an end-of-file character (usually <span class="c007">ctrl-D</span>).</p><p>Typing an interrupt character (usually <span class="c007">ctrl-C</span>) will not exit the
debugger, but will terminate the action of any debugger command that is in
progress and return to the debugger command level. </p>
<!--TOC section id="sec338" Commands-->
<h2 class="section" id="sec338">16.3&#XA0;&#XA0;Commands</h2><!--SEC END --><p> <a id="s:debugger-commands"></a></p><p>A debugger command is a single line of input. It starts with a command
name, which is followed by arguments depending on this name. Examples:
</p><pre>        run
        goto 1000
        set arguments arg1 arg2
</pre><p>
A command name can be truncated as long as there is no ambiguity. For
instance, <span class="c007">go 1000</span> is understood as <span class="c007">goto 1000</span>, since there are no
other commands whose name starts with <span class="c007">go</span>. For the most frequently
used commands, ambiguous abbreviations are allowed. For instance, <span class="c007">r</span>
stands for <span class="c007">run</span> even though there are others commands starting with
<span class="c007">r</span>. You can test the validity of an abbreviation using the <span class="c007">help</span> command.</p><p>If the previous command has been successful, a blank line (typing just
<span class="c007">RET</span>) will repeat it.</p>
<!--TOC subsection id="sec339" Getting help-->
<h3 class="subsection" id="sec339">16.3.1&#XA0;&#XA0;Getting help</h3><!--SEC END --><p>The OCaml debugger has a simple on-line help system, which gives
a brief description of each command and variable.</p><dl class="description"><dt class="dt-description">
<span class="c010">help</span></dt><dd class="dd-description">
Print the list of commands.</dd><dt class="dt-description"><span class="c019"><span class="c007">help </span><span class="c013">command</span></span></dt><dd class="dd-description">
Give help about the command <span class="c013">command</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">help set </span><span class="c013">variable</span>, <span class="c007">help show </span><span class="c013">variable</span></span></dt><dd class="dd-description">
Give help about the variable <span class="c013">variable</span>. The list of all debugger
variables can be obtained with <span class="c007">help set</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">help info </span><span class="c013">topic</span></span></dt><dd class="dd-description">
Give help about <span class="c013">topic</span>. Use <span class="c007">help info</span> to get a list of known topics.
</dd></dl>
<!--TOC subsection id="sec340" Accessing the debugger state-->
<h3 class="subsection" id="sec340">16.3.2&#XA0;&#XA0;Accessing the debugger state</h3><!--SEC END --><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set </span><span class="c013">variable value</span></span></dt><dd class="dd-description">
Set the debugger variable <span class="c013">variable</span> to the value <span class="c013">value</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">show </span><span class="c013">variable</span></span></dt><dd class="dd-description">
Print the value of the debugger variable <span class="c013">variable</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">info </span><span class="c013">subject</span></span></dt><dd class="dd-description">
Give information about the given subject.
For instance, <span class="c007">info breakpoints</span> will print the list of all breakpoints.
</dd></dl>
<!--TOC section id="sec341" Executing a program-->
<h2 class="section" id="sec341">16.4&#XA0;&#XA0;Executing a program</h2><!--SEC END -->
<!--TOC subsection id="sec342" Events-->
<h3 class="subsection" id="sec342">16.4.1&#XA0;&#XA0;Events</h3><!--SEC END --><p>Events are &#X201C;interesting&#X201D; locations in the source code, corresponding
to the beginning or end of evaluation of &#X201C;interesting&#X201D;
sub-expressions. Events are the unit of single-stepping (stepping goes
to the next or previous event encountered in the program execution).
Also, breakpoints can only be set at events. Thus, events play the
role of line numbers in debuggers for conventional languages.</p><p>During program execution, a counter is incremented at each event
encountered. The value of this counter is referred as the <em>current
time</em>. Thanks to reverse execution, it is possible to jump back and
forth to any time of the execution.</p><p>Here is where the debugger events (written &#XA7;&#XA7;) are located in
the source code:
</p><ul class="itemize"><li class="li-itemize">
Following a function application:
<pre>
(f arg)&#XA7;&#XA7;
</pre>
</li><li class="li-itemize">On entrance to a function:
<pre>
fun x y z -&gt; &#XA7;&#XA7; ...
</pre>
</li><li class="li-itemize">On each case of a pattern-matching definition (function,
<span class="c007">match</span>&#X2026;<span class="c007">with</span> construct, <span class="c007">try</span>&#X2026;<span class="c007">with</span> construct):
<pre>
function pat1 -&gt; &#XA7;&#XA7; expr1
       | ...
       | patN -&gt; &#XA7;&#XA7; exprN
</pre>
</li><li class="li-itemize">Between subexpressions of a sequence:
<pre>
expr1; &#XA7;&#XA7; expr2; &#XA7;&#XA7; ...; &#XA7;&#XA7; exprN
</pre>
</li><li class="li-itemize">In the two branches of a conditional expression:
<pre>
if cond then &#XA7;&#XA7; expr1 else &#XA7;&#XA7; expr2
</pre>
</li><li class="li-itemize">At the beginning of each iteration of a loop:
<pre>
while cond do &#XA7;&#XA7; body done
for i = a to b do &#XA7;&#XA7; body done
</pre>
</li></ul><p>
Exceptions: A function application followed by a function return is replaced
by the compiler by a jump (tail-call optimization). In this case, no
event is put after the function application.
</p>
<!--TOC subsection id="sec343" Starting the debugged program-->
<h3 class="subsection" id="sec343">16.4.2&#XA0;&#XA0;Starting the debugged program</h3><!--SEC END --><p>The debugger starts executing the debugged program only when needed.
This allows setting breapoints or assigning debugger variables before
execution starts. There are several ways to start execution:
</p><dl class="description"><dt class="dt-description">
<span class="c010">run</span></dt><dd class="dd-description"> Run the program until a breakpoint is hit, or the program
terminates.
</dd><dt class="dt-description"><span class="c010">goto 0</span></dt><dd class="dd-description"> Load the program and stop on the first event.
</dd><dt class="dt-description"><span class="c019"><span class="c007">goto </span><span class="c013">time</span></span></dt><dd class="dd-description"> Load the program and execute it until the
given time. Useful when you already know approximately at what time
the problem appears. Also useful to set breakpoints on function values
that have not been computed at time 0 (see section&#XA0;<a href="#s%3Abreakpoints">16.5</a>).
</dd></dl><p>The execution of a program is affected by certain information it
receives when the debugger starts it, such as the command-line
arguments to the program and its working directory. The debugger
provides commands to specify this information (<span class="c007">set arguments</span> and <span class="c007">cd</span>).
These commands must be used before program execution starts. If you try
to change the arguments or the working directory after starting your
program, the debugger will kill the program (after asking for confirmation).</p>
<!--TOC subsection id="sec344" Running the program-->
<h3 class="subsection" id="sec344">16.4.3&#XA0;&#XA0;Running the program</h3><!--SEC END --><p>The following commands execute the program forward or backward,
starting at the current time. The execution will stop either when
specified by the command or when a breakpoint is encountered.</p><dl class="description"><dt class="dt-description">
<span class="c010">run</span></dt><dd class="dd-description"> Execute the program forward from current time. Stops at
next breakpoint or when the program terminates.
</dd><dt class="dt-description"><span class="c010">reverse</span></dt><dd class="dd-description"> Execute the program backward from current time.
Mostly useful to go to the last breakpoint encountered before the
current time.
</dd><dt class="dt-description"><span class="c019"><span class="c007">step </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description"> Run the program and stop at the next
event. With an argument, do it <span class="c013">count</span> times. If <span class="c013">count</span> is 0,
run until the program terminates or a breakpoint is hit.
</dd><dt class="dt-description"><span class="c019"><span class="c007">backstep </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description"> Run the program backward and stop at
the previous event. With an argument, do it <span class="c013">count</span> times.
</dd><dt class="dt-description"><span class="c019"><span class="c007">next </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description"> Run the program and stop at the next
event, skipping over function calls. With an argument, do it
<span class="c013">count</span> times.
</dd><dt class="dt-description"><span class="c019"><span class="c007">previous </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description"> Run the program backward and stop at
the previous event, skipping over function calls. With an argument, do
it <span class="c013">count</span> times.
</dd><dt class="dt-description"><span class="c010">finish</span></dt><dd class="dd-description"> Run the program until the current function returns.
</dd><dt class="dt-description"><span class="c010">start</span></dt><dd class="dd-description"> Run the program backward and stop at the first event
before the current function invocation.
</dd></dl>
<!--TOC subsection id="sec345" Time travel-->
<h3 class="subsection" id="sec345">16.4.4&#XA0;&#XA0;Time travel</h3><!--SEC END --><p>You can jump directly to a given time, without stopping on
breakpoints, using the <span class="c007">goto</span> command.</p><p>As you move through the program, the debugger maintains an history of
the successive times you stop at. The <span class="c007">last</span> command can be used to
revisit these times: each <span class="c007">last</span> command moves one step back through
the history. That is useful mainly to undo commands such as <span class="c007">step</span>
and <span class="c007">next</span>.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">goto </span><span class="c013">time</span></span></dt><dd class="dd-description">
Jump to the given time.
</dd><dt class="dt-description"><span class="c019"><span class="c007">last </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description">
Go back to the latest time recorded in the execution history. With an
argument, do it <span class="c013">count</span> times.
</dd><dt class="dt-description"><span class="c019"><span class="c007">set history </span><span class="c013">size</span></span></dt><dd class="dd-description">
Set the size of the execution history.
</dd></dl>
<!--TOC subsection id="sec346" Killing the program-->
<h3 class="subsection" id="sec346">16.4.5&#XA0;&#XA0;Killing the program</h3><!--SEC END --><dl class="description"><dt class="dt-description">
<span class="c010">kill</span></dt><dd class="dd-description"> Kill the program being executed. This command is mainly
useful if you wish to recompile the program without leaving the debugger.
</dd></dl>
<!--TOC section id="sec347" Breakpoints-->
<h2 class="section" id="sec347">16.5&#XA0;&#XA0;Breakpoints</h2><!--SEC END --><p> <a id="s:breakpoints"></a></p><p>A breakpoint causes the program to stop whenever a certain point in
the program is reached. It can be set in several ways using the
<span class="c007">break</span> command. Breakpoints are assigned numbers when set, for
further reference. The most comfortable way to set breakpoints is
through the Emacs interface (see section&#XA0;<a href="#s%3Ainf-debugger">16.10</a>).</p><dl class="description"><dt class="dt-description">
<span class="c010">break</span></dt><dd class="dd-description">
Set a breakpoint at the current position in the program execution. The
current position must be on an event (i.e., neither at the beginning,
nor at the end of the program).</dd><dt class="dt-description"><span class="c019"><span class="c007">break </span><span class="c013">function</span></span></dt><dd class="dd-description">
Set a breakpoint at the beginning of <span class="c013">function</span>. This works only
when the functional value of the identifier <span class="c013">function</span> has been
computed and assigned to the identifier. Hence this command cannot be
used at the very beginning of the program execution, when all
identifiers are still undefined; use <span class="c007">goto</span> <span class="c013">time</span> to advance
execution until the functional value is available.</dd><dt class="dt-description"><span class="c019"><span class="c007">break @</span> [<span class="c013">module</span>] <span class="c013">line</span></span></dt><dd class="dd-description">
Set a breakpoint in module <span class="c013">module</span> (or in the current module if
<span class="c013">module</span> is not given), at the first event of line <span class="c013">line</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">break @</span> [<span class="c013">module</span>] <span class="c013">line column</span></span></dt><dd class="dd-description">
Set a breakpoint in module <span class="c013">module</span> (or in the current module if
<span class="c013">module</span> is not given), at the event closest to line <span class="c013">line</span>,
column <span class="c013">column</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">break @</span> [<span class="c013">module</span>] <span class="c007">#</span> <span class="c013">character</span></span></dt><dd class="dd-description">
Set a breakpoint in module <span class="c013">module</span> at the event closest to
character number <span class="c013">character</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">break </span><span class="c013">address</span></span></dt><dd class="dd-description">
Set a breakpoint at the code address <span class="c013">address</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">delete </span>[<span class="c013">breakpoint-numbers</span>]</span></dt><dd class="dd-description">
Delete the specified breakpoints. Without argument, all breakpoints
are deleted (after asking for confirmation).</dd><dt class="dt-description"><span class="c010">info breakpoints</span></dt><dd class="dd-description"> Print the list of all breakpoints.
</dd></dl>
<!--TOC section id="sec348" The call stack-->
<h2 class="section" id="sec348">16.6&#XA0;&#XA0;The call stack</h2><!--SEC END --><p>Each time the program performs a function application, it saves the
location of the application (the return address) in a block of data
called a stack frame. The frame also contains the local variables of
the caller function. All the frames are allocated in a region of
memory called the call stack. The command <span class="c007">backtrace</span> (or <span class="c007">bt</span>)
displays parts of the call stack.</p><p>At any time, one of the stack frames is &#X201C;selected&#X201D; by the debugger; several
debugger commands refer implicitly to the selected frame. In particular,
whenever you ask the debugger for the value of a local variable, the
value is found in the selected frame. The commands <span class="c007">frame</span>, <span class="c007">up</span> and <span class="c007">down</span>
select whichever frame you are interested in.</p><p>When the program stops, the debugger automatically selects the
currently executing frame and describes it briefly as the <span class="c007">frame</span>
command does.</p><dl class="description"><dt class="dt-description">
<span class="c010">frame</span></dt><dd class="dd-description">
Describe the currently selected stack frame.</dd><dt class="dt-description"><span class="c019"><span class="c007">frame</span> <span class="c013">frame-number</span></span></dt><dd class="dd-description">
Select a stack frame by number and describe it. The frame currently
executing when the program stopped has number 0; its caller has number
1; and so on up the call stack.</dd><dt class="dt-description"><span class="c019"><span class="c007">backtrace </span>[<span class="c013">count</span>], <span class="c007">bt </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description">
Print the call stack. This is useful to see which sequence of function
calls led to the currently executing frame. With a positive argument,
print only the innermost <span class="c013">count</span> frames.
With a negative argument, print only the outermost -<span class="c013">count</span> frames.</dd><dt class="dt-description"><span class="c019"><span class="c007">up</span> [<span class="c013">count</span>]</span></dt><dd class="dd-description">
Select and display the stack frame just &#X201C;above&#X201D; the selected frame,
that is, the frame that called the selected frame. An argument says how
many frames to go up.</dd><dt class="dt-description"><span class="c019"><span class="c007">down </span>[<span class="c013">count</span>]</span></dt><dd class="dd-description">
Select and display the stack frame just &#X201C;below&#X201D; the selected frame,
that is, the frame that was called by the selected frame. An argument
says how many frames to go down.
</dd></dl>
<!--TOC section id="sec349" Examining variable values-->
<h2 class="section" id="sec349">16.7&#XA0;&#XA0;Examining variable values</h2><!--SEC END --><p>The debugger can print the current value of simple expressions. The
expressions can involve program variables: all the identifiers that
are in scope at the selected program point can be accessed.</p><p>Expressions that can be printed are a subset of OCaml
expressions, as described by the following grammar:
</p><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" id="simple-expr"><span class="c014">simple-expr</span></a></td><td class="c022">::=</td><td class="c024">
<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;{&#XA0;<a class="syntax" href="#capitalized-ident"><span class="c014">capitalized-ident</span></a>&#XA0;<span class="c008">.</span>&#XA0;}&#XA0;&#XA0;<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">*</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">$</span>&#XA0;<span class="c014">integer</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#simple-expr"><span class="c014">simple-expr</span></a>&#XA0;<span class="c008">.</span>&#XA0;&#XA0;<a class="syntax" href="#lowercase-ident"><span class="c014">lowercase-ident</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#simple-expr"><span class="c014">simple-expr</span></a>&#XA0;<span class="c008">.(</span>&#XA0;&#XA0;<span class="c014">integer</span>&#XA0;<span class="c008">)</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<a class="syntax" href="#simple-expr"><span class="c014">simple-expr</span></a>&#XA0;<span class="c008">.[</span>&#XA0;&#XA0;<span class="c014">integer</span>&#XA0;<span class="c008">]</span>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">!</span>&#XA0;<a class="syntax" href="#simple-expr"><span class="c014">simple-expr</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">(</span>&#XA0;<a class="syntax" href="#simple-expr"><span class="c014">simple-expr</span></a>&#XA0;<span class="c008">)</span>
</td></tr>
</table></td></tr>
</table><p>
The first two cases refer to a value identifier, either unqualified or
qualified by the path to the structure that define it.
<span class="c007">*</span> refers to the result just computed (typically, the value of a
function application), and is valid only if the selected event is an
&#X201C;after&#X201D; event (typically, a function application).
<span class="c008">$</span> <span class="c014">integer</span> refer to a previously printed value. The remaining four
forms select part of an expression: respectively, a record field, an
array element, a string element, and the current contents of a
reference.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">print </span><span class="c013">variables</span></span></dt><dd class="dd-description">
Print the values of the given variables. <span class="c007">print</span> can be abbreviated as
<span class="c007">p</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">display </span><span class="c013">variables</span></span></dt><dd class="dd-description">
Same as <span class="c007">print</span>, but limit the depth of printing to 1. Useful to
browse large data structures without printing them in full.
<span class="c007">display</span> can be abbreviated as <span class="c007">d</span>.
</dd></dl><p>When printing a complex expression, a name of the form <span class="c007">$</span><span class="c013">integer</span>
is automatically assigned to its value. Such names are also assigned
to parts of the value that cannot be printed because the maximal
printing depth is exceeded. Named values can be printed later on
with the commands <span class="c007">p $</span><span class="c013">integer</span> or <span class="c007">d $</span><span class="c013">integer</span>.
Named values are valid only as long as the program is stopped. They
are forgotten as soon as the program resumes execution.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set print_depth</span> <span class="c013">d</span></span></dt><dd class="dd-description">
Limit the printing of values to a maximal depth of <span class="c013">d</span>. 
</dd><dt class="dt-description"><span class="c019"><span class="c007">set print_length</span> <span class="c013">l</span></span></dt><dd class="dd-description">
Limit the printing of values to at most <span class="c013">l</span> nodes printed.
</dd></dl>
<!--TOC section id="sec350" Controlling the debugger-->
<h2 class="section" id="sec350">16.8&#XA0;&#XA0;Controlling the debugger</h2><!--SEC END -->
<!--TOC subsection id="sec351" Setting the program name and arguments-->
<h3 class="subsection" id="sec351">16.8.1&#XA0;&#XA0;Setting the program name and arguments</h3><!--SEC END --><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set program</span> <span class="c013">file</span></span></dt><dd class="dd-description">
Set the program name to <span class="c013">file</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">set arguments</span> <span class="c013">arguments</span></span></dt><dd class="dd-description">
Give <span class="c013">arguments</span> as command-line arguments for the program.
</dd></dl><p>A shell is used to pass the arguments to the debugged program. You can
therefore use wildcards, shell variables, and file redirections inside
the arguments. To debug programs that read from standard input, it is
recommended to redirect their input from a file (using
<span class="c007">set arguments &lt; input-file</span>), otherwise input to the program and
input to the debugger are not properly separated, and inputs are not
properly replayed when running the program backwards.</p>
<!--TOC subsection id="sec352" How programs are loaded-->
<h3 class="subsection" id="sec352">16.8.2&#XA0;&#XA0;How programs are loaded</h3><!--SEC END --><p>The <span class="c007">loadingmode</span> variable controls how the program is executed.</p><dl class="description"><dt class="dt-description">
<span class="c010">set loadingmode direct</span></dt><dd class="dd-description">
The program is run directly by the debugger. This is the default mode.
</dd><dt class="dt-description"><span class="c010">set loadingmode runtime</span></dt><dd class="dd-description">
The debugger execute the OCaml runtime <span class="c007">ocamlrun</span> on the program.
Rarely useful; moreover it prevents the debugging of programs compiled
in &#X201C;custom runtime&#X201D; mode.
</dd><dt class="dt-description"><span class="c010">set loadingmode manual</span></dt><dd class="dd-description">
The user starts manually the program, when asked by the debugger.
Allows remote debugging (see section&#XA0;<a href="#s%3Acommunication">16.8.6</a>).
</dd></dl>
<!--TOC subsection id="sec353" Search path for files-->
<h3 class="subsection" id="sec353">16.8.3&#XA0;&#XA0;Search path for files</h3><!--SEC END --><p>The debugger searches for source files and compiled interface files in
a list of directories, the search path. The search path initially
contains the current directory <span class="c007">.</span> and the standard library directory.
The <span class="c007">directory</span> command adds directories to the path.</p><p>Whenever the search path is modified, the debugger will clear any
information it may have cached about the files.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">directory</span> <span class="c013">directorynames</span></span></dt><dd class="dd-description">
Add the given directories to the search path. These directories are
added at the front, and will therefore be searched first.</dd><dt class="dt-description"><span class="c019"><span class="c007">directory</span> <span class="c013">directorynames</span> <span class="c007">for</span> <span class="c013">modulename</span></span></dt><dd class="dd-description">
Same as <span class="c007">directory</span> <span class="c013">directorynames</span>, but the given directories will be
searched only when looking for the source file of a module that has 
been packed into <span class="c013">modulename</span>.</dd><dt class="dt-description"><span class="c010">directory</span></dt><dd class="dd-description">
Reset the search path. This requires confirmation.
</dd></dl>
<!--TOC subsection id="sec354" Working directory-->
<h3 class="subsection" id="sec354">16.8.4&#XA0;&#XA0;Working directory</h3><!--SEC END --><p>Each time a program is started in the debugger, it inherits its working
directory from the current working directory of the debugger. This
working directory is initially whatever it inherited from its parent
process (typically the shell), but you can specify a new working
directory in the debugger with the <span class="c007">cd</span> command or the <span class="c007">-cd</span>
command-line option.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">cd</span> <span class="c013">directory</span></span></dt><dd class="dd-description">
Set the working directory for <span class="c007">ocamldebug</span> to <span class="c013">directory</span>.</dd><dt class="dt-description"><span class="c010">pwd</span></dt><dd class="dd-description">
Print the working directory for <span class="c007">ocamldebug</span>.
</dd></dl>
<!--TOC subsection id="sec355" Turning reverse execution on and off-->
<h3 class="subsection" id="sec355">16.8.5&#XA0;&#XA0;Turning reverse execution on and off</h3><!--SEC END --><p>In some cases, you may want to turn reverse execution off. This speeds
up the program execution, and is also sometimes useful for interactive
programs.</p><p>Normally, the debugger takes checkpoints of the program state from
time to time. That is, it makes a copy of the current state of the
program (using the Unix system call <span class="c007">fork</span>). If the variable
<span class="c013">checkpoints</span> is set to <span class="c007">off</span>, the debugger will not take any
checkpoints.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set checkpoints</span> <span class="c013">on/off</span></span></dt><dd class="dd-description">
Select whether the debugger makes checkpoints or not.
</dd></dl>
<!--TOC subsection id="sec356" Communication between the debugger and the program-->
<h3 class="subsection" id="sec356">16.8.6&#XA0;&#XA0;Communication between the debugger and the program</h3><!--SEC END --><p>
<a id="s:communication"></a></p><p>The debugger communicate with the program being debugged through a
Unix socket. You may need to change the socket name, for example if
you need to run the debugger on a machine and your program on another.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set socket</span> <span class="c013">socket</span></span></dt><dd class="dd-description">
Use <span class="c013">socket</span> for communication with the program. <span class="c013">socket</span> can be
either a file name, or an Internet port specification
<span class="c013">host</span>:<span class="c013">port</span>, where <span class="c013">host</span> is a host name or an Internet
address in dot notation, and <span class="c013">port</span> is a port number on the host.
</dd></dl><p>On the debugged program side, the socket name is passed through the
<span class="c007">CAML_DEBUG_SOCKET</span> environment variable.</p>
<!--TOC subsection id="sec357" Fine-tuning the debugger-->
<h3 class="subsection" id="sec357">16.8.7&#XA0;&#XA0;Fine-tuning the debugger</h3><!--SEC END --><p> <a id="s:fine-tuning"></a></p><p>Several variables enables to fine-tune the debugger. Reasonable
defaults are provided, and you should normally not have to change them.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set processcount</span> <span class="c013">count</span></span></dt><dd class="dd-description">
Set the maximum number of checkpoints to <span class="c013">count</span>. More checkpoints
facilitate going far back in time, but use more memory and create more
Unix processes.
</dd></dl><p>As checkpointing is quite expensive, it must not be done too often. On
the other hand, backward execution is faster when checkpoints are
taken more often. In particular, backward single-stepping is more
responsive when many checkpoints have been taken just before the
current time. To fine-tune the checkpointing strategy, the debugger
does not take checkpoints at the same frequency for long displacements
(e.g. <span class="c007">run</span>) and small ones (e.g. <span class="c007">step</span>). The two variables <span class="c007">bigstep</span>
and <span class="c007">smallstep</span> contain the number of events between two checkpoints
in each case.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">set bigstep</span> <span class="c013">count</span></span></dt><dd class="dd-description">
Set the number of events between two checkpoints for long displacements.
</dd><dt class="dt-description"><span class="c019"><span class="c007">set smallstep</span> <span class="c013">count</span></span></dt><dd class="dd-description">
Set the number of events between two checkpoints for small
displacements.
</dd></dl><p>The following commands display information on checkpoints and events:</p><dl class="description"><dt class="dt-description">
<span class="c010">info checkpoints</span></dt><dd class="dd-description">
Print a list of checkpoints.
</dd><dt class="dt-description"><span class="c019"><span class="c007">info events</span> [<span class="c013">module</span>]</span></dt><dd class="dd-description">
Print the list of events in the given module (the current module, by default).
</dd></dl>
<!--TOC subsection id="sec358" User-defined printers-->
<h3 class="subsection" id="sec358">16.8.8&#XA0;&#XA0;User-defined printers</h3><!--SEC END --><p>Just as in the toplevel system (section&#XA0;<a href="#s%3Atoplevel-directives">9.2</a>),
the user can register functions for printing values of certain types.
For technical reasons, the debugger cannot call printing functions
that reside in the program being debugged. The code for the printing
functions must therefore be loaded explicitly in the debugger.</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">load_printer "</span><span class="c013">file-name</span><span class="c007">"</span></span></dt><dd class="dd-description">
Load in the debugger the indicated <span class="c007">.cmo</span> or <span class="c007">.cma</span> object file. The
file is loaded in an environment consisting only of the OCaml
standard library plus the definitions provided by object files
previously loaded using <span class="c007">load_printer</span>. If this file depends on other
object files not yet loaded, the debugger automatically loads them if
it is able to find them in the search path. The loaded file does not
have direct access to the modules of the program being debugged.</dd><dt class="dt-description"><span class="c019"><span class="c007">install_printer </span><span class="c013">printer-name</span></span></dt><dd class="dd-description">
Register the function named <span class="c013">printer-name</span> (a
value path) as a printer for objects whose types match the argument
type of the function. That is, the debugger will call
<span class="c013">printer-name</span> when it has such an object to print.
The printing function <span class="c013">printer-name</span> must use the <span class="c007">Format</span> library
module to produce its output, otherwise its output will not be
correctly located in the values printed by the toplevel loop.<p>The value path <span class="c013">printer-name</span> must refer to one of the functions
defined by the object files loaded using <span class="c007">load_printer</span>. It cannot
reference the functions of the program being debugged.</p></dd><dt class="dt-description"><span class="c019"><span class="c007">remove_printer </span><span class="c013">printer-name</span></span></dt><dd class="dd-description">
Remove the named function from the table of value printers.
</dd></dl>
<!--TOC section id="sec359" Miscellaneous commands-->
<h2 class="section" id="sec359">16.9&#XA0;&#XA0;Miscellaneous commands</h2><!--SEC END --><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">list</span> [<span class="c013">module</span>] [<span class="c013">beginning</span>] [<span class="c013">end</span>]</span></dt><dd class="dd-description">
List the source of module <span class="c013">module</span>, from line number
<span class="c013">beginning</span> to line number <span class="c013">end</span>. By default, 20 lines of the
current module are displayed, starting 10 lines before the current
position.
</dd><dt class="dt-description"><span class="c019"><span class="c007">source</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Read debugger commands from the script <span class="c013">filename</span>.
</dd></dl>
<!--TOC section id="sec360" Running the debugger under Emacs-->
<h2 class="section" id="sec360">16.10&#XA0;&#XA0;Running the debugger under Emacs</h2><!--SEC END --><p> <a id="s:inf-debugger"></a></p><p>The most user-friendly way to use the debugger is to run it under Emacs.
See the file <span class="c007">emacs/README</span> in the distribution for information on how
to load the Emacs Lisp files for OCaml support.</p><p>The OCaml debugger is started under Emacs by the command <span class="c007">M-x camldebug</span>, with argument the name of the executable file
<span class="c013">progname</span> to debug. Communication with the debugger takes place
in an Emacs buffer named <span class="c007">*camldebug-</span><span class="c013">progname</span><span class="c007">*</span>. The editing
and history facilities of Shell mode are available for interacting
with the debugger.</p><p>In addition, Emacs displays the source files containing the current
event (the current position in the program execution) and highlights
the location of the event. This display is updated synchronously with
the debugger action.</p><p>The following bindings for the most common debugger commands are
available in the <span class="c007">*camldebug-</span><span class="c013">progname</span><span class="c007">*</span> buffer:</p><dl class="description"><dt class="dt-description">
<span class="c010">C-c C-s</span></dt><dd class="dd-description"> (command <span class="c007">step</span>): execute the program one step forward.
</dd><dt class="dt-description"><span class="c010">C-c C-k</span></dt><dd class="dd-description"> (command <span class="c007">backstep</span>): execute the program one step backward.
</dd><dt class="dt-description"><span class="c010">C-c C-n</span></dt><dd class="dd-description"> (command <span class="c007">next</span>): execute the program one step
forward, skipping over function calls.
</dd><dt class="dt-description"><span class="c019">Middle mouse button</span></dt><dd class="dd-description"> (command <span class="c007">display</span>): display named value.
<span class="c007">$</span><span class="c013">n</span> under mouse cursor (support incremental browsing of large
data structures).
</dd><dt class="dt-description"><span class="c010">C-c C-p</span></dt><dd class="dd-description"> (command <span class="c007">print</span>): print value of identifier at point.
</dd><dt class="dt-description"><span class="c010">C-c C-d</span></dt><dd class="dd-description"> (command <span class="c007">display</span>): display value of identifier at point.
</dd><dt class="dt-description"><span class="c010">C-c C-r</span></dt><dd class="dd-description"> (command <span class="c007">run</span>): execute the program forward to next
breakpoint.
</dd><dt class="dt-description"><span class="c010">C-c C-v</span></dt><dd class="dd-description"> (command <span class="c007">reverse</span>): execute the program backward to
latest breakpoint.
</dd><dt class="dt-description"><span class="c010">C-c C-l</span></dt><dd class="dd-description"> (command <span class="c007">last</span>): go back one step in the command history.
</dd><dt class="dt-description"><span class="c010">C-c C-t</span></dt><dd class="dd-description"> (command <span class="c007">backtrace</span>): display backtrace of function calls.
</dd><dt class="dt-description"><span class="c010">C-c C-f</span></dt><dd class="dd-description"> (command <span class="c007">finish</span>): run forward till the current
function returns.
</dd><dt class="dt-description"><span class="c010">C-c &lt;</span></dt><dd class="dd-description"> (command <span class="c007">up</span>): select the stack frame below the
current frame.
</dd><dt class="dt-description"><span class="c010">C-c &gt;</span></dt><dd class="dd-description"> (command <span class="c007">down</span>): select the stack frame above the
current frame.
</dd></dl><p>In all buffers in OCaml editing mode, the following debugger commands
are also available:</p><dl class="description"><dt class="dt-description">
<span class="c010">C-x C-a C-b</span></dt><dd class="dd-description"> (command <span class="c007">break</span>): set a breakpoint at event closest
to point
</dd><dt class="dt-description"><span class="c010">C-x C-a C-p</span></dt><dd class="dd-description"> (command <span class="c007">print</span>): print value of identifier at point
</dd><dt class="dt-description"><span class="c010">C-x C-a C-d</span></dt><dd class="dd-description"> (command <span class="c007">display</span>): display value of identifier at point
</dd></dl>
<!--TOC chapter id="sec361" Profiling (ocamlprof)-->
<h1 class="chapter" id="sec361">Chapter&#XA0;17&#XA0;&#XA0;Profiling (ocamlprof)</h1><!--SEC END --><p> <a id="c:profiler"></a>

</p><!--NAME profil.html-->
<p>This chapter describes how the execution of OCaml
programs can be profiled, by recording how many times functions are
called, branches of conditionals are taken, &#X2026;</p>
<!--TOC section id="sec362" Compiling for profiling-->
<h2 class="section" id="sec362">17.1&#XA0;&#XA0;Compiling for profiling</h2><!--SEC END --><p>Before profiling an execution, the program must be compiled in
profiling mode, using the <span class="c007">ocamlcp</span> front-end to the <span class="c007">ocamlc</span> compiler
(see chapter&#XA0;<a href="#c%3Acamlc">8</a>) or the <span class="c007">ocamloptp</span> front-end to the
<span class="c007">ocamlopt</span> compiler (see chapter&#XA0;<a href="#c%3Anativecomp">11</a>). When compiling
modules separately, <span class="c007">ocamlcp</span> or <span class="c007">ocamloptp</span> must be used when
compiling the modules (production of <span class="c007">.cmo</span> or <span class="c007">.cmx</span> files), and can
also be used (though this is not strictly necessary) when linking them
together.</p>
<!--TOC paragraph id="sec363" Note-->
<h5 class="paragraph" id="sec363">Note</h5><!--SEC END --><p> If a module (<span class="c007">.ml</span> file) doesn&#X2019;t have a corresponding
interface (<span class="c007">.mli</span> file), then compiling it with <span class="c007">ocamlcp</span> will produce
object files (<span class="c007">.cmi</span> and <span class="c007">.cmo</span>) that are not compatible with the ones
produced by <span class="c007">ocamlc</span>, which may lead to problems (if the <span class="c007">.cmi</span> or
<span class="c007">.cmo</span> is still around) when switching between profiling and
non-profiling compilations. To avoid this problem, you should always
have a <span class="c007">.mli</span> file for each <span class="c007">.ml</span> file. The same problem exists with
<span class="c007">ocamloptp</span>.</p>
<!--TOC paragraph id="sec364" Note-->
<h5 class="paragraph" id="sec364">Note</h5><!--SEC END --><p> To make sure your programs can be compiled in
profiling mode, avoid using any identifier that begins with
<span class="c007">__ocaml_prof</span>.</p><p>The amount of profiling information can be controlled through the <span class="c007">-P</span>
option to <span class="c007">ocamlcp</span> or <span class="c007">ocamloptp</span>, followed by one or several letters
indicating which parts of the program should be profiled:</p><dl class="description"><dt class="dt-description">
<span class="c010">a</span></dt><dd class="dd-description"> all options
</dd><dt class="dt-description"><span class="c010">f</span></dt><dd class="dd-description"> function calls : a count point is set at the beginning of
each function body
</dd><dt class="dt-description"><span class="c010">i</span></dt><dd class="dd-description"> <span class="c019">if &#X2026;then &#X2026;else &#X2026;</span> : count points are set in
both <span class="c019">then</span> branch and <span class="c019">else</span> branch
</dd><dt class="dt-description"><span class="c010">l</span></dt><dd class="dd-description"> <span class="c019">while, for</span> loops: a count point is set at the beginning of
the loop body
</dd><dt class="dt-description"><span class="c010">m</span></dt><dd class="dd-description"> <span class="c019">match</span> branches: a count point is set at the beginning of the
body of each branch
</dd><dt class="dt-description"><span class="c010">t</span></dt><dd class="dd-description"> <span class="c019">try &#X2026;with &#X2026;</span> branches: a count point is set at the
beginning of the body of each branch
</dd></dl><p>For instance, compiling with <span class="c007">ocamlcp -P film</span> profiles function calls,
if&#X2026;then&#X2026;else&#X2026;, loops and pattern matching.</p><p>Calling <span class="c007">ocamlcp</span> or <span class="c007">ocamloptp</span> without the <span class="c007">-P</span> option defaults to
<span class="c007">-P fm</span>, meaning that only function calls and pattern matching are
profiled.</p>
<!--TOC paragraph id="sec365" Note-->
<h5 class="paragraph" id="sec365">Note</h5><!--SEC END --><p> For compatibility with previous releases, <span class="c007">ocamlcp</span>
also accepts the <span class="c007">-p</span> option, with the same arguments and behaviour as
<span class="c007">-P</span>.</p><p>The <span class="c007">ocamlcp</span> and <span class="c007">ocamloptp</span> commands also accept all the options of
the corresponding <span class="c007">ocamlc</span> or <span class="c007">ocamlopt</span> compiler, except the <span class="c007">-pp</span>
(preprocessing) option.</p>
<!--TOC section id="sec366" Profiling an execution-->
<h2 class="section" id="sec366">17.2&#XA0;&#XA0;Profiling an execution</h2><!--SEC END --><p>Running an executable that has been compiled with <span class="c007">ocamlcp</span> or
<span class="c007">ocamloptp</span> records the execution counts for the specified parts of
the program and saves them in a file called <span class="c007">ocamlprof.dump</span> in the
current directory.</p><p>If the environment variable <span class="c007">OCAMLPROF_DUMP</span> is set when the program
exits, its value is used as the file name instead of <span class="c007">ocamlprof.dump</span>.</p><p>The dump file is written only if the program terminates
normally (by calling <span class="c007">exit</span> or by falling through). It is not written
if the program terminates with an uncaught exception.</p><p>If a compatible dump file already exists in the current directory, then the
profiling information is accumulated in this dump file. This allows, for
instance, the profiling of several executions of a program on
different inputs. Note that dump files produced by byte-code
executables (compiled with <span class="c007">ocamlcp</span>) are compatible with the dump
files produced by native executables (compiled with <span class="c007">ocamloptp</span>).</p>
<!--TOC section id="sec367" Printing profiling information-->
<h2 class="section" id="sec367">17.3&#XA0;&#XA0;Printing profiling information</h2><!--SEC END --><p>The <span class="c007">ocamlprof</span> command produces a source listing of the program modules
where execution counts have been inserted as comments. For instance,
</p><pre>        ocamlprof foo.ml
</pre><p>prints the source code for the <span class="c007">foo</span> module, with comments indicating
how many times the functions in this module have been called. Naturally,
this information is accurate only if the source file has not been modified
after it was compiled.</p><p>The following options are recognized by <span class="c007">ocamlprof</span>:</p><dl class="description"><dt class="dt-description"><span class="c019"><span class="c007">-f</span> <span class="c013">dumpfile</span></span></dt><dd class="dd-description">
Specifies an alternate dump file of profiling information to be read.</dd><dt class="dt-description"><span class="c019"><span class="c007">-F</span> <span class="c013">string</span></span></dt><dd class="dd-description">
Specifies an additional string to be output with profiling information.
By default, <span class="c007">ocamlprof</span> will annotate programs with comments of the form
<span class="c007">(* <span class="c013">n</span> *)</span> where <span class="c013">n</span> is the counter value for a profiling
point. With option <span class="c007">-F <span class="c013">s</span></span>, the annotation will be
<span class="c007">(* <span class="c013">sn</span> *)</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-impl</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Process the file <span class="c013">filename</span> as an implementation file, even if its
extension is not <span class="c007">.ml</span>.</dd><dt class="dt-description"><span class="c019"><span class="c007">-intf</span> <span class="c013">filename</span></span></dt><dd class="dd-description">
Process the file <span class="c013">filename</span> as an interface file, even if its
extension is not <span class="c007">.mli</span>.</dd><dt class="dt-description"><span class="c010">-version</span></dt><dd class="dd-description">
Print version string and exit.</dd><dt class="dt-description"><span class="c010">-vnum</span></dt><dd class="dd-description">
Print short version number and exit.</dd><dt class="dt-description"><span class="c019"><span class="c007">-help</span> or <span class="c007">--help</span></span></dt><dd class="dd-description">
Display a short usage summary and exit.
</dd></dl>
<!--TOC section id="sec368" Time profiling-->
<h2 class="section" id="sec368">17.4&#XA0;&#XA0;Time profiling</h2><!--SEC END --><p>Profiling with <span class="c007">ocamlprof</span> only records execution counts, not the actual
time spent within each function. There is currently no way to perform
time profiling on bytecode programs generated by <span class="c007">ocamlc</span>.</p><p>Native-code programs generated by <span class="c007">ocamlopt</span> can be profiled for time
and execution counts using the <span class="c007">-p</span> option and the standard Unix
profiler <span class="c007">gprof</span>. Just add the <span class="c007">-p</span> option when compiling and linking
the program:
</p><pre>
        ocamlopt -o myprog -p <span class="c013">other-options files</span>
        ./myprog
        gprof myprog
</pre><p>
OCaml function names in the output of <span class="c007">gprof</span> have the following format:
</p><pre>
        <span class="c013">Module-name</span>_<span class="c013">function-name</span>_<span class="c013">unique-number</span>
</pre><p>
Other functions shown are either parts of the OCaml run-time system or
external C functions linked with the program.</p><p>The output of <span class="c007">gprof</span> is described in the Unix manual page for
<span class="c007">gprof(1)</span>. It generally consists of two parts: a &#X201C;flat&#X201D; profile
showing the time spent in each function and the number of invocation
of each function, and a &#X201C;hierarchical&#X201D; profile based on the call
graph. Currently, only the Intel x86 ports of <span class="c007">ocamlopt</span> under
Linux, BSD and MacOS X support the two profiles. On other platforms,
<span class="c007">gprof</span> will report only the &#X201C;flat&#X201D; profile with just time
information. When reading the output of <span class="c007">gprof</span>, keep in mind that
the accumulated times computed by <span class="c007">gprof</span> are based on heuristics and
may not be exact.</p>
<!--TOC paragraph id="sec369" Note-->
<h5 class="paragraph" id="sec369">Note</h5><!--SEC END --><p> The <span class="c007">ocamloptp</span> command also accepts the <span class="c007">-p</span>
option. In that case, both kinds of profiling are performed by the
program, and you can display the results with the <span class="c007">gprof</span> and <span class="c007">ocamlprof</span>
commands, respectively.

</p>
<!--TOC chapter id="sec370" The ocamlbuild compilation manager-->
<h1 class="chapter" id="sec370">Chapter&#XA0;18&#XA0;&#XA0;The ocamlbuild compilation manager</h1><!--SEC END --><p> <a id="c:ocamlbuild"></a>

</p><!--NAME ocamlbuild.html-->
<p><span class="c013">(Chapter written by Berke Durak and Nicolas Pouillard)</span></p><p><br>
<br>
</p><p><span class="c007">ocamlbuild</span> is a tool automating the compilation of most OCaml projects with minimal
user input. Its use is not restricted to projects having a simple structure &#X2013;
the extra effort needed to make it work with the more complex projects is in
reasonable proportion with their added complexity. In practice, one will use a
set of small text files, and, if needed, an OCaml compilation module that can
fine-tune the behaviour and define custom rules.</p>
<!--TOC section id="sec371" Features of <span class="c007">ocamlbuild</span>-->
<h2 class="section" id="sec371">18.1&#XA0;&#XA0;Features of <span class="c007">ocamlbuild</span></h2><!--SEC END --><p>
<em>This section is intended to read like a sales brochure or a datasheet.</em></p><ul class="itemize"><li class="li-itemize">
Built-in compilation rules for OCaml projects handle all the nasty cases:
native and byte-code, missing <span class="c007">.mli</span> files, preprocessor rules,
libraries, package (-pack) debugging and profiling flags, C stubs.
</li><li class="li-itemize">Plugin mechanism for writing compilation rules and actions in a real programming language,
OCaml itself.
</li><li class="li-itemize">Automatic inference of dependencies.
</li><li class="li-itemize">Correct handling of dynamically discovered dependencies.
</li><li class="li-itemize">Object files and other temporary files are created in a specific directory, leaving your main directory uncluttered.
</li><li class="li-itemize">Sanity checks ensure that object files are where they are supposed to be: in the build directory.
</li><li class="li-itemize">Regular projects are built using a single command with no extra files.
</li><li class="li-itemize">Parallel compilation to speed up things on multi-core systems.
</li><li class="li-itemize">Sophisticated display mode to keep your screen free of boring and repetitive compilation message
while giving you important progress information in a glimpse, and correctly multiplexing the error messages.
</li><li class="li-itemize">Tags and flags provide a concise and convenient mechanism for automatic selection of compilation, preprocessing and
other options.
</li><li class="li-itemize">Extended shell-like glob patterns, that can be combined using boolean operators,
allow you to concisely define the tags that apply to a given file.
</li><li class="li-itemize">Mechanisms for defining the mutual visibility of subdirectories.
</li><li class="li-itemize">Cache mechanism avoiding unnecessary compilations where reasonably computable.
</li></ul>
<!--TOC section id="sec372" Limitations-->
<h2 class="section" id="sec372">18.2&#XA0;&#XA0;Limitations</h2><!--SEC END --><p>
<em>Not perfect nor complete yet, but already pretty damn useful.</em></p><p>We were not expecting to write the ultimate compilation tool in a few man-months, however we believe we have
a tool that solves many compilation problems, especially our own, in a satisfactory way. Hence there are a
lot of missing features, incomplete options and hideous bugs lurking in <span class="c007">ocamlbuild</span>, and we hope that the OCaml community
will find our first try at <span class="c007">ocamlbuild</span> useful and hopefully help it grow into a tool that satisfies most needs of most users
by providing feedback, bug reports and patches.</p><p>The plugin API maybe somewhat lacking in maturity, as it has only been tested
by a few people. We believe a good API can only evolve under pressure from
many peers and the courage to rewrite things cleanly when time is ripe by the
developers. Most of the important functions a user will need are encapsulated
in the plugin API, which is the <span class="c007">Ocamlbuild_plugin</span> module pack. We
intend to keep that API backwards compatible. It may happen that intricate
projects need features not available in that module &#X2013; you may then use
functions or values directly from the core <span class="c007">ocamlbuild</span> modules. We ask you to report
such usage to the authors so that we may make the necessary changes to the API;
you may also want to isolate calls to the non-API parts of the <span class="c007">ocamlbuild</span> library
from the rest of your plugin to be able to keep the later when incompatible
changes arise.</p><p>The way that <span class="c007">ocamlbuild</span> handles the command-line options, the <span class="c007">_tags</span> file,
the target names, names of the tags, and so on, are not expected to change in
incompatible ways. We intend to keep a project that compiles without a plugin
compilable without modifications in the future.
</p>
<!--TOC section id="sec373" Using <span class="c007">ocamlbuild</span>-->
<h2 class="section" id="sec373">18.3&#XA0;&#XA0;Using <span class="c007">ocamlbuild</span></h2><!--SEC END --><p>
<em>Learn how to use <span class="c007">ocamlbuild</span> with short, specific, straight-to-the-point examples.</em></p><p>The amount of time and effort spent on the compilation process of a project
should be proportionate to that spent on the project itself. It should be easy
to set up a small project, maybe a little harder for a medium-sized project,
and it may take some more time, but not too much, for a big project. Ideally
setting up a big project would be as easy as setting up a small project. However,
as projects grow, modularization techniques start to be used, and the probability
of using meta programming or multiple programming languages increases, thus making
the compilation process more delicate.</p><p><span class="c007">ocamlbuild</span> is intended to be very easy to use for projects, large or small, with a simple
compilation process: typing
<span class="c007">ocamlbuild foo.native</span> should be enough to compile the native version
of a program whose top module is <span class="c007">foo.ml</span> and whose dependencies are in
the same directory. As your project gets more complex, you will gradually
start to use command-line options to specify libraries to link with, then
configuration files, ultimately culminating in a custom OCaml plugin for
complex projects with arbitrary dependencies and actions.</p>
<!--TOC subsection id="sec374" Hygiene &amp; where is my code ?-->
<h3 class="subsection" id="sec374">18.3.1&#XA0;&#XA0;Hygiene &amp; where is my code ?</h3><!--SEC END --><p>
Your code is in the <span class="c007">_build</span> directory, but <span class="c007">ocamlbuild</span> automatically creates
a symbolic link to the executables it produces in the current directory.
<span class="c007">ocamlbuild</span> copies the source files and compiles them in a separate directory
which is <span class="c007">_build</span> by default.</p><p>For <span class="c007">ocamlbuild</span>, any file that is not in the build directory is a source file.
It is not unreasonable to think that some users may have bought binary object files
they keep in their project directory. Usually binary files cluttering the project
directory are due to previous builds using other systems. <span class="c007">ocamlbuild</span> has so-called
&#X201C;hygiene&#X201D; rules that state that object files (<span class="c007">.cmo</span>, <span class="c007">.cmi</span>,
or <span class="c007">.o</span> files, for instance) must not appear outside of the build
directory. These rules are enforced at startup; any violations will be reported
and <span class="c007">ocamlbuild</span> will exit. You must then remove these files by hand or run, with caution,
the script <span class="c007">sanitize.sh</span>, which is generated in your source directory.
This script will contain commands to remove them for you.</p><p>To disable these checks, you can use the <span class="c007">-no-hygiene</span> flag. If you have
files that must elude the hygiene squad, just tag them with <span class="c007">precious</span>
or <span class="c007">not_hygienic</span>.
</p>
<!--TOC subsection id="sec375" Hello, world !-->
<h3 class="subsection" id="sec375">18.3.2&#XA0;&#XA0;Hello, world !</h3><!--SEC END --><p>
Assuming we are in a directory named <span class="c007">example1</span> containing one file <span class="c007">hello.ml</span>
whose contents are
</p><pre>let _ =
  Printf.printf "Hello, %s ! My name is %s\n"
    (if Array.length Sys.argv &gt; 1 then Sys.argv.(1) else "stranger")
    Sys.argv.(0)
;;
</pre><p>we can compile and link it into a native executable by invoking <span class="c007">ocamlbuild hello.native</span>.
Here, <span class="c007">hello</span> is the basename of the top-level module and <span class="c007">native</span> is an extension used
by <span class="c007">ocamlbuild</span> to denote native code executables.
</p><pre>% ls
hello.ml
% ocamlbuild hello.native
Finished, 4 targets (0 cached) in 00:00:00.
% ls -l
total 12
drwxrwx--- 2 linus gallium 4096 2007-01-17 16:24 _build/
-rw-rw---- 1 linus gallium   43 2007-01-17 16:23 hello.ml
lrwxrwxrwx 1 linus gallium   19 2007-01-17 16:24 hello.native -&gt; _build/hello.native*
</pre><p>What&#X2019;s this funny <span class="c007">_build</span> directory ? Well that&#X2019;s where <span class="c007">ocamlbuild</span> does its dirty work
of compiling. You usually won&#X2019;t have to look very often into this directory. Source files are copied
into <span class="c007">_build</span> and this is where the compilers will be run. Various cache files are also stored
there. Its contents may look like this:
</p><pre>% ls -l _build
total 208
-rw-rw---- 1 linus gallium    337 2007-01-17 16:24 _digests
-rw-rw---- 1 linus gallium    191 2007-01-17 16:24 hello.cmi
-rw-rw---- 1 linus gallium    262 2007-01-17 16:24 hello.cmo
-rw-rw---- 1 linus gallium    225 2007-01-17 16:24 hello.cmx
-rw-rw---- 1 linus gallium     43 2007-01-17 16:23 hello.ml
-rw-rw---- 1 linus gallium     17 2007-01-17 16:24 hello.ml.depends
-rwxrwx--- 1 linus gallium 173528 2007-01-17 16:24 hello.native*
-rw-rw---- 1 linus gallium    936 2007-01-17 16:24 hello.o
-rw-rw---- 1 linus gallium     22 2007-01-17 16:24 ocamlc.where
</pre>
<!--TOC subsection id="sec376" Executing my code-->
<h3 class="subsection" id="sec376">18.3.3&#XA0;&#XA0;Executing my code</h3><!--SEC END --><p>
You can execute your code the old-fashioned way (<span class="c007">./hello.native</span>).
You may also type
</p><pre>ocamlbuild hello.native -- Caesar
</pre><p>and it will compile and then run <span class="c007">hello.native</span> with the arguments following <span class="c007">--</span>,
which should display:
</p><pre>% ocamlbuild hello.native -- Caesar
Finished, 4 targets (0 cached) in 00:00:00.
Hello, Caesar ! My name is _build/hello.native
</pre>
<!--TOC subsection id="sec377" The log file, verbosity and debugging-->
<h3 class="subsection" id="sec377">18.3.4&#XA0;&#XA0;The log file, verbosity and debugging</h3><!--SEC END --><p>
By default, if you run <span class="c007">ocamlbuild</span> on a terminal, it will use some ANSI escape sequences
to display a nice, one-line progress indicator. To see what commands <span class="c007">ocamlbuild</span> has actually run,
you can check the contents of the <span class="c007">_build/_log</span> file. To change the name of the
log file or to disable logging, use the <span class="c007">-log &lt;file&gt;</span> or <span class="c007">-no-log</span> options.
Note that the log file is truncated at each execution of <span class="c007">ocamlbuild</span>.</p><p>The log file contains all the external commands that <span class="c007">ocamlbuild</span> ran or intended to
run along with the target name and the computed tags. With the
<span class="c007">-verbose &lt;level&gt;</span> option, <span class="c007">ocamlbuild</span> will also write more or less useful
debugging information; a verbosity level of 1 (which can also be specified
using the <span class="c007">-verbose</span> switch) prints generally useful information; higher
levels produce much more output.
</p>
<!--TOC subsection id="sec378" Cleaning-->
<h3 class="subsection" id="sec378">18.3.5&#XA0;&#XA0;Cleaning</h3><!--SEC END --><p>
<span class="c007">ocamlbuild</span> may leave a <span class="c007">_build</span> directory and symbolic links to executables in
that directory (unless when using -no-links). All of these can be removed safely
by hand, or by invoking <span class="c007">ocamlbuild</span> with the <span class="c007">-clean</span> flag.
</p>
<!--TOC subsection id="sec379" Where and how to run <span class="c007">ocamlbuild</span>?-->
<h3 class="subsection" id="sec379">18.3.6&#XA0;&#XA0;Where and how to run <span class="c007">ocamlbuild</span>?</h3><!--SEC END --><p>
An important point is that <span class="c007">ocamlbuild</span> must be invoked from the root of the project,
even if this project has multiple, nested subdirectories. This is because <span class="c007">ocamlbuild</span> likes to store the object files in a single <span class="c007">_build</span> directory. You
can change the name of that directory with the <span class="c007">-build-dir</span> option.</p><p><span class="c007">ocamlbuild</span> can be either invoked manually from the UNIX or Windows shell, or
automatically from a build script or a Makefile. Unless run with the
<span class="c007">-no-hygiene</span> option, there is the possibility that <span class="c007">ocamlbuild</span> will prompt the
user for a response. By default, on UNIX systems, if <span class="c007">ocamlbuild</span> senses that the
standard output is a terminal, it will use a nice progress indicator using ANSI
codes, instrumenting the output of the processes it spawns to have a consistent
display. Under non-UNIX systems, or if the standard output is not a terminal,
it will run in classic mode where it will echo the executed commands on its
standard output. This selection can be overridden with the <span class="c007">-classic-display</span> option.
</p>
<!--TOC subsection id="sec380" Dependencies-->
<h3 class="subsection" id="sec380">18.3.7&#XA0;&#XA0;Dependencies</h3><!--SEC END --><p>
<em>Dependencies are automatically discovered.</em></p><p>Most of the value of <span class="c007">ocamlbuild</span> lies in the fact that it often needs no extra
information to compile a project besides the name of the top-level module.
<span class="c007">ocamlbuild</span> calls <span class="c007">ocamldep</span> to automatically find the dependencies of any
modules it wants to compile. These dependencies are dynamically incorporated
in the dependency graph, something <span class="c007">make</span> cannot do.
For instance, let&#X2019;s add a module <span class="c007">Greet</span> that implements various ways of
greeting people.
</p><pre>% cat greet.ml
type how = Nicely | Badly;;

let greet how who =
  match how with Nicely -&gt; Printf.printf "Hello, %s !\n" who
               | Badly  -&gt; Printf.printf "Oh, here is that %s again.\n" who
;;
% cat hello.ml
open Greet

let _ =
  let name =
    if Array.length Sys.argv &gt; 1 then
      Sys.argv.(1)
    else
      "stranger"
  in
  greet
    (if name = "Caesar" then Nicely else Badly)
    name;
  Printf.printf "My name is %s\n" Sys.argv.(0)
;;
</pre><p>Then the module <span class="c007">Hello</span> depends on the module <span class="c007">Greet</span> and <span class="c007">ocamlbuild</span> can
figure this out for himself &#X2013; we still only have to invoke <span class="c007">ocamlbuild hello.native</span>. Needless to say, this works for any number of modules.
</p>
<!--TOC subsection id="sec381" Native and byte-code-->
<h3 class="subsection" id="sec381">18.3.8&#XA0;&#XA0;Native and byte-code</h3><!--SEC END --><p>
If we want to compile byte-code instead of native, we just a target name of
<span class="c007">hello.byte</span> instead of <span class="c007">hello.native</span>, i.e., we type
<span class="c007">ocamlbuild hello.byte</span>.
</p>
<!--TOC subsection id="sec382" Compile flags-->
<h3 class="subsection" id="sec382">18.3.9&#XA0;&#XA0;Compile flags</h3><!--SEC END --><p>
To pass a flag to the compiler, such as the <span class="c007">-rectypes</span> option,
use the <span class="c007">-cflag</span> option as in:
</p><pre>ocamlbuild -cflag -rectypes hello.native
</pre><p>You can put multiple <span class="c007">-cflag</span> options, they will be passed to the compiler
in the same order. You can also give them in a comma-separated list with the
<span class="c007">-cflags</span> option (notice the plural):
</p><pre>ocamlbuild -cflags -I,+lablgtk,-rectypes hello.native
</pre><p>These flags apply when compiling, that is, when producing <span class="c007">.cmi</span>,
<span class="c007">.cmo</span>,<span class="c007">.cmx</span> and <span class="c007">.o</span> files from <span class="c007">.ml</span> or
<span class="c007">.mli</span> files.
</p>
<!--TOC subsection id="sec383" Link flags-->
<h3 class="subsection" id="sec383">18.3.10&#XA0;&#XA0;Link flags</h3><!--SEC END --><p>
Link flags apply when the various object files are collected and linked into
one executable. These will typically be include directories for libraries.
They are given using the <span class="c007">-lflag</span> and <span class="c007">-lflags</span> options, which
work in the same way as the <span class="c007">-cflag</span> and <span class="c007">-cflags</span> options.
</p>
<!--TOC subsection id="sec384" Linking with external libraries-->
<h3 class="subsection" id="sec384">18.3.11&#XA0;&#XA0;Linking with external libraries</h3><!--SEC END --><p>
In our third example, we use one Unix system call and functions from the <span class="c007">num</span>
library:
</p><pre>% cat epoch.ml
let _ =
  let s = Num.num_of_string (Printf.sprintf "%.0f" (Unix.gettimeofday ())) in
  let ps = Num.mult_num (Num.num_of_string "1000000000000") s in
  Printf.printf "%s picoseconds have passed since January 1st, 1970.\n"
    (Num.string_of_num ps)
;;
</pre><p>This requires linking with the <span class="c007">unix</span> and <span class="c007">num</span> modules, which is accomplished
by using the <span class="c007">-lib unix</span> and <span class="c007">-lib num</span> flags, or, alternatively, <span class="c007">-libs unix,num</span>:
</p><pre>% ocamlbuild -libs nums,unix epoch.native --
Finished, 4 targets (4 cached) in 00:00:00.
1169051647000000000000 picoseconds have passed since January 1st, 1970.
</pre><p>You may need to add options such as <span class="c007">-cflags -I,/usr/local/lib/ocaml/</span>
and <span class="c007">-lflags -I,/usr/local/lib/ocaml/</span> if the libraries you wish to
link with are not in OCaml&#X2019;s default search path.
</p>
<!--TOC subsection id="sec385" The <span class="c007">_tags</span> files-->
<h3 class="subsection" id="sec385">18.3.12&#XA0;&#XA0;The <span class="c007">_tags</span> files</h3><!--SEC END --><p>
Finer control over the compiler flags applied to each source file, such as
preprocessing, debugging, profiling and linking options, can be gained using
<span class="c007">ocamlbuild</span>&#X2019;s tagging mechanism.</p><p>Every source file has a set of tags which tells <span class="c007">ocamlbuild</span> what kind of file it is
and what to do with it. A tag is simply a string, usually lowercase, for
example <span class="c007">ocaml</span> or <span class="c007">native</span>. The set of tags attached to a file
is computed by applying the tagging rules to the filename. Tagging rules are
defined in <span class="c007">_tags</span> files in any parent directory of a file, up to the main
project directory.</p><p>Each line in the <span class="c007">_tags</span> file is made of a glob pattern (see subsection
<a href="#subsec%3Aglob">18.3.13</a>) and a list of tags. More than one rule can apply to a file
and rules are applied in the order in which they appear in a file.
By preceding a tag with a minus sign, one may remove tags from one or more files.</p>
<!--TOC subsubsection id="sec386" Example: the built-in <span class="c007">_tags</span> file-->
<h4 class="subsubsection" id="sec386">Example: the built-in <span class="c007">_tags</span> file</h4><!--SEC END --><pre>     &lt;**/*.ml&gt; or &lt;**/*.mli&gt; or &lt;**/*.mlpack&gt; or &lt;**/*.ml.depends&gt;: ocaml
     &lt;**/*.byte&gt;: ocaml, byte, program
     &lt;**/*.odoc&gt;: ocaml, doc
     &lt;**/*.native&gt;: ocaml, native, program
     &lt;**/*.cma&gt;: ocaml, byte, library
     &lt;**/*.cmxa&gt;: ocaml, native, library
     &lt;**/*.cmo&gt;: ocaml, byte
     &lt;**/*.cmi&gt;: ocaml, byte, native
     &lt;**/*.cmx&gt;: ocaml, native
</pre><p>
Two special tags made from the path name of the file relative to the toplevel
of the project are automatically defined for each file. For a file
<span class="c007">foo/bar.ml</span> those tags will be <span class="c007">file:foo/bar.ml</span>, and
<span class="c007">extension:ml</span>.</p><p>If you do not have subdirectories, you can put <span class="c007">*.ml</span> instead of
<span class="c007">**/*.ml</span>.
</p>
<!--TOC subsection id="sec387" Glob patterns and expressions-->
<h3 class="subsection" id="sec387">18.3.13&#XA0;&#XA0;Glob patterns and expressions</h3><!--SEC END --><p>
<a id="subsec:glob"></a>
Glob patterns have a syntax similar to those used by UNIX shells to select path
names (like <span class="c007">foo_*.ba?</span>). They are used in <span class="c007">ocamlbuild</span> to define the files
and directories to which tags apply. Glob expressions are glob patterns
enclosed in brackets <span class="c007">&lt;</span> and <span class="c007">&gt;</span> combined using the standard
boolean operators <span class="c007">and</span>, <span class="c007">or</span>, <span class="c007">not</span>. This allows one to
describe sets of path names in more concise and more readable ways.</p><p>Please note that file and directory names are supposed to be made of the
following characters: <span class="c007">a</span>, &#X2026;, <span class="c007">z</span>, <span class="c007">A</span>,
&#X2026;, <span class="c007">Z</span>, <span class="c007">0</span>, &#X2026;, <span class="c007">9</span>, <span class="c007">_</span>,
<span class="c007">-</span> and <span class="c007">.</span>. This is called the pathname alphabet <span class="c013">P</span>.</p><blockquote class="table"><div class="center"><hr class="c032"></div>
<div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c028"><span class="c012"><em> Formal syntax</em></span></td><td class="c029"><span class="c012"><em> Example</em></span></td><td class="c028"><span class="c012"><em>Matches</em></span></td><td class="c028"><span class="c012"><em>Does not match</em></span></td><td class="c028"><span class="c012"><em> Meaning (formal meaning) </em></span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c013">u</span> <br>
 A string of pathname characters</span></td><td class="c029"><span class="c012"> <span class="c007">foo.ml</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo.ml</span></span></td><td class="c028"><span class="c012"> <span class="c007">fo.ml</span>, <span class="c007">bar/foo.ml</span></span></td><td class="c028"><span class="c012"> The exact string <span class="c013">u</span>
({ <span class="c013">u</span> }, where <span class="c013">u</span> &#X2208; <span class="c013">P</span></span><sup><span class="c012">*</span></sup><span class="c012">) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">*</span> <br>
 The wild-card star</span></td><td class="c029"><span class="c012"> <span class="c007">*</span></span></td><td class="c028"><span class="c012"> &#X3B5;, <span class="c007">foo</span>, <span class="c007">bar</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo/bar</span>, <span class="c007">/bar</span></span></td><td class="c028"><span class="c012"> Any string not containing a slash
(<span class="c013">P</span></span><sup><span class="c012">*</span></sup><span class="c012">) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">?</span> <br>
 The joker</span></td><td class="c029"><span class="c012"> <span class="c007">?</span></span></td><td class="c028"><span class="c012"> <span class="c007">a</span>, <span class="c007">b</span>, <span class="c007">z</span></span></td><td class="c028"><span class="c012"> <span class="c007">/</span>, <span class="c007">bar</span></span></td><td class="c028"><span class="c012"> Any one-letter string, excluding the slash </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">**/</span> <br>
 The prefix inter-directory star</span></td><td class="c029"><span class="c012"> <span class="c007">**/foo.ml</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo.ml</span>, <span class="c007">bar/foo.ml</span>, <span class="c007">bar/baz/foo.ml</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo/bar</span>, <span class="c007">/bar</span></span></td><td class="c028"><span class="c012"> The empty string, or any string ending with a slash
(&#X3B5; &#X222A; <span class="c013">P</span></span><sup><span class="c012">*</span></sup><span class="c012"><span class="c007">/</span>) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">/**</span> <br>
 The suffix inter-directory star</span></td><td class="c029"><span class="c012"> <span class="c007">foo/**</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo</span>, <span class="c007">foo/bar</span></span></td><td class="c028"><span class="c012"> <span class="c007">bar/foo</span></span></td><td class="c028"><span class="c012"> Any string starting with a slash, or the empty string
(&#X3B5; &#X222A; <span class="c007">/</span><span class="c013">P</span></span><sup><span class="c012">*</span></sup><span class="c012">) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">/**/</span> <br>
 The infix inter-directory star</span></td><td class="c029"><span class="c012"> <span class="c007">bar/**/foo.ml</span></span></td><td class="c028"><span class="c012"> <span class="c007">bar/foo.ml</span>, <span class="c007">bar/baz/foo.ml</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo.ml</span></span></td><td class="c028"><span class="c012"> Any string starting and ending with a slash
(&#X3B5; &#X222A; <span class="c007">/</span><span class="c013">P</span></span><sup><span class="c012">*</span></sup><span class="c012"><span class="c007">/</span>) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">[</span> <span class="c013">r</span></span><sub><span class="c012">1</span></sub><span class="c016"> r</span><sub><span class="c012">2</span></sub><span class="c012"> &#X22EF; <span class="c013">r</span></span><sub><span class="c016">k</span></sub><span class="c012"> <span class="c007">]</span>
where <span class="c013">r</span></span><sub><span class="c016">i</span></sub><span class="c012"> is either <span class="c013">c</span> or <span class="c013">c</span></span><sub><span class="c012">1</span></sub><span class="c012">&#X2212;<span class="c013">c</span></span><sub><span class="c012">2</span></sub><span class="c012"> (1 &#X2264; <span class="c013">i</span> &#X2264; <span class="c013">k</span>)
<br>
 The positive character class</span></td><td class="c029"><span class="c012"> <span class="c007">[a-fA-F0-9_.]</span></span></td><td class="c028"><span class="c012"> <span class="c007">3</span>, <span class="c007">F</span>, <span class="c007">.</span></span></td><td class="c028"><span class="c012"> <span class="c007">z</span>, <span class="c007">bar</span></span></td><td class="c028"><span class="c012"> Any one-letter string made of characters from one of the ranges
<span class="c013">r</span></span><sub><span class="c016">i</span></sub><span class="c012"> (1 &#X2264; <span class="c013">i</span> &#X2264; <span class="c013">n</span>).
(<span class="c015">L</span>(<span class="c013">r</span></span><sub><span class="c012">1</span></sub><span class="c012">) &#X222A; &#X22EF; &#X222A; <span class="c015">L</span>(<span class="c013">r</span></span><sub><span class="c016">n</span></sub><span class="c012">)) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">[^</span><span class="c013">r</span></span><sub><span class="c012">1</span></sub><span class="c016"> r</span><sub><span class="c012">2</span></sub><span class="c012"> &#X22EF; <span class="c013">r</span></span><sub><span class="c016">k</span></sub><span class="c012"> <span class="c007">]</span>
where <span class="c013">r</span></span><sub><span class="c016">i</span></sub><span class="c012"> is either <span class="c013">c</span> or <span class="c013">c</span></span><sub><span class="c012">1</span></sub><span class="c012">&#X2212;<span class="c013">c</span></span><sub><span class="c012">2</span></sub><span class="c012"> (1 &#X2264; <span class="c013">i</span> &#X2264; <span class="c013">k</span>)
<br>
 The negative character class</span></td><td class="c029"><span class="c012"> <span class="c007">[^a-fA-F0-9_.]</span></span></td><td class="c028"><span class="c012"> <span class="c007">z</span>, <span class="c007">bar</span></span></td><td class="c028"><span class="c012"> <span class="c007">3</span>, <span class="c007">F</span>, <span class="c007">.</span></span></td><td class="c028"><span class="c012"> Any one-letter string NOT made of characters from one of the ranges
<span class="c013">r</span></span><sub><span class="c016">i</span></sub><span class="c012"> (1 &#X2264; <span class="c013">i</span> &#X2264; <span class="c013">n</span>).
(&#X3A3;</span><sup><span class="c012">*</span></sup><span class="c012"> &#X2216; (<span class="c015">L</span>(<span class="c013">r</span></span><sub><span class="c012">1</span></sub><span class="c012">) &#X222A; &#X22EF; &#X222A; <span class="c015">L</span>(<span class="c013">r</span></span><sub><span class="c016">n</span></sub><span class="c012">))) </span></td></tr>
<tr><td class="c028"><span class="c016">p</span><sub><span class="c012">1</span></sub><span class="c016"> p</span><sub><span class="c012">2</span></sub><span class="c012"> <br>
 A concatenation of patterns</span></td><td class="c029"><span class="c012"> <span class="c007">foo*</span></span></td><td class="c028"><span class="c012"> <span class="c007">foo</span>, <span class="c007">foob</span>, <span class="c007">foobar</span></span></td><td class="c028"><span class="c012"> <span class="c007">fo</span>, <span class="c007">bar</span></span></td><td class="c028"><span class="c012"> Any string with a prefix matching <span class="c013">p</span></span><sub><span class="c012">1</span></sub><span class="c012"> and the corresponding suffix
matching <span class="c013">p</span></span><sub><span class="c012">2</span></sub><span class="c012">,
({ <span class="c013">uv</span> &#X2223; <span class="c013">u</span> &#X2208; <span class="c015">L</span>(<span class="c013">p</span></span><sub><span class="c012">1</span></sub><span class="c012">), <span class="c013">v</span> &#X2208; <span class="c015">L</span>(<span class="c013">p</span></span><sub><span class="c012">2</span></sub><span class="c012">) }) </span></td></tr>
<tr><td class="c028"><span class="c012"><span class="c007">{</span> <span class="c013">p</span></span><sub><span class="c012">1</span></sub><span class="c012"> <span class="c007">,</span> <span class="c013">p</span></span><sub><span class="c012">2</span></sub><span class="c012"> <span class="c007">,</span> &#X22EF; <span class="c007">,</span> <span class="c013">p</span></span><sub><span class="c016">k</span></sub><span class="c012"> <span class="c007">}</span> <br>
 A union of patterns</span></td><td class="c029"><span class="c012"> <span class="c007">toto.{ml,mli}</span></span></td><td class="c028"><span class="c012"> <span class="c007">toto.ml</span>, <span class="c007">toto.mli</span></span></td><td class="c028"><span class="c012"> <span class="c007">toto.</span></span></td><td class="c028"><span class="c012"> Any string matching one of the patterns <span class="c013">p</span></span><sub><span class="c016">i</span></sub><span class="c012"> for 1 &#X2264; <span class="c013">i</span> &#X2264; <span class="c013">k</span>.
(<span class="c015">L</span>(<span class="c013">p</span></span><sub><span class="c012">1</span></sub><span class="c012">) &#X222A; &#X22EF; &#X222A; <span class="c015">L</span>(<span class="c013">p</span></span><sub><span class="c016">k</span></sub><span class="c012">)) </span></td></tr>
</table><span class="c012">
</span></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c027">Table 18.1: 
Syntax and semantics of glob patterns.
</td></tr>
</table></div>
<div class="center"><hr class="c032"></div></blockquote><blockquote class="table"><div class="center"><hr class="c032"></div>
<div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c028"><span class="c012"><em> Formal syntax</em></span></td><td class="c029"><span class="c012"><em> Example</em></span></td><td class="c028"><span class="c012"><em> Meaning (formal meaning) </em></span></td></tr>
<tr><td class="c028"><span class="c012"> <span class="c007">&lt;</span><span class="c013">p</span><span class="c007">&gt;</span></span></td><td class="c029"><span class="c012"> <span class="c007">&lt;foo.ml&gt;</span></span></td><td class="c028"><span class="c012"> Pathnames matching the pattern <span class="c013">p</span> </span></td></tr>
<tr><td class="c028"><span class="c016"> e</span><sub><span class="c012">1</span></sub><span class="c012"> &#XA0; <span class="c009">or</span> &#XA0; <span class="c013">e</span></span><sub><span class="c012">2</span></sub></td><td class="c029"><span class="c012"> <span class="c007">&lt;*.ml&gt; or &lt;foo/bar.ml&gt;</span></span></td><td class="c028"><span class="c012"> Pathnames matching at least one of the expressions <span class="c013">e</span></span><sub><span class="c012">1</span></sub><span class="c012"> and <span class="c013">e</span></span><sub><span class="c012">2</span></sub><span class="c012"> </span></td></tr>
<tr><td class="c028"><span class="c016"> e</span><sub><span class="c012">1</span></sub><span class="c012"> &#XA0; <span class="c009">and</span> &#XA0; <span class="c013">e</span></span><sub><span class="c012">2</span></sub></td><td class="c029"><span class="c012"> <span class="c007">&lt;*.ml&gt; and &lt;foo_*&gt;</span></span></td><td class="c028"><span class="c012"> Pathnames matching both expressions <span class="c013">e</span></span><sub><span class="c012">1</span></sub><span class="c012"> and <span class="c013">e</span></span><sub><span class="c012">2</span></sub><span class="c012"> </span></td></tr>
<tr><td class="c028"><span class="c012"> <span class="c009">not</span> &#XA0; <span class="c013">e</span></span></td><td class="c029"><span class="c012"> <span class="c007">not &lt;*.mli&gt;</span></span></td><td class="c028"><span class="c012"> Pathnames not matching the expression <span class="c013">e</span> </span></td></tr>
<tr><td class="c028"><span class="c016"> <span class="c007">true</span></span></td><td class="c029"><span class="c012"> <span class="c007">true</span></span></td><td class="c028"><span class="c012"> All pathnames </span></td></tr>
<tr><td class="c028"><span class="c016"> <span class="c007">false</span></span></td><td class="c029"><span class="c012"> <span class="c007">false</span></span></td><td class="c028"><span class="c012"> No pathnames </span></td></tr>
</table><span class="c012">
</span></div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c027">Table 18.2: 
Syntax and semantics of glob expressions.
</td></tr>
</table></div>
<div class="center"><hr class="c032"></div></blockquote>
<!--TOC subsection id="sec388" Subdirectories-->
<h3 class="subsection" id="sec388">18.3.14&#XA0;&#XA0;Subdirectories</h3><!--SEC END --><p>
If the files of your project are held in one or more subdirectories,
<span class="c007">ocamlbuild</span> must be made aware of that fact using the <span class="c007">-I</span> or <span class="c007">-Is</span> options
or by adding an <span class="c007">include</span> tag. For instance, assume your project is made
of three subdirectories, <span class="c007">foo</span>, <span class="c007">bar</span> and <span class="c007">baz</span> containing
various <span class="c007">.ml</span> files, the main file being <span class="c007">foo/main.ml</span>. Then you can
either type:
</p><pre>% ocamlbuild -Is foo,bar,baz foo/main.native
</pre><p>or add the following line in the <span class="c007">_tags</span> file
</p><pre>&lt;foo&gt; or &lt;bar&gt; or &lt;baz&gt;: include
</pre><p>and call
</p><pre>% ocamlbuild foo/main.native
</pre><p>
There are then two cases. If no other modules named <span class="c007">Bar</span> or
<span class="c007">Baz</span> exist elsewhere in the project, then you are done. Just use
<span class="c007">Foo</span>, <span class="c007">Foo.Bar</span> and <span class="c007">Foo.Baz</span> in your code.
Otherwise, you will need to use the plugin mechanism and define the mutual
visibility of the subdirectories using the <span class="c007">Pathname.define_context</span>
function.</p>
<!--TOC subsubsection id="sec389" Note on subdirectory traversal-->
<h4 class="subsubsection" id="sec389">Note on subdirectory traversal</h4><!--SEC END --><p>
<span class="c007">ocamlbuild</span> used to traverse by default any subdirectory not explicitly excluded.
This is no longer the case. Note that you can still have a fine grained
control using your <span class="c007">_tags</span> file and the <span class="c007">traverse</span> tag.</p><p>There is no longer the <span class="c007">true: traverse</span> tag declaration by default. To
make <span class="c007">ocamlbuild</span> recursive use one of these:
</p><ol class="enumerate" type=1><li class="li-enumerate">
Give the <span class="c007">-r</span> flag to ocamlbuild.
</li><li class="li-enumerate">Have a <span class="c007">_tags</span> or myocamlbuild.ml file in your top directory.
</li></ol>
<!--TOC subsection id="sec390" Grouping targets with <span class="c007">.itarget</span>-->
<h3 class="subsection" id="sec390">18.3.15&#XA0;&#XA0;Grouping targets with <span class="c007">.itarget</span></h3><!--SEC END --><p>
You can create a file named <span class="c007">foo.itarget</span> containing
a list of targets, one per line, such as
</p><pre>main.native
main.byte
stuff.docdir/index.html
</pre><p>Requesting the target <span class="c007">foo.otarget</span> will then build every target
listed in the file <span class="c007">foo.itarget</span>. Blank lines and lines starting
with a sharp (<span class="c007">#</span>) are ignored.
</p>
<!--TOC subsection id="sec391" Packing subdirectories into modules-->
<h3 class="subsection" id="sec391">18.3.16&#XA0;&#XA0;Packing subdirectories into modules</h3><!--SEC END --><p>
OCaml&#X2019;s <span class="c007">-pack</span> option allows you to structure the contents of a
module in a subdirectory. For instance, assume you have a directory
<span class="c007">foo</span> containing two modules <span class="c007">bar.ml</span> and <span class="c007">baz.ml</span>.
You want from these to build a module <span class="c007">Foo</span> containing <span class="c007">Bar</span>
and <span class="c007">Baz</span> as submodules. In the case where no modules named
<span class="c007">Bar</span> or <span class="c007">Baz</span> exist outside of <span class="c007">Foo</span>, to do this you
must write a file <span class="c007">foo.mlpack</span>, preferably sitting in the same
directory as the directory <span class="c007">Foo</span> and containing the list of modules
(one per line) it must contain:
</p><pre>Bar
Baz
</pre><p>Then when you will request for building <span class="c007">foo.cmo</span> the package will be
made from <span class="c007">bar.cmo</span> and <span class="c007">baz.cmo</span>.
</p>
<!--TOC subsection id="sec392" Making an OCaml library-->
<h3 class="subsection" id="sec392">18.3.17&#XA0;&#XA0;Making an OCaml library</h3><!--SEC END --><p>
In a similar way than for packaged modules you can make a library by putting
it&#X2019;s contents in a file (with the mllib extension). For instance, assume you
have a two modules <span class="c007">bar.ml</span> and <span class="c007">baz.ml</span>. You want from these to
build a library <span class="c007">foo.cmx?a</span> containing <span class="c007">Bar</span> and <span class="c007">Baz</span>
modules. To do this you must write a file <span class="c007">foo.mllib</span> containing the
list of modules (one per line) it must contain:
</p><pre>Bar
Baz
</pre><p>Then when you will request for building <span class="c007">foo.cma</span> the library will be
made from <span class="c007">bar.cmo</span> and <span class="c007">baz.cmo</span>.
</p>
<!--TOC subsection id="sec393" Making an OCaml toplevel-->
<h3 class="subsection" id="sec393">18.3.18&#XA0;&#XA0;Making an OCaml toplevel</h3><!--SEC END --><p>
Making a toplevel is almost the same thing than making a packaged module or a
library. Just write a file with the <span class="c007">mltop</span> extension (like
<span class="c007">foo.mltop</span>) and request for building the toplevel using the
<span class="c007">top</span> extension (<span class="c007">foo.top</span> in this example).
</p>
<!--TOC subsection id="sec394" Preprocessor options and tags-->
<h3 class="subsection" id="sec394">18.3.19&#XA0;&#XA0;Preprocessor options and tags</h3><!--SEC END --><p>
You can specify preprocessor options with <span class="c007">-pp</span> followed by the
preprocessor string, for instance <span class="c007">ocamlbuild -pp camlp4o.opt -unsafe</span>
would run your sources through CamlP4 with the <span class="c007">-unsafe</span> option.
Another way is to use the tags file.
</p><div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c023"> <span class="c019">Tag</span></td><td class="c023"><span class="c019">Preprocessor command</span></td><td class="c023"><span class="c019">Remark</span> </td></tr>
<tr><td class="c023"> <span class="c007">pp(cmd...)</span></td><td class="c023"><span class="c007">cmd...</span></td><td class="c023">Arbitrary
preprocessor command<sup><a id="text3" href="#note3">1</a></sup> </td></tr>
<tr><td class="c023"> <span class="c007">camlp4o</span></td><td class="c023"><span class="c007">camlp4o</span></td><td class="c023">Original OCaml syntax </td></tr>
<tr><td class="c023"> <span class="c007">camlp4r</span></td><td class="c023"><span class="c007">camlp4r</span></td><td class="c023">Revised OCaml syntax </td></tr>
<tr><td class="c023"> <span class="c007">camlp4of</span></td><td class="c023"><span class="c007">camlp4of</span></td><td class="c023">Original OCaml syntax with extensions </td></tr>
<tr><td class="c023"> <span class="c007">camlp4rf</span></td><td class="c023"><span class="c007">camlp4rf</span></td><td class="c023">Revised OCaml syntax with extensions </td></tr>
</table>
</div>
<!--TOC subsection id="sec395" Debugging byte code and profiling native code-->
<h3 class="subsection" id="sec395">18.3.20&#XA0;&#XA0;Debugging byte code and profiling native code</h3><!--SEC END --><p>
The preferred way of compiling code suitable for debugging with <span class="c007">ocamldebug</span> or
profiling native code with <span class="c007">ocamlprof</span> is to use the appropriate target
extensions, <span class="c007">.d.byte</span> for debugging or <span class="c007">.p.native</span>.</p><p>Another way is to add use the <span class="c007">debug</span> or <span class="c007">profile</span> tags.
Note that these tags must be applied at the compilation and linking stages.
Hence you must either use <span class="c007">-tag debug</span> or <span class="c007">-tag profile</span>
on the command line, or add a
</p><pre>true: debug
</pre><p>line to your <span class="c007">_tags</span> file.
Please note that the byte-code profiler works in a wholly different way
and is not supported by <span class="c007">ocamlbuild</span>.
</p>
<!--TOC subsection id="sec396" Generating documentation using <span class="c007">ocamldoc</span>-->
<h3 class="subsection" id="sec396">18.3.21&#XA0;&#XA0;Generating documentation using <span class="c007">ocamldoc</span></h3><!--SEC END --><p>
Write the names of the modules whose interfaces will be documented in a file
whose extension is <span class="c007">.odocl</span>, for example <span class="c007">foo.odocl</span>, then invoke
<span class="c007">ocamlbuild</span> on the target <span class="c007">foo.docdir/index.html</span>. This will collect all the
documentation from the interfaces (which will be build, if necessary) using
<span class="c007">ocamldoc</span> and generate a set of HTML files under the directory
<span class="c007">foo.docdir/</span>, which is actually a link to <span class="c007">_build/foo.docdir/</span>.
As for packing subdirectories into modules, the module names must be written
one per line, without extensions and correctly capitalized. Note that
generating documentation in formats other than HTML or from implementations is
not supported.
</p>
<!--TOC subsection id="sec397" The display line-->
<h3 class="subsection" id="sec397">18.3.22&#XA0;&#XA0;The display line</h3><!--SEC END --><p>
Provided <span class="c007">ocamlbuild</span> runs in a terminal under a POSIX environment, it will
display a sophisticated progress-indicator line that graciously interacts
with the output of subcommands. This line looks like this:
</p><pre>00:00:02 210  (180 ) main.cmx                             ONbp--il /
</pre><p>Here, 00:00:02 is the elapsed time in hour:minute:second format since <span class="c007">ocamlbuild</span> has
been invoked; 210 is the number of external commands, typically calls to the
compiler or the like, that may or may not have been invoked; 180 is the number
of external commands that have not been invoked since their result is already
in the build directory; <span class="c007">main.cmx</span> is the name of the last target built;
<span class="c007">ONbp--il</span> is a short string that describes the tags that have been
encountered and the slash at the end is a frame from a rotating ticker. Hence,
the display line has the following structure:
</p><pre>HH:MM:SS JOBS (CACHED) PATHNAME                           TAGS TICKER
</pre><p>
The tag string is made of 8 indicators which each monitor a tag. These tags
are <span class="c007">ocaml</span>, <span class="c007">native</span>, <span class="c007">byte</span>, <span class="c007">program</span>,
<span class="c007">pp</span>, <span class="c007">debug</span>, <span class="c007">interf</span> and <span class="c007">link</span>. Initially,
each indicator displays a dash <span class="c007">-</span>. If the current target has the
monitored tag, then the indicator displays the corresponding character
(see table <a href="#tab%3Atag-chars">18.3</a>) in uppercase. Otherwise, it displays that
character in lowercase. This allows you to see the set of tags that have
been applied to files in your project during the current invocation of <span class="c007">ocamlbuild</span>.</p><p>Hence the tag string <span class="c007">ONbp--il</span> means that the current target
<span class="c007">main.cmx</span> has the tags <span class="c007">ocaml</span> and <span class="c007">native</span>, and that
the tags <span class="c007">ocaml</span>, <span class="c007">native</span>, <span class="c007">byte</span>, <span class="c007">program</span>,
<span class="c007">interf</span> and <span class="c007">link</span> have already been seen.</p><blockquote class="table"><div class="center"><hr class="c032"></div>
<div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c023"> <span class="c019">Tag</span></td><td class="c021"><span class="c019">Display character</span> </td></tr>
<tr><td class="c023"> ocaml</td><td class="c021">O </td></tr>
<tr><td class="c023"> native</td><td class="c021">N </td></tr>
<tr><td class="c023"> byte</td><td class="c021">B </td></tr>
<tr><td class="c023"> program</td><td class="c021">P </td></tr>
<tr><td class="c023"> pp</td><td class="c021">R </td></tr>
<tr><td class="c023"> debug</td><td class="c021">D </td></tr>
<tr><td class="c023"> interf</td><td class="c021">I </td></tr>
<tr><td class="c023"> link</td><td class="c021">L </td></tr>
</table>
</div>
<div class="caption"><table class="c002 cellpading0"><tr><td class="c027">Table 18.3: <a id="tab:tag-chars"></a> Relation between the characters displayed in
the tag string and the tags.</td></tr>
</table></div>
<div class="center"><hr class="c032"></div></blockquote>
<!--TOC subsection id="sec398" <span class="c007">ocamllex</span>, <span class="c007">ocamlyacc</span> and <span class="c007">menhir</span>-->
<h3 class="subsection" id="sec398">18.3.23&#XA0;&#XA0;<span class="c007">ocamllex</span>, <span class="c007">ocamlyacc</span> and <span class="c007">menhir</span></h3><!--SEC END --><p>
<span class="c007">ocamlbuild</span> knows how to run the standard lexer and parser generator tools
<span class="c007">ocamllex</span> and <span class="c007">ocamlyacc</span> when your files have the
standard <span class="c007">.mll</span> and <span class="c007">.mly</span> extensions. If you want to
use <span class="c007">menhir</span> instead of <span class="c007">ocamlyacc</span>, you can either
launch <span class="c007">ocamlbuild</span> with the <span class="c007">-use-menhir</span> option or add a
</p><pre>true: use_menhir
</pre><p>line to your <span class="c007">_tags</span> file. Note that there is currently no way
of using <span class="c007">menhir</span> and <span class="c007">ocamlyacc</span> in the same execution
of <span class="c007">ocamlbuild</span>.
</p>
<!--TOC subsection id="sec399" Changing the compilers or tools-->
<h3 class="subsection" id="sec399">18.3.24&#XA0;&#XA0;Changing the compilers or tools</h3><!--SEC END --><p>
As <span class="c007">ocamlbuild</span> is part of your OCaml distribution, it knows if it can call the
native compilers and tools (<span class="c007">ocamlc.opt</span>, <span class="c007">ocamlopt.opt</span>...)
or not. However you may want <span class="c007">ocamlbuild</span> to use another <span class="c007">ocaml</span> compiler
for different reasons (such as cross-compiling or using a wrapper such as
<span class="c007">ocamlfind</span>). Here is the list of relevant options:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">-ocamlc &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-ocamlopt &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-ocamldep &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-ocamlyacc &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-menhir &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-ocamllex &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-ocamlmktop &lt;command&gt;</span>
</li><li class="li-itemize"><span class="c007">-ocamlrun &lt;command&gt;</span>
</li></ul>
<!--TOC subsection id="sec400" Interaction with version control systems-->
<h3 class="subsection" id="sec400">18.3.25&#XA0;&#XA0;Interaction with version control systems</h3><!--SEC END --><p>
Here are tips for configuring your version control system to ignore the files
and directories generated by <span class="c007">ocamlbuild</span>.</p><p>The directory <span class="c007">_build</span> and any symbolic links
pointing into <span class="c007">_build</span> should be ignored.
To do this, you must add the following ignore patterns to your version
control system&#X2019;s ignore set:
</p><pre>_build
*.native
*.byte
*.d.native
*.p.byte
</pre><p>
For CVS, add the above lines to the <span class="c007">.cvsignore</span> file.
For Subversion (SVN), type <span class="c007">svn propedit svn:ignore .</span> and add the
above lines.
</p>
<!--TOC subsection id="sec401" A shell script for driving it all?-->
<h3 class="subsection" id="sec401">18.3.26&#XA0;&#XA0;A shell script for driving it all?</h3><!--SEC END --><p>
<em>To shell or to make ?</em>
Traditionally, makefiles have two major functions. The first one
is the dependency-ordering, rule-matching logic used for compiling.
The second one is as a dispatcher for various actions defined using
phony targets with shell script actions. These actions include cleaning,
cleaning really well, archiving, uploading and so on. Their characteristic
is that they rely little or not on the building process &#X2013; they either need
the building to have been completed, or they don&#X2019;t need anything.
As <span class="c007">/bin/sh</span> scripts have been here for three to four decades and are
not going anywhere, why not replace that functionality of makefiles with a
shell script ? We have thought of three bad reasons:
</p><ul class="itemize"><li class="li-itemize">
Typing <span class="c007">make</span> to compile is now an automatism,
</li><li class="li-itemize">We need to share variable definitions between rules and actions,
</li><li class="li-itemize">Escaping already way too special-character-sensitive shell code with
invisible tabs and backslashes is a dangerously fun game.
</li></ul><p>
We also have bad reasons for not using an OCaml script to drive everything:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">Sys.command</span> calls the <span class="c007">/bin/sh</span> anyway,
</li><li class="li-itemize">Shell scripts can execute partial commands or commands with badly formed arguments.
</li><li class="li-itemize">Shell scripts are more concise for expressing... shell scripts.
</li></ul><p>
Anyway you are of course free to use a makefile or an OCaml script to call ocamlbuild.
Here is an example shell driver script:
</p><pre>#!/bin/sh

set -e

TARGET=epoch
FLAGS="-libs unix,nums"
OCAMLBUILD=ocamlbuild

ocb()
{
  $OCAMLBUILD $FLAGS $*
}

rule() {
  case $1 in
    clean)  ocb -clean;;
    native) ocb $TARGET.native;;
    byte)   ocb $TARGET.byte;;
    all)    ocb $TARGET.native $TARGET.byte;;
    depend) echo "Not needed.";;
    *)      echo "Unknown action $1";;
  esac;
}

if [ $# -eq 0 ]; then
  rule all
else
  while [ $# -gt 0 ]; do
    rule $1;
    shift
  done
fi
</pre>
<!--TOC section id="sec402" Appendix: Motivations-->
<h2 class="section" id="sec402">18.4&#XA0;&#XA0;Appendix: Motivations</h2><!--SEC END --><p>
<em>This inflammatory appendix describes the frustration that led us to write <span class="c007">ocamlbuild</span>.</em></p><p>Many people have painfully found that the utilities of the <span class="c007">make</span>
family, namely GNU Make, BSD Make, and their derivatives, fail to scale to
large projects, especially when using multi-stage compilation rules, such as
custom pre-processors, unless dependencies are hand-defined. But as your
project gets larger, more modular, and uses more diverse pre-processing tools,
it becomes increasingly difficult to correctly define dependencies by hand.
Hence people tend to use language-specific tools that attempt to extract
dependencies. However another problem then appears: <span class="c007">make</span> was designed
with the idea of a static dependency graph. Dependency extracting tools,
however, are typically run by a rule in <span class="c007">make</span> itself; this means that
make has to reload the dependency information. This is the origin of the
<span class="c007">make clean; make depend; make</span> mantra. This approach tends to work
quite well as long as all the files sit in a single directory and there is only
one stage of pre-processing. If there are two or more stages, then dependency
extracting tools must be run two or more times - and this means multiple
invocations of <span class="c007">make</span>. Also, if one distributes the modules of a large
project into multiple subdirectories, it becomes difficult to distribute the
makefiles themselves, because the language of <span class="c007">make</span> was not conceived
to be modular; the only two mechanisms permitted, inclusion of makefile
fragments, and invocation of other make instances, must be skillfully
coordinated with phony target names (<span class="c007">depend1, depend2...</span>) to insure
inclusion of generated dependencies with multi-stage programming; changes in
the structure of the project must be reflected by hand and the order of
variable definitions must be well-thought ahead to avoid long afternoons spent
combinatorially fiddling makefiles until it works but no one understands why.</p><p>These problems become especially apparent with OCaml: to ensure type safety and
to allow a small amount of cross-unit optimization when compiling native code,
interface and object files include cryptographical digests of interfaces they
are to be linked with. This means that linking is safer, but that makefile sloppiness
leads to messages such as:
</p><pre>Files foo.cmo and bar.cmo
make inconsistent assumptions over interface Bar
</pre><p>
The typical reaction is then to issue the mantra <span class="c007">make clean; make
depend; make</span> and everything compiles just fine... from the beginning. Hence
on medium projects, the programmer often has to wait for minutes instead of the
few seconds that would be taken if <span class="c007">make</span> could correctly guess the
small number of files that really had to be recompiled.</p><p>It is not surprising that hacking a build tool such as <span class="c007">make</span> to include
a programming language while retaining the original syntax and semantics gives
an improvised and cumbersome macro language of dubious expressive power. For
example, using GNU make, suppose you have a list of <span class="c007">.ml</span>s that you want
to convert into a list including both <span class="c007">.cmo</span>s and <span class="c007">.cmi</span>s, that
is you want to transform <span class="c007">a.ml b.ml c.ml</span> into <span class="c007">a.cmi a.cmo b.cmi
b.cmo c.cmi c.cmo</span> while preserving the dependency order which must be hand
specified for linking <sup><a id="text4" href="#note4">2</a></sup>.
Unfortunately <span class="c007">$patsubst %.ml, %.cmi %.cmo, a.ml b.ml c.ml</span> won&#X2019;t
work since the %-sign in the right-hand of a <span class="c007">patsubst</span> gets
substituted only once. You then have to delve into something that is hardly
lambda calculus: an intricate network of <span class="c007">foreach</span>, <span class="c007">eval</span>,
<span class="c007">call</span> and <span class="c007">define</span>s may get you the job done, unless you chicken
out and opt for an external <span class="c007">awk</span>, <span class="c007">sed</span> or <span class="c007">perl</span> call.
People who at this point have not lost their temper or sanity usually resort to
metaprogramming by writing Makefile generators using a mixture of shell and m4.
One such an attempt gave something that is the nightmare of wannabe package
maintainers: it&#X2019;s called <span class="c007">autotools</span>.</p><p>Note that it is also difficult to write <span class="c007">Makefiles</span> to build object
files in a separate directory. It is not impossible since the language of
<span class="c007">make</span> is Turing-complete, a proof of which is left as an exercise.
Note that building things in a separate directory is not necessarily a young
enthusiast&#X2019;s way of giving a different look and feel to his projects &#X2013; it may
be a good way of telling the computer that <span class="c007">foo.mli</span> is generated by
<span class="c007">ocamlyacc</span> using <span class="c007">foo.mly</span> and can thus be removed.
</p>
<!--TOC section id="sec403" Appendix: Summary of default rules-->
<h2 class="section" id="sec403">18.5&#XA0;&#XA0;Appendix: Summary of default rules</h2><!--SEC END --><p>
The contents of this table give a summary of the most important default rules.
To get the most accurate and up-to-date information, launch <span class="c007">ocamlbuild</span> with the
<span class="c007">-documentation</span> option.
</p><div class="center">
<table class="c000 cellpadding1" border=1><tr><td class="c029"><span class="c020"> Tags</span></td><td class="c029"><span class="c020">Dependencies</span></td><td class="c028"><span class="c020">Targets </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%.itarget</span></td><td class="c028"><span class="c012">%.otarget </span></td></tr>
<tr><td class="c029"><span class="c012"> ocaml</span></td><td class="c029"><span class="c012">%.mli %.mli.depends</span></td><td class="c028"><span class="c012">%.cmi </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, debug, ocaml</span></td><td class="c029"><span class="c012">%.mlpack %.cmi</span></td><td class="c028"><span class="c012">%.d.cmo </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, ocaml</span></td><td class="c029"><span class="c012">%.mlpack</span></td><td class="c028"><span class="c012">%.cmo %.cmi </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, ocaml</span></td><td class="c029"><span class="c012">%.mli %.ml %.ml.depends %.cmi</span></td><td class="c028"><span class="c012">%.d.cmo </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, ocaml</span></td><td class="c029"><span class="c012">%.mli %.ml %.ml.depends %.cmi</span></td><td class="c028"><span class="c012">%.cmo </span></td></tr>
<tr><td class="c029"><span class="c012"> native, ocaml, profile</span></td><td class="c029"><span class="c012">%.mlpack %.cmi</span></td><td class="c028"><span class="c012">%.p.cmx %.p.o </span></td></tr>
<tr><td class="c029"><span class="c012"> native, ocaml</span></td><td class="c029"><span class="c012">%.mlpack %.cmi</span></td><td class="c028"><span class="c012">%.cmx %.o </span></td></tr>
<tr><td class="c029"><span class="c012"> native, ocaml, profile</span></td><td class="c029"><span class="c012">%.ml %.ml.depends %.cmi</span></td><td class="c028"><span class="c012">%.p.cmx %.p.o </span></td></tr>
<tr><td class="c029"><span class="c012"> native, ocaml</span></td><td class="c029"><span class="c012">%.ml %.ml.depends %.cmi</span></td><td class="c028"><span class="c012">%.cmx %.o </span></td></tr>
<tr><td class="c029"><span class="c012"> debug, ocaml</span></td><td class="c029"><span class="c012">%.ml %.ml.depends %.cmi</span></td><td class="c028"><span class="c012">%.d.cmo </span></td></tr>
<tr><td class="c029"><span class="c012"> ocaml</span></td><td class="c029"><span class="c012">%.ml %.ml.depends</span></td><td class="c028"><span class="c012">%.cmo %.cmi </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, debug, ocaml, program</span></td><td class="c029"><span class="c012">%.d.cmo</span></td><td class="c028"><span class="c012">%.d.byte </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, ocaml, program</span></td><td class="c029"><span class="c012">%.cmo</span></td><td class="c028"><span class="c012">%.byte </span></td></tr>
<tr><td class="c029"><span class="c012"> native, ocaml, profile, program</span></td><td class="c029"><span class="c012">%.p.cmx %.p.o</span></td><td class="c028"><span class="c012">%.p.native </span></td></tr>
<tr><td class="c029"><span class="c012"> native, ocaml, program</span></td><td class="c029"><span class="c012">%.cmx %.o</span></td><td class="c028"><span class="c012">%.native </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, debug, library, ocaml</span></td><td class="c029"><span class="c012">%.mllib</span></td><td class="c028"><span class="c012">%.d.cma </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, library, ocaml</span></td><td class="c029"><span class="c012">%.mllib</span></td><td class="c028"><span class="c012">%.cma </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, debug, library, ocaml</span></td><td class="c029"><span class="c012">%.d.cmo</span></td><td class="c028"><span class="c012">%.d.cma </span></td></tr>
<tr><td class="c029"><span class="c012"> byte, library, ocaml</span></td><td class="c029"><span class="c012">%.cmo</span></td><td class="c028"><span class="c012">%.cma </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">lib%(libname).clib</span></td><td class="c028"><span class="c012">lib%(libname).a dll%(libname).so </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%(path)/lib%(libname).clib</span></td><td class="c028"><span class="c012">%(path)/lib%(libname).a %(path)/dll%(libname).so </span></td></tr>
<tr><td class="c029"><span class="c012"> library, native, ocaml, profile</span></td><td class="c029"><span class="c012">%.mllib</span></td><td class="c028"><span class="c012">%.p.cmxa %.p.a </span></td></tr>
<tr><td class="c029"><span class="c012"> library, native, ocaml</span></td><td class="c029"><span class="c012">%.mllib</span></td><td class="c028"><span class="c012">%.cmxa %.a </span></td></tr>
<tr><td class="c029"><span class="c012"> library, native, ocaml, profile</span></td><td class="c029"><span class="c012">%.p.cmx %.p.o</span></td><td class="c028"><span class="c012">%.p.cmxa %.p.a </span></td></tr>
<tr><td class="c029"><span class="c012"> library, native, ocaml</span></td><td class="c029"><span class="c012">%.cmx %.o</span></td><td class="c028"><span class="c012">%.cmxa %.a </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%.ml</span></td><td class="c028"><span class="c012">%.ml.depends </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%.mli</span></td><td class="c028"><span class="c012">%.mli.depends </span></td></tr>
<tr><td class="c029"><span class="c012"> ocaml</span></td><td class="c029"><span class="c012">%.mll</span></td><td class="c028"><span class="c012">%.ml </span></td></tr>
<tr><td class="c029"><span class="c012"> doc, ocaml</span></td><td class="c029"><span class="c012">%.mli %.mli.depends</span></td><td class="c028"><span class="c012">%.odoc </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%.odocl</span></td><td class="c028"><span class="c012">%.docdir/index.html </span></td></tr>
<tr><td class="c029"><span class="c012"> ocaml</span></td><td class="c029"><span class="c012">%.mly</span></td><td class="c028"><span class="c012">%.ml %.mli </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%.c</span></td><td class="c028"><span class="c012">%.o </span></td></tr>
<tr><td class="c029"><span class="c012">&nbsp;</span></td><td class="c029"><span class="c012">%.ml %.ml.depends</span></td><td class="c028"><span class="c012">%.inferred.mli </span></td></tr>
</table><span class="c012">
</span></div>
<!--BEGIN NOTES chapter-->
<hr class="ffootnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note3" href="#text3">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The command must not contain newlines or parentheses.</div>
</dd><dt class="dt-thefootnotes"><a id="note4" href="#text4">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">By the way, what&#X2019;s the point of having a
declarative language if <span class="c007">make</span> can&#X2019;t sort the dependencies in
topological order for giving them to <span class="c007">gcc</span> or whatever ?</div>
</dd></dl>
<!--END NOTES-->
<!--TOC chapter id="c:intf-c" Interfacing C with OCaml-->
<h1 class="chapter" id="c:intf-c">Chapter&#XA0;19&#XA0;&#XA0;Interfacing C with OCaml</h1><!--SEC END --><!--NAME intfc.html-->
<p>This chapter describes how user-defined primitives, written in C, can
be linked with OCaml code and called from OCaml functions.</p>
<!--TOC section id="sec405" Overview and compilation information-->
<h2 class="section" id="sec405">19.1&#XA0;&#XA0;Overview and compilation information</h2><!--SEC END -->
<!--TOC subsection id="sec406" Declaring primitives-->
<h3 class="subsection" id="sec406">19.1.1&#XA0;&#XA0;Declaring primitives</h3><!--SEC END --><table class="display dcenter"><tr class="c026"><td class="dcell"><table class="c002 cellpading0"><tr><td class="c025">
<a class="syntax" href="#definition"><span class="c014">definition</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;...
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td><td class="c022">&#X2223;</td><td class="c024">&#XA0;<span class="c008">external</span>&#XA0;<a class="syntax" href="#value-name"><span class="c014">value-name</span></a>&#XA0;<span class="c008">:</span>&#XA0;&#XA0;<a class="syntax" href="#typexpr"><span class="c014">typexpr</span></a>&#XA0;<span class="c008">=</span>&#XA0;&#XA0;<a class="syntax" href="#external-declaration"><span class="c014">external-declaration</span></a>
&#XA0;</td></tr>
<tr><td class="c025">&nbsp;</td></tr>
<tr><td class="c025">
<a class="syntax" id="external-declaration"><span class="c014">external-declaration</span></a></td><td class="c022">::=</td><td class="c024">&#XA0;<a class="syntax" href="#string-literal"><span class="c014">string-literal</span></a>&#XA0;&#XA0;[&#XA0;<a class="syntax" href="#string-literal"><span class="c014">string-literal</span></a>&#XA0;&#XA0;[&#XA0;<a class="syntax" href="#string-literal"><span class="c014">string-literal</span></a>&#XA0;]&#XA0;]
</td></tr>
</table></td></tr>
</table><p>User primitives are declared in an implementation file or
<span class="c008">struct</span>&#X2026;<span class="c008">end</span> module expression using the <span class="c008">external</span> keyword:
</p><pre>
        external <span class="c013">name</span> : <span class="c013">type</span> = <span class="c013">C-function-name</span>
</pre><p>
This defines the value name <span class="c013">name</span> as a function with type
<span class="c013">type</span> that executes by calling the given C function.
For instance, here is how the <span class="c007">input</span> primitive is declared in the
standard library module <span class="c007">Pervasives</span>:
</p><pre>        external input : in_channel -&gt; string -&gt; int -&gt; int -&gt; int
                       = "input"
</pre><p>Primitives with several arguments are always curried. The C function
does not necessarily have the same name as the ML function.</p><p>External functions thus defined can be specified in interface files or
<span class="c008">sig</span>&#X2026;<span class="c008">end</span> signatures either as regular values
</p><pre>
        val <span class="c013">name</span> : <span class="c013">type</span>
</pre><p>
thus hiding their implementation as a C function, or explicitly as
&#X201C;manifest&#X201D; external functions
</p><pre>
        external <span class="c013">name</span> : <span class="c013">type</span> = <span class="c013">C-function-name</span>
</pre><p>
The latter is slightly more efficient, as it allows clients of the
module to call directly the C function instead of going through the
corresponding OCaml function.</p><p>The arity (number of arguments) of a primitive is automatically
determined from its OCaml type in the <span class="c007">external</span> declaration, by
counting the number of function arrows in the type. For instance,
<span class="c007">input</span> above has arity 4, and the <span class="c007">input</span> C function is called with
four arguments. Similarly,
</p><pre>    external input2 : in_channel * string * int * int -&gt; int = "input2"
</pre><p>has arity 1, and the <span class="c007">input2</span> C function receives one argument (which
is a quadruple of OCaml values).</p><p>Type abbreviations are not expanded when determining the arity of a
primitive. For instance,
</p><pre>        type int_endo = int -&gt; int
        external f : int_endo -&gt; int_endo = "f"
        external g : (int -&gt; int) -&gt; (int -&gt; int) = "f"
</pre><p><span class="c007">f</span> has arity 1, but <span class="c007">g</span> has arity 2. This allows a primitive to
return a functional value (as in the <span class="c007">f</span> example above): just remember
to name the functional return type in a type abbreviation.</p><p>Note that the language accepts external declarations with one or two
flag strings in addition to the C function&#X2019;s name. These flags are
reserved for the implementation of the standard library.</p>
<!--TOC subsection id="sec407" Implementing primitives-->
<h3 class="subsection" id="sec407">19.1.2&#XA0;&#XA0;Implementing primitives</h3><!--SEC END --><p>User primitives with arity <span class="c013">n</span> &#X2264; 5 are implemented by C functions
that take <span class="c013">n</span> arguments of type <span class="c007">value</span>, and return a result of type
<span class="c007">value</span>. The type <span class="c007">value</span> is the type of the representations for OCaml
values. It encodes objects of several base types (integers,
floating-point numbers, strings, &#X2026;), as well as OCaml data
structures. The type <span class="c007">value</span> and the associated conversion
functions and macros are described in details below. For instance,
here is the declaration for the C function implementing the <span class="c007">input</span>
primitive:
</p><pre>CAMLprim value input(value channel, value buffer, value offset, value length)
{
  ...
}
</pre><p>When the primitive function is applied in an OCaml program, the C
function is called with the values of the expressions to which the
primitive is applied as arguments. The value returned by the function is
passed back to the OCaml program as the result of the function
application.</p><p>User primitives with arity greater than 5 should be implemented by two
C functions. The first function, to be used in conjunction with the
bytecode compiler <span class="c007">ocamlc</span>, receives two arguments: a pointer to an
array of OCaml values (the values for the arguments), and an
integer which is the number of arguments provided. The other function,
to be used in conjunction with the native-code compiler <span class="c007">ocamlopt</span>,
takes its arguments directly. For instance, here are the two C
functions for the 7-argument primitive <span class="c007">Nat.add_nat</span>:
</p><pre>CAMLprim value add_nat_native(value nat1, value ofs1, value len1,
                              value nat2, value ofs2, value len2,
                              value carry_in)
{
  ...
}
CAMLprim value add_nat_bytecode(value * argv, int argn)
{
  return add_nat_native(argv[0], argv[1], argv[2], argv[3],
                        argv[4], argv[5], argv[6]);
}
</pre><p>The names of the two C functions must be given in the primitive
declaration, as follows:
</p><pre>
        external <span class="c013">name</span> : <span class="c013">type</span> =
                 <span class="c013">bytecode-C-function-name native-code-C-function-name</span>
</pre><p>
For instance, in the case of <span class="c007">add_nat</span>, the declaration is:
</p><pre>        external add_nat: nat -&gt; int -&gt; int -&gt; nat -&gt; int -&gt; int -&gt; int -&gt; int
                        = "add_nat_bytecode" "add_nat_native"
</pre><p>
Implementing a user primitive is actually two separate tasks: on the
one hand, decoding the arguments to extract C values from the given
OCaml values, and encoding the return value as an OCaml
value; on the other hand, actually computing the result from the arguments.
Except for very simple primitives, it is often preferable to have two
distinct C functions to implement these two tasks. The first function
actually implements the primitive, taking native C values as
arguments and returning a native C value. The second function,
often called the &#X201C;stub code&#X201D;, is a simple wrapper around the first
function that converts its arguments from OCaml values to C values,
call the first function, and convert the returned C value to OCaml
value. For instance, here is the stub code for the <span class="c007">input</span>
primitive:
</p><pre>CAMLprim value input(value channel, value buffer, value offset, value length)
{
  return Val_long(getblock((struct channel *) channel,
                           &amp;Byte(buffer, Long_val(offset)),
                           Long_val(length)));
}
</pre><p>(Here, <span class="c007">Val_long</span>, <span class="c007">Long_val</span> and so on are conversion macros for the
type <span class="c007">value</span>, that will be described later. The <span class="c007">CAMLprim</span> macro
expands to the required compiler directives to ensure that the
function following it is exported and accessible from OCaml.)
The hard work is performed by the function <span class="c007">getblock</span>, which is
declared as:
</p><pre>long getblock(struct channel * channel, char * p, long n)
{
  ...
}
</pre><p>
To write C code that operates on OCaml values, the following
include files are provided:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Include file</span></td><td class="c021"><span class="c019">Provides</span> </td></tr>
<tr><td class="c029">
<span class="c007">caml/mlvalues.h</span></td><td class="c028">definition of the <span class="c007">value</span> type, and conversion
macros </td></tr>
<tr><td class="c029"><span class="c007">caml/alloc.h</span></td><td class="c028">allocation functions (to create structured OCaml
objects) </td></tr>
<tr><td class="c029"><span class="c007">caml/memory.h</span></td><td class="c028">miscellaneous memory-related functions
and macros (for GC interface, in-place modification of structures, etc). </td></tr>
<tr><td class="c029"><span class="c007">caml/fail.h</span></td><td class="c028">functions for raising exceptions
(see section&#XA0;<a href="#s%3Ac-exceptions">19.4.5</a>) </td></tr>
<tr><td class="c029"><span class="c007">caml/callback.h</span></td><td class="c028">callback from C to OCaml (see
section&#XA0;<a href="#s%3Acallback">19.7</a>). </td></tr>
<tr><td class="c029"><span class="c007">caml/custom.h</span></td><td class="c028">operations on custom blocks (see
section&#XA0;<a href="#s%3Acustom">19.9</a>). </td></tr>
<tr><td class="c029"><span class="c007">caml/intext.h</span></td><td class="c028">operations for writing user-defined
serialization and deserialization functions for custom blocks
(see section&#XA0;<a href="#s%3Acustom">19.9</a>). </td></tr>
<tr><td class="c029"><span class="c007">caml/threads.h</span></td><td class="c028">operations for interfacing in the presence
of multiple threads (see section&#XA0;<a href="#s%3AC-multithreading">19.10</a>). </td></tr>
</table></div><p>
These files reside in the <span class="c007">caml/</span> subdirectory of the OCaml
standard library directory (usually <span class="c007">/usr/local/lib/ocaml</span>).</p><p><span class="c019">Note:</span> It is recommended to define the macro <span class="c007">CAML_NAME_SPACE</span>
before including these header files. If you do not define it, the
header files will also define short names (without the <span class="c007">caml_</span> prefix)
for most functions, which usually produce clashes with names defined
by other C libraries that you might use. Including the header files
without <span class="c007">CAML_NAME_SPACE</span> is only supported for backward
compatibility.</p>
<!--TOC subsection id="sec408" Statically linking C code with OCaml code-->
<h3 class="subsection" id="sec408">19.1.3&#XA0;&#XA0;Statically linking C code with OCaml code</h3><!--SEC END --><p>
<a id="staticlink-c-code"></a></p><p>The OCaml runtime system comprises three main parts: the bytecode
interpreter, the memory manager, and a set of C functions that
implement the primitive operations. Some bytecode instructions are
provided to call these C functions, designated by their offset in a
table of functions (the table of primitives).</p><p>In the default mode, the OCaml linker produces bytecode for the
standard runtime system, with a standard set of primitives. References
to primitives that are not in this standard set result in the
&#X201C;unavailable C primitive&#X201D; error. (Unless dynamic loading of C
libraries is supported &#X2013; see section&#XA0;<a href="#dynlink-c-code">19.1.4</a> below.)</p><p>In the &#X201C;custom runtime&#X201D; mode, the OCaml linker scans the
object files and determines the set of required primitives. Then, it
builds a suitable runtime system, by calling the native code linker with:
</p><ul class="itemize"><li class="li-itemize">
the table of the required primitives;
</li><li class="li-itemize">a library that provides the bytecode interpreter, the
memory manager, and the standard primitives;
</li><li class="li-itemize">libraries and object code files (<span class="c007">.o</span> files) mentioned on the
command line for the OCaml linker, that provide implementations
for the user&#X2019;s primitives.
</li></ul><p>
This builds a runtime system with the required primitives. The OCaml
linker generates bytecode for this custom runtime system. The
bytecode is appended to the end of the custom runtime system, so that
it will be automatically executed when the output file (custom
runtime + bytecode) is launched.</p><p>To link in &#X201C;custom runtime&#X201D; mode, execute the <span class="c007">ocamlc</span> command with:
</p><ul class="itemize"><li class="li-itemize">
the <span class="c007">-custom</span> option;
</li><li class="li-itemize">the names of the desired OCaml object files (<span class="c007">.cmo</span> and <span class="c007">.cma</span> files) ;
</li><li class="li-itemize">the names of the C object files and libraries (<span class="c007">.o</span> and <span class="c007">.a</span>
files) that implement the required primitives. Under Unix and Windows,
a library named <span class="c007">lib</span><span class="c013">name</span><span class="c007">.a</span> (respectively, <span class="c007">.lib</span>) residing in one of
the standard library directories can also be specified as <span class="c007">-cclib -l</span><span class="c013">name</span>.
</li></ul><p>If you are using the native-code compiler <span class="c007">ocamlopt</span>, the <span class="c007">-custom</span>
flag is not needed, as the final linking phase of <span class="c007">ocamlopt</span> always
builds a standalone executable. To build a mixed OCaml/C executable,
execute the <span class="c007">ocamlopt</span> command with:
</p><ul class="itemize"><li class="li-itemize">
the names of the desired OCaml native object files (<span class="c007">.cmx</span> and
<span class="c007">.cmxa</span> files);
</li><li class="li-itemize">the names of the C object files and libraries (<span class="c007">.o</span>, <span class="c007">.a</span>,
<span class="c007">.so</span> or <span class="c007">.dll</span> files) that implement the required primitives.
</li></ul><p>Starting with Objective Caml 3.00, it is possible to record the
<span class="c007">-custom</span> option as well as the names of C libraries in an OCaml
library file <span class="c007">.cma</span> or <span class="c007">.cmxa</span>. For instance, consider an OCaml library
<span class="c007">mylib.cma</span>, built from the OCaml object files <span class="c007">a.cmo</span> and <span class="c007">b.cmo</span>,
which reference C code in <span class="c007">libmylib.a</span>. If the library is
built as follows:
</p><pre>
        ocamlc -a -o mylib.cma -custom a.cmo b.cmo -cclib -lmylib
</pre><p>
users of the library can simply link with <span class="c007">mylib.cma</span>:
</p><pre>
        ocamlc -o myprog mylib.cma ...
</pre><p>
and the system will automatically add the <span class="c007">-custom</span> and <span class="c007">-cclib -lmylib</span> options, achieving the same effect as
</p><pre>
        ocamlc -o myprog -custom a.cmo b.cmo ... -cclib -lmylib
</pre><p>
The alternative, of course, is to build the library without extra
options:
</p><pre>
        ocamlc -a -o mylib.cma a.cmo b.cmo
</pre><p>
and then ask users to provide the <span class="c007">-custom</span> and <span class="c007">-cclib -lmylib</span>
options themselves at link-time:
</p><pre>
        ocamlc -o myprog -custom mylib.cma ... -cclib -lmylib
</pre><p>
The former alternative is more convenient for the final users of the
library, however.</p>
<!--TOC subsection id="sec409" Dynamically linking C code with OCaml code-->
<h3 class="subsection" id="sec409">19.1.4&#XA0;&#XA0;Dynamically linking C code with OCaml code</h3><!--SEC END --><p>
<a id="dynlink-c-code"></a></p><p>Starting with Objective Caml 3.03, an alternative to static linking of C code
using the <span class="c007">-custom</span> code is provided. In this mode, the OCaml linker
generates a pure bytecode executable (no embedded custom runtime
system) that simply records the names of dynamically-loaded libraries
containing the C code. The standard OCaml runtime system <span class="c007">ocamlrun</span>
then loads dynamically these libraries, and resolves references to the
required primitives, before executing the bytecode.</p><p>This facility is currently supported and known to work well under
Linux, MacOS&#XA0;X, and Windows. It is supported, but not
fully tested yet, under FreeBSD, Tru64, Solaris and Irix. It is not
supported yet under other Unixes.</p><p>To dynamically link C code with OCaml code, the C code must first be
compiled into a shared library (under Unix) or DLL (under Windows).
This involves 1- compiling the C files with appropriate C compiler
flags for producing position-independent code (when required by the
operating system), and 2- building a
shared library from the resulting object files. The resulting shared
library or DLL file must be installed in a place where <span class="c007">ocamlrun</span> can
find it later at program start-up time (see
section&#XA0;<a href="#s-ocamlrun-dllpath">10.3</a>).
Finally (step 3), execute the <span class="c007">ocamlc</span> command with
</p><ul class="itemize"><li class="li-itemize">
the names of the desired OCaml object files (<span class="c007">.cmo</span> and <span class="c007">.cma</span> files) ;
</li><li class="li-itemize">the names of the C shared libraries (<span class="c007">.so</span> or <span class="c007">.dll</span> files) that
implement the required primitives. Under Unix and Windows,
a library named <span class="c007">dll</span><span class="c013">name</span><span class="c007">.so</span> (respectively, <span class="c007">.dll</span>) residing
in one of the standard library directories can also be specified as
<span class="c007">-dllib -l</span><span class="c013">name</span>.
</li></ul><p>
Do <em>not</em> set the <span class="c007">-custom</span> flag, otherwise you&#X2019;re back to static linking
as described in section&#XA0;<a href="#staticlink-c-code">19.1.3</a>.
The <span class="c007">ocamlmklib</span> tool (see section&#XA0;<a href="#s-ocamlmklib">19.11</a>)
automates steps 2 and 3.</p><p>As in the case of static linking, it is possible (and recommended) to
record the names of C libraries in an OCaml <span class="c007">.cma</span> library archive.
Consider again an OCaml library
<span class="c007">mylib.cma</span>, built from the OCaml object files <span class="c007">a.cmo</span> and <span class="c007">b.cmo</span>,
which reference C code in <span class="c007">dllmylib.so</span>. If the library is
built as follows:
</p><pre>
        ocamlc -a -o mylib.cma a.cmo b.cmo -dllib -lmylib
</pre><p>
users of the library can simply link with <span class="c007">mylib.cma</span>:
</p><pre>
        ocamlc -o myprog mylib.cma ...
</pre><p>
and the system will automatically add the <span class="c007">-dllib -lmylib</span> option,
achieving the same effect as
</p><pre>
        ocamlc -o myprog a.cmo b.cmo ... -dllib -lmylib
</pre><p>
Using this mechanism, users of the library <span class="c007">mylib.cma</span> do not need to
known that it references C code, nor whether this C code must be
statically linked (using <span class="c007">-custom</span>) or dynamically linked.</p>
<!--TOC subsection id="sec410" Choosing between static linking and dynamic linking-->
<h3 class="subsection" id="sec410">19.1.5&#XA0;&#XA0;Choosing between static linking and dynamic linking</h3><!--SEC END --><p>After having described two different ways of linking C code with OCaml
code, we now review the pros and cons of each, to help developers of
mixed OCaml/C libraries decide.</p><p>The main advantage of dynamic linking is that it preserves the
platform-independence of bytecode executables. That is, the bytecode
executable contains no machine code, and can therefore be compiled on
platform <span class="c013">A</span> and executed on other platforms <span class="c013">B</span>, <span class="c013">C</span>, &#X2026;, as long
as the required shared libraries are available on all these
platforms. In contrast, executables generated by <span class="c007">ocamlc -custom</span> run
only on the platform on which they were created, because they embark a
custom-tailored runtime system specific to that platform. In
addition, dynamic linking results in smaller executables.</p><p>Another advantage of dynamic linking is that the final users of the
library do not need to have a C compiler, C linker, and C runtime
libraries installed on their machines. This is no big deal under
Unix and Cygwin, but many Windows users are reluctant to install
Microsoft Visual C just to be able to do <span class="c007">ocamlc -custom</span>.</p><p>There are two drawbacks to dynamic linking. The first is that the
resulting executable is not stand-alone: it requires the shared
libraries, as well as <span class="c007">ocamlrun</span>, to be installed on the machine
executing the code. If you wish to distribute a stand-alone
executable, it is better to link it statically, using <span class="c007">ocamlc -custom -ccopt -static</span> or <span class="c007">ocamlopt -ccopt -static</span>. Dynamic linking also
raises the &#X201C;DLL hell&#X201D; problem: some care must be taken to ensure
that the right versions of the shared libraries are found at start-up
time.</p><p>The second drawback of dynamic linking is that it complicates the
construction of the library. The C compiler and linker flags to
compile to position-independent code and build a shared library vary
wildly between different Unix systems. Also, dynamic linking is not
supported on all Unix systems, requiring a fall-back case to static
linking in the Makefile for the library. The <span class="c007">ocamlmklib</span> command
(see section&#XA0;<a href="#s-ocamlmklib">19.11</a>) tries to hide some of these system
dependencies.</p><p>In conclusion: dynamic linking is highly recommended under the native
Windows port, because there are no portability problems and it is much
more convenient for the end users. Under Unix, dynamic linking should
be considered for mature, frequently used libraries because it
enhances platform-independence of bytecode executables. For new or
rarely-used libraries, static linking is much simpler to set up in a
portable way.</p>
<!--TOC subsection id="sec411" Building standalone custom runtime systems-->
<h3 class="subsection" id="sec411">19.1.6&#XA0;&#XA0;Building standalone custom runtime systems</h3><!--SEC END --><p>
<a id="s:custom-runtime"></a></p><p>It is sometimes inconvenient to build a custom runtime system each
time OCaml code is linked with C libraries, like <span class="c007">ocamlc -custom</span> does.
For one thing, the building of the runtime system is slow on some
systems (that have bad linkers or slow remote file systems); for
another thing, the platform-independence of bytecode files is lost,
forcing to perform one <span class="c007">ocamlc -custom</span> link per platform of interest.</p><p>An alternative to <span class="c007">ocamlc -custom</span> is to build separately a custom
runtime system integrating the desired C libraries, then generate
&#X201C;pure&#X201D; bytecode executables (not containing their own runtime
system) that can run on this custom runtime. This is achieved by the
<span class="c007">-make-runtime</span> and <span class="c007">-use-runtime</span> flags to <span class="c007">ocamlc</span>. For example,
to build a custom runtime system integrating the C parts of the
&#X201C;Unix&#X201D; and &#X201C;Threads&#X201D; libraries, do:
</p><pre>        ocamlc -make-runtime -o /home/me/ocamlunixrun unix.cma threads.cma
</pre><p>To generate a bytecode executable that runs on this runtime system,
do:
</p><pre>
        ocamlc -use-runtime /home/me/ocamlunixrun -o myprog \
                unix.cma threads.cma <span class="c013">your .cmo and .cma files</span>
</pre><p>
The bytecode executable <span class="c007">myprog</span> can then be launched as usual:
<span class="c007">myprog</span> <span class="c013">args</span> or <span class="c007">/home/me/ocamlunixrun myprog</span> <span class="c013">args</span>.</p><p>Notice that the bytecode libraries <span class="c007">unix.cma</span> and <span class="c007">threads.cma</span> must
be given twice: when building the runtime system (so that <span class="c007">ocamlc</span>
knows which C primitives are required) and also when building the
bytecode executable (so that the bytecode from <span class="c007">unix.cma</span> and
<span class="c007">threads.cma</span> is actually linked in).</p>
<!--TOC section id="sec412" The <span class="c007">value</span> type-->
<h2 class="section" id="sec412">19.2&#XA0;&#XA0;The <span class="c007">value</span> type</h2><!--SEC END --><p>All OCaml objects are represented by the C type <span class="c007">value</span>,
defined in the include file <span class="c007">caml/mlvalues.h</span>, along with macros to
manipulate values of that type. An object of type <span class="c007">value</span> is either:
</p><ul class="itemize"><li class="li-itemize">
an unboxed integer;
</li><li class="li-itemize">a pointer to a block inside the heap (such as the blocks
allocated through one of the <code>caml_alloc_*</code> functions below);
</li><li class="li-itemize">a pointer to an object outside the heap (e.g., a pointer to a block
allocated by <span class="c007">malloc</span>, or to a C variable).
</li></ul>
<!--TOC subsection id="sec413" Integer values-->
<h3 class="subsection" id="sec413">19.2.1&#XA0;&#XA0;Integer values</h3><!--SEC END --><p>Integer values encode 31-bit signed integers (63-bit on 64-bit
architectures). They are unboxed (unallocated).</p>
<!--TOC subsection id="sec414" Blocks-->
<h3 class="subsection" id="sec414">19.2.2&#XA0;&#XA0;Blocks</h3><!--SEC END --><p>Blocks in the heap are garbage-collected, and therefore have strict
structure constraints. Each block includes a header containing the
size of the block (in words), and the tag of the block.
The tag governs how the contents of the blocks are structured. A tag
lower than <span class="c007">No_scan_tag</span> indicates a structured block, containing
well-formed values, which is recursively traversed by the garbage
collector. A tag greater than or equal to <span class="c007">No_scan_tag</span> indicates a
raw block, whose contents are not scanned by the garbage collector.
For the benefit of ad-hoc polymorphic primitives such as equality and
structured input-output, structured and raw blocks are further
classified according to their tags as follows:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Tag</span></td><td class="c021"><span class="c019">Contents of the block</span> </td></tr>
<tr><td class="c029">
0 to <span class="c007">No_scan_tag</span>&#X2212;1</td><td class="c028">A structured block (an array of
OCaml objects). Each field is a <span class="c007">value</span>. </td></tr>
<tr><td class="c029"><span class="c007">Closure_tag</span></td><td class="c028">A closure representing a functional value. The first
word is a pointer to a piece of code, the remaining words are
<span class="c007">value</span> containing the environment. </td></tr>
<tr><td class="c029"><span class="c007">String_tag</span></td><td class="c028">A character string. </td></tr>
<tr><td class="c029"><span class="c007">Double_tag</span></td><td class="c028">A double-precision floating-point number. </td></tr>
<tr><td class="c029"><span class="c007">Double_array_tag</span></td><td class="c028">An array or record of double-precision
floating-point numbers. </td></tr>
<tr><td class="c029"><span class="c007">Abstract_tag</span></td><td class="c028">A block representing an abstract datatype. </td></tr>
<tr><td class="c029"><span class="c007">Custom_tag</span></td><td class="c028">A block representing an abstract datatype
with user-defined finalization, comparison, hashing,
serialization and deserialization functions atttached. </td></tr>
</table></div>
<!--TOC subsection id="sec415" Pointers outside the heap-->
<h3 class="subsection" id="sec415">19.2.3&#XA0;&#XA0;Pointers outside the heap</h3><!--SEC END --><p>Any word-aligned pointer to an address outside the heap can be safely
cast to and from the type <span class="c007">value</span>. This includes pointers returned by
<span class="c007">malloc</span>, and pointers to C variables (of size at least one word)
obtained with the <code>&amp;</code> operator.</p><p>Caution: if a pointer returned by <span class="c007">malloc</span> is cast to the type <span class="c007">value</span>
and returned to OCaml, explicit deallocation of the pointer using
<span class="c007">free</span> is potentially dangerous, because the pointer may still be
accessible from the OCaml world. Worse, the memory space deallocated
by <span class="c007">free</span> can later be reallocated as part of the OCaml heap; the
pointer, formerly pointing outside the OCaml heap, now points inside
the OCaml heap, and this can confuse the garbage collector. To avoid
these problems, it is preferable to wrap the pointer in a OCaml block
with tag <span class="c007">Abstract_tag</span> or <span class="c007">Custom_tag</span>.</p>
<!--TOC section id="sec416" Representation of OCaml data types-->
<h2 class="section" id="sec416">19.3&#XA0;&#XA0;Representation of OCaml data types</h2><!--SEC END --><p>This section describes how OCaml data types are encoded in the
<span class="c007">value</span> type.</p>
<!--TOC subsection id="sec417" Atomic types-->
<h3 class="subsection" id="sec417">19.3.1&#XA0;&#XA0;Atomic types</h3><!--SEC END --><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">OCaml type</span></td><td class="c021"><span class="c019">Encoding</span> </td></tr>
<tr><td class="c023">
<span class="c007">int</span></td><td class="c023">Unboxed integer values. </td></tr>
<tr><td class="c023"><span class="c007">char</span></td><td class="c023">Unboxed integer values (ASCII code). </td></tr>
<tr><td class="c023"><span class="c007">float</span></td><td class="c023">Blocks with tag <span class="c007">Double_tag</span>. </td></tr>
<tr><td class="c023"><span class="c007">string</span></td><td class="c023">Blocks with tag <span class="c007">String_tag</span>. </td></tr>
<tr><td class="c023"><span class="c007">int32</span></td><td class="c023">Blocks with tag <span class="c007">Custom_tag</span>. </td></tr>
<tr><td class="c023"><span class="c007">int64</span></td><td class="c023">Blocks with tag <span class="c007">Custom_tag</span>. </td></tr>
<tr><td class="c023"><span class="c007">nativeint</span></td><td class="c023">Blocks with tag <span class="c007">Custom_tag</span>. </td></tr>
</table></div>
<!--TOC subsection id="sec418" Tuples and records-->
<h3 class="subsection" id="sec418">19.3.2&#XA0;&#XA0;Tuples and records</h3><!--SEC END --><p>Tuples are represented by pointers to blocks, with tag&#XA0;0.</p><p>Records are also represented by zero-tagged blocks. The ordering of
labels in the record type declaration determines the layout of
the record fields: the value associated to the label
declared first is stored in field&#XA0;0 of the block, the value associated
to the label declared next goes in field&#XA0;1, and so on.</p><p>As an optimization, records whose fields all have static type <span class="c007">float</span>
are represented as arrays of floating-point numbers, with tag
<span class="c007">Double_array_tag</span>. (See the section below on arrays.)</p>
<!--TOC subsection id="sec419" Arrays-->
<h3 class="subsection" id="sec419">19.3.3&#XA0;&#XA0;Arrays</h3><!--SEC END --><p>Arrays of integers and pointers are represented like tuples,
that is, as pointers to blocks tagged&#XA0;0. They are accessed with the
<span class="c007">Field</span> macro for reading and the <span class="c007">caml_modify</span> function for writing.</p><p>Arrays of floating-point numbers (type <span class="c007">float array</span>)
have a special, unboxed, more efficient representation.
These arrays are represented by pointers to blocks with tag
<span class="c007">Double_array_tag</span>. They should be accessed with the <span class="c007">Double_field</span>
and <span class="c007">Store_double_field</span> macros.</p>
<!--TOC subsection id="sec420" Concrete data types-->
<h3 class="subsection" id="sec420">19.3.4&#XA0;&#XA0;Concrete data types</h3><!--SEC END --><p>Constructed terms are represented either by unboxed integers (for
constant constructors) or by blocks whose tag encode the constructor
(for non-constant constructors). The constant constructors and the
non-constant constructors for a given concrete type are numbered
separately, starting from 0, in the order in which they appear in the
concrete type declaration. Constant constructors are represented by
unboxed integers equal to the constructor number. A non-constant
constructors declared with <span class="c013">n</span> arguments is represented by
a block of size <span class="c013">n</span>, tagged with the constructor number; the <span class="c013">n</span>
fields contain its arguments. Example:</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Constructed term</span></td><td class="c021"><span class="c019">Representation</span> </td></tr>
<tr><td class="c029">
<span class="c007">()</span></td><td class="c028"><span class="c007">Val_int(0)</span> </td></tr>
<tr><td class="c029"><span class="c007">false</span></td><td class="c028"><span class="c007">Val_int(0)</span> </td></tr>
<tr><td class="c029"><span class="c007">true</span></td><td class="c028"><span class="c007">Val_int(1)</span> </td></tr>
<tr><td class="c029"><span class="c007">[]</span></td><td class="c028"><span class="c007">Val_int(0)</span> </td></tr>
<tr><td class="c029"><span class="c007">h::t</span></td><td class="c028">Block with size = 2 and tag = 0; first field
contains <span class="c007">h</span>, second field <span class="c007">t</span>. </td></tr>
</table></div><p>As a convenience, <span class="c007">caml/mlvalues.h</span> defines the macros <span class="c007">Val_unit</span>,
<span class="c007">Val_false</span> and <span class="c007">Val_true</span> to refer to <span class="c007">()</span>, <span class="c007">false</span> and <span class="c007">true</span>.</p><p>The following artificial example illustrates the assignment of
integers and block tags to constructors:
</p><pre>type t =
  | A             (* First constant constructor -&gt; integer "Val_int(0)" *)
  | B of string   (* First non-constant constructor -&gt; block with tag 0 *)
  | C             (* Second constant constructor -&gt; integer "Val_int(1)" *)
  | D of bool     (* Second non-constant constructor -&gt; block with tag 1 *)
  | E of t * t    (* Third non-constant constructor -&gt; block with tag 2 *)
</pre>
<!--TOC subsection id="sec421" Objects-->
<h3 class="subsection" id="sec421">19.3.5&#XA0;&#XA0;Objects</h3><!--SEC END --><p>Objects are represented as blocks with tag <span class="c007">Object_tag</span>. The first
field of the block refers to the object class and associated method
suite, in a format that cannot easily be exploited from C. The second
field contains a unique object ID, used for comparisons. The remaining
fields of the object contain the values of the instance variables of
the object. It is unsafe to access directly instance variables, as the
type system provides no guaranteee about the instance variables
contained by an object.
</p><p>One may extract a public method from an object using the C function
<span class="c007">caml_get_public_method</span> (declared in <span class="c007">&lt;caml/mlvalues.h&gt;</span>.)
Since public method tags are hashed in the same way as variant tags,
and methods are functions taking self as first argument, if you want
to do the method call <span class="c007">foo#bar</span> from the C side, you should call:
</p><pre>  callback(caml_get_public_method(foo, hash_variant("bar")), foo);
</pre>
<!--TOC subsection id="sec422" Polymorphic variants-->
<h3 class="subsection" id="sec422">19.3.6&#XA0;&#XA0;Polymorphic variants</h3><!--SEC END --><p>Like constructed terms, polymorphic variant values are represented either
as integers (for polymorphic variants without arguments), or as blocks
(for polymorphic variants with an argument). Unlike constructed
terms, variant constructors are not numbered starting from 0, but
identified by a hash value (an OCaml integer), as computed by the C function
<span class="c007">hash_variant</span> (declared in <span class="c007">&lt;caml/mlvalues.h&gt;</span>):
the hash value for a variant constructor named, say, <span class="c007">VConstr</span>
is <span class="c007">hash_variant("VConstr")</span>.</p><p>The variant value <span class="c007">`VConstr</span> is represented by
<span class="c007">hash_variant("VConstr")</span>. The variant value <span class="c007">`VConstr(</span><span class="c013">v</span><span class="c007">)</span> is
represented by a block of size 2 and tag 0, with field number 0
containing <span class="c007">hash_variant("VConstr")</span> and field number 1 containing
<span class="c013">v</span>.</p><p>Unlike constructed values, polymorphic variant values taking several
arguments are not flattened.
That is, <span class="c007">`VConstr(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">w</span><span class="c007">)</span> is represented by a block
of size 2, whose field number 1 contains the representation of the
pair <span class="c007">(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">w</span><span class="c007">)</span>, rather than a block of size 3
containing <span class="c013">v</span> and <span class="c013">w</span> in fields 1 and 2.</p>
<!--TOC section id="sec423" Operations on values-->
<h2 class="section" id="sec423">19.4&#XA0;&#XA0;Operations on values</h2><!--SEC END -->
<!--TOC subsection id="sec424" Kind tests-->
<h3 class="subsection" id="sec424">19.4.1&#XA0;&#XA0;Kind tests</h3><!--SEC END --><ul class="itemize"><li class="li-itemize">
<span class="c007">Is_long(</span><span class="c013">v</span><span class="c007">)</span> is true if value <span class="c013">v</span> is an immediate integer,
false otherwise
</li><li class="li-itemize"><span class="c007">Is_block(</span><span class="c013">v</span><span class="c007">)</span> is true if value <span class="c013">v</span> is a pointer to a block,
and false if it is an immediate integer.
</li></ul>
<!--TOC subsection id="sec425" Operations on integers-->
<h3 class="subsection" id="sec425">19.4.2&#XA0;&#XA0;Operations on integers</h3><!--SEC END --><ul class="itemize"><li class="li-itemize">
<span class="c007">Val_long(</span><span class="c013">l</span><span class="c007">)</span> returns the value encoding the <span class="c007">long int</span> <span class="c013">l</span>.
</li><li class="li-itemize"><span class="c007">Long_val(</span><span class="c013">v</span><span class="c007">)</span> returns the <span class="c007">long int</span> encoded in value <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Val_int(</span><span class="c013">i</span><span class="c007">)</span> returns the value encoding the <span class="c007">int</span> <span class="c013">i</span>.
</li><li class="li-itemize"><span class="c007">Int_val(</span><span class="c013">v</span><span class="c007">)</span> returns the <span class="c007">int</span> encoded in value <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Val_bool(</span><span class="c013">x</span><span class="c007">)</span> returns the OCaml boolean representing the
truth value of the C integer <span class="c013">x</span>.
</li><li class="li-itemize"><span class="c007">Bool_val(</span><span class="c013">v</span><span class="c007">)</span> returns 0 if <span class="c013">v</span> is the OCaml boolean
<span class="c007">false</span>, 1 if <span class="c013">v</span> is <span class="c007">true</span>.
</li><li class="li-itemize"><span class="c007">Val_true</span>, <span class="c007">Val_false</span> represent the OCaml booleans <span class="c007">true</span> and <span class="c007">false</span>.
</li></ul>
<!--TOC subsection id="sec426" Accessing blocks-->
<h3 class="subsection" id="sec426">19.4.3&#XA0;&#XA0;Accessing blocks</h3><!--SEC END --><ul class="itemize"><li class="li-itemize">
<span class="c007">Wosize_val(</span><span class="c013">v</span><span class="c007">)</span> returns the size of the block <span class="c013">v</span>, in words,
excluding the header.
</li><li class="li-itemize"><span class="c007">Tag_val(</span><span class="c013">v</span><span class="c007">)</span> returns the tag of the block <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Field(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> returns the value contained in the
<span class="c013">n</span><sup><span class="c012">th</span></sup> field of the structured block <span class="c013">v</span>. Fields are numbered from 0 to
<span class="c007">Wosize_val</span>(<span class="c013">v</span>)&#X2212;1.
</li><li class="li-itemize"><span class="c007">Store_field(</span><span class="c013">b</span><span class="c007">, </span><span class="c013">n</span><span class="c007">, </span><span class="c013">v</span><span class="c007">)</span> stores the value
<span class="c013">v</span> in the field number <span class="c013">n</span> of value <span class="c013">b</span>, which must be a
structured block.
</li><li class="li-itemize"><span class="c007">Code_val(</span><span class="c013">v</span><span class="c007">)</span> returns the code part of the closure <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">caml_string_length(</span><span class="c013">v</span><span class="c007">)</span> returns the length (number of bytes)
of the string <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Byte(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> returns the <span class="c013">n</span><sup><span class="c012">th</span></sup> byte of the string
<span class="c013">v</span>, with type <span class="c007">char</span>. Characters are numbered from 0 to
<span class="c007">string_length</span>(<span class="c013">v</span>)&#X2212;1.
</li><li class="li-itemize"><span class="c007">Byte_u(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> returns the <span class="c013">n</span><sup><span class="c012">th</span></sup> byte of the string
<span class="c013">v</span>, with type <span class="c007">unsigned char</span>. Characters are numbered from 0 to
<span class="c007">string_length</span>(<span class="c013">v</span>)&#X2212;1.
</li><li class="li-itemize"><span class="c007">String_val(</span><span class="c013">v</span><span class="c007">)</span> returns a pointer to the first byte of the string
<span class="c013">v</span>, with type <span class="c007">char *</span>. This pointer is a valid C string: there is a
null byte after the last byte in the string. However, OCaml
strings can contain embedded null bytes, which will confuse
the usual C functions over strings.
</li><li class="li-itemize"><span class="c007">Double_val(</span><span class="c013">v</span><span class="c007">)</span> returns the floating-point number contained in
value <span class="c013">v</span>, with type <span class="c007">double</span>.
</li><li class="li-itemize"><span class="c007">Double_field(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> returns
the <span class="c013">n</span><sup><span class="c012">th</span></sup> element of the array of floating-point numbers <span class="c013">v</span> (a
block tagged <span class="c007">Double_array_tag</span>).
</li><li class="li-itemize"><span class="c007">Store_double_field(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">, </span><span class="c013">d</span><span class="c007">)</span> stores the double precision floating-point number <span class="c013">d</span>
in the <span class="c013">n</span><sup><span class="c012">th</span></sup> element of the array of floating-point numbers <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Data_custom_val(</span><span class="c013">v</span><span class="c007">)</span> returns a pointer to the data part
of the custom block <span class="c013">v</span>. This pointer has type <span class="c007">void *</span> and must
be cast to the type of the data contained in the custom block.
</li><li class="li-itemize"><span class="c007">Int32_val(</span><span class="c013">v</span><span class="c007">)</span> returns the 32-bit integer contained
in the <span class="c007">int32</span> <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Int64_val(</span><span class="c013">v</span><span class="c007">)</span> returns the 64-bit integer contained
in the <span class="c007">int64</span> <span class="c013">v</span>.
</li><li class="li-itemize"><span class="c007">Nativeint_val(</span><span class="c013">v</span><span class="c007">)</span> returns the long integer contained
in the <span class="c007">nativeint</span> <span class="c013">v</span>.
</li></ul><p>
The expressions <span class="c007">Field(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span>,
<span class="c007">Byte(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> and
<span class="c007">Byte_u(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span>
are valid l-values. Hence, they can be assigned to, resulting in an
in-place modification of value <span class="c013">v</span>.
Assigning directly to <span class="c007">Field(</span><span class="c013">v</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> must
be done with care to avoid confusing the garbage collector (see
below).</p>
<!--TOC subsection id="sec427" Allocating blocks-->
<h3 class="subsection" id="sec427">19.4.4&#XA0;&#XA0;Allocating blocks</h3><!--SEC END -->
<!--TOC subsubsection id="sec428" Simple interface-->
<h4 class="subsubsection" id="sec428">Simple interface</h4><!--SEC END --><ul class="itemize"><li class="li-itemize">
<span class="c007">Atom(</span><span class="c013">t</span><span class="c007">)</span> returns an &#X201C;atom&#X201D; (zero-sized block) with tag <span class="c013">t</span>.
Zero-sized blocks are preallocated outside of the heap. It is
incorrect to try and allocate a zero-sized block using the functions below.
For instance, <span class="c007">Atom(0)</span> represents the empty array.
</li><li class="li-itemize"><span class="c007">caml_alloc(</span><span class="c013">n</span><span class="c007">, </span><span class="c013">t</span><span class="c007">)</span> returns a fresh block of size <span class="c013">n</span>
with tag <span class="c013">t</span>. If <span class="c013">t</span> is less than <span class="c007">No_scan_tag</span>, then the
fields of the block are initialized with a valid value in order to
satisfy the GC constraints.
</li><li class="li-itemize"><span class="c007">caml_alloc_tuple(</span><span class="c013">n</span><span class="c007">)</span> returns a fresh block of size
<span class="c013">n</span> words, with tag 0.
</li><li class="li-itemize"><span class="c007">caml_alloc_string(</span><span class="c013">n</span><span class="c007">)</span> returns a string value of length <span class="c013">n</span> bytes.
The string initially contains garbage.
</li><li class="li-itemize"><span class="c007">caml_copy_string(</span><span class="c013">s</span><span class="c007">)</span> returns a string value containing a copy of
the null-terminated C string <span class="c013">s</span> (a <span class="c007">char *</span>).
</li><li class="li-itemize"><span class="c007">caml_copy_double(</span><span class="c013">d</span><span class="c007">)</span> returns a floating-point value initialized
with the <span class="c007">double</span> <span class="c013">d</span>.
</li><li class="li-itemize"><span class="c007">caml_copy_int32(</span><span class="c013">i</span><span class="c007">)</span>, <span class="c007">caml_copy_int64(</span><span class="c013">i</span><span class="c007">)</span> and
<span class="c007">caml_copy_nativeint(</span><span class="c013">i</span><span class="c007">)</span> return a value of OCaml type <span class="c007">int32</span>,
<span class="c007">int64</span> and <span class="c007">nativeint</span>, respectively, initialized with the integer
<span class="c013">i</span>.
</li><li class="li-itemize"><span class="c007">caml_alloc_array(</span><span class="c013">f</span><span class="c007">, </span><span class="c013">a</span><span class="c007">)</span> allocates an array of values, calling
function <span class="c013">f</span> over each element of the input array <span class="c013">a</span> to transform it
into a value. The array <span class="c013">a</span> is an array of pointers terminated by the
null pointer. The function <span class="c013">f</span> receives each pointer as argument, and
returns a value. The zero-tagged block returned by
<span class="c007">alloc_array(</span><span class="c013">f</span><span class="c007">, </span><span class="c013">a</span><span class="c007">)</span> is filled with the values returned by the
successive calls to <span class="c013">f</span>. (This function must not be used to build
an array of floating-point numbers.)
</li><li class="li-itemize"><span class="c007">caml_copy_string_array(</span><span class="c013">p</span><span class="c007">)</span> allocates an array of strings, copied from
the pointer to a string array <span class="c013">p</span> (a <code>char **</code>). <span class="c013">p</span> must
be NULL-terminated.
</li></ul>
<!--TOC subsubsection id="sec429" Low-level interface-->
<h4 class="subsubsection" id="sec429">Low-level interface</h4><!--SEC END --><p>The following functions are slightly more efficient than <span class="c007">caml_alloc</span>, but
also much more difficult to use.</p><p>From the standpoint of the allocation functions, blocks are divided
according to their size as zero-sized blocks, small blocks (with size
less than or equal to <code>Max_young_wosize</code>), and large blocks (with
size greater than <code>Max_young_wosize</code>). The constant
<code>Max_young_wosize</code> is declared in the include file <span class="c007">mlvalues.h</span>. It
is guaranteed to be at least 64 (words), so that any block with
constant size less than or equal to 64 can be assumed to be small. For
blocks whose size is computed at run-time, the size must be compared
against <code>Max_young_wosize</code> to determine the correct allocation procedure.</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_alloc_small(</span><span class="c013">n</span><span class="c007">, </span><span class="c013">t</span><span class="c007">)</span> returns a fresh small block of size
<span class="c013">n</span> &#X2264; <span class="c007">Max_young_wosize</span> words, with tag <span class="c013">t</span>.
If this block is a structured block (i.e. if <span class="c013">t</span> &lt; <span class="c007">No_scan_tag</span>), then
the fields of the block (initially containing garbage) must be initialized
with legal values (using direct assignment to the fields of the block)
before the next allocation.
</li><li class="li-itemize"><span class="c007">caml_alloc_shr(</span><span class="c013">n</span><span class="c007">, </span><span class="c013">t</span><span class="c007">)</span> returns a fresh block of size
<span class="c013">n</span>, with tag <span class="c013">t</span>.
The size of the block can be greater than <code>Max_young_wosize</code>. (It
can also be smaller, but in this case it is more efficient to call
<span class="c007">caml_alloc_small</span> instead of <span class="c007">caml_alloc_shr</span>.)
If this block is a structured block (i.e. if <span class="c013">t</span> &lt; <span class="c007">No_scan_tag</span>), then
the fields of the block (initially containing garbage) must be initialized
with legal values (using the <span class="c007">caml_initialize</span> function described below)
before the next allocation.
</li></ul>
<!--TOC subsection id="sec430" Raising exceptions-->
<h3 class="subsection" id="sec430">19.4.5&#XA0;&#XA0;Raising exceptions</h3><!--SEC END --><p> <a id="s:c-exceptions"></a></p><p>Two functions are provided to raise two standard exceptions:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_failwith(</span><span class="c013">s</span><span class="c007">)</span>, where <span class="c013">s</span> is a null-terminated C string (with
type <code>char *</code>), raises exception <span class="c007">Failure</span> with argument <span class="c013">s</span>.
</li><li class="li-itemize"><span class="c007">caml_invalid_argument(</span><span class="c013">s</span><span class="c007">)</span>, where <span class="c013">s</span> is a null-terminated C
string (with type <code>char *</code>), raises exception <span class="c007">Invalid_argument</span>
with argument <span class="c013">s</span>.
</li></ul><p>Raising arbitrary exceptions from C is more delicate: the
exception identifier is dynamically allocated by the OCaml program, and
therefore must be communicated to the C function using the
registration facility described below in section&#XA0;<a href="#s%3Aregister-exn">19.7.3</a>.
Once the exception identifier is recovered in C, the following
functions actually raise the exception:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_raise_constant(</span><span class="c013">id</span><span class="c007">)</span> raises the exception <span class="c013">id</span> with
no argument;
</li><li class="li-itemize"><span class="c007">caml_raise_with_arg(</span><span class="c013">id</span><span class="c007">, </span><span class="c013">v</span><span class="c007">)</span> raises the exception
<span class="c013">id</span> with the OCaml value <span class="c013">v</span> as argument;
</li><li class="li-itemize"><span class="c007">caml_raise_with_args(</span><span class="c013">id</span><span class="c007">, </span><span class="c013">n</span><span class="c007">, </span><span class="c013">v</span><span class="c007">)</span>
raises the exception <span class="c013">id</span> with the OCaml values
<span class="c013">v</span><span class="c007">[0]</span>, &#X2026;, <span class="c013">v</span><span class="c007">[</span><span class="c013">n</span><span class="c007">-1]</span> as arguments;
</li><li class="li-itemize"><span class="c007">caml_raise_with_string(</span><span class="c013">id</span><span class="c007">, </span><span class="c013">s</span><span class="c007">)</span>, where <span class="c013">s</span> is a
null-terminated C string, raises the exception <span class="c013">id</span> with a copy of
the C string <span class="c013">s</span> as argument.
</li></ul>
<!--TOC section id="sec431" Living in harmony with the garbage collector-->
<h2 class="section" id="sec431">19.5&#XA0;&#XA0;Living in harmony with the garbage collector</h2><!--SEC END --><p>Unused blocks in the heap are automatically reclaimed by the garbage
collector. This requires some cooperation from C code that
manipulates heap-allocated blocks.</p>
<!--TOC subsection id="sec432" Simple interface-->
<h3 class="subsection" id="sec432">19.5.1&#XA0;&#XA0;Simple interface</h3><!--SEC END --><p>All the macros described in this section are declared in the
<span class="c007">memory.h</span> header file.</p><div class="theorem"><span class="c019">Rule&#XA0;1</span>&#XA0;&#XA0;<em>
A function that has parameters or local variables of type <span class="c007">value</span> must
begin with a call to one of the <span class="c007">CAMLparam</span> macros and return with
<span class="c007">CAMLreturn</span>, <span class="c007">CAMLreturn0</span>, or <span class="c007">CAMLreturnT</span>.
</em></div><p>There are six <span class="c007">CAMLparam</span> macros: <span class="c007">CAMLparam0</span> to <span class="c007">CAMLparam5</span>, which
take zero to five arguments respectively. If your function has fewer
than 5 parameters of type <span class="c007">value</span>, use the corresponding macros
with these parameters as arguments. If your function has more than 5
parameters of type <span class="c007">value</span>, use <span class="c007">CAMLparam5</span> with five of these
parameters, and use one or more calls to the <span class="c007">CAMLxparam</span> macros for
the remaining parameters (<span class="c007">CAMLxparam1</span> to <span class="c007">CAMLxparam5</span>).</p><p>The macros <span class="c007">CAMLreturn</span>, <span class="c007">CAMLreturn0</span>, and <span class="c007">CAMLreturnT</span> are used to
replace the C
keyword <span class="c007">return</span>. Every occurence of <span class="c007">return x</span> must be replaced by
<span class="c007">CAMLreturn (x)</span> if <span class="c007">x</span> has type <span class="c007">value</span>, or <span class="c007">CAMLreturnT (t, x)</span>
(where <span class="c007">t</span> is the type of <span class="c007">x</span>); every occurence of <span class="c007">return</span> without
argument must be
replaced by <span class="c007">CAMLreturn0</span>. If your C function is a procedure (i.e. if
it returns void), you must insert <span class="c007">CAMLreturn0</span> at the end (to replace
C&#X2019;s implicit <span class="c007">return</span>).</p>
<!--TOC paragraph id="sec433" Note:-->
<h5 class="paragraph" id="sec433">Note:</h5><!--SEC END --><p> some C compilers give bogus warnings about unused
variables <span class="c007">caml__dummy_xxx</span> at each use of <span class="c007">CAMLparam</span> and
<span class="c007">CAMLlocal</span>. You should ignore them.</p><p> <br>
</p><p>Example:
</p><pre>void foo (value v1, value v2, value v3)
{
  CAMLparam3 (v1, v2, v3);
  ...
  CAMLreturn0;
}
</pre>
<!--TOC paragraph id="sec434" Note:-->
<h5 class="paragraph" id="sec434">Note:</h5><!--SEC END --><p> if your function is a primitive with more than 5 arguments
for use with the byte-code runtime, its arguments are not <span class="c007">value</span>s and
must not be declared (they have types <span class="c007">value *</span> and <span class="c007">int</span>).</p><div class="theorem"><span class="c019">Rule&#XA0;2</span>&#XA0;&#XA0;<em>
Local variables of type <span class="c007">value</span> must be declared with one of the
<span class="c007">CAMLlocal</span> macros. Arrays of <span class="c007">value</span>s are declared with
<span class="c007">CAMLlocalN</span>. These macros must be used at the beginning of the
function, not in a nested block.
</em></div><p>The macros <span class="c007">CAMLlocal1</span> to <span class="c007">CAMLlocal5</span> declare and initialize one to
five local variables of type <span class="c007">value</span>. The variable names are given as
arguments to the macros. <span class="c007">CAMLlocalN(</span><span class="c013">x</span><span class="c007">, </span><span class="c013">n</span><span class="c007">)</span> declares
and initializes a local variable of type <span class="c007">value [</span><span class="c013">n</span><span class="c007">]</span>. You can
use several calls to these macros if you have more than 5 local
variables.</p><p>Example:
</p><pre>value bar (value v1, value v2, value v3)
{
  CAMLparam3 (v1, v2, v3);
  CAMLlocal1 (result);
  result = caml_alloc (3, 0);
  ...
  CAMLreturn (result);
}
</pre><div class="theorem"><span class="c019">Rule&#XA0;3</span>&#XA0;&#XA0;<em>
Assignments to the fields of structured blocks must be done with the
<span class="c007">Store_field</span> macro (for normal blocks) or <span class="c007">Store_double_field</span> macro
(for arrays and records of floating-point numbers). Other assignments
must not use <span class="c007">Store_field</span> nor <span class="c007">Store_double_field</span>.
</em></div><p><span class="c007">Store_field (</span><span class="c013">b</span><span class="c007">, </span><span class="c013">n</span><span class="c007">, </span><span class="c013">v</span><span class="c007">)</span> stores the value
<span class="c013">v</span> in the field number <span class="c013">n</span> of value <span class="c013">b</span>, which must be a
block (i.e. <span class="c007">Is_block(</span><span class="c013">b</span><span class="c007">)</span> must be true).</p><p>Example:
</p><pre>value bar (value v1, value v2, value v3)
{
  CAMLparam3 (v1, v2, v3);
  CAMLlocal1 (result);
  result = caml_alloc (3, 0);
  Store_field (result, 0, v1);
  Store_field (result, 1, v2);
  Store_field (result, 2, v3);
  CAMLreturn (result);
}
</pre>
<!--TOC paragraph id="sec435" Warning:-->
<h5 class="paragraph" id="sec435">Warning:</h5><!--SEC END --><p> The first argument of <span class="c007">Store_field</span> and
<span class="c007">Store_double_field</span> must be a variable declared by <span class="c007">CAMLparam*</span> or
a parameter declared by <span class="c007">CAMLlocal*</span> to ensure that a garbage
collection triggered by the evaluation of the other arguments will not
invalidate the first argument after it is computed.</p><div class="theorem"><span class="c019">Rule&#XA0;4</span>&#XA0;&#XA0;<em> Global variables containing values must be registered
with the garbage collector using the <span class="c007">caml_register_global_root</span> function.
</em></div><p>Registration of a global variable <span class="c007">v</span> is achieved by calling
<span class="c007">caml_register_global_root(&amp;v)</span> just before or just after a valid
value is stored in <span class="c007">v</span> for the first time. You must not call any
of the OCaml runtime functions or macros between registering and
storing the value.</p><p>A registered global variable <span class="c007">v</span> can be un-registered by calling
<span class="c007">caml_remove_global_root(&amp;v)</span>.</p><p>If the contents of the global variable <span class="c007">v</span> are seldom modified after
registration, better performance can be achieved by calling
<span class="c007">caml_register_generational_global_root(&amp;v)</span> to register <span class="c007">v</span> (after
its initialization with a valid <span class="c007">value</span>, but before any allocation or
call to the GC functions),
and <span class="c007">caml_remove_generational_global_root(&amp;v)</span> to un-register it. In
this case, you must not modify the value of <span class="c007">v</span> directly, but you must
use <span class="c007">caml_modify_generational_global_root(&amp;v,x)</span> to set it to <span class="c007">x</span>.
The garbage collector takes advantage of the guarantee that <span class="c007">v</span> is not
modified between calls to <span class="c007">caml_modify_generational_global_root</span> to scan it
less often. This improves performance if the
modifications of <span class="c007">v</span> happen less often than minor collections.</p>
<!--TOC paragraph id="sec436" Note:-->
<h5 class="paragraph" id="sec436">Note:</h5><!--SEC END --><p> The <span class="c007">CAML</span> macros use identifiers (local variables, type
identifiers, structure tags) that start with <span class="c007">caml__</span>. Do not use any
identifier starting with <span class="c007">caml__</span> in your programs.</p>
<!--TOC subsection id="sec437" Low-level interface-->
<h3 class="subsection" id="sec437">19.5.2&#XA0;&#XA0;Low-level interface</h3><!--SEC END --><p>We now give the GC rules corresponding to the low-level allocation
functions <span class="c007">caml_alloc_small</span> and <span class="c007">caml_alloc_shr</span>. You can ignore those rules
if you stick to the simplified allocation function <span class="c007">caml_alloc</span>.</p><div class="theorem"><span class="c019">Rule&#XA0;5</span>&#XA0;&#XA0;<em> After a structured block (a block with tag less than
<span class="c007">No_scan_tag</span>) is allocated with the low-level functions, all fields
of this block must be filled with well-formed values before the next
allocation operation. If the block has been allocated with
<span class="c007">caml_alloc_small</span>, filling is performed by direct assignment to the fields
of the block:
</em><pre><em>
        Field(<span class="c013">v</span>, <span class="c013">n</span>) = </em><span class="c013">v</span><sub><span class="c013">n</span></sub><em>;
</em></pre><em>
If the block has been allocated with <span class="c007">caml_alloc_shr</span>, filling is performed
through the <span class="c007">caml_initialize</span> function:
</em><pre><em>
        caml_initialize(&amp;Field(<span class="c013">v</span>, <span class="c013">n</span>), </em><span class="c013">v</span><sub><span class="c013">n</span></sub><em>);
</em></pre>
</div><p>The next allocation can trigger a garbage collection. The garbage
collector assumes that all structured blocks contain well-formed
values. Newly created blocks contain random data, which generally do
not represent well-formed values.</p><p>If you really need to allocate before the fields can receive their
final value, first initialize with a constant value (e.g.
<span class="c007">Val_unit</span>), then allocate, then modify the fields with the correct
value (see rule&#XA0;6).</p><div class="theorem"><span class="c019">Rule&#XA0;6</span>&#XA0;&#XA0;<em> Direct assignment to a field of a block, as in
</em><pre><em>
        Field(<span class="c013">v</span>, <span class="c013">n</span>) = <span class="c013">w</span>;
</em></pre><em>
is safe only if <span class="c013">v</span> is a block newly allocated by <span class="c007">caml_alloc_small</span>;
that is, if no allocation took place between the
allocation of <span class="c013">v</span> and the assignment to the field. In all other cases,
never assign directly. If the block has just been allocated by <span class="c007">caml_alloc_shr</span>,
use <span class="c007">caml_initialize</span> to assign a value to a field for the first time:
</em><pre><em>
        caml_initialize(&amp;Field(<span class="c013">v</span>, <span class="c013">n</span>), <span class="c013">w</span>);
</em></pre><em>
Otherwise, you are updating a field that previously contained a
well-formed value; then, call the <span class="c007">caml_modify</span> function:
</em><pre><em>
        caml_modify(&amp;Field(<span class="c013">v</span>, <span class="c013">n</span>), <span class="c013">w</span>);
</em></pre>
</div><p>To illustrate the rules above, here is a C function that builds and
returns a list containing the two integers given as parameters.
First, we write it using the simplified allocation functions:
</p><pre>value alloc_list_int(int i1, int i2)
{
  CAMLparam0 ();
  CAMLlocal2 (result, r);

  r = caml_alloc(2, 0);                   /* Allocate a cons cell */
  Store_field(r, 0, Val_int(i2));         /* car = the integer i2 */
  Store_field(r, 1, Val_int(0));          /* cdr = the empty list [] */
  result = caml_alloc(2, 0);              /* Allocate the other cons cell */
  Store_field(result, 0, Val_int(i1));    /* car = the integer i1 */
  Store_field(result, 1, r);              /* cdr = the first cons cell */
  CAMLreturn (result);
}
</pre><p>Here, the registering of <span class="c007">result</span> is not strictly needed, because no
allocation takes place after it gets its value, but it&#X2019;s easier and
safer to simply register all the local variables that have type <span class="c007">value</span>.</p><p>Here is the same function written using the low-level allocation
functions. We notice that the cons cells are small blocks and can be
allocated with <span class="c007">caml_alloc_small</span>, and filled by direct assignments on
their fields.
</p><pre>value alloc_list_int(int i1, int i2)
{
  CAMLparam0 ();
  CAMLlocal2 (result, r);

  r = caml_alloc_small(2, 0);             /* Allocate a cons cell */
  Field(r, 0) = Val_int(i2);              /* car = the integer i2 */
  Field(r, 1) = Val_int(0);               /* cdr = the empty list [] */
  result = caml_alloc_small(2, 0);        /* Allocate the other cons cell */
  Field(result, 0) = Val_int(i1);         /* car = the integer i1 */
  Field(result, 1) = r;                   /* cdr = the first cons cell */
  CAMLreturn (result);
}
</pre><p>In the two examples above, the list is built bottom-up. Here is an
alternate way, that proceeds top-down. It is less efficient, but
illustrates the use of <span class="c007">caml_modify</span>.
</p><pre>value alloc_list_int(int i1, int i2)
{
  CAMLparam0 ();
  CAMLlocal2 (tail, r);

  r = caml_alloc_small(2, 0);             /* Allocate a cons cell */
  Field(r, 0) = Val_int(i1);              /* car = the integer i1 */
  Field(r, 1) = Val_int(0);               /* A dummy value
  tail = caml_alloc_small(2, 0);          /* Allocate the other cons cell */
  Field(tail, 0) = Val_int(i2);           /* car = the integer i2 */
  Field(tail, 1) = Val_int(0);            /* cdr = the empty list [] */
  caml_modify(&amp;Field(r, 1), tail);        /* cdr of the result = tail */
  CAMLreturn (r);
}
</pre><p>It would be incorrect to perform
<span class="c007">Field(r, 1) = tail</span> directly, because the allocation of <span class="c007">tail</span>
has taken place since <span class="c007">r</span> was allocated.</p>
<!--TOC section id="sec438" A complete example-->
<h2 class="section" id="sec438">19.6&#XA0;&#XA0;A complete example</h2><!--SEC END --><p>This section outlines how the functions from the Unix <span class="c007">curses</span> library
can be made available to OCaml programs. First of all, here is
the interface <span class="c007">curses.mli</span> that declares the <span class="c007">curses</span> primitives and
data types:
</p><pre>type window                   (* The type "window" remains abstract *)
external initscr: unit -&gt; window = "curses_initscr"
external endwin: unit -&gt; unit = "curses_endwin"
external refresh: unit -&gt; unit = "curses_refresh"
external wrefresh : window -&gt; unit = "curses_wrefresh"
external newwin: int -&gt; int -&gt; int -&gt; int -&gt; window = "curses_newwin"
external addch: char -&gt; unit = "curses_addch"
external mvwaddch: window -&gt; int -&gt; int -&gt; char -&gt; unit = "curses_mvwaddch"
external addstr: string -&gt; unit = "curses_addstr"
external mvwaddstr: window -&gt; int -&gt; int -&gt; string -&gt; unit = "curses_mvwaddstr"
(* lots more omitted *)
</pre><p>To compile this interface:
</p><pre>        ocamlc -c curses.mli
</pre><p>
To implement these functions, we just have to provide the stub code;
the core functions are already implemented in the <span class="c007">curses</span> library.
The stub code file, <span class="c007">curses_stubs.c</span>, looks like this:
</p><pre>#include &lt;curses.h&gt;
#include &lt;caml/mlvalues.h&gt;
#include &lt;caml/memory.h&gt;
#include &lt;caml/alloc.h&gt;
#include &lt;caml/custom.h&gt;

/* Encapsulation of opaque window handles (of type WINDOW *)
   as OCaml custom blocks. */

static struct custom_operations curses_window_ops = {
  "fr.inria.caml.curses_windows",
  custom_finalize_default,
  custom_compare_default,
  custom_hash_default,
  custom_serialize_default,
  custom_deserialize_default
};

/* Accessing the WINDOW * part of an OCaml custom block */
#define Window_val(v) (*((WINDOW **) Data_custom_val(v)))

/* Allocating an OCaml custom block to hold the given WINDOW * */
static value alloc_window(WINDOW * w)
{
  value v = alloc_custom(&amp;curses_window_ops, sizeof(WINDOW *), 0, 1);
  Window_val(v) = w;
  return v;
}

value caml_curses_initscr(value unit)
{
  CAMLparam1 (unit);
  CAMLreturn (alloc_window(initscr()));
}

value caml_curses_endwin(value unit)
{
  CAMLparam1 (unit);
  endwin();
  CAMLreturn (Val_unit);
}

value caml_curses_refresh(value unit)
{
  CAMLparam1 (unit);
  refresh();
  CAMLreturn (Val_unit);
}

value caml_curses_wrefresh(value win)
{
  CAMLparam1 (win);
  wrefresh(Window_val(win));
  CAMLreturn (Val_unit);
}

value caml_curses_newwin(value nlines, value ncols, value x0, value y0)
{
  CAMLparam4 (nlines, ncols, x0, y0);
  CAMLreturn (alloc_window(newwin(Int_val(nlines), Int_val(ncols),
                                  Int_val(x0), Int_val(y0))));
}

value caml_curses_addch(value c)
{
  CAMLparam1 (c);
  addch(Int_val(c));            /* Characters are encoded like integers */
  CAMLreturn (Val_unit);
}

value caml_curses_mvwaddch(value win, value x, value y, value c)
{
  CAMLparam4 (win, x, y, c);
  mvwaddch(Window_val(win), Int_val(x), Int_val(y), Int_val(c));
  CAMLreturn (Val_unit);
}

value caml_curses_addstr(value s)
{
  CAMLparam1 (s);
  addstr(String_val(s));
  CAMLreturn (Val_unit);
}

value caml_curses_mvwaddstr(value win, value x, value y, value s)
{
  CAMLparam4 (win, x, y, s);
  mvwaddstr(Window_val(win), Int_val(x), Int_val(y), String_val(s));
  CAMLreturn (Val_unit);
}

/* This goes on for pages. */
</pre><p>
The file <span class="c007">curses_stubs.c</span> can be compiled with:
</p><pre>        cc -c -I`ocamlc -where` curses.c
</pre><p>or, even simpler,
</p><pre>        ocamlc -c curses.c
</pre><p>(When passed a <span class="c007">.c</span> file, the <span class="c007">ocamlc</span> command simply calls the C
compiler on that file, with the right <span class="c007">-I</span> option.)</p><p>Now, here is a sample OCaml program <span class="c007">test.ml</span> that uses the <span class="c007">curses</span>
module:
</p><pre>open Curses
let main_window = initscr () in
let small_window = newwin 10 5 20 10 in
  mvwaddstr main_window 10 2 "Hello";
  mvwaddstr small_window 4 3 "world";
  refresh();
  Unix.sleep 5;
  endwin()
</pre><p>To compile and link this program, run:
</p><pre>        ocamlc -custom -o test unix.cma test.ml curses_stubs.o -cclib -lcurses
</pre><p>(On some machines, you may need to put
<span class="c007">-cclib -lcurses -cclib -ltermcap</span> or <span class="c007">-cclib -ltermcap</span>
instead of <span class="c007">-cclib -lcurses</span>.)</p>
<!--TOC section id="sec439" Advanced topic: callbacks from C to OCaml-->
<h2 class="section" id="sec439">19.7&#XA0;&#XA0;Advanced topic: callbacks from C to OCaml</h2><!--SEC END --><p> <a id="s:callback"></a>
</p><p>So far, we have described how to call C functions from OCaml. In this
section, we show how C functions can call OCaml functions, either as
callbacks (OCaml calls C which calls OCaml), or because the main program
is written in C.</p>
<!--TOC subsection id="sec440" Applying OCaml closures from C-->
<h3 class="subsection" id="sec440">19.7.1&#XA0;&#XA0;Applying OCaml closures from C</h3><!--SEC END --><p> <a id="s:callbacks"></a></p><p>C functions can apply OCaml function values (closures) to OCaml values.
The following functions are provided to perform the applications:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_callback(</span><span class="c013">f, a</span><span class="c007">)</span> applies the functional value <span class="c013">f</span> to
the value <span class="c013">a</span> and returns the value returned by&#XA0;<span class="c013">f</span>.
</li><li class="li-itemize"><span class="c007">caml_callback2(</span><span class="c013">f, a, b</span><span class="c007">)</span> applies the functional value <span class="c013">f</span>
(which is assumed to be a curried OCaml function with two arguments) to
<span class="c013">a</span> and <span class="c013">b</span>.
</li><li class="li-itemize"><span class="c007">caml_callback3(</span><span class="c013">f, a, b, c</span><span class="c007">)</span> applies the functional value <span class="c013">f</span>
(a curried OCaml function with three arguments) to <span class="c013">a</span>, <span class="c013">b</span> and <span class="c013">c</span>.
</li><li class="li-itemize"><span class="c007">caml_callbackN(</span><span class="c013">f, n, args</span><span class="c007">)</span> applies the functional value <span class="c013">f</span>
to the <span class="c013">n</span> arguments contained in the array of values <span class="c013">args</span>.
</li></ul><p>
If the function <span class="c013">f</span> does not return, but raises an exception that
escapes the scope of the application, then this exception is
propagated to the next enclosing OCaml code, skipping over the C
code. That is, if an OCaml function <span class="c013">f</span> calls a C function <span class="c013">g</span> that
calls back an OCaml function <span class="c013">h</span> that raises a stray exception, then the
execution of <span class="c013">g</span> is interrupted and the exception is propagated back
into <span class="c013">f</span>.</p><p>If the C code wishes to catch exceptions escaping the OCaml function,
it can use the functions <span class="c007">caml_callback_exn</span>, <span class="c007">caml_callback2_exn</span>,
<span class="c007">caml_callback3_exn</span>, <span class="c007">caml_callbackN_exn</span>. These functions take the same
arguments as their non-<span class="c007">_exn</span> counterparts, but catch escaping
exceptions and return them to the C code. The return value <span class="c013">v</span> of the
<span class="c007">caml_callback*_exn</span> functions must be tested with the macro
<span class="c007">Is_exception_result(</span><span class="c013">v</span><span class="c007">)</span>. If the macro returns &#X201C;false&#X201D;, no
exception occured, and <span class="c013">v</span> is the value returned by the OCaml
function. If <span class="c007">Is_exception_result(</span><span class="c013">v</span><span class="c007">)</span> returns &#X201C;true&#X201D;,
an exception escaped, and its value (the exception descriptor) can be
recovered using <span class="c007">Extract_exception(</span><span class="c013">v</span><span class="c007">)</span>.</p>
<!--TOC paragraph id="sec441" Warning:-->
<h5 class="paragraph" id="sec441">Warning:</h5><!--SEC END --><p> If the OCaml function returned with an exception,
<span class="c007">Extract_exception</span> should be applied to the exception result prior
to calling a function that may trigger garbage collection.
Otherwise, if <span class="c013">v</span> is reachable during garbage collection, the runtime
can crash since <span class="c013">v</span> does not contain a valid value.</p><p>Example:
</p><pre>    value call_caml_f_ex(value closure, value arg)
    {
      CAMLparam2(closure, arg);
      CAMLlocal2(res, tmp);
      res = caml_callback_exn(closure, arg);
      if(Is_exception_result(res)) {
        res = Extract_exception(res);
        tmp = caml_alloc(3, 0); /* Safe to allocate: res contains valid value. */
        ...
      }
      CAMLreturn (res);
    }
</pre>
<!--TOC subsection id="sec442" Obtaining or registering OCaml closures for use in C functions-->
<h3 class="subsection" id="sec442">19.7.2&#XA0;&#XA0;Obtaining or registering OCaml closures for use in C functions</h3><!--SEC END --><p>There are two ways to obtain OCaml function values (closures) to
be passed to the <span class="c007">callback</span> functions described above. One way is to
pass the OCaml function as an argument to a primitive function. For
example, if the OCaml code contains the declaration
</p><pre>    external apply : ('a -&gt; 'b) -&gt; 'a -&gt; 'b = "caml_apply"
</pre><p>the corresponding C stub can be written as follows:
</p><pre>    CAMLprim value caml_apply(value vf, value vx)
    {
      CAMLparam2(vf, vx);
      CAMLlocal1(vy);
      vy = caml_callback(vf, vx);
      CAMLreturn(vy);
    }
</pre><p>
Another possibility is to use the registration mechanism provided by
OCaml. This registration mechanism enables OCaml code to register
OCaml functions under some global name, and C code to retrieve the
corresponding closure by this global name.</p><p>On the OCaml side, registration is performed by evaluating
<span class="c007">Callback.register</span> <span class="c013">n v</span>. Here, <span class="c013">n</span> is the global name
(an arbitrary string) and <span class="c013">v</span> the OCaml value. For instance:
</p><pre>    let f x = print_string "f is applied to "; print_int x; print_newline()
    let _ = Callback.register "test function" f
</pre><p>
On the C side, a pointer to the value registered under name <span class="c013">n</span> is
obtained by calling <span class="c007">caml_named_value(</span><span class="c013">n</span><span class="c007">)</span>. The returned
pointer must then be dereferenced to recover the actual OCaml value.
If no value is registered under the name <span class="c013">n</span>, the null pointer is
returned. For example, here is a C wrapper that calls the OCaml function <span class="c007">f</span>
above:
</p><pre>    void call_caml_f(int arg)
    {
        caml_callback(*caml_named_value("test function"), Val_int(arg));
    }
</pre><p>
The pointer returned by <span class="c007">caml_named_value</span> is constant and can safely
be cached in a C variable to avoid repeated name lookups. On the other
hand, the value pointed to can change during garbage collection and
must always be recomputed at the point of use. Here is a more
efficient variant of <span class="c007">call_caml_f</span> above that calls <span class="c007">caml_named_value</span>
only once:
</p><pre>    void call_caml_f(int arg)
    {
        static value * closure_f = NULL;
        if (closure_f == NULL) {
            /* First time around, look up by name */
            closure_f = caml_named_value("test function");
        }
        caml_callback(*closure_f, Val_int(arg));
    }
</pre>
<!--TOC subsection id="sec443" Registering OCaml exceptions for use in C functions-->
<h3 class="subsection" id="sec443">19.7.3&#XA0;&#XA0;Registering OCaml exceptions for use in C functions</h3><!--SEC END --><p> <a id="s:register-exn"></a></p><p>The registration mechanism described above can also be used to
communicate exception identifiers from OCaml to C. The OCaml code
registers the exception by evaluating
<span class="c007">Callback.register_exception</span> <span class="c013">n exn</span>, where <span class="c013">n</span> is an
arbitrary name and <span class="c013">exn</span> is an exception value of the
exception to register. For example:
</p><pre>    exception Error of string
    let _ = Callback.register_exception "test exception" (Error "any string")
</pre><p>The C code can then recover the exception identifier using
<span class="c007">caml_named_value</span> and pass it as first argument to the functions
<span class="c007">raise_constant</span>, <span class="c007">raise_with_arg</span>, and <span class="c007">raise_with_string</span> (described
in section&#XA0;<a href="#s%3Ac-exceptions">19.4.5</a>) to actually raise the exception. For
example, here is a C function that raises the <span class="c007">Error</span> exception with
the given argument:
</p><pre>    void raise_error(char * msg)
    {
        caml_raise_with_string(*caml_named_value("test exception"), msg);
    }
</pre>
<!--TOC subsection id="sec444" Main program in C-->
<h3 class="subsection" id="sec444">19.7.4&#XA0;&#XA0;Main program in C</h3><!--SEC END --><p> <a id="s:main-c"></a></p><p>In normal operation, a mixed OCaml/C program starts by executing the
OCaml initialization code, which then may proceed to call C
functions. We say that the main program is the OCaml code. In some
applications, it is desirable that the C code plays the role of the
main program, calling OCaml functions when needed. This can be achieved as
follows:
</p><ul class="itemize"><li class="li-itemize">
The C part of the program must provide a <span class="c007">main</span> function,
which will override the default <span class="c007">main</span> function provided by the OCaml
runtime system. Execution will start in the user-defined <span class="c007">main</span> function
just like for a regular C program.</li><li class="li-itemize">At some point, the C code must call <span class="c007">caml_main(argv)</span> to
initialize the OCaml code. The <span class="c007">argv</span> argument is a C array of strings
(type <span class="c007">char **</span>), terminated with a <span class="c007">NULL</span> pointer,
which represents the command-line arguments, as
passed as second argument to <span class="c007">main</span>. The OCaml array <span class="c007">Sys.argv</span> will
be initialized from this parameter. For the bytecode compiler,
<span class="c007">argv[0]</span> and <span class="c007">argv[1]</span> are also consulted to find the file containing
the bytecode.</li><li class="li-itemize">The call to <span class="c007">caml_main</span> initializes the OCaml runtime system,
loads the bytecode (in the case of the bytecode compiler), and
executes the initialization code of the OCaml program. Typically, this
initialization code registers callback functions using <span class="c007">Callback.register</span>.
Once the OCaml initialization code is complete, control returns to the
C code that called <span class="c007">caml_main</span>.</li><li class="li-itemize">The C code can then invoke OCaml functions using the callback
mechanism (see section&#XA0;<a href="#s%3Acallbacks">19.7.1</a>).
</li></ul>
<!--TOC subsection id="sec445" Embedding the OCaml code in the C code-->
<h3 class="subsection" id="sec445">19.7.5&#XA0;&#XA0;Embedding the OCaml code in the C code</h3><!--SEC END --><p> <a id="s:embedded-code"></a></p><p>The bytecode compiler in custom runtime mode (<span class="c007">ocamlc -custom</span>)
normally appends the bytecode to the executable file containing the
custom runtime. This has two consequences. First, the final linking
step must be performed by <span class="c007">ocamlc</span>. Second, the OCaml runtime library
must be able to find the name of the executable file from the
command-line arguments. When using <span class="c007">caml_main(argv)</span> as in
section&#XA0;<a href="#s%3Amain-c">19.7.4</a>, this means that <span class="c007">argv[0]</span> or <span class="c007">argv[1]</span> must
contain the executable file name.</p><p>An alternative is to embed the bytecode in the C code. The
<span class="c007">-output-obj</span> option to <span class="c007">ocamlc</span> is provided for this purpose. It
causes the <span class="c007">ocamlc</span> compiler to output a C object file (<span class="c007">.o</span> file,
<span class="c007">.obj</span> under Windows) containing the bytecode for the OCaml part of the
program, as well as a <span class="c007">caml_startup</span> function. The C object file
produced by <span class="c007">ocamlc -output-obj</span> can then be linked with C code using
the standard C compiler, or stored in a C library.</p><p>The <span class="c007">caml_startup</span> function must be called from the main C program in
order to initialize the OCaml runtime and execute the OCaml
initialization code. Just like <span class="c007">caml_main</span>, it takes one <span class="c007">argv</span>
parameter containing the command-line parameters. Unlike <span class="c007">caml_main</span>,
this <span class="c007">argv</span> parameter is used only to initialize <span class="c007">Sys.argv</span>, but not
for finding the name of the executable file.</p><p>The <span class="c007">-output-obj</span> option can also be used to obtain the C source file.
More interestingly, the same option can also produce directly a shared
library (<span class="c007">.so</span> file, <span class="c007">.dll</span> under Windows) that contains the OCaml
code, the OCaml runtime system and any other static C code given to
<span class="c007">ocamlc</span> (<span class="c007">.o</span>, <span class="c007">.a</span>, respectively, <span class="c007">.obj</span>, <span class="c007">.lib</span>). This use of
<span class="c007">-output-obj</span> is very similar to a normal linking step, but instead of
producing a main program that automatically runs the OCaml code, it
produces a shared library that can run the OCaml code on demand. The
three possible behaviors of <span class="c007">-output-obj</span> are selected according
to the extension of the resulting file (given with <span class="c007">-o</span>).</p><p>The native-code compiler <span class="c007">ocamlopt</span> also supports the <span class="c007">-output-obj</span>
option, causing it to output a C object file or a shared library
containing the native code for all OCaml modules on the command-line,
as well as the OCaml startup code. Initialization is performed by
calling <span class="c007">caml_startup</span> as in the case of the bytecode compiler.</p><p>For the final linking phase, in addition to the object file produced
by <span class="c007">-output-obj</span>, you will have to provide the OCaml runtime
library (<span class="c007">libcamlrun.a</span> for bytecode, <span class="c007">libasmrun.a</span> for native-code),
as well as all C libraries that are required by the OCaml libraries
used. For instance, assume the OCaml part of your program uses the
Unix library. With <span class="c007">ocamlc</span>, you should do:
</p><pre>
        ocamlc -output-obj -o camlcode.o unix.cma <span class="c013">other</span> .cmo <span class="c013">and</span> .cma <span class="c013">files</span>
        cc -o myprog <span class="c013">C objects and libraries</span> \
           camlcode.o -L/usr/local/lib/ocaml -lunix -lcamlrun
</pre><p>
With <span class="c007">ocamlopt</span>, you should do:
</p><pre>
        ocamlopt -output-obj -o camlcode.o unix.cmxa <span class="c013">other</span> .cmx <span class="c013">and</span> .cmxa <span class="c013">files</span>
        cc -o myprog <span class="c013">C objects and libraries</span> \
           camlcode.o -L/usr/local/lib/ocaml -lunix -lasmrun
</pre>
<!--TOC paragraph id="sec446" Warning:-->
<h5 class="paragraph" id="sec446">Warning:</h5><!--SEC END --><p> On some ports, special options are required on the final
linking phase that links together the object file produced by the
<span class="c007">-output-obj</span> option and the remainder of the program. Those options
are shown in the configuration file <span class="c007">config/Makefile</span> generated during
compilation of OCaml, as the variables <span class="c007">BYTECCLINKOPTS</span>
(for object files produced by <span class="c007">ocamlc -output-obj</span>) and
<span class="c007">NATIVECCLINKOPTS</span> (for object files produced by <span class="c007">ocamlopt -output-obj</span>).
</p><ul class="itemize"><li class="li-itemize">
Windows with the MSVC compiler: the object file produced by
OCaml have been compiled with the <span class="c007">/MD</span> flag, and therefore
all other object files linked with it should also be compiled with
<span class="c007">/MD</span>.
</li><li class="li-itemize">other systems: you may have to add one or more of <span class="c007">-lcurses</span>,
<span class="c007">-lm</span>, <span class="c007">-ldl</span>, depending on your OS and C compiler.
</li></ul>
<!--TOC paragraph id="sec447" Stack backtraces.-->
<h5 class="paragraph" id="sec447">Stack backtraces.</h5><!--SEC END --><p> When OCaml bytecode produced by
<span class="c007">ocamlc -g</span> is embedded in a C program, no debugging information is
included, and therefore it is impossible to print stack backtraces on
uncaught exceptions. This is not the case when native code produced
by <span class="c007">ocamlopt -g</span> is embedded in a C program: stack backtrace
information is available, but the backtrace mechanism needs to be
turned on programmatically. This can be achieved from the OCaml side
by calling <span class="c007">Printexc.record_backtrace true</span> in the initialization of
one of the OCaml modules. This can also be achieved from the C side
by calling <span class="c007">caml_record_backtrace(Val_int(1));</span> in the OCaml-C glue code.</p>
<!--TOC section id="sec448" Advanced example with callbacks-->
<h2 class="section" id="sec448">19.8&#XA0;&#XA0;Advanced example with callbacks</h2><!--SEC END --><p>This section illustrates the callback facilities described in
section&#XA0;<a href="#s%3Acallback">19.7</a>. We are going to package some OCaml functions
in such a way that they can be linked with C code and called from C
just like any C functions. The OCaml functions are defined in the
following <span class="c007">mod.ml</span> OCaml source:</p><pre>(* File mod.ml -- some "useful" OCaml functions *)

let rec fib n = if n &lt; 2 then 1 else fib(n-1) + fib(n-2)

let format_result n = Printf.sprintf "Result is: %d\n" n

(* Export those two functions to C *)

let _ = Callback.register "fib" fib
let _ = Callback.register "format_result" format_result
</pre><p>
Here is the C stub code for calling these functions from C:</p><pre>/* File modwrap.c -- wrappers around the OCaml functions */

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;caml/mlvalues.h&gt;
#include &lt;caml/callback.h&gt;

int fib(int n)
{
  static value * fib_closure = NULL;
  if (fib_closure == NULL) fib_closure = caml_named_value("fib");
  return Int_val(caml_callback(*fib_closure, Val_int(n)));
}

char * format_result(int n)
{
  static value * format_result_closure = NULL;
  if (format_result_closure == NULL)
    format_result_closure = caml_named_value("format_result");
  return strdup(String_val(caml_callback(*format_result_closure, Val_int(n))));
  /* We copy the C string returned by String_val to the C heap
     so that it remains valid after garbage collection. */
}
</pre><p>
We now compile the OCaml code to a C object file and put it in a C
library along with the stub code in <span class="c007">modwrap.c</span> and the OCaml runtime system:
</p><pre>        ocamlc -custom -output-obj -o modcaml.o mod.ml
        ocamlc -c modwrap.c
        cp /usr/local/lib/ocaml/libcamlrun.a mod.a
        ar r mod.a modcaml.o modwrap.o
</pre><p>(One can also use <span class="c007">ocamlopt -output-obj</span> instead of <span class="c007">ocamlc -custom -output-obj</span>. In this case, replace <span class="c007">libcamlrun.a</span> (the bytecode
runtime library) by <span class="c007">libasmrun.a</span> (the native-code runtime library).)</p><p>Now, we can use the two functions <span class="c007">fib</span> and <span class="c007">format_result</span> in any C
program, just like regular C functions. Just remember to call
<span class="c007">caml_startup</span> once before.</p><pre>/* File main.c -- a sample client for the OCaml functions */

#include &lt;stdio.h&gt;

int main(int argc, char ** argv)
{
  int result;

  /* Initialize OCaml code */
  caml_startup(argv);
  /* Do some computation */
  result = fib(10);
  printf("fib(10) = %s\n", format_result(result));
  return 0;
}
</pre><p>
To build the whole program, just invoke the C compiler as follows:
</p><pre>        cc -o prog main.c mod.a -lcurses
</pre><p>(On some machines, you may need to put <span class="c007">-ltermcap</span> or
<span class="c007">-lcurses -ltermcap</span> instead of <span class="c007">-lcurses</span>.)</p>
<!--TOC section id="sec449" Advanced topic: custom blocks-->
<h2 class="section" id="sec449">19.9&#XA0;&#XA0;Advanced topic: custom blocks</h2><!--SEC END --><p> <a id="s:custom"></a>
</p><p>Blocks with tag <span class="c007">Custom_tag</span> contain both arbitrary user data and a
pointer to a C struct, with type <span class="c007">struct custom_operations</span>, that
associates user-provided finalization, comparison, hashing,
serialization and deserialization functions to this block.</p>
<!--TOC subsection id="sec450" The <span class="c007">struct custom</span><span class="c007">_</span><span class="c007">operations</span>-->
<h3 class="subsection" id="sec450">19.9.1&#XA0;&#XA0;The <span class="c007">struct custom_operations</span></h3><!--SEC END --><p>The <span class="c007">struct custom_operations</span> is defined in <span class="c007">&lt;caml/custom.h&gt;</span> and
contains the following fields:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">char *identifier</span> <br>
A zero-terminated character string serving as an identifier for
serialization and deserialization operations.</li><li class="li-itemize"><span class="c007">void  (*finalize)(value v)</span> <br>
The <span class="c007">finalize</span> field contains a pointer to a C function that is called
when the block becomes unreachable and is about to be reclaimed.
The block is passed as first argument to the function.
The <span class="c007">finalize</span> field can also be <span class="c007">custom_finalize_default</span> to indicate that no
finalization function is associated with the block.</li><li class="li-itemize"><span class="c007">int (*compare)(value v1, value v2)</span> <br>
The <span class="c007">compare</span> field contains a pointer to a C function that is
called whenever two custom blocks are compared using OCaml&#X2019;s generic
comparison operators (<span class="c007">=</span>, <span class="c007">&lt;&gt;</span>, <span class="c007">&lt;=</span>, <span class="c007">&gt;=</span>, <span class="c007">&lt;</span>, <span class="c007">&gt;</span> and
<span class="c007">compare</span>). The C function should return 0 if the data contained in
the two blocks are structurally equal, a negative integer if the data
from the first block is less than the data from the second block, and
a positive integer if the data from the first block is greater than
the data from the second block.<p>The <span class="c007">compare</span> field can be set to <span class="c007">custom_compare_default</span>; this
default comparison function simply raises <span class="c007">Failure</span>.</p></li><li class="li-itemize"><span class="c007">int (*compare_ext)(value v1, value v2)</span> <br>
(Since 3.12.1)
The <span class="c007">compare_ext</span> field contains a pointer to a C function that is
called whenever one custom block and one unboxed integer are compared using OCaml&#X2019;s generic
comparison operators (<span class="c007">=</span>, <span class="c007">&lt;&gt;</span>, <span class="c007">&lt;=</span>, <span class="c007">&gt;=</span>, <span class="c007">&lt;</span>, <span class="c007">&gt;</span> and
<span class="c007">compare</span>). As in the case of the <span class="c007">compare</span> field, the C function
should return 0 if the two arguments are structurally equal, a
negative integer if the first argument compares less than the second
argument, and a positive integer if the first argument compares
greater than the second argument.<p>The <span class="c007">compare_ext</span> field can be set to <span class="c007">custom_compare_ext_default</span>; this
default comparison function simply raises <span class="c007">Failure</span>.</p></li><li class="li-itemize"><span class="c007">long (*hash)(value v)</span> <br>
The <span class="c007">hash</span> field contains a pointer to a C function that is called
whenever OCaml&#X2019;s generic hash operator (see module <span class="c007">Hashtbl</span>) is
applied to a custom block. The C function can return an arbitrary
long integer representing the hash value of the data contained in the
given custom block. The hash value must be compatible with the
<span class="c007">compare</span> function, in the sense that two structurally equal data
(that is, two custom blocks for which <span class="c007">compare</span> returns 0) must have
the same hash value.<p>The <span class="c007">hash</span> field can be set to <span class="c007">custom_hash_default</span>, in which case
the custom block is ignored during hash computation.</p></li><li class="li-itemize"><span class="c007">void (*serialize)(value v, unsigned long * wsize_32, unsigned long * wsize_64)</span> <br>
The <span class="c007">serialize</span> field contains a pointer to a C function that is
called whenever the custom block needs to be serialized (marshaled)
using the OCaml functions <span class="c007">output_value</span> or <span class="c007">Marshal.to_...</span>.
For a custom block, those functions first write the identifier of the
block (as given by the <span class="c007">identifier</span> field) to the output stream,
then call the user-provided <span class="c007">serialize</span> function. That function is
responsible for writing the data contained in the custom block, using
the <span class="c007">serialize_...</span> functions defined in <span class="c007">&lt;caml/intext.h&gt;</span> and listed
below. The user-provided <span class="c007">serialize</span> function must then store in its
<span class="c007">wsize_32</span> and <span class="c007">wsize_64</span> parameters the sizes in bytes of the data
part of the custom block on a 32-bit architecture and on a 64-bit
architecture, respectively.<p>The <span class="c007">serialize</span> field can be set to <span class="c007">custom_serialize_default</span>,
in which case the <span class="c007">Failure</span> exception is raised when attempting to
serialize the custom block.</p></li><li class="li-itemize"><span class="c007">unsigned long (*deserialize)(void * dst)</span> <br>
The <span class="c007">deserialize</span> field contains a pointer to a C function that is
called whenever a custom block with identifier <span class="c007">identifier</span> needs to
be deserialized (un-marshaled) using the OCaml functions <span class="c007">input_value</span>
or <span class="c007">Marshal.from_...</span>. This user-provided function is responsible for
reading back the data written by the <span class="c007">serialize</span> operation, using the
<span class="c007">deserialize_...</span> functions defined in <span class="c007">&lt;caml/intext.h&gt;</span> and listed
below. It must then rebuild the data part of the custom block
and store it at the pointer given as the <span class="c007">dst</span> argument. Finally, it
returns the size in bytes of the data part of the custom block.
This size must be identical to the <span class="c007">wsize_32</span> result of
the <span class="c007">serialize</span> operation if the architecture is 32 bits, or
<span class="c007">wsize_64</span> if the architecture is 64 bits.<p>The <span class="c007">deserialize</span> field can be set to <span class="c007">custom_deserialize_default</span>
to indicate that deserialization is not supported. In this case,
do not register the <span class="c007">struct custom_operations</span> with the deserializer
using <span class="c007">register_custom_operations</span> (see below).
</p></li></ul><p>Note: the <span class="c007">finalize</span>, <span class="c007">compare</span>, <span class="c007">hash</span>, <span class="c007">serialize</span> and <span class="c007">deserialize</span>
functions attached to custom block descriptors must never trigger a
garbage collection. Within these functions, do not call any of the
OCaml allocation functions, and do not perform a callback into OCaml
code. Do not use <span class="c007">CAMLparam</span> to register the parameters to these
functions, and do not use <span class="c007">CAMLreturn</span> to return the result.</p>
<!--TOC subsection id="sec451" Allocating custom blocks-->
<h3 class="subsection" id="sec451">19.9.2&#XA0;&#XA0;Allocating custom blocks</h3><!--SEC END --><p>Custom blocks must be allocated via the <span class="c007">caml_alloc_custom</span> function:
</p><div class="center">
<span class="c007">caml_alloc_custom(</span><span class="c013">ops</span><span class="c007">, </span><span class="c013">size</span><span class="c007">, </span><span class="c013">used</span><span class="c007">, </span><span class="c013">max</span><span class="c007">)</span>
</div><p>
returns a fresh custom block, with room for <span class="c013">size</span> bytes of user
data, and whose associated operations are given by <span class="c013">ops</span> (a
pointer to a <span class="c007">struct custom_operations</span>, usually statically allocated
as a C global variable).</p><p>The two parameters <span class="c013">used</span> and <span class="c013">max</span> are used to control the
speed of garbage collection when the finalized object contains
pointers to out-of-heap resources. Generally speaking, the
OCaml incremental major collector adjusts its speed relative to the
allocation rate of the program. The faster the program allocates, the
harder the GC works in order to reclaim quickly unreachable blocks
and avoid having large amount of &#X201C;floating garbage&#X201D; (unreferenced
objects that the GC has not yet collected).</p><p>Normally, the allocation rate is measured by counting the in-heap size
of allocated blocks. However, it often happens that finalized
objects contain pointers to out-of-heap memory blocks and other resources
(such as file descriptors, X Windows bitmaps, etc.). For those
blocks, the in-heap size of blocks is not a good measure of the
quantity of resources allocated by the program.</p><p>The two arguments <span class="c013">used</span> and <span class="c013">max</span> give the GC an idea of how
much out-of-heap resources are consumed by the finalized block
being allocated: you give the amount of resources allocated to this
object as parameter <span class="c013">used</span>, and the maximum amount that you want
to see in floating garbage as parameter <span class="c013">max</span>. The units are
arbitrary: the GC cares only about the ratio <span class="c013">used</span> / <span class="c013">max</span>.</p><p>For instance, if you are allocating a finalized block holding an X
Windows bitmap of <span class="c013">w</span> by <span class="c013">h</span> pixels, and you&#X2019;d rather not
have more than 1 mega-pixels of unreclaimed bitmaps, specify
<span class="c013">used</span> = <span class="c013">w</span> * <span class="c013">h</span> and <span class="c013">max</span> = 1000000.</p><p>Another way to describe the effect of the <span class="c013">used</span> and <span class="c013">max</span>
parameters is in terms of full GC cycles. If you allocate many custom
blocks with <span class="c013">used</span> / <span class="c013">max</span> = 1 / <span class="c013">N</span>, the GC will then do one
full cycle (examining every object in the heap and calling
finalization functions on those that are unreachable) every <span class="c013">N</span>
allocations. For instance, if <span class="c013">used</span> = 1 and <span class="c013">max</span> = 1000,
the GC will do one full cycle at least every 1000 allocations of
custom blocks.</p><p>If your finalized blocks contain no pointers to out-of-heap resources,
or if the previous discussion made little sense to you, just take
<span class="c013">used</span> = 0 and <span class="c013">max</span> = 1. But if you later find that the
finalization functions are not called &#X201C;often enough&#X201D;, consider
increasing the <span class="c013">used</span> / <span class="c013">max</span> ratio.</p>
<!--TOC subsection id="sec452" Accessing custom blocks-->
<h3 class="subsection" id="sec452">19.9.3&#XA0;&#XA0;Accessing custom blocks</h3><!--SEC END --><p>The data part of a custom block <span class="c013">v</span> can be
accessed via the pointer <span class="c007">Data_custom_val(</span><span class="c013">v</span><span class="c007">)</span>. This pointer
has type <span class="c007">void *</span> and should be cast to the actual type of the data
stored in the custom block.</p><p>The contents of custom blocks are not scanned by the garbage
collector, and must therefore not contain any pointer inside the OCaml
heap. In other terms, never store an OCaml <span class="c007">value</span> in a custom block,
and do not use <span class="c007">Field</span>, <span class="c007">Store_field</span> nor <span class="c007">caml_modify</span> to access the data
part of a custom block. Conversely, any C data structure (not
containing heap pointers) can be stored in a custom block.</p>
<!--TOC subsection id="sec453" Writing custom serialization and deserialization functions-->
<h3 class="subsection" id="sec453">19.9.4&#XA0;&#XA0;Writing custom serialization and deserialization functions</h3><!--SEC END --><p>The following functions, defined in <span class="c007">&lt;caml/intext.h&gt;</span>, are provided to
write and read back the contents of custom blocks in a portable way.
Those functions handle endianness conversions when e.g. data is
written on a little-endian machine and read back on a big-endian machine.</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Function</span></td><td class="c021"><span class="c019">Action</span> </td></tr>
<tr><td class="c029">
<span class="c007">caml_serialize_int_1</span></td><td class="c028">Write a 1-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_int_2</span></td><td class="c028">Write a 2-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_int_4</span></td><td class="c028">Write a 4-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_int_8</span></td><td class="c028">Write a 8-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_float_4</span></td><td class="c028">Write a 4-byte float </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_float_8</span></td><td class="c028">Write a 8-byte float </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_block_1</span></td><td class="c028">Write an array of 1-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_block_2</span></td><td class="c028">Write an array of 2-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_block_4</span></td><td class="c028">Write an array of 4-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_serialize_block_8</span></td><td class="c028">Write an array of 8-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_uint_1</span></td><td class="c028">Read an unsigned 1-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_sint_1</span></td><td class="c028">Read a signed 1-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_uint_2</span></td><td class="c028">Read an unsigned 2-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_sint_2</span></td><td class="c028">Read a signed 2-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_uint_4</span></td><td class="c028">Read an unsigned 4-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_sint_4</span></td><td class="c028">Read a signed 4-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_uint_8</span></td><td class="c028">Read an unsigned 8-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_sint_8</span></td><td class="c028">Read a signed 8-byte integer </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_float_4</span></td><td class="c028">Read a 4-byte float </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_float_8</span></td><td class="c028">Read an 8-byte float </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_block_1</span></td><td class="c028">Read an array of 1-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_block_2</span></td><td class="c028">Read an array of 2-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_block_4</span></td><td class="c028">Read an array of 4-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_block_8</span></td><td class="c028">Read an array of 8-byte quantities </td></tr>
<tr><td class="c029"><span class="c007">caml_deserialize_error</span></td><td class="c028">Signal an error during deserialization;
<span class="c007">input_value</span> or <span class="c007">Marshal.from_...</span> raise a <span class="c007">Failure</span> exception after
cleaning up their internal data structures </td></tr>
</table></div><p>Serialization functions are attached to the custom blocks to which
they apply. Obviously, deserialization functions cannot be attached
this way, since the custom block does not exist yet when
deserialization begins! Thus, the <span class="c007">struct custom_operations</span> that
contain deserialization functions must be registered with the
deserializer in advance, using the <span class="c007">register_custom_operations</span>
function declared in <span class="c007">&lt;caml/custom.h&gt;</span>. Deserialization proceeds by
reading the identifier off the input stream, allocating a custom block
of the size specified in the input stream, searching the registered
<span class="c007">struct custom_operation</span> blocks for one with the same identifier, and
calling its <span class="c007">deserialize</span> function to fill the data part of the custom block.</p>
<!--TOC subsection id="sec454" Choosing identifiers-->
<h3 class="subsection" id="sec454">19.9.5&#XA0;&#XA0;Choosing identifiers</h3><!--SEC END --><p>Identifiers in <span class="c007">struct custom_operations</span> must be chosen carefully,
since they must identify uniquely the data structure for serialization
and deserialization operations. In particular, consider including a
version number in the identifier; this way, the format of the data can
be changed later, yet backward-compatible deserialisation functions
can be provided.</p><p>Identifiers starting with <span class="c007">_</span> (an underscore character) are reserved
for the OCaml runtime system; do not use them for your custom
data. We recommend to use a URL
(<span class="c007">http://mymachine.mydomain.com/mylibrary/version-number</span>)
or a Java-style package name
(<span class="c007">com.mydomain.mymachine.mylibrary.version-number</span>)
as identifiers, to minimize the risk of identifier collision.</p>
<!--TOC subsection id="sec455" Finalized blocks-->
<h3 class="subsection" id="sec455">19.9.6&#XA0;&#XA0;Finalized blocks</h3><!--SEC END --><p>Custom blocks generalize the finalized blocks that were present in
OCaml prior to version 3.00. For backward compatibility, the
format of custom blocks is compatible with that of finalized blocks,
and the <span class="c007">alloc_final</span> function is still available to allocate a custom
block with a given finalization function, but default comparison,
hashing and serialization functions. <span class="c007">caml_alloc_final(</span><span class="c013">n</span><span class="c007">, </span><span class="c013">f</span><span class="c007">, </span><span class="c013">used</span><span class="c007">, </span><span class="c013">max</span><span class="c007">)</span> returns a fresh custom block of
size <span class="c013">n</span> words, with finalization function <span class="c013">f</span>. The first
word is reserved for storing the custom operations; the other
<span class="c013">n</span>-1 words are available for your data. The two parameters
<span class="c013">used</span> and <span class="c013">max</span> are used to control the speed of garbage
collection, as described for <span class="c007">caml_alloc_custom</span>.</p>
<!--TOC section id="sec456" Advanced topic: multithreading-->
<h2 class="section" id="sec456">19.10&#XA0;&#XA0;Advanced topic: multithreading</h2><!--SEC END --><p>
<a id="s:C-multithreading"></a></p><p>Using multiple threads (shared-memory concurrency) in a mixed OCaml/C
application requires special precautions, which are described in this
section.</p>
<!--TOC subsection id="sec457" Registering threads created from C-->
<h3 class="subsection" id="sec457">19.10.1&#XA0;&#XA0;Registering threads created from C</h3><!--SEC END --><p>Callbacks from C to OCaml are possible only if the calling thread is
known to the OCaml run-time system. Threads created from OCaml (through
the <span class="c007">Thread.create</span> function of the system threads library) are
automatically known to the run-time system. If the application
creates additional threads from C and wishes to callback into OCaml
code from these threads, it must first register them with the run-time
system. The following functions are declared in the include file
<span class="c007">&lt;caml/threads.h&gt;</span>.</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_c_thread_register()</span> registers the calling thread with the OCaml
run-time system. Returns 1 on success, 0 on error. Registering an
already-register thread does nothing and returns 0.
</li><li class="li-itemize"><span class="c007">caml_c_thread_unregister()</span> must be called before the thread
terminates, to unregister it from the OCaml run-time system.
Returns 1 on success, 0 on error. If the calling thread was not
previously registered, does nothing and returns 0.
</li></ul>
<!--TOC subsection id="sec458" Parallel execution of long-running C code-->
<h3 class="subsection" id="sec458">19.10.2&#XA0;&#XA0;Parallel execution of long-running C code</h3><!--SEC END --><p>The OCaml run-time system is not reentrant: at any time, at most one
thread can be executing OCaml code or C code that uses the OCaml
run-time system. Technically, this is enforced by a &#X201C;master lock&#X201D;
that any thread must hold while executing such code.</p><p>When OCaml calls the C code implementing a primitive, the master lock
is held, therefore the C code has full access to the facilities of the
run-time system. However, no other thread can execute OCaml code
concurrently with the C code of the primitive.</p><p>If a C primitive runs for a long time or performs potentially blocking
input-output operations, it can explicitly release the master lock,
enabling other OCaml threads to run concurrently with its operations.
The C code must re-acquire the master lock before returning to OCaml.
This is achieved with the following functions, declared in
the include file <span class="c007">&lt;caml/threads.h&gt;</span>.</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_release_runtime_system()</span>
The calling thread releases the master lock and other OCaml resources,
enabling other threads to run OCaml code in parallel with the execution
of the calling thread.
</li><li class="li-itemize"><span class="c007">caml_acquire_runtime_system()</span>
The calling thread re-acquires the master lock and other OCaml
resources. It may block until no other thread uses the OCaml run-time
system.
</li></ul><p>After <span class="c007">caml_release_runtime_system()</span> was called and until
<span class="c007">caml_acquire_runtime_system()</span> is called, the C code must not access
any OCaml data, nor call any function of the run-time system, nor call
back into OCaml code. Consequently, arguments provided by OCaml to the
C primitive must be copied into C data structures before calling
<span class="c007">caml_release_runtime_system()</span>, and results to be returned to OCaml
must be encoded as OCaml values after <span class="c007">caml_acquire_runtime_system()</span>
returns.</p><p>Example: the following C primitive invokes <span class="c007">gethostbyname</span> to find the
IP address of a host name. The <span class="c007">gethostbyname</span> function can block for
a long time, so we choose to release the OCaml run-time system while it
is running.
</p><pre>CAMLprim stub_gethostbyname(value vname)
{
  CAMLparam1 (vname);
  CAMLlocal1 (vres);
  struct hostent * h;

  /* Copy the string argument to a C string, allocated outside the
     OCaml heap. */
  name = stat_alloc(caml_string_length(vname) + 1);
  strcpy(name, String_val(vname));
  /* Release the OCaml run-time system */
  caml_release_runtime_system();
  /* Resolve the name */
  h = gethostbyname(name);
  /* Re-acquire the OCaml run-time system */
  caml_acquire_runtime_system();
  /* Encode the relevant fields of h as the OCaml value vres */
  ... /* Omitted */
  /* Return to OCaml */
  CAMLreturn (vres);
}
</pre><p>
Callbacks from C to OCaml must be performed while holding the master
lock to the OCaml run-time system. This is naturally the case if the
callback is performed by a C primitive that did not release the
run-time system. If the C primitive released the run-time system
previously, or the callback is performed from other C code that was
not invoked from OCaml (e.g. an event loop in a GUI application), the
run-time system must be acquired before the callback and released
after:
</p><pre>  caml_acquire_runtime_system();
  /* Resolve OCaml function vfun to be invoked */
  /* Build OCaml argument varg to the callback */
  vres = callback(vfun, varg);
  /* Copy relevant parts of result vres to C data structures */
  caml_release_runtime_system();
</pre><p>
Note: the <span class="c007">acquire</span> and <span class="c007">release</span> functions described above were
introduced in OCaml 3.12. Older code uses the following historical
names, declared in <span class="c007">&lt;caml/signals.h&gt;</span>:
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_enter_blocking_section</span> as an alias for
<span class="c007">caml_release_runtime_system</span>
</li><li class="li-itemize"><span class="c007">caml_leave_blocking_section</span> as an alias for
<span class="c007">caml_acquire_runtime_system</span>
</li></ul><p>
Intuition: a &#X201C;blocking section&#X201D; is a piece of C code that does not
use the OCaml run-time system, typically a blocking input/output operation.</p>
<!--TOC section id="sec459" Building mixed C/OCaml libraries: <span class="c007">ocamlmklib</span>-->
<h2 class="section" id="sec459">19.11&#XA0;&#XA0;Building mixed C/OCaml libraries: <span class="c007">ocamlmklib</span></h2><!--SEC END --><p>
<a id="s-ocamlmklib"></a></p><p>The <span class="c007">ocamlmklib</span> command facilitates the construction of libraries
containing both OCaml code and C code, and usable both in static
linking and dynamic linking modes. This command is available under
Windows since Objective Caml 3.11 and under other operating systems since
Objective Caml 3.03.</p><p>The <span class="c007">ocamlmklib</span> command takes three kinds of arguments:
</p><ul class="itemize"><li class="li-itemize">
OCaml source files and object files (<span class="c007">.cmo</span>, <span class="c007">.cmx</span>, <span class="c007">.ml</span>)
comprising the OCaml part of the library;
</li><li class="li-itemize">C object files (<span class="c007">.o</span>, <span class="c007">.a</span>, respectively, <span class="c007">.obj</span>, <span class="c007">.lib</span>)
comprising the C part of the library;
</li><li class="li-itemize">Support libraries for the C part (<span class="c007">-l</span><span class="c013">lib</span>).
</li></ul><p>
It generates the following outputs:
</p><ul class="itemize"><li class="li-itemize">
An OCaml bytecode library <span class="c007">.cma</span> incorporating the <span class="c007">.cmo</span> and
<span class="c007">.ml</span> OCaml files given as arguments, and automatically referencing the
C library generated with the C object files.
</li><li class="li-itemize">An OCaml native-code library <span class="c007">.cmxa</span> incorporating the <span class="c007">.cmx</span> and
<span class="c007">.ml</span> OCaml files given as arguments, and automatically referencing the
C library generated with the C object files.
</li><li class="li-itemize">If dynamic linking is supported on the target platform, a
<span class="c007">.so</span> (respectively, <span class="c007">.dll</span>) shared library built from the C object files given as arguments,
and automatically referencing the support libraries.
</li><li class="li-itemize">A C static library <span class="c007">.a</span>(respectively, <span class="c007">.lib</span>) built from the C object files.
</li></ul><p>
In addition, the following options are recognized:
</p><dl class="description"><dt class="dt-description">
<span class="c019"><span class="c007">-cclib</span>, <span class="c007">-ccopt</span>, <span class="c007">-I</span>, <span class="c007">-linkall</span></span></dt><dd class="dd-description">
These options are passed as is to <span class="c007">ocamlc</span> or <span class="c007">ocamlopt</span>.
See the documentation of these commands.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-rpath</span>, <span class="c007">-R</span>, <span class="c007">-Wl,-rpath</span>, <span class="c007">-Wl,-R</span></span></dt><dd class="dd-description">
These options are passed as is to the C compiler. Refer to the
documentation of the C compiler.
</dd><dt class="dt-description"><span class="c010">-custom</span></dt><dd class="dd-description"> Force the construction of a statically linked library
only, even if dynamic linking is supported.
</dd><dt class="dt-description"><span class="c010">-failsafe</span></dt><dd class="dd-description"> Fall back to building a statically linked library
if a problem occurs while building the shared library (e.g. some of
the support libraries are not available as shared libraries).
</dd><dt class="dt-description"><span class="c019"><span class="c007">-L</span><span class="c013">dir</span></span></dt><dd class="dd-description"> Add <span class="c013">dir</span> to the search path for support
libraries (<span class="c007">-l</span><span class="c013">lib</span>).
</dd><dt class="dt-description"><span class="c019"><span class="c007">-ocamlc</span> <span class="c013">cmd</span></span></dt><dd class="dd-description"> Use <span class="c013">cmd</span> instead of <span class="c007">ocamlc</span> to call
the bytecode compiler.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-ocamlopt</span> <span class="c013">cmd</span></span></dt><dd class="dd-description"> Use <span class="c013">cmd</span> instead of <span class="c007">ocamlopt</span> to call
the native-code compiler.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-o</span> <span class="c013">output</span></span></dt><dd class="dd-description"> Set the name of the generated OCaml library.
<span class="c007">ocamlmklib</span> will generate <span class="c013">output</span><span class="c007">.cma</span> and/or <span class="c013">output</span><span class="c007">.cmxa</span>.
If not specified, defaults to <span class="c007">a</span>.
</dd><dt class="dt-description"><span class="c019"><span class="c007">-oc</span> <span class="c013">outputc</span></span></dt><dd class="dd-description"> Set the name of the generated C library.
<span class="c007">ocamlmklib</span> will generate <span class="c007">lib</span><span class="c013">outputc</span><span class="c007">.so</span> (if shared
libraries are supported) and <span class="c007">lib</span><span class="c013">outputc</span><span class="c007">.a</span>.
If not specified, defaults to the output name given with <span class="c007">-o</span>.
</dd></dl>
<!--TOC paragraph id="sec460" Example-->
<h5 class="paragraph" id="sec460">Example</h5><!--SEC END --><p> Consider an OCaml interface to the standard <span class="c007">libz</span>
C library for reading and writing compressed files. Assume this
library resides in <span class="c007">/usr/local/zlib</span>. This interface is
composed of an OCaml part <span class="c007">zip.cmo</span>/<span class="c007">zip.cmx</span> and a C part <span class="c007">zipstubs.o</span>
containing the stub code around the <span class="c007">libz</span> entry points. The
following command builds the OCaml libraries <span class="c007">zip.cma</span> and <span class="c007">zip.cmxa</span>,
as well as the companion C libraries <span class="c007">dllzip.so</span> and <span class="c007">libzip.a</span>:
</p><pre>ocamlmklib -o zip zip.cmo zip.cmx zipstubs.o -lz -L/usr/local/zlib
</pre><p>If shared libraries are supported, this performs the following
commands:
</p><pre>ocamlc -a -o zip.cma zip.cmo -dllib -lzip \
        -cclib -lzip -cclib -lz -ccopt -L/usr/local/zlib
ocamlopt -a -o zip.cmxa zip.cmx -cclib -lzip \
        -cclib -lzip -cclib -lz -ccopt -L/usr/local/zlib
gcc -shared -o dllzip.so zipstubs.o -lz -L/usr/local/zlib
ar rc libzip.a zipstubs.o
</pre><p>If shared libraries are not supported, the following commands are
performed instead:
</p><pre>ocamlc -a -custom -o zip.cma zip.cmo -cclib -lzip \
        -cclib -lz -ccopt -L/usr/local/zlib
ocamlopt -a -o zip.cmxa zip.cmx -lzip \
        -cclib -lz -ccopt -L/usr/local/zlib
ar rc libzip.a zipstubs.o
</pre><p>Instead of building simultaneously the bytecode library, the
native-code library and the C libraries, <span class="c007">ocamlmklib</span> can be called
three times to build each separately. Thus,
</p><pre>ocamlmklib -o zip zip.cmo -lz -L/usr/local/zlib
</pre><p>builds the bytecode library <span class="c007">zip.cma</span>, and
</p><pre>ocamlmklib -o zip zip.cmx -lz -L/usr/local/zlib
</pre><p>builds the native-code library <span class="c007">zip.cmxa</span>, and
</p><pre>ocamlmklib -o zip zipstubs.o -lz -L/usr/local/zlib
</pre><p>builds the C libraries <span class="c007">dllzip.so</span> and <span class="c007">libzip.a</span>. Notice that the
support libraries (<span class="c007">-lz</span>) and the corresponding options
(<span class="c007">-L/usr/local/zlib</span>) must be given on all three invocations of <span class="c007">ocamlmklib</span>,
because they are needed at different times depending on whether shared
libraries are supported.
</p>
<!--TOC part id="sec461" The OCaml library-->
<table class="center"><tr><td><h1 class="part" id="sec461">Part&#XA0;IV<br>
The OCaml library</h1></td></tr>
</table><!--SEC END --><p>
<a id="p:library"></a>
</p>
<!--TOC chapter id="sec462" The core library-->
<h1 class="chapter" id="sec462">Chapter&#XA0;20&#XA0;&#XA0;The core library</h1><!--SEC END --><p> <a id="c:corelib"></a></p><!--NAME core.html-->
<p>This chapter describes the OCaml core library, which is
composed of declarations for built-in types and exceptions, plus
the module <span class="c007">Pervasives</span> that provides basic operations on these
built-in types. The <span class="c007">Pervasives</span> module is special in two
ways:
</p><ul class="itemize"><li class="li-itemize">
It is automatically linked with the user&#X2019;s object code files by
the <span class="c007">ocamlc</span> command (chapter&#XA0;<a href="#c%3Acamlc">8</a>).</li><li class="li-itemize">It is automatically &#X201C;opened&#X201D; when a compilation starts, or
when the toplevel system is launched. Hence, it is possible to use
unqualified identifiers to refer to the functions provided by the
<span class="c007">Pervasives</span> module, without adding a <span class="c007">open Pervasives</span> directive.
</li></ul><!--TOC section id="sec463" Conventions-->
<h2 class="section" id="sec463">Conventions</h2><!--SEC END --><p>The declarations of the built-in types and the components of module
<span class="c007">Pervasives</span> are printed one by one in typewriter font, followed by a
short comment. All library modules and the components they provide are
indexed at the end of this report.</p>
<!--TOC section id="sec464" Built-in types and predefined exceptions-->
<h2 class="section" id="sec464">20.1&#XA0;&#XA0;Built-in types and predefined exceptions</h2><!--SEC END --><p>The following built-in types and predefined exceptions are always
defined in the
compilation environment, but are not part of any module. As a
consequence, they can only be referred by their short names.</p><!--TOC subsection id="sec465" Built-in types-->
<h3 class="subsection" id="sec465">Built-in types</h3><!--SEC END --><pre> type int
</pre><p><a id="hevea_manual9"></a>
</p><blockquote class="quote">
The type of integer numbers.
</blockquote><pre> type char
</pre><p><a id="hevea_manual10"></a>
</p><blockquote class="quote">
The type of characters.
</blockquote><pre> type string
</pre><p><a id="hevea_manual11"></a>
</p><blockquote class="quote">
The type of character strings.
</blockquote><pre> type float
</pre><p><a id="hevea_manual12"></a>
</p><blockquote class="quote">
The type of floating-point numbers.
</blockquote><pre> type bool = false | true
</pre><p><a id="hevea_manual13"></a>
</p><blockquote class="quote">
The type of booleans (truth values).
</blockquote><pre> type unit = ()
</pre><p><a id="hevea_manual14"></a>
</p><blockquote class="quote">
The type of the unit value.
</blockquote><pre> type exn
</pre><p><a id="hevea_manual15"></a>
</p><blockquote class="quote">
The type of exception values.
</blockquote><pre> type 'a array
</pre><p><a id="hevea_manual16"></a>
</p><blockquote class="quote">
The type of arrays whose elements have type <span class="c007">'a</span>.
</blockquote><pre> type 'a list = [] | :: of 'a * 'a list
</pre><p><a id="hevea_manual17"></a>
</p><blockquote class="quote">
The type of lists whose elements have type <span class="c007">'a</span>.
</blockquote><pre>type 'a option = None | Some of 'a
</pre><p><a id="hevea_manual18"></a>
</p><blockquote class="quote">
The type of optional values of type <span class="c007">'a</span>.
</blockquote><pre>type int32
</pre><p><a id="hevea_manual19"></a>
</p><blockquote class="quote">
The type of signed 32-bit integers.
See the <span class="c007">Int32</span>[<a href="libref/Int32.html"><span class="c007">Int32</span></a>] module.
</blockquote><pre>type int64
</pre><p><a id="hevea_manual20"></a>
</p><blockquote class="quote">
The type of signed 64-bit integers.
See the <span class="c007">Int64</span>[<a href="libref/Int64.html"><span class="c007">Int64</span></a>] module.
</blockquote><pre>type nativeint
</pre><p><a id="hevea_manual21"></a>
</p><blockquote class="quote">
The type of signed, platform-native integers (32 bits on 32-bit
processors, 64 bits on 64-bit processors).
See the <span class="c007">Nativeint</span>[<a href="libref/Nativeint.html"><span class="c007">Nativeint</span></a>] module.
</blockquote><pre>type ('a, 'b, 'c, 'd, 'e, 'f) format6
</pre><p><a id="hevea_manual22"></a>
</p><blockquote class="quote">
The type of format strings. <span class="c007">'a</span> is the type of the parameters of
the format, <span class="c007">'f</span> is the result type for the <span class="c007">printf</span>-style
functions, <span class="c007">'b</span> is the type of the first argument given to <span class="c007">%a</span> and
<span class="c007">%t</span> printing functions (see module <span class="c007">Printf</span>[<a href="libref/Printf.html"><span class="c007">Printf</span></a>]),
<span class="c007">'c</span> is the result type of these functions, and also the type of the
argument transmitted to the first argument of <span class="c007">kprintf</span>-style
functions, <span class="c007">'d</span> is the result type for the <span class="c007">scanf</span>-style functions
(see module <span class="c007">Scanf</span>[<a href="libref/Scanf.html"><span class="c007">Scanf</span></a>]),
and <span class="c007">'e</span> is the type of the receiver function for the <span class="c007">scanf</span>-style
functions.
</blockquote><pre>type 'a lazy_t
</pre><p><a id="hevea_manual23"></a>
</p><blockquote class="quote">
This type is used to implement the <span class="c007">Lazy</span>[<a href="libref/Lazy.html"><span class="c007">Lazy</span></a>] module.
It should not be used directly.
</blockquote><!--TOC subsection id="sec466" Predefined exceptions-->
<h3 class="subsection" id="sec466">Predefined exceptions</h3><!--SEC END --><pre>exception Match_failure of (string * int * int)
</pre><p><a id="hevea_manual24"></a>
</p><blockquote class="quote">
Exception raised when none of the cases of a pattern-matching
apply. The arguments are the location of the <span class="c007">match</span> keyword
in the source code (file name, line number, column number).
</blockquote><pre>exception Assert_failure of (string * int * int)
</pre><p><a id="hevea_manual25"></a>
</p><blockquote class="quote">
Exception raised when an assertion fails. The arguments are
the location of the <span class="c007">assert</span> keyword in the source code
(file name, line number, column number).
</blockquote><pre>exception Invalid_argument of string
</pre><p><a id="hevea_manual26"></a>
</p><blockquote class="quote">
Exception raised by library functions to signal that the given
arguments do not make sense.
</blockquote><pre>exception Failure of string
</pre><p><a id="hevea_manual27"></a>
</p><blockquote class="quote">
Exception raised by library functions to signal that they are
undefined on the given arguments.
</blockquote><pre>exception Not_found
</pre><p><a id="hevea_manual28"></a>
</p><blockquote class="quote">
Exception raised by search functions when the desired object
could not be found.
</blockquote><pre>exception Out_of_memory
</pre><p><a id="hevea_manual29"></a>
</p><blockquote class="quote">
Exception raised by the garbage collector
when there is insufficient memory to complete the computation.
</blockquote><pre>exception Stack_overflow
</pre><p><a id="hevea_manual30"></a>
</p><blockquote class="quote">
Exception raised by the bytecode interpreter when the evaluation
stack reaches its maximal size. This often indicates infinite
or excessively deep recursion in the user&#X2019;s program.
(Not fully implemented by the native-code compiler;
see section&#XA0;<a href="#s%3Acompat-native-bytecode">11.5</a>.)
</blockquote><pre>exception Sys_error of string
</pre><p><a id="hevea_manual31"></a>
</p><blockquote class="quote">
Exception raised by the input/output functions to report
an operating system error.
</blockquote><pre>exception End_of_file
</pre><p><a id="hevea_manual32"></a>
</p><blockquote class="quote">
Exception raised by input functions to signal that the
end of file has been reached.
</blockquote><pre>exception Division_by_zero
</pre><p><a id="hevea_manual33"></a>
</p><blockquote class="quote">
Exception raised by integer division and remainder operations
when their second argument is zero.
</blockquote><pre>exception Sys_blocked_io
</pre><p><a id="hevea_manual34"></a>
</p><blockquote class="quote">
A special case of <span class="c007">Sys_error</span> raised when no I/O is possible
on a non-blocking I/O channel.
</blockquote><pre>exception Undefined_recursive_module of (string * int * int)
</pre><p><a id="hevea_manual35"></a>
</p><blockquote class="quote">
Exception raised when an ill-founded recursive module definition
is evaluated. (See section&#XA0;<a href="#s-recursive-modules">7.8</a>.)
The arguments are the location of the definition in the source code
(file name, line number, column number).
</blockquote>
<!--TOC section id="sec467" Module <span class="c007">Pervasives</span>: the initially opened module-->
<h2 class="section" id="sec467">20.2&#XA0;&#XA0;Module <span class="c007">Pervasives</span>: the initially opened module</h2><!--SEC END --><ul class="ftoc2"><li class="li-links">
<a href="libref/Pervasives.html">Module <span class="c007">Pervasives</span>: the initially opened module</a>
</li></ul>
<!--TOC chapter id="sec468" The standard library-->
<h1 class="chapter" id="sec468">Chapter&#XA0;21&#XA0;&#XA0;The standard library</h1><!--SEC END --><p> <a id="c:stdlib"></a></p><!--NAME stdlib.html-->
<p>This chapter describes the functions provided by the OCaml
standard library. The modules from the standard library are
automatically linked with the user&#X2019;s object code files by the <span class="c007">ocamlc</span>
command. Hence, these modules can be used in standalone programs without
having to add any <span class="c007">.cmo</span> file on the command line for the linking
phase. Similarly, in interactive use, these globals can be used in
toplevel phrases without having to load any <span class="c007">.cmo</span> file in memory.</p><p>Unlike the <span class="c007">Pervasives</span> module from the core library, the modules from the
standard library are not automatically &#X201C;opened&#X201D; when a compilation
starts, or when the toplevel system is launched. Hence it is necessary
to use qualified identifiers to refer to the functions provided by these
modules, or to add <span class="c007">open</span> directives.</p><p><a id="stdlib:top"></a></p><!--TOC section id="sec469" Conventions-->
<h2 class="section" id="sec469">Conventions</h2><!--SEC END --><p>For easy reference, the modules are listed below in alphabetical order
of module names.
For each module, the declarations from its signature are printed
one by one in typewriter font, followed by a short comment.
All modules and the identifiers they export are indexed at the end of
this report.</p><ul class="ftoc2"><li class="li-links">
<a href="libref/Arg.html">Module <span class="c007">Arg</span>: parsing of command line arguments</a>
</li><li class="li-links"><a href="libref/Array.html">Module <span class="c007">Array</span>: array operations</a>
</li><li class="li-links"><a href="libref/ArrayLabels.html">Module <span class="c007">ArrayLabels</span>: array operations (with labels)</a>
</li><li class="li-links"><a href="libref/Buffer.html">Module <span class="c007">Buffer</span>: extensible string buffers</a>
</li><li class="li-links"><a href="libref/Callback.html">Module <span class="c007">Callback</span>: registering OCaml values with the C runtime</a>
</li><li class="li-links"><a href="libref/Char.html">Module <span class="c007">Char</span>: character operations</a>
</li><li class="li-links"><a href="libref/Complex.html">Module <span class="c007">Complex</span>: Complex numbers</a>
</li><li class="li-links"><a href="libref/Digest.html">Module <span class="c007">Digest</span>: MD5 message digest</a>
</li><li class="li-links"><a href="libref/Filename.html">Module <span class="c007">Filename</span>: operations on file names</a>
</li><li class="li-links"><a href="libref/Format.html">Module <span class="c007">Format</span>: pretty printing</a>
</li><li class="li-links"><a href="libref/Gc.html">Module <span class="c007">Gc</span>: memory management control and statistics; finalised values</a>
</li><li class="li-links"><a href="libref/Genlex.html">Module <span class="c007">Genlex</span>: a generic lexical analyzer</a>
</li><li class="li-links"><a href="libref/Hashtbl.html">Module <span class="c007">Hashtbl</span>: hash tables and hash functions</a>
</li><li class="li-links"><a href="libref/Int32.html">Module <span class="c007">Int32</span>: 32-bit integers</a>
</li><li class="li-links"><a href="libref/Int64.html">Module <span class="c007">Int64</span>: 64-bit integers</a>
</li><li class="li-links"><a href="libref/Lazy.html">Module <span class="c007">Lazy</span>: deferred computations</a>
</li><li class="li-links"><a href="libref/Lexing.html">Module <span class="c007">Lexing</span>: the run-time library for lexers generated by <span class="c007">ocamllex</span></a>
</li><li class="li-links"><a href="libref/List.html">Module <span class="c007">List</span>: list operations</a>
</li><li class="li-links"><a href="libref/ListLabels.html">Module <span class="c007">ListLabels</span>: list operations (with labels)</a>
</li><li class="li-links"><a href="libref/Map.html">Module <span class="c007">Map</span>: association tables over ordered types</a>
</li><li class="li-links"><a href="libref/Marshal.html">Module <span class="c007">Marshal</span>: marshaling of data structures</a>
</li><li class="li-links"><a href="libref/MoreLabels.html">Module <span class="c007">MoreLabels</span>: Include modules <span class="c007">Hashtbl</span>, <span class="c007">Map</span> and <span class="c007">Set</span> with labels</a>
</li><li class="li-links"><a href="libref/Nativeint.html">Module <span class="c007">Nativeint</span>: processor-native integers</a>
</li><li class="li-links"><a href="libref/Oo.html">Module <span class="c007">Oo</span>: object-oriented extension</a>
</li><li class="li-links"><a href="libref/Parsing.html">Module <span class="c007">Parsing</span>: the run-time library for parsers generated by <span class="c007">ocamlyacc</span></a>
</li><li class="li-links"><a href="libref/Printexc.html">Module <span class="c007">Printexc</span>: facilities for printing exceptions</a>
</li><li class="li-links"><a href="libref/Printf.html">Module <span class="c007">Printf</span>: formatting printing functions</a>
</li><li class="li-links"><a href="libref/Queue.html">Module <span class="c007">Queue</span>: first-in first-out queues</a>
</li><li class="li-links"><a href="libref/Random.html">Module <span class="c007">Random</span>: pseudo-random number generator (PRNG)</a>
</li><li class="li-links"><a href="libref/Scanf.html">Module <span class="c007">Scanf</span>: formatted input functions</a>
</li><li class="li-links"><a href="libref/Set.html">Module <span class="c007">Set</span>: sets over ordered types</a>
</li><li class="li-links"><a href="libref/Sort.html">Module <span class="c007">Sort</span>: sorting and merging lists</a>
</li><li class="li-links"><a href="libref/Stack.html">Module <span class="c007">Stack</span>: last-in first-out stacks</a>
</li><li class="li-links"><a href="libref/StdLabels.html">Module <span class="c007">StdLabels</span>: Include modules <span class="c007">Array</span>, <span class="c007">List</span> and <span class="c007">String</span> with labels</a>
</li><li class="li-links"><a href="libref/Stream.html">Module <span class="c007">Stream</span>: streams and parsers</a>
</li><li class="li-links"><a href="libref/String.html">Module <span class="c007">String</span>: string operations</a>
</li><li class="li-links"><a href="libref/StringLabels.html">Module <span class="c007">StringLabels</span>: string operations (with labels)</a>
</li><li class="li-links"><a href="libref/Sys.html">Module <span class="c007">Sys</span>: system interface</a>
</li><li class="li-links"><a href="libref/Weak.html">Module <span class="c007">Weak</span>: arrays of weak pointers</a>
</li></ul>
<!--TOC chapter id="sec470" The unix library: Unix system calls-->
<h1 class="chapter" id="sec470">Chapter&#XA0;22&#XA0;&#XA0;The unix library: Unix system calls</h1><!--SEC END --><!--NAME libunix.html-->
<p>The <span class="c007">unix</span> library makes many Unix
system calls and system-related library functions available to
OCaml programs. This chapter describes briefly the functions
provided. Refer to sections 2&#XA0;and&#XA0;3 of the Unix manual for more
details on the behavior of these functions.</p><p>Not all functions are provided by all Unix variants. If some functions
are not available, they will raise <span class="c007">Invalid_arg</span> when called.</p><p>Programs that use the <span class="c007">unix</span> library must be linked as follows:
</p><pre>
        ocamlc <span class="c013">other options</span> unix.cma <span class="c013">other files</span>
        ocamlopt <span class="c013">other options</span> unix.cmxa <span class="c013">other files</span>
</pre><p>
For interactive use of the <span class="c007">unix</span> library, do:
</p><pre>
        ocamlmktop -o mytop unix.cma
        ./mytop
</pre><p>
or (if dynamic linking of C libraries is supported on your platform),
start <span class="c007">ocaml</span> and type <span class="c007">#load "unix.cma";;</span>.</p><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
A fairly complete emulation of the Unix system calls is provided in
the Windows version of OCaml. The end of this chapter gives
more information on the functions that are not supported under Windows.
</blockquote><ul class="ftoc2"><li class="li-links">
<a href="libref/Unix.html">Module <span class="c007">Unix</span>: Unix system calls</a>
</li><li class="li-links"><a href="libref/UnixLabels.html">Module <span class="c007">UnixLabels</span>: Labeled
Unix system calls</a>
</li></ul><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
The Cygwin port of OCaml fully implements all functions from
the Unix module. The native Win32 ports implement a subset of them.
Below is a list of the functions that are not implemented, or only
partially implemented, by the Win32 ports. Functions not mentioned are
fully implemented and behave as described previously in this chapter.<div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Functions</span></td><td class="c021"><span class="c019">Comment</span> </td></tr>
<tr><td class="c029">
<span class="c007">fork</span></td><td class="c028">not implemented, use <span class="c007">create_process</span> or threads </td></tr>
<tr><td class="c029"><span class="c007">wait</span></td><td class="c028">not implemented, use <span class="c007">waitpid</span> </td></tr>
<tr><td class="c029"><span class="c007">waitpid</span></td><td class="c028">can only wait for a given PID, not any child process </td></tr>
<tr><td class="c029"><span class="c007">getppid</span></td><td class="c028">not implemented (meaningless under Windows) </td></tr>
<tr><td class="c029"><span class="c007">nice</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">truncate</span>, <span class="c007">ftruncate</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">link</span>, <span class="c007">symlink</span>, <span class="c007">readlink</span></td><td class="c028">not implemented (no links under
Windows) </td></tr>
<tr><td class="c029"><span class="c007">access</span></td><td class="c028">execute permission <span class="c007">X_OK</span> cannot be tested,
it just tests for read permission instead </td></tr>
<tr><td class="c029"><span class="c007">fchmod</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">chown</span>, <span class="c007">fchown</span></td><td class="c028">not implemented (make no sense on a DOS
file system) </td></tr>
<tr><td class="c029"><span class="c007">umask</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">mkfifo</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">kill</span>, <span class="c007">pause</span></td><td class="c028">not implemented (no inter-process signals in Windows) </td></tr>
<tr><td class="c029"><span class="c007">alarm</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">times</span></td><td class="c028">partially implemented, will not report timings for child
processes </td></tr>
<tr><td class="c029"><span class="c007">getitimer</span>, <span class="c007">setitimer</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">getuid</span>, <span class="c007">getgid</span></td><td class="c028">always return 1 </td></tr>
<tr><td class="c029"><span class="c007">getgid</span>, <span class="c007">getegid</span>, <span class="c007">getgroups</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">setuid</span>, <span class="c007">setgid</span></td><td class="c028">not implemented </td></tr>
<tr><td class="c029"><span class="c007">getpwnam</span>, <span class="c007">getpwuid</span></td><td class="c028">always raise <span class="c007">Not_found</span> </td></tr>
<tr><td class="c029"><span class="c007">getgrnam</span>, <span class="c007">getgrgid</span></td><td class="c028">always raise <span class="c007">Not_found</span> </td></tr>
<tr><td class="c029">type <span class="c007">socket_domain</span></td><td class="c028">the domains <span class="c007">PF_UNIX</span> and <span class="c007">PF_INET6</span>
are not supported; <span class="c007">PF_INET</span> is fully supported </td></tr>
<tr><td class="c029"><span class="c007">establish_server</span></td><td class="c028">not implemented; use threads </td></tr>
<tr><td class="c029">terminal functions (<span class="c007">tc*</span>)</td><td class="c028">not implemented </td></tr>
</table></div></blockquote>
<!--TOC chapter id="sec471" The num library: arbitrary-precision rational arithmetic-->
<h1 class="chapter" id="sec471">Chapter&#XA0;23&#XA0;&#XA0;The num library: arbitrary-precision rational arithmetic</h1><!--SEC END --><!--NAME libnum.html-->
<p>The <span class="c007">num</span> library implements integer arithmetic and rational
arithmetic in arbitrary precision.</p><p>More documentation on the functions provided in this library can be found
in <em>The CAML Numbers Reference Manual</em> by
Val&#XE9;rie M&#XE9;nissier-Morain, technical report 141, INRIA, july 1992
(available electronically,
<a href="http://hal.inria.fr/docs/00/07/00/27/PDF/RT-0141.pdf"><span class="c007">http://hal.inria.fr/docs/00/07/00/27/PDF/RT-0141.pdf</span></a>).</p><p>Programs that use the <span class="c007">num</span> library must be linked as follows:
</p><pre>
        ocamlc <span class="c013">other options</span> nums.cma <span class="c013">other files</span>
        ocamlopt <span class="c013">other options</span> nums.cmxa <span class="c013">other files</span>
</pre><p>
For interactive use of the <span class="c007">nums</span> library, do:
</p><pre>
        ocamlmktop -o mytop nums.cma
        ./mytop
</pre><p>
or (if dynamic linking of C libraries is supported on your platform),
start <span class="c007">ocaml</span> and type <span class="c007">#load "nums.cma";;</span>.</p><ul class="ftoc2"><li class="li-links">
<a href="libref/Num.html">Module <span class="c007">Num</span>: operation on arbitrary-precision numbers</a>
</li><li class="li-links"><a href="libref/Big_int.html">Module <span class="c007">Big_int</span>: operations on arbitrary-precision integers</a>
</li><li class="li-links"><a href="libref/Arith_status.html">Module <span class="c007">Arith_status</span>: flags that control rational arithmetic</a>
</li></ul>
<!--TOC chapter id="sec472" The str library: regular expressions and string processing-->
<h1 class="chapter" id="sec472">Chapter&#XA0;24&#XA0;&#XA0;The str library: regular expressions and string processing</h1><!--SEC END --><!--NAME libstr.html-->
<p>The <span class="c007">str</span> library provides high-level string processing functions,
some based on regular expressions. It is intended to support the kind
of file processing that is usually performed with scripting languages
such as <span class="c007">awk</span>, <span class="c007">perl</span> or <span class="c007">sed</span>.</p><p>Programs that use the <span class="c007">str</span> library must be linked as follows:
</p><pre>
        ocamlc <span class="c013">other options</span> str.cma <span class="c013">other files</span>
        ocamlopt <span class="c013">other options</span> str.cmxa <span class="c013">other files</span>
</pre><p>
For interactive use of the <span class="c007">str</span> library, do:
</p><pre>
        ocamlmktop -o mytop str.cma
        ./mytop
</pre><p>
or (if dynamic linking of C libraries is supported on your platform),
start <span class="c007">ocaml</span> and type <span class="c007">#load "str.cma";;</span>.</p><ul class="ftoc2"><li class="li-links">
<a href="libref/Str.html">Module <span class="c007">Str</span>: regular expressions and string processing</a>
</li></ul>
<!--TOC chapter id="sec473" The threads library-->
<h1 class="chapter" id="sec473">Chapter&#XA0;25&#XA0;&#XA0;The threads library</h1><!--SEC END --><p>
<a id="c:threads"></a></p><!--NAME threads.html-->
<!--NAME libthreads.html-->
<p>The <span class="c007">threads</span> library allows concurrent programming in OCaml.
It provides multiple threads of control (also called lightweight
processes) that execute concurrently in the same memory space. Threads
communicate by in-place modification of shared data structures, or by
sending and receiving data on communication channels.</p><p>The <span class="c007">threads</span> library is implemented by time-sharing on a single
processor. It will not take advantage of multi-processor machines.
Using this library will therefore never make programs run
faster. However, many programs are easier to write when structured as
several communicating processes.</p><p>Two implementations of the <span class="c007">threads</span> library are available, depending
on the capabilities of the operating system:
</p><ul class="itemize"><li class="li-itemize">
System threads. This implementation builds on the OS-provided threads
facilities: POSIX 1003.1c threads for Unix, and Win32 threads for
Windows. When available, system threads support both bytecode and
native-code programs.
</li><li class="li-itemize">VM-level threads. This implementation performs time-sharing and
context switching at the level of the OCaml virtual machine (bytecode
interpreter). It is available on Unix systems, and supports only
bytecode programs. It cannot be used with native-code programs.
</li></ul><p>
Programs that use system threads must be linked as follows:
</p><pre>
        ocamlc -thread <span class="c013">other options</span> unix.cma threads.cma <span class="c013">other files</span>
        ocamlopt -thread <span class="c013">other options</span> unix.cmxa threads.cmxa <span class="c013">other files</span>
</pre><p>
Compilation units that use the <span class="c007">threads</span> library must also be compiled with
the <span class="c007">-thread</span> option (see chapter&#XA0;<a href="#c%3Acamlc">8</a>).</p><p>Programs that use VM-level threads must be compiled with the <span class="c007">-vmthread</span>
option to <span class="c007">ocamlc</span> (see chapter&#XA0;<a href="#c%3Acamlc">8</a>), and be linked as follows:
</p><pre>
        ocamlc -vmthread <span class="c013">other options</span> threads.cma <span class="c013">other files</span>
</pre><p>
Compilation units that use <span class="c007">threads</span> library must also be compiled with
the <span class="c007">-vmthread</span> option (see chapter&#XA0;<a href="#c%3Acamlc">8</a>).</p><ul class="ftoc2"><li class="li-links">
<a href="libref/Thread.html">Module <span class="c007">Thread</span>: lightweight threads</a>
</li><li class="li-links"><a href="libref/Mutex.html">Module <span class="c007">Mutex</span>: locks for mutual exclusion</a>
</li><li class="li-links"><a href="libref/Condition.html">Module <span class="c007">Condition</span>: condition variables to synchronize between threads</a>
</li><li class="li-links"><a href="libref/Event.html">Module <span class="c007">Event</span>: first-class synchronous communication</a>
</li><li class="li-links"><a href="libref/ThreadUnix.html">Module <span class="c007">ThreadUnix</span>: thread-compatible system calls</a>
</li></ul>
<!--TOC chapter id="sec474" The graphics library-->
<h1 class="chapter" id="sec474">Chapter&#XA0;26&#XA0;&#XA0;The graphics library</h1><!--SEC END --><!--NAME libgraph.html-->
<p>The <span class="c007">graphics</span> library provides a set of portable drawing primitives.
Drawing takes place
in a separate window that is created when <span class="c007">Graphics.open_graph</span> is called.</p><blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0;
This library is implemented under the X11 windows system. 
Programs that use the <span class="c007">graphics</span> library must be linked as follows:
<pre>
        ocamlc <span class="c013">other options</span> graphics.cma <span class="c013">other files</span>
</pre>
For interactive use of the <span class="c007">graphics</span> library, do:
<pre>
        ocamlmktop -o mytop graphics.cma
        ./mytop
</pre>
or (if dynamic linking of C libraries is supported on your platform),
start <span class="c007">ocaml</span> and type <span class="c007">#load "graphics.cma";;</span>.<p>Here are the graphics mode specifications supported by
<span class="c007">Graphics.open_graph</span> on
the X11 implementation of this library:
the argument to <span class="c007">Graphics.open_graph</span> has the format
<span class="c007">"</span><span class="c013">display-name geometry</span><span class="c007">"</span>,
where <span class="c013">display-name</span> is the name of the X-windows display to
connect to, and <span class="c013">geometry</span> is a standard X-windows geometry
specification. The two components are separated by a space. Either can
be omitted, or both. Examples:
</p><dl class="description"><dt class="dt-description">
<span class="c010">Graphics.open_graph "foo:0"</span></dt><dd class="dd-description">
connects to the display <span class="c007">foo:0</span> and creates a window with the default geometry
</dd><dt class="dt-description"><span class="c010">Graphics.open_graph "foo:0 300x100+50-0"</span></dt><dd class="dd-description">
connects to the display <span class="c007">foo:0</span> and creates a window 300 pixels wide
by 100 pixels tall, at location (50,0)
</dd><dt class="dt-description"><span class="c010">Graphics.open_graph " 300x100+50-0"</span></dt><dd class="dd-description">
connects to the default display and creates a window 300 pixels wide
by 100 pixels tall, at location (50,0)
</dd><dt class="dt-description"><span class="c010">Graphics.open_graph ""</span></dt><dd class="dd-description">
connects to the default display and creates a window with the default
geometry.
</dd></dl></blockquote><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
This library is available both for standalone compiled programs and
under the toplevel application <span class="c007">ocamlwin.exe</span>. For the latter, this
library must be loaded in-core by typing
<pre>        #load "graphics.cma";;
</pre></blockquote><p>The screen coordinates are interpreted as shown in the figure below.
Notice that the coordinate system used is the same as in mathematics:
<span class="c013">y</span> increases from the bottom of the screen to the top of the screen,
and angles are measured counterclockwise (in degrees).
Drawing is clipped to the screen.
</p><div class="center">
<img src="libgraph.gif">
</div><ul class="ftoc2"><li class="li-links">
<a href="libref/Graphics.html">Module <span class="c007">Graphics</span>: machine-independent graphics primitives</a>
</li></ul>
<!--TOC chapter id="sec475" The dynlink library: dynamic loading and linking of object files-->
<h1 class="chapter" id="sec475">Chapter&#XA0;27&#XA0;&#XA0;The dynlink library: dynamic loading and linking of object files</h1><!--SEC END --><!--NAME libdynlink.html-->
<p>The <span class="c007">dynlink</span> library supports type-safe dynamic loading and linking
of bytecode object files (<span class="c007">.cmo</span> and <span class="c007">.cma</span> files) in a running
bytecode program, or of native plugins (usually <span class="c007">.cmxs</span> files) in a
running native program. Type safety is ensured by limiting the set of
modules from the running program that the loaded object file can
access, and checking that the running program and the loaded object
file have been compiled against the same interfaces for these modules.
In native code, there are also some compatibility checks on the
implementations (to avoid errors with cross-module optimizations); it
might be useful to hide <span class="c007">.cmx</span> files when building native plugins so
that they remain independent of the implementation of modules in the
main program.</p><p>Programs that use the <span class="c007">dynlink</span> library simply need to link
<span class="c007">dynlink.cma</span> or <span class="c007">dynlink.cmxa</span> with their object files and other libraries. </p><ul class="ftoc2"><li class="li-links">
<a href="libref/Dynlink.html">Module <span class="c007">Dynlink</span>: dynamic loading of bytecode object files</a>
</li></ul>
<!--TOC chapter id="sec476" The LablTk library: Tcl/Tk GUI interface-->
<h1 class="chapter" id="sec476">Chapter&#XA0;28&#XA0;&#XA0;The LablTk library: Tcl/Tk GUI interface</h1><!--SEC END --><!--NAME liblabltk.html-->
<p>The <span class="c007">labltk</span> library provides access to the Tcl/Tk GUI from
OCaml programs. This interface is generated in an automated way, and
you should refer to Tcl/Tk books and man pages for detailed
information on the behavior of the numerous functions. We also suggest
to use <span class="c007">ocamlbrowser</span> to see the types of the various functions, that
are the best documentation for the library itself.</p><p><br>
Programs that use the <span class="c007">labltk</span> library must be linked as follows:
</p><pre>
        ocamlc <span class="c013">other options</span> -I +labltk labltk.cma <span class="c013">other files</span>
        ocamlopt <span class="c013">other options</span> -I +labltk labltk.cmxa <span class="c013">other files</span>
</pre><blockquote class="quote"><span class="c011">Unix:</span>&#XA0;&#XA0;
The <span class="c007">labltk</span> library is available for any system with Tcl/Tk installed,
starting from Tcl 7.5/Tk 4.1 up to Tcl/Tk 8.4. Beware that some beta
versions may have compatibility problems.<p>If the library was not compiled correctly, try to run again the
<span class="c007">configure</span> script with the option <span class="c007">-tkdefs</span> <span class="c013">switches</span>,
where <span class="c013">switches</span> is a list of C-style inclusion paths leading to
the right <span class="c007">tcl.h</span> and <span class="c007">tk.h</span>, for instance
<span class="c007">"-I/usr/local/include/tcl8.4 -I/usr/local/include/tk8.4"</span>.</p><p>A script is installed, to make easier the use of the <span class="c007">labltk</span>
library as toplevel.
</p><dl class="description"><dt class="dt-description">
<span class="c010">labltk</span></dt><dd class="dd-description">
This is a toplevel including the <span class="c007">labltk</span> library, and the path is
already set as to allow the use of the various modules. It also
includes code for the Unix and Str libraries. You can use it
in place of <span class="c007">ocaml</span>.
</dd></dl></blockquote><blockquote class="quote"><span class="c011">Windows:</span>&#XA0;&#XA0;
The <span class="c007">labltk</span> library has been precompiled for use with Tcl/Tk 8.4.
You must first have it installed on your system.
It can be downloaded from <br>
<span class="c007">http://www.activestate.com/products/ActiveTcl/</span>.
After installing it, you must put the dynamically loaded libraries
<span class="c007">tcl84.dll</span> and <span class="c007">tk84.dll</span> (from the <span class="c007">bin</span> directory of the Tcl
installation) in a directory included in you path.<p>No toplevel is available, but you can load the library from the
standard toplevel with the following commands.
</p><blockquote class="quote">
<pre># #directory "+labltk";;
# #load "labltk.cma";;
</pre></blockquote><p>
You can also load it directly from the command line.
</p><blockquote class="quote">
<pre>C:\ocaml\bin&gt; ocaml -I +labltk labltk.cma
</pre></blockquote></blockquote><p>The <span class="c007">labltk</span> library is composed of a large number of modules.
</p><blockquote class="quote">
<pre>Bell                Imagebitmap         Place
Button              Imagephoto          Radiobutton
Canvas              Label               Scale
Checkbutton         Listbox             Scrollbar
Clipboard           Menu                Selection
Dialog              Menubutton          Text
Entry               Message             Tk
Focus               Option              Tkwait
Frame               Optionmenu          Toplevel
Grab                Pack                Winfo
Grid                Palette             Wm
</pre></blockquote><p>Giving a detailed account of each of these module would be impractical
here. We will just present some of the basic functions in the module
<span class="c007">Tk</span>. Note that for most other modules information can be found in the
Tcl <span class="c007">man</span> page of their name.</p><ul class="ftoc2"><li class="li-links">
<a href="libref/Tk.html">The <span class="c007">Tk</span> library: Basic functions and types for LablTk</a>
</li></ul>
<!--TOC chapter id="sec477" The bigarray library-->
<h1 class="chapter" id="sec477">Chapter&#XA0;29&#XA0;&#XA0;The bigarray library</h1><!--SEC END --><!--NAME libbigarray.html-->
<p>The <span class="c007">bigarray</span> library implements large, multi-dimensional, numerical
arrays. These arrays are called &#X201C;big arrays&#X201D; to distinguish them
from the standard OCaml arrays described in
<a href="libref/Array.html">Module <span class="c007">Array</span></a>.
The main differences between &#X201C;big arrays&#X201D; and standard OCaml arrays
are as follows:
</p><ul class="itemize"><li class="li-itemize">
Big arrays are not limited in size, unlike OCaml arrays
(<span class="c007">float array</span> are limited to 2097151 elements on a 32-bit platform,
other <span class="c007">array</span> types to 4194303 elements).
</li><li class="li-itemize">Big arrays are multi-dimensional. Any number of dimensions
between 1 and 16 is supported. In contrast, OCaml arrays are
mono-dimensional and require encoding multi-dimensional arrays as
arrays of arrays.
</li><li class="li-itemize">Big arrays can only contain integers and floating-point
numbers, while OCaml arrays can contain arbitrary OCaml data types.
However, big arrays provide more space-efficient storage of integer
and floating-point elements, in particular because they support
&#X201C;small&#X201D; types such as single-precision floats and 8 and 16-bit
integers, in addition to the standard OCaml types of double-precision
floats and 32 and 64-bit integers.
</li><li class="li-itemize">The memory layout of big arrays is entirely compatible with that
of arrays in C and Fortran, allowing large arrays to be passed back
and forth between OCaml code and C / Fortran code with no data copying
at all.
</li><li class="li-itemize">Big arrays support interesting high-level operations that normal
arrays do not provide efficiently, such as extracting sub-arrays and
&#X201C;slicing&#X201D; a multi-dimensional array along certain dimensions, all
without any copying.
</li></ul><p>
Programs that use the <span class="c007">bigarray</span> library must be linked as follows:
</p><pre>
        ocamlc <span class="c013">other options</span> bigarray.cma <span class="c013">other files</span>
        ocamlopt <span class="c013">other options</span> bigarray.cmxa <span class="c013">other files</span>
</pre><p>
For interactive use of the <span class="c007">bigarray</span> library, do:
</p><pre>
        ocamlmktop -o mytop bigarray.cma
        ./mytop
</pre><p>
or (if dynamic linking of C libraries is supported on your platform),
start <span class="c007">ocaml</span> and type <span class="c007">#load "bigarray.cma";;</span>.</p>
<!--TOC section id="sec478" Module <span class="c007">Bigarray</span>: large, multi-dimensional, numerical arrays-->
<h2 class="section" id="sec478">29.1&#XA0;&#XA0;Module <span class="c007">Bigarray</span>: large, multi-dimensional, numerical arrays</h2><!--SEC END --><ul class="ftoc2"><li class="li-links">
<a href="libref/Bigarray.html">Module <span class="c007">Bigarray</span></a>
</li></ul>
<!--TOC section id="sec479" Big arrays in the OCaml-C interface-->
<h2 class="section" id="sec479">29.2&#XA0;&#XA0;Big arrays in the OCaml-C interface</h2><!--SEC END --><p>C stub code that interface C or Fortran code with OCaml code, as
described in chapter&#XA0;<a href="#c%3Aintf-c">19</a>, can exploit big arrays as
follows.</p>
<!--TOC subsection id="sec480" Include file-->
<h3 class="subsection" id="sec480">29.2.1&#XA0;&#XA0;Include file</h3><!--SEC END --><p>The include file <span class="c007">&lt;caml/bigarray.h&gt;</span> must be included in the C stub
file. It declares the functions, constants and macros discussed
below.</p>
<!--TOC subsection id="sec481" Accessing an OCaml bigarray from C or Fortran-->
<h3 class="subsection" id="sec481">29.2.2&#XA0;&#XA0;Accessing an OCaml bigarray from C or Fortran</h3><!--SEC END --><p>If <span class="c013">v</span> is a OCaml <span class="c007">value</span> representing a big array, the expression
<span class="c007">Caml_ba_data_val(</span><span class="c013">v</span><span class="c007">)</span> returns a pointer to the data part of the array.
This pointer is of type <span class="c007">void *</span> and can be cast to the appropriate C
type for the array (e.g. <span class="c007">double []</span>, <span class="c007">char [][10]</span>, etc).</p><p>Various characteristics of the OCaml big array can be consulted from C
as follows:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">C expression</span></td><td class="c021"><span class="c019">Returns</span> </td></tr>
<tr><td class="c023">
<span class="c007">Caml_ba_array_val(</span><span class="c013">v</span><span class="c007">)-&gt;num_dims</span></td><td class="c023">number of dimensions </td></tr>
<tr><td class="c023"><span class="c007">Caml_ba_array_val(</span><span class="c013">v</span><span class="c007">)-&gt;dim[</span><span class="c013">i</span><span class="c007">]</span></td><td class="c023"><span class="c013">i</span>-th dimension </td></tr>
<tr><td class="c023"><span class="c007">Caml_ba_array_val(</span><span class="c013">v</span><span class="c007">)-&gt;flags &amp; BIGARRAY_KIND_MASK</span></td><td class="c023">kind of array elements </td></tr>
</table></div><p>
The kind of array elements is one of the following constants:
</p><div class="center"><table class="c001 cellpadding1" border=1><tr><td class="c021"><span class="c019">Constant</span></td><td class="c021"><span class="c019">Element kind</span> </td></tr>
<tr><td class="c023">
<span class="c007">CAML_BA_FLOAT32</span></td><td class="c023">32-bit single-precision floats </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_FLOAT64</span></td><td class="c023">64-bit double-precision floats </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_SINT8</span></td><td class="c023">8-bit signed integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_UINT8</span></td><td class="c023">8-bit unsigned integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_SINT16</span></td><td class="c023">16-bit signed integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_UINT16</span></td><td class="c023">16-bit unsigned integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_INT32</span></td><td class="c023">32-bit signed integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_INT64</span></td><td class="c023">64-bit signed integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_CAML_INT</span></td><td class="c023">31- or 63-bit signed integers </td></tr>
<tr><td class="c023"><span class="c007">CAML_BA_NATIVE_INT</span></td><td class="c023">32- or 64-bit (platform-native) integers </td></tr>
</table></div><p>
The following example shows the passing of a two-dimensional big array
to a C function and a Fortran function.
</p><pre>    extern void my_c_function(double * data, int dimx, int dimy);
    extern void my_fortran_function_(double * data, int * dimx, int * dimy);

    value caml_stub(value bigarray)
    {
      int dimx = Caml_ba_array_val(bigarray)-&gt;dim[0];
      int dimy = Caml_ba_array_val(bigarray)-&gt;dim[1];
      /* C passes scalar parameters by value */
      my_c_function(Caml_ba_data_val(bigarray), dimx, dimy);
      /* Fortran passes all parameters by reference */
      my_fortran_function_(Caml_ba_data_val(bigarray), &amp;dimx, &amp;dimy);
      return Val_unit;
    }
</pre>
<!--TOC subsection id="sec482" Wrapping a C or Fortran array as an OCaml big array-->
<h3 class="subsection" id="sec482">29.2.3&#XA0;&#XA0;Wrapping a C or Fortran array as an OCaml big array</h3><!--SEC END --><p>A pointer <span class="c013">p</span> to an already-allocated C or Fortran array can be
wrapped and returned to OCaml as a big array using the <span class="c007">caml_ba_alloc</span>
or <span class="c007">caml_ba_alloc_dims</span> functions.
</p><ul class="itemize"><li class="li-itemize">
<span class="c007">caml_ba_alloc(</span><span class="c013">kind</span> <span class="c007">|</span> <span class="c013">layout</span>, <span class="c013">numdims</span>, <span class="c013">p</span>, <span class="c013">dims</span><span class="c007">)</span><p>Return an OCaml big array wrapping the data pointed to by <span class="c013">p</span>.
<span class="c013">kind</span> is the kind of array elements (one of the <span class="c007">CAML_BA_</span>
kind constants above). <span class="c013">layout</span> is <span class="c007">CAML_BA_C_LAYOUT</span> for an
array with C layout and <span class="c007">CAML_BA_FORTRAN_LAYOUT</span> for an array with
Fortran layout. <span class="c013">numdims</span> is the number of dimensions in the
array. <span class="c013">dims</span> is an array of <span class="c013">numdims</span> long integers, giving
the sizes of the array in each dimension.</p></li><li class="li-itemize"><span class="c007">caml_ba_alloc_dims(</span><span class="c013">kind</span> <span class="c007">|</span> <span class="c013">layout</span>, <span class="c013">numdims</span>,
<span class="c013">p</span>, <span class="c007">(long) </span><span class="c013">dim</span><sub>1</sub>, <span class="c007">(long) </span><span class="c013">dim</span><sub>2</sub>, &#X2026;, <span class="c007">(long) </span><span class="c013">dim</span><sub><span class="c013">numdims</span></sub><span class="c007">)</span><p>Same as <span class="c007">caml_ba_alloc</span>, but the sizes of the array in each dimension
are listed as extra arguments in the function call, rather than being
passed as an array.
</p></li></ul><p>
The following example illustrates how statically-allocated C and
Fortran arrays can be made available to OCaml.
</p><pre>    extern long my_c_array[100][200];
    extern float my_fortran_array_[300][400];

    value caml_get_c_array(value unit)
    {
      long dims[2];
      dims[0] = 100; dims[1] = 200;
      return caml_ba_alloc(CAML_BA_NATIVE_INT | CAML_BA_C_LAYOUT,
                           2, my_c_array, dims);
    }

    value caml_get_fortran_array(value unit)
    {
      return caml_ba_alloc_dims(CAML_BA_FLOAT32 | CAML_BA_FORTRAN_LAYOUT,
                                2, my_fortran_array_, 300L, 400L);
    }
</pre>
<!--TOC part id="sec483" Appendix-->
<table class="center"><tr><td><h1 class="part" id="sec483">Part&#XA0;V<br>
Appendix</h1></td></tr>
</table><!--SEC END --><p>
<a id="p:appendix"></a></p><ul class="ftoc2"><li class="li-links">
<a href="libref/index_modules.html">Index of modules</a>
</li><li class="li-links"><a href="libref/index_module_types.html">Index of module types</a>
</li><li class="li-links"><a href="libref/index_types.html">Index of types</a>
</li><li class="li-links"><a href="libref/index_exceptions.html">Index of exceptions</a>
</li><li class="li-links"><a href="libref/index_values.html">Index of values</a>
</li></ul><!--TOC chapter id="sec484" Index of keywords-->
<h1 class="chapter" id="sec484">Index of keywords</h1><!--SEC END --><p></p><table class="c002 cellpading0"><tr><td class="c027"><ul class="indexenv"><li class="li-indexenv">
<span class="c007">and</span>, see <span class="c013"><span class="c007">let</span>, <span class="c007">type</span>, <span class="c007">class</span></span>, <a href="#hevea_manual.kwd84">6.9.2</a>, <a href="#hevea_manual.kwd109">6.9.3</a>, <a href="#hevea_manual.kwd113">6.9.4</a>, <a href="#hevea_manual.kwd117">6.9.5</a>
</li><li class="li-indexenv"><span class="c007">as</span>, <a href="#hevea_manual.kwd2">6.4</a>, <a href="#hevea_manual.kwd3">6.4</a>, <a href="#hevea_manual.kwd4">6.4</a>, <a href="#hevea_manual.kwd5">6.6</a>, <a href="#hevea_manual.kwd6">6.6</a>, <a href="#hevea_manual.kwd7">6.6</a>, <a href="#hevea_manual.kwd86">6.9.2</a>, <a href="#hevea_manual.kwd95">6.9.2</a>
</li><li class="li-indexenv"><span class="c007">assert</span>, <a href="#hevea_manual.kwd173">7.5</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">begin</span>, <a href="#hevea_manual.kwd27">6.7</a>, <a href="#hevea_manual.kwd39">6.7.1</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">class</span>, <a href="#hevea_manual.kwd108">6.9.3</a>, <a href="#hevea_manual.kwd112">6.9.4</a>, <a href="#hevea_manual.kwd115">6.9.5</a>, <a href="#hevea_manual.kwd127">6.10</a>, <a href="#hevea_manual.kwd137">6.10.2</a>, <a href="#hevea_manual.kwd138">6.10.2</a>, <a href="#hevea_manual.kwd154">6.11</a>, <a href="#hevea_manual.kwd164">6.11.2</a>, <a href="#hevea_manual.kwd165">6.11.2</a>
</li><li class="li-indexenv"><span class="c007">constraint</span>, <a href="#hevea_manual.kwd55">6.8.1</a>, <a href="#hevea_manual.kwd57">6.8.1</a>, <a href="#hevea_manual.kwd67">6.9.1</a>, <a href="#hevea_manual.kwd77">6.9.1</a>, <a href="#hevea_manual.kwd92">6.9.2</a>, <a href="#hevea_manual.kwd106">6.9.2</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">do</span>, see <span class="c013"><span class="c007">while</span>, <span class="c007">for</span></span>
</li><li class="li-indexenv"><span class="c007">done</span>, see <span class="c013"><span class="c007">while</span>, <span class="c007">for</span></span>
</li><li class="li-indexenv"><span class="c007">downto</span>, see <span class="c009">for</span>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">else</span>, see <span class="c009">if</span>
</li><li class="li-indexenv"><span class="c007">end</span>, <a href="#hevea_manual.kwd28">6.7</a>, <a href="#hevea_manual.kwd40">6.7.1</a>, <a href="#hevea_manual.kwd60">6.9.1</a>, <a href="#hevea_manual.kwd79">6.9.2</a>, <a href="#hevea_manual.kwd120">6.10</a>, <a href="#hevea_manual.kwd132">6.10.2</a>, <a href="#hevea_manual.kwd148">6.11</a>, <a href="#hevea_manual.kwd159">6.11.2</a>
</li><li class="li-indexenv"><span class="c007">exception</span>, <a href="#hevea_manual.kwd58">6.8.2</a>, <a href="#hevea_manual.kwd126">6.10</a>, <a href="#hevea_manual.kwd136">6.10.2</a>, <a href="#hevea_manual.kwd153">6.11</a>, <a href="#hevea_manual.kwd163">6.11.2</a>
</li><li class="li-indexenv"><span class="c007">external</span>, <a href="#hevea_manual.kwd124">6.10</a>, <a href="#hevea_manual.kwd134">6.10.2</a>, <a href="#hevea_manual.kwd151">6.11</a>, <a href="#hevea_manual.kwd161">6.11.2</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">false</span>, <a href="#hevea_manual.kwd0">6.3</a>
</li><li class="li-indexenv"><span class="c007">for</span>, <a href="#hevea_manual.kwd20">6.7</a>, <a href="#hevea_manual.kwd49">6.7.2</a>
</li><li class="li-indexenv"><span class="c007">fun</span>, <a href="#hevea_manual.kwd14">6.7</a>, <a href="#hevea_manual.kwd34">6.7</a>, <a href="#hevea_manual.kwd42">6.7.1</a>, <a href="#hevea_manual.kwd80">6.9.2</a>, <a href="#hevea_manual.kwd185">7.13</a>
</li><li class="li-indexenv"><span class="c007">function</span>, <a href="#hevea_manual.kwd13">6.7</a>, <a href="#hevea_manual.kwd35">6.7</a>, <a href="#hevea_manual.kwd41">6.7.1</a>
</li><li class="li-indexenv"><span class="c007">functor</span>, <a href="#hevea_manual.kwd121">6.10</a>, <a href="#hevea_manual.kwd145">6.10.3</a>, <a href="#hevea_manual.kwd149">6.11</a>, <a href="#hevea_manual.kwd172">6.11.3</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">if</span>, <a href="#hevea_manual.kwd23">6.7</a>, <a href="#hevea_manual.kwd33">6.7</a>, <a href="#hevea_manual.kwd45">6.7.2</a>
</li><li class="li-indexenv"><span class="c007">in</span>, see <span class="c009">let</span>, <a href="#hevea_manual.kwd83">6.9.2</a>
</li><li class="li-indexenv"><span class="c007">include</span>, <a href="#hevea_manual.kwd130">6.10</a>, <a href="#hevea_manual.kwd144">6.10.2</a>, <a href="#hevea_manual.kwd157">6.11</a>, <a href="#hevea_manual.kwd171">6.11.2</a>, <a href="#hevea_manual.kwd191">7.15</a>
</li><li class="li-indexenv"><span class="c007">inherit</span>, <a href="#hevea_manual.kwd61">6.9.1</a>, <a href="#hevea_manual.kwd68">6.9.1</a>, <a href="#hevea_manual.kwd85">6.9.2</a>, <a href="#hevea_manual.kwd94">6.9.2</a>
</li><li class="li-indexenv"><span class="c007">inherit!</span>, <a href="#hevea_manual.kwd197">7.17</a>
</li><li class="li-indexenv"><span class="c007">initializer</span>, <a href="#hevea_manual.kwd93">6.9.2</a>, <a href="#hevea_manual.kwd107">6.9.2</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">lazy</span>, <a href="#hevea_manual.kwd174">7.6</a>
</li><li class="li-indexenv"><span class="c007">let</span>, <a href="#hevea_manual.kwd11">6.7</a>, <a href="#hevea_manual.kwd38">6.7</a>, <a href="#hevea_manual.kwd44">6.7.1</a>, <a href="#hevea_manual.kwd81">6.9.2</a>, <a href="#hevea_manual.kwd150">6.11</a>, <a href="#hevea_manual.kwd160">6.11.2</a>, <a href="#hevea_manual.kwd175">7.7</a>, <a href="#hevea_manual.kwd181">7.10</a>, <a href="#hevea_manual.kwd183">7.12</a>
<br>
<br>
</li></ul></td><td class="c027"><ul class="indexenv"><li class="li-indexenv"><span class="c007">match</span>, <a href="#hevea_manual.kwd26">6.7</a>, <a href="#hevea_manual.kwd36">6.7</a>, <a href="#hevea_manual.kwd46">6.7.2</a>, <a href="#hevea_manual.kwd200">7.19</a>
</li><li class="li-indexenv"><span class="c007">method</span>, <a href="#hevea_manual.kwd64">6.9.1</a>, <a href="#hevea_manual.kwd72">6.9.1</a>, <a href="#hevea_manual.kwd75">6.9.1</a>, <a href="#hevea_manual.kwd89">6.9.2</a>, <a href="#hevea_manual.kwd101">6.9.2</a>, <a href="#hevea_manual.kwd104">6.9.2</a>
</li><li class="li-indexenv"><span class="c007">method!</span>, <a href="#hevea_manual.kwd195">7.17</a>
</li><li class="li-indexenv"><span class="c007">module</span>, <a href="#hevea_manual.kwd128">6.10</a>, <a href="#hevea_manual.kwd140">6.10.2</a>, <a href="#hevea_manual.kwd142">6.10.2</a>, <a href="#hevea_manual.kwd155">6.11</a>, <a href="#hevea_manual.kwd167">6.11.2</a>, <a href="#hevea_manual.kwd169">6.11.2</a>, <a href="#hevea_manual.kwd176">7.7</a>, <a href="#hevea_manual.kwd177">7.8</a>, <a href="#hevea_manual.kwd186">7.14</a>, <a href="#hevea_manual.kwd189">7.15</a>, <a href="#hevea_manual.kwd193">7.16</a>
</li><li class="li-indexenv"><span class="c007">mutable</span>, <a href="#hevea_manual.kwd54">6.8.1</a>, <a href="#hevea_manual.kwd56">6.8.1</a>, <a href="#hevea_manual.kwd63">6.9.1</a>, <a href="#hevea_manual.kwd70">6.9.1</a>, <a href="#hevea_manual.kwd88">6.9.2</a>, <a href="#hevea_manual.kwd97">6.9.2</a>, <a href="#hevea_manual.kwd100">6.9.2</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">new</span>, <a href="#hevea_manual.kwd30">6.7</a>, <a href="#hevea_manual.kwd51">6.7.5</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">object</span>, <a href="#hevea_manual.kwd31">6.7</a>, <a href="#hevea_manual.kwd52">6.7.5</a>, <a href="#hevea_manual.kwd59">6.9.1</a>, <a href="#hevea_manual.kwd78">6.9.2</a>
</li><li class="li-indexenv"><span class="c007">of</span>, see <span class="c013"><span class="c007">type</span>, <span class="c007">exception</span></span>
</li><li class="li-indexenv"><span class="c007">open</span>, <a href="#hevea_manual.kwd129">6.10</a>, <a href="#hevea_manual.kwd143">6.10.2</a>, <a href="#hevea_manual.kwd156">6.11</a>, <a href="#hevea_manual.kwd170">6.11.2</a>, <a href="#hevea_manual.kwd182">7.10</a>
</li><li class="li-indexenv"><span class="c007">open!</span>, <a href="#hevea_manual.kwd198">7.18</a>
</li><li class="li-indexenv"><span class="c007">or</span>, <a href="#hevea_manual.kwd25">6.7</a>, <a href="#hevea_manual.kwd32">6.7</a>, <a href="#hevea_manual.kwd47">6.7.2</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">private</span>, <a href="#hevea_manual.kwd65">6.9.1</a>, <a href="#hevea_manual.kwd73">6.9.1</a>, <a href="#hevea_manual.kwd76">6.9.1</a>, <a href="#hevea_manual.kwd90">6.9.2</a>, <a href="#hevea_manual.kwd102">6.9.2</a>, <a href="#hevea_manual.kwd105">6.9.2</a>, <a href="#hevea_manual.kwd179">7.9</a>, <a href="#hevea_manual.kwd180">7.9.3</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">rec</span>, see <span class="c009">let</span>, <a href="#hevea_manual.kwd82">6.9.2</a>, <a href="#hevea_manual.kwd178">7.8</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">sig</span>, <a href="#hevea_manual.kwd119">6.10</a>, <a href="#hevea_manual.kwd131">6.10.2</a>
</li><li class="li-indexenv"><span class="c007">struct</span>, <a href="#hevea_manual.kwd147">6.11</a>, <a href="#hevea_manual.kwd158">6.11.2</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">then</span>, see <span class="c009">if</span>
</li><li class="li-indexenv"><span class="c007">to</span>, see <span class="c009">for</span>
</li><li class="li-indexenv"><span class="c007">true</span>, <a href="#hevea_manual.kwd1">6.3</a>
</li><li class="li-indexenv"><span class="c007">try</span>, <a href="#hevea_manual.kwd12">6.7</a>, <a href="#hevea_manual.kwd37">6.7</a>, <a href="#hevea_manual.kwd50">6.7.2</a>
</li><li class="li-indexenv"><span class="c007">type</span>, <a href="#hevea_manual.kwd53">6.8.1</a>, <a href="#hevea_manual.kwd116">6.9.5</a>, <a href="#hevea_manual.kwd125">6.10</a>, <a href="#hevea_manual.kwd135">6.10.2</a>, <a href="#hevea_manual.kwd139">6.10.2</a>, <a href="#hevea_manual.kwd141">6.10.2</a>, <a href="#hevea_manual.kwd152">6.11</a>, <a href="#hevea_manual.kwd162">6.11.2</a>, <a href="#hevea_manual.kwd166">6.11.2</a>, <a href="#hevea_manual.kwd168">6.11.2</a>, <a href="#hevea_manual.kwd184">7.13</a>, <a href="#hevea_manual.kwd190">7.15</a>, <a href="#hevea_manual.kwd194">7.16</a>, <a href="#hevea_manual.kwd199">7.19</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">val</span>, <a href="#hevea_manual.kwd62">6.9.1</a>, <a href="#hevea_manual.kwd69">6.9.1</a>, <a href="#hevea_manual.kwd87">6.9.2</a>, <a href="#hevea_manual.kwd96">6.9.2</a>, <a href="#hevea_manual.kwd99">6.9.2</a>, <a href="#hevea_manual.kwd123">6.10</a>, <a href="#hevea_manual.kwd133">6.10.2</a>, <a href="#hevea_manual.kwd187">7.14</a>
</li><li class="li-indexenv"><span class="c007">val!</span>, <a href="#hevea_manual.kwd196">7.17</a>
</li><li class="li-indexenv"><span class="c007">virtual</span>, <a href="#hevea_manual.kwd66">6.9.1</a>, <a href="#hevea_manual.kwd71">6.9.1</a>, <a href="#hevea_manual.kwd74">6.9.1</a>, <a href="#hevea_manual.kwd91">6.9.2</a>, <a href="#hevea_manual.kwd98">6.9.2</a>, <a href="#hevea_manual.kwd103">6.9.2</a>, <a href="#hevea_manual.kwd110">6.9.3</a>, <a href="#hevea_manual.kwd111">6.9.3</a>, <a href="#hevea_manual.kwd114">6.9.4</a>, <a href="#hevea_manual.kwd118">6.9.5</a>
<br>
<br>
</li><li class="li-indexenv"><span class="c007">when</span>, <a href="#hevea_manual.kwd29">6.7</a>, <a href="#hevea_manual.kwd43">6.7.1</a>
</li><li class="li-indexenv"><span class="c007">while</span>, <a href="#hevea_manual.kwd48">6.7.2</a>
</li><li class="li-indexenv"><span class="c007">with</span>, see <span class="c013"><span class="c007">match</span>, <span class="c007">try</span></span>, <a href="#hevea_manual.kwd122">6.10</a>, <a href="#hevea_manual.kwd146">6.10.4</a>, <a href="#hevea_manual.kwd188">7.14</a>, <a href="#hevea_manual.kwd192">7.16</a>
</li></ul></td></tr>
</table><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H<span class="c012"><sup>E</sup></span>V<span class="c012"><sup>E</sup></span>A</em></a><em>.</em></blockquote></body>
</html>
